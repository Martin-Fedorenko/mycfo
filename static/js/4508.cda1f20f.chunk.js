"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4508],{3665:(e,r,n)=>{n.d(r,{A:()=>a});var s=n(14057),o=n(70579);const a=(0,s.A)((0,o.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},22950:(e,r,n)=>{n.d(r,{A:()=>a});var s=n(14057),o=n(70579);const a=(0,s.A)((0,o.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},28259:(e,r,n)=>{n.d(r,{A:()=>j});var s=n(89379),o=n(80045),a=n(65043),l=n(58387),i=n(31807),c=n(58128),t=n(28301),d=n(79857),u=n(86061);function h(e){return(0,u.Ay)("MuiTableContainer",e)}(0,d.A)("MuiTableContainer",["root"]);var A=n(70579);const x=["className","component"],m=(0,c.Ay)("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),j=a.forwardRef(function(e,r){const n=(0,t.b)({props:e,name:"MuiTableContainer"}),{className:a,component:c="div"}=n,d=(0,o.A)(n,x),u=(0,s.A)((0,s.A)({},n),{},{component:c}),j=(e=>{const{classes:r}=e;return(0,i.A)({root:["root"]},h,r)})(u);return(0,A.jsx)(m,(0,s.A)({ref:r,as:c,className:(0,l.A)(j.root,a),ownerState:u},d))})},38915:(e,r,n)=>{n.d(r,{A:()=>v});var s=n(79722),o=n(35644),a=n(29296),l=n(13658);const i=s.A.create(),c=l.A.PRONOSTICO,t={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let d=null,u=!1;const h=e=>Boolean(e&&c&&String(e).startsWith(String(c))),A=e=>{try{return sessionStorage.getItem(e)}catch(r){return console.warn("No se pudo leer sessionStorage:",r),null}},x=(e,r)=>{try{void 0!==r&&null!==r&&sessionStorage.setItem(e,r)}catch(n){console.warn("No se pudo escribir en sessionStorage:",n)}},m=()=>{if(!u){u=!0;try{sessionStorage.clear()}catch(e){}null!==a.m&&void 0!==a.m&&a.m.limpiarSesion&&a.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},j=()=>{const e=A("refreshToken"),r=(()=>{const e=A("email")||A("username");if(!e||!t.UserPoolId||!t.ClientId)return null;const r=new o.NE(t);return new o.TU({Username:e,Pool:r})})();if(!e||!r)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const n=new o.c9({RefreshToken:e});return new Promise((e,s)=>{r.refreshSession(n,(r,n)=>{if(r)return void s(r);const o=n.getAccessToken().getJwtToken(),a=n.getIdToken().getJwtToken(),l=n.getRefreshToken().getToken();x("accessToken",o),x("idToken",a),l&&x("refreshToken",l),e(o)})})};i.interceptors.request.use(e=>{const r=sessionStorage.getItem("accessToken");if(h(e.url)){var n;e.headers=null!==(n=e.headers)&&void 0!==n?n:{},r&&(e.headers.Authorization="Bearer ".concat(r));const s=sessionStorage.getItem("sub");s&&(e.headers["X-Usuario-Sub"]=s)}return e}),i.interceptors.response.use(e=>e,async e=>{const{config:r,response:n}=e;if(!r||!n||401!==n.status||!h(r.url))return Promise.reject(e);if(r.__isRetryRequest)return m(),Promise.reject(e);try{var s;const e=await(d||(d=j().then(e=>(d=null,e)).catch(e=>{throw d=null,e})),d);if(!e)throw new Error("No se obtuvo un token renovado.");return r.__isRetryRequest=!0,r.headers=null!==(s=r.headers)&&void 0!==s?s:{},r.headers.Authorization="Bearer ".concat(e),i(r)}catch(o){return m(),Promise.reject(o)}});const v=i},44508:(e,r,n)=>{n.r(r),n.d(r,{default:()=>D});var s=n(89379),o=n(65043),a=n(53969),l=n(55895),i=n(91449),c=n(94799),t=n(26529),d=n(56647),u=n(28259),h=n(87443),A=n(10756),x=n(86172),m=n(81341),j=n(34375),v=n(24343),g=n(10256),f=n(9446),p=n(88889),b=n(80172),C=n(38517),y=n(81911),S=n(78776),z=n(85877),w=n(12097),k=n(3665),E=n(5362),P=n(22950),T=n(61773),O=n(85465),M=n(27421),N=n(14057),R=n(70579);const F=(0,N.A)((0,R.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow");var I=n(29001),W=n(96470),q=n(13658),B=n(38915);const U=[{label:"Mensual",value:1},{label:"Bimestral",value:2},{label:"Semestral",value:6},{label:"Anual",value:12}],_=[{label:"1 a\xf1o",value:12},{label:"2 a\xf1os",value:24},{label:"3 a\xf1os",value:36},{label:"4 a\xf1os",value:48},{label:"5 a\xf1os",value:60}];function D(){const[e,r]=o.useState([]),[n,N]=o.useState([]),[D,H]=o.useState(!0),[V,G]=o.useState(null),[J,L]=o.useState(null),[X,Z]=o.useState(!1),[K,Q]=o.useState(!1),[Y,$]=o.useState(null),[ee,re]=o.useState(null),[ne,se]=o.useState(null),[oe,ae]=o.useState(!1),[le,ie]=o.useState(null),[ce,te]=o.useState({nombre:"",mesesFrecuencia:1,horizonteMeses:12}),[de,ue]=o.useState(!1),[he,Ae]=o.useState(null),xe=(0,I.Zp)();o.useEffect(()=>{me()},[]);const me=async()=>{H(!0),G(null);try{const[e,n]=await Promise.all([B.A.get("".concat(q.A.PRONOSTICO,"/api/forecasts")),B.A.get("".concat(q.A.PRONOSTICO,"/api/forecast-config"))]);r(e.data),N(n.data)}catch(s){var e,n;console.error("Error cargando datos:",s),G((null===(e=s.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Error al cargar los datos. Por favor intenta nuevamente.")}finally{H(!1)}},je=()=>{se(null),ie(null)},ve=async()=>{if(ne&&le)if(le.nombre&&""!==le.nombre.trim()){ue(!0);try{await B.A.put("".concat(q.A.PRONOSTICO,"/api/forecast-config/").concat(ne),le),se(null),ie(null),me(),L("Configuraci\xf3n actualizada exitosamente")}catch(n){var e,r;console.error("Error guardando configuraci\xf3n:",n),G((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al guardar la configuraci\xf3n.")}finally{ue(!1)}}else G("El nombre es requerido")},ge=e=>{const r=U.find(r=>r.value===e);return r?r.label:"Cada ".concat(e," meses")},fe=e=>{const r=_.find(r=>r.value===e);return r?r.label:"".concat(e," meses")},pe=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("es-AR",{year:"numeric",month:"long",day:"numeric"})}catch(r){return e}},be=(e,r)=>{if(r){const e=new Date(r).toLocaleDateString("es-AR",{year:"numeric",month:"long"});return"Pron\xf3stico mensual de ".concat(e)}return e||"Pron\xf3stico sin nombre"};return D?(0,R.jsx)(W.A,{}):(0,R.jsxs)(a.A,{sx:{p:3},children:[(0,R.jsx)(l.A,{variant:"h4",component:"h1",sx:{mb:3},children:"Pron\xf3sticos Fijos"}),V&&(0,R.jsx)(i.A,{severity:"error",sx:{mb:2},onClose:()=>G(null),children:V}),J&&(0,R.jsx)(i.A,{severity:"success",sx:{mb:2},onClose:()=>L(null),children:J}),(0,R.jsxs)(c.A,{sx:{mb:4},children:[(0,R.jsxs)(a.A,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderColor:"divider"},children:[(0,R.jsx)(l.A,{variant:"h6",children:"Configuraciones"}),(0,R.jsx)(t.A,{title:"Agregar nueva configuraci\xf3n",children:(0,R.jsx)(d.A,{color:"primary",onClick:()=>{ae(!0),te({nombre:"",mesesFrecuencia:1,horizonteMeses:12})},disabled:oe,children:(0,R.jsx)(P.A,{})})})]}),(0,R.jsx)(u.A,{children:(0,R.jsxs)(h.A,{children:[(0,R.jsx)(A.A,{children:(0,R.jsxs)(x.A,{children:[(0,R.jsx)(m.A,{children:(0,R.jsx)("strong",{children:"Nombre"})}),(0,R.jsx)(m.A,{children:(0,R.jsx)("strong",{children:"Frecuencia"})}),(0,R.jsx)(m.A,{children:(0,R.jsx)("strong",{children:"Horizonte"})}),(0,R.jsx)(m.A,{align:"center",children:(0,R.jsx)("strong",{children:"Acciones"})})]})}),(0,R.jsxs)(j.A,{children:[oe&&(0,R.jsxs)(x.A,{children:[(0,R.jsx)(m.A,{children:(0,R.jsx)(v.A,{size:"small",value:ce.nombre,onChange:e=>te((0,s.A)((0,s.A)({},ce),{},{nombre:e.target.value})),placeholder:"Nombre de la configuraci\xf3n",fullWidth:!0})}),(0,R.jsx)(m.A,{children:(0,R.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,R.jsx)(f.A,{value:ce.mesesFrecuencia,onChange:e=>te((0,s.A)((0,s.A)({},ce),{},{mesesFrecuencia:e.target.value})),children:U.map(e=>(0,R.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,R.jsx)(m.A,{children:(0,R.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,R.jsx)(f.A,{value:ce.horizonteMeses,onChange:e=>te((0,s.A)((0,s.A)({},ce),{},{horizonteMeses:e.target.value})),children:_.map(e=>(0,R.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,R.jsxs)(m.A,{align:"center",children:[(0,R.jsx)(d.A,{color:"success",onClick:async()=>{if(ce.nombre&&""!==ce.nombre.trim()){ue(!0);try{await B.A.post("".concat(q.A.PRONOSTICO,"/api/forecast-config"),ce),ae(!1),te({nombre:"",mesesFrecuencia:1,horizonteMeses:12}),me(),L("Configuraci\xf3n creada exitosamente")}catch(n){var e,r;console.error("Error creando configuraci\xf3n:",n),G((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al crear la configuraci\xf3n.")}finally{ue(!1)}}else G("El nombre es requerido")},disabled:de,size:"small",children:de?(0,R.jsx)(b.A,{size:20}):(0,R.jsx)(O.A,{})}),(0,R.jsx)(d.A,{color:"error",onClick:()=>{ae(!1),te({nombre:"",mesesFrecuencia:1,horizonteMeses:12})},disabled:de,size:"small",children:(0,R.jsx)(M.A,{})})]})]}),0!==n.length||oe?n.map(e=>(0,R.jsx)(x.A,{hover:!0,children:ne===e.id?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(m.A,{children:(0,R.jsx)(v.A,{size:"small",value:le.nombre,onChange:e=>ie((0,s.A)((0,s.A)({},le),{},{nombre:e.target.value})),fullWidth:!0})}),(0,R.jsx)(m.A,{children:(0,R.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,R.jsx)(f.A,{value:le.mesesFrecuencia,onChange:e=>ie((0,s.A)((0,s.A)({},le),{},{mesesFrecuencia:e.target.value})),children:U.map(e=>(0,R.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,R.jsx)(m.A,{children:(0,R.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,R.jsx)(f.A,{value:le.horizonteMeses,onChange:e=>ie((0,s.A)((0,s.A)({},le),{},{horizonteMeses:e.target.value})),children:_.map(e=>(0,R.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,R.jsxs)(m.A,{align:"center",children:[(0,R.jsx)(d.A,{color:"success",onClick:ve,disabled:de,size:"small",children:de?(0,R.jsx)(b.A,{size:20}):(0,R.jsx)(O.A,{})}),(0,R.jsx)(d.A,{color:"error",onClick:je,disabled:de,size:"small",children:(0,R.jsx)(M.A,{})})]})]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(m.A,{children:e.nombre}),(0,R.jsx)(m.A,{children:ge(e.mesesFrecuencia)}),(0,R.jsx)(m.A,{children:fe(e.horizonteMeses)}),(0,R.jsxs)(m.A,{align:"center",children:[(0,R.jsx)(t.A,{title:"Calcular ahora",children:(0,R.jsx)(d.A,{color:"success",onClick:()=>(async e=>{Ae(e),G(null);try{await B.A.post("".concat(q.A.PRONOSTICO,"/api/forecasts/generar/").concat(e)),L("Pron\xf3stico generado exitosamente"),me()}catch(s){var r,n;console.error("Error generando forecast:",s),G((null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Error al generar el pron\xf3stico. Por favor intenta nuevamente.")}finally{Ae(null)}})(e.id),disabled:he===e.id,size:"small",children:he===e.id?(0,R.jsx)(b.A,{size:20}):(0,R.jsx)(F,{})})}),(0,R.jsx)(t.A,{title:"Editar",children:(0,R.jsx)(d.A,{color:"primary",onClick:()=>(e=>{se(e.id),ie({nombre:e.nombre||"",mesesFrecuencia:e.mesesFrecuencia||1,horizonteMeses:e.horizonteMeses||12})})(e),size:"small",children:(0,R.jsx)(T.A,{})})}),(0,R.jsx)(t.A,{title:"Eliminar",children:(0,R.jsx)(d.A,{color:"error",onClick:()=>(e=>{re(e),Q(!0)})(e),size:"small",children:(0,R.jsx)(E.A,{})})})]})]})},e.id)):(0,R.jsx)(x.A,{children:(0,R.jsx)(m.A,{colSpan:4,align:"center",children:(0,R.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{py:3},children:"No hay configuraciones. Haz clic en + para agregar una."})})})]})]})})]}),(0,R.jsxs)(c.A,{children:[(0,R.jsx)(a.A,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:(0,R.jsx)(l.A,{variant:"h6",children:"Pron\xf3sticos Generados"})}),(0,R.jsx)(u.A,{children:(0,R.jsxs)(h.A,{children:[(0,R.jsx)(A.A,{children:(0,R.jsxs)(x.A,{children:[(0,R.jsx)(m.A,{children:(0,R.jsx)("strong",{children:"Nombre"})}),(0,R.jsx)(m.A,{children:(0,R.jsx)("strong",{children:"Horizonte"})}),(0,R.jsx)(m.A,{children:(0,R.jsx)("strong",{children:"Frecuencia"})}),(0,R.jsx)(m.A,{children:(0,R.jsx)("strong",{children:"Fecha Generaci\xf3n"})}),(0,R.jsx)(m.A,{align:"center",children:(0,R.jsx)("strong",{children:"Acciones"})})]})}),(0,R.jsx)(j.A,{children:0===e.length?(0,R.jsx)(x.A,{children:(0,R.jsx)(m.A,{colSpan:5,align:"center",children:(0,R.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{py:3},children:"No hay pron\xf3sticos generados a\xfan."})})}):e.map(e=>(0,R.jsxs)(x.A,{hover:!0,children:[(0,R.jsx)(m.A,{children:be(e.nombre,e.createdAt)}),(0,R.jsx)(m.A,{children:fe(e.horizonteMeses)}),(0,R.jsx)(m.A,{children:ge(e.mesesFrecuencia)}),(0,R.jsx)(m.A,{children:pe(e.createdAt)}),(0,R.jsxs)(m.A,{align:"center",children:[(0,R.jsx)(t.A,{title:"Ver pron\xf3stico",children:(0,R.jsx)(d.A,{color:"primary",onClick:()=>{return r=e.id,void xe("/pronostico-fijo/".concat(r));var r},size:"small",children:(0,R.jsx)(k.A,{})})}),(0,R.jsx)(t.A,{title:"Eliminar",children:(0,R.jsx)(d.A,{color:"error",onClick:()=>(e=>{$(e),Z(!0)})(e),size:"small",children:(0,R.jsx)(E.A,{})})})]})]},e.id))})]})})]}),(0,R.jsxs)(C.A,{open:X,onClose:()=>Z(!1),children:[(0,R.jsx)(y.A,{children:"Confirmar Eliminaci\xf3n"}),(0,R.jsx)(S.A,{children:(0,R.jsxs)(l.A,{children:['\xbfEst\xe1s seguro de que deseas eliminar el pron\xf3stico "',be(null===Y||void 0===Y?void 0:Y.nombre,null===Y||void 0===Y?void 0:Y.createdAt),'"? Esta acci\xf3n no se puede deshacer.']})}),(0,R.jsxs)(z.A,{children:[(0,R.jsx)(w.A,{onClick:()=>Z(!1),children:"Cancelar"}),(0,R.jsx)(w.A,{onClick:async()=>{if(Y)try{await B.A.delete("".concat(q.A.PRONOSTICO,"/api/forecasts/").concat(Y.id)),Z(!1),$(null),me(),L("Pron\xf3stico eliminado exitosamente")}catch(n){var e,r;console.error("Error eliminando forecast:",n),G((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al eliminar el pron\xf3stico.")}},color:"error",variant:"contained",children:"Eliminar"})]})]}),(0,R.jsxs)(C.A,{open:K,onClose:()=>Q(!1),children:[(0,R.jsx)(y.A,{children:"Confirmar Eliminaci\xf3n"}),(0,R.jsx)(S.A,{children:(0,R.jsxs)(l.A,{children:['\xbfEst\xe1s seguro de que deseas eliminar la configuraci\xf3n "',null===ee||void 0===ee?void 0:ee.nombre,'"? Esta acci\xf3n no se puede deshacer.']})}),(0,R.jsxs)(z.A,{children:[(0,R.jsx)(w.A,{onClick:()=>Q(!1),children:"Cancelar"}),(0,R.jsx)(w.A,{onClick:async()=>{if(ee)try{await B.A.delete("".concat(q.A.PRONOSTICO,"/api/forecast-config/").concat(ee.id)),Q(!1),re(null),me(),L("Configuraci\xf3n eliminada exitosamente")}catch(n){var e,r;console.error("Error eliminando configuraci\xf3n:",n),G((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al eliminar la configuraci\xf3n.")}},color:"error",variant:"contained",children:"Eliminar"})]})]})]})}}}]);
//# sourceMappingURL=4508.cda1f20f.chunk.js.map