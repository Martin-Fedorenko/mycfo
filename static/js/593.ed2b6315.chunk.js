"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[593],{12483:(e,n,t)=>{t.r(n),t.d(n,{default:()=>me});var a=t(65043),o=t(49806),i=t(70298),r=t(55895),s=t(53969),l=t(91449),c=t(12097),d=t(26020),u=t(73849),h=t(89379);const p=t(13658).A.REGISTRO;async function m(e){let{method:n="GET",body:t,headers:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o="".concat(p).concat(e),i={method:n,headers:(0,h.A)({},a||{})},r=sessionStorage.getItem("sub");r&&(i.headers["X-Usuario-Sub"]=r),void 0!==t&&(i.headers["Content-Type"]="application/json",i.body=JSON.stringify(t));const s=await fetch(o,i),l=await s.text();let c=null;try{c=l?JSON.parse(l):null}catch(m){c=l}if(!s.ok){var d,u;const e=(null===(d=c)||void 0===d?void 0:d.message)||(null===(u=c)||void 0===u?void 0:u.error)||l||"HTTP ".concat(s.status),n=new Error(e);throw n.status=s.status,n.payload=c,n}return c}const g={getStatus:()=>m("/api/mp/status"),startOAuth:async()=>{const e=await m("/api/mp/oauth/url");console.log("Respuesta /oauth/url:",e);const n=(null===e||void 0===e?void 0:e.url)||(null===e||void 0===e?void 0:e.authUrl);if(!n)throw new Error("El backend no devolvi\xf3 la URL de autorizaci\xf3n");return n},unlink:()=>m("/api/mp/unlink",{method:"POST"}),listPayments:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:n,to:t,q:a,page:o=0,pageSize:i=20}=e,r=new URLSearchParams;return n&&r.set("from",n),t&&r.set("to",t),a&&r.set("q",a),r.set("page",o),r.set("size",i),r.set("sort","fecha,DESC"),m("/api/mp/payments?".concat(r.toString()))},listImportedPayments:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:n,to:t,q:a,page:o=0,pageSize:i=20}=e,r=new URLSearchParams;return n&&r.set("from",n),t&&r.set("to",t),a&&r.set("q",a),r.set("page",o),r.set("size",i),r.set("sort","fecha,DESC"),m("/api/mp/imported-payments?".concat(r.toString()))},previewPaymentsByMonth:e=>{let{month:n,year:t}=e;return m("/api/mp/preview",{method:"POST",body:{month:n,year:t}})},previewPaymentById:e=>m("/api/mp/preview",{method:"POST",body:{paymentId:e}}),previewByExternalReference:e=>m("/api/mp/preview",{method:"POST",body:{externalReference:e}}),importSelectedPayments:e=>m("/api/mp/import/selected",{method:"POST",body:e}),importPaymentsByMonth:e=>{let{month:n,year:t}=e;return m("/api/mp/import",{method:"POST",body:{month:n,year:t}})},importPaymentById:e=>m("/api/mp/import",{method:"POST",body:{paymentId:e}}),getConfig:()=>m("/api/mp/config"),updateConfig:e=>m("/api/mp/config",{method:"PUT",body:e}),billPayments:e=>m("/api/mp/facturar",{method:"POST",body:{paymentIds:e}}),updatePaymentCategory:(e,n)=>m("/api/mp/payments/".concat(e,"/category"),{method:"PUT",body:{categoria:n}})};var x=t(91244),v=t(7240),f=t(16128),y=t(95563);const A=t.p+"static/media/logoMPblanconegro.836a450199546d4ca029.png";var b=t(70579);function j(e){let{onLinked:n}=e;const[t,o]=a.useState(!1),[r,l]=a.useState(null);return a.useEffect(()=>{const e=new URLSearchParams(window.location.search);"linked"!==e.get("mp")&&"1"!==e.get("linked")||!n||n()},[n]),(0,b.jsxs)(x.A,{variant:"outlined",sx:{maxWidth:860,mx:"auto",mt:6,borderRadius:2,overflow:"hidden"},children:[(0,b.jsx)(v.A,{title:"Vincular tu cuenta de Mercado Pago",subheader:"Conecta tu cuenta para importar pagos y movimientos.",sx:{pb:0}}),(0,b.jsx)(i.A,{alignItems:"center",justifyContent:"center",sx:{mt:3,mb:1},children:(0,b.jsx)(s.A,{sx:{p:1.25,borderRadius:2,bgcolor:"#0d1117",border:"1px solid rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center",minWidth:80},children:(0,b.jsx)("img",{src:A,alt:"Mercado Pago",style:{height:125,opacity:.95,filter:"drop-shadow(0 2px 6px rgba(0,0,0,0.45))"}})})}),(0,b.jsxs)(i.A,{spacing:3,children:[(0,b.jsx)(f.A,{}),(0,b.jsx)(y.A,{sx:{px:2,pb:2},children:(0,b.jsx)(s.A,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:(0,b.jsx)(c.A,{variant:"contained",onClick:async()=>{o(!0),l(null);try{const e=await g.startOAuth();if(!e)throw new Error("URL de autorizaci\xf3n vac\xeda");window.location.href=e}catch(e){l((null===e||void 0===e?void 0:e.message)||"No se pudo iniciar la vinculaci\xf3n"),o(!1)}},disabled:t,children:t?"Redirigiendo...":"Vincular cuenta"})})})]})]})}var S=t(94799),C=t(32911),w=t(24343),P=t(23182),k=t(76072),I=t(26529),R=t(4268),z=t(26392);const E=20,W=[10,20,50,100];var D=t(15474),M=t(60446),O=t.n(M);function T(e){let{accountLabel:n,filters:t,onFiltersChange:a,onOpenImport:o,onOpenConfig:l,onUnlink:d,onRefresh:u,onExport:p,onBillSelected:m,selectedCount:g=0,unlinkBusy:x=!1}=e;const v=e=>a((0,h.A)((0,h.A)({},t),e)),f=e=>{if(!e)return null;const n=O()(e);return n.isValid()?n:null},y=e=>n=>{v({[e]:n&&n.isValid()?n.format("YYYY-MM-DD"):""})},A={fontWeight:600,color:"text.secondary",mb:.5,display:"block"},j=e=>{let{label:n,value:t,onChange:a}=e;return(0,b.jsxs)(s.A,{sx:{minWidth:{xs:"100%",sm:200}},children:[(0,b.jsx)(r.A,{variant:"caption",sx:A,children:n}),(0,b.jsx)(D.A,{value:t,onChange:a})]})},S=e=>{let{value:n,onChange:t}=e;return(0,b.jsxs)(s.A,{sx:{minWidth:{xs:"100%",sm:260}},children:[(0,b.jsx)(r.A,{variant:"caption",sx:A,children:"Buscar"}),(0,b.jsx)(w.A,{size:"small",placeholder:"Buscar...",value:n,onChange:t,fullWidth:!0})]})};return(0,b.jsxs)(P.A,{sx:{p:2,gap:2,flexWrap:"wrap",alignItems:"center",justifyContent:"center","& .MuiTextField-root":{minWidth:{xs:"100%",sm:180}}},children:[(0,b.jsx)(s.A,{sx:{mr:1,p:2,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",minWidth:{xs:"100%",sm:220}},children:(0,b.jsxs)(i.A,{spacing:1,alignItems:"center",children:[(0,b.jsx)(k.A,{label:n,color:"primary",variant:"outlined",sx:{fontSize:"0.9rem",fontWeight:600}}),(0,b.jsx)(I.A,{title:x?"Desvinculando...":"Desvincular",children:(0,b.jsx)("span",{children:(0,b.jsx)(c.A,{variant:"outlined",startIcon:(0,b.jsx)(z.A,{}),onClick:d,disabled:x,size:"small",sx:{borderColor:"divider",color:"text.primary",bgcolor:"background.paper",minWidth:0,"&:hover":{borderColor:"primary.main",bgcolor:"action.hover"}},children:"Desvincular"})})})]})}),(0,b.jsxs)(i.A,{direction:{xs:"column",md:"row"},spacing:1,alignItems:"center",justifyContent:"center",sx:{flexGrow:1},children:[(0,b.jsx)(j,{label:"Desde",value:f(t.from),onChange:y("from")}),(0,b.jsx)(j,{label:"Hasta",value:f(t.to),onChange:y("to")}),(0,b.jsx)(S,{value:t.q,onChange:e=>v({q:e.target.value})})]}),(0,b.jsx)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,b.jsx)(c.A,{variant:"contained",startIcon:(0,b.jsx)(R.A,{}),onClick:o,sx:{px:4,py:1.4,fontSize:"1rem",ml:0},children:"Importar"})})]})}var B=t(28259),N=t(87443),L=t(10756),U=t(86172),F=t(81341),Y=t(38865),q=t(34375),V=t(52412),G=t(17060),H=t(56647),_=t(61773),J=t(85465),X=t(27421),$=t(92659);function K(e){let{value:n="MercadoPago",onChange:t,disabled:o=!1}=e;const[i,r]=a.useState(!1),[l,c]=a.useState(n);a.useEffect(()=>{c(n)},[n]);const d=()=>{l&&l!==n&&$.gd.includes(l)&&(null===t||void 0===t||t(l)),r(!1)},u=()=>{c(n),r(!1)};return i?(0,b.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5,minWidth:200},children:[(0,b.jsx)(G.A,{size:"small",value:l,onChange:(e,n)=>{n&&c(n)},options:$.gd,autoHighlight:!0,openOnFocus:!0,disableClearable:!0,sx:{minWidth:150,"& .MuiOutlinedInput-root":{height:32,fontSize:"0.75rem"}},renderInput:e=>(0,b.jsx)(w.A,(0,h.A)((0,h.A)({},e),{},{autoFocus:!0,placeholder:"Seleccionar categor\xeda",variant:"outlined"}))}),(0,b.jsx)(I.A,{title:"Guardar",children:(0,b.jsx)(H.A,{size:"small",onClick:d,color:"primary",children:(0,b.jsx)(J.A,{fontSize:"small"})})}),(0,b.jsx)(I.A,{title:"Cancelar",children:(0,b.jsx)(H.A,{size:"small",onClick:u,color:"inherit",children:(0,b.jsx)(X.A,{fontSize:"small"})})})]}):(0,b.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,b.jsx)(k.A,{size:"small",label:n,color:"default",variant:"outlined",sx:{minWidth:80}}),!o&&(0,b.jsx)(I.A,{title:"Editar categor\xeda",children:(0,b.jsx)(H.A,{size:"small",onClick:()=>r(!0),sx:{opacity:.7,"&:hover":{opacity:1}},children:(0,b.jsx)(_.A,{fontSize:"small"})})})]})}const Q=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-AR")},Z=(e,n,t)=>{if(null==e)return"\u2014";const a=t&&e>0?-e:e;try{return new Intl.NumberFormat("es-AR",{style:"currency",currency:n||"ARS"}).format(a)}catch(o){return"".concat(a," ").concat(n||"ARS")}};function ee(e){let{rows:n=[],loading:t=!1,page:a=0,pageSize:o=20,total:i=0,selected:r=[],onSelectChange:l,onPageChange:c,onPageSizeChange:u,onCategoryChange:h}=e;const p=n.length>0&&r.length===n.length,m=r.length>0&&r.length<n.length;return(0,b.jsxs)(B.A,{sx:{borderRadius:2},children:[t&&(0,b.jsx)(d.A,{}),(0,b.jsxs)(N.A,{size:"small",stickyHeader:!0,children:[(0,b.jsx)(L.A,{children:(0,b.jsxs)(U.A,{children:[(0,b.jsx)(F.A,{padding:"checkbox",children:(0,b.jsx)(Y.A,{checked:p,indeterminate:m,onChange:e=>{e.target.checked?l(n.map((e,n)=>e.id||e.mpPaymentId||"row-".concat(n))):l([])},inputProps:{"aria-label":"Seleccionar todos"}})}),(0,b.jsx)(F.A,{sx:{fontWeight:600},children:"Tipo"}),(0,b.jsx)(F.A,{sx:{fontWeight:600},children:"Monto Total"}),(0,b.jsx)(F.A,{sx:{fontWeight:600},children:"Fecha"}),(0,b.jsx)(F.A,{sx:{fontWeight:600},children:"Descripci\xf3n"}),(0,b.jsx)(F.A,{sx:{fontWeight:600},children:"Origen"}),(0,b.jsx)(F.A,{sx:{fontWeight:600},children:"Categor\xeda"})]})}),(0,b.jsxs)(q.A,{children:[0===n.length&&!t&&(0,b.jsx)(U.A,{children:(0,b.jsx)(F.A,{colSpan:7,children:(0,b.jsx)(s.A,{sx:{p:3,textAlign:"center",color:"text.secondary"},children:"No hay pagos para mostrar."})})}),n.map((e,n)=>{const t=e.id||e.mpPaymentId||"row-".concat(n),a=Q(e.fecha||e.date);return(0,b.jsxs)(U.A,{hover:!0,selected:r.includes(t),sx:{"&.Mui-selected":{backgroundColor:e=>e.palette.action.selected},"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,b.jsx)(F.A,{padding:"checkbox",children:(0,b.jsx)(Y.A,{checked:r.includes(t),onChange:()=>(e=>{r.includes(e)?l(r.filter(n=>n!==e)):l([...r,e])})(t),inputProps:{"aria-label":"Seleccionar ".concat(t)}})}),(0,b.jsx)(F.A,{children:(0,b.jsx)(k.A,{size:"small",label:e.tipo||e.estado||e.status||"\u2014",sx:{backgroundColor:"Egreso"===e.tipo?"#ffebee":"Ingreso"===e.tipo?"#e8f5e8":"#f5f5f5",color:"Egreso"===e.tipo?"#d32f2f":"Ingreso"===e.tipo?"#2e7d32":"#666666",fontWeight:"bold",border:"Egreso"===e.tipo?"1px solid #d32f2f":"Ingreso"===e.tipo?"1px solid #2e7d32":"1px solid #e0e0e0"},variant:"outlined"})}),(0,b.jsx)(F.A,{align:"right",children:((n,t)=>{const a=null!==(n=null!==(t=e.montoTotal)&&void 0!==t?t:e.total)&&void 0!==n?n:e.amount,o=e.moneda||e.currency||"ARS",i="Egreso"===e.tipo;return(0,b.jsx)("span",{style:{color:i?"#d32f2f":"#2e7d32",fontWeight:"bold"},children:Z(a,o,i)})})()}),(0,b.jsx)(F.A,{children:a}),(0,b.jsx)(F.A,{children:e.descripcion||e.detalle||e.description||"\u2014"}),(0,b.jsx)(F.A,{children:e.origen||e.comprador||e.buyer||"\u2014"}),(0,b.jsx)(F.A,{children:(0,b.jsx)(K,{value:e.categoria||"MercadoPago",onChange:n=>null===h||void 0===h?void 0:h(e,n),disabled:!h})})]},t)})]})]}),(0,b.jsx)(V.A,{component:"div",count:i,page:a,onPageChange:(e,n)=>c(n),rowsPerPage:o,onRowsPerPageChange:e=>u(parseInt(e.target.value,10)),rowsPerPageOptions:W})]})}var ne=t(38517),te=t(78776),ae=t(94527),oe=t(88889),ie=t(85877);const re=[{v:1,label:"Enero"},{v:2,label:"Febrero"},{v:3,label:"Marzo"},{v:4,label:"Abril"},{v:5,label:"Mayo"},{v:6,label:"Junio"},{v:7,label:"Julio"},{v:8,label:"Agosto"},{v:9,label:"Septiembre"},{v:10,label:"Octubre"},{v:11,label:"Noviembre"},{v:12,label:"Diciembre"}];function se(e){let{open:n,onClose:t,onImport:o}=e;const d=new Date,[u,h]=a.useState(d.getMonth()+1),[p,m]=a.useState(d.getFullYear()),[g,x]=a.useState(""),[v,f]=a.useState(!1),[y,j]=a.useState(null);a.useEffect(()=>{n&&(j(null),f(!1),x(""),h(d.getMonth()+1),m(d.getFullYear()))},[n]);return(0,b.jsxs)(ne.A,{open:n,onClose:v?void 0:t,maxWidth:"sm",fullWidth:!0,children:[(0,b.jsx)(te.A,{dividers:!0,children:(0,b.jsxs)(i.A,{spacing:3,sx:{mt:1},children:[(0,b.jsx)(s.A,{sx:{display:"flex",justifyContent:"center"},children:(0,b.jsx)(s.A,{sx:{p:1.1,borderRadius:2,bgcolor:"#0d1117",border:"1px solid rgba(255,255,255,0.08)",display:"inline-flex"},children:(0,b.jsx)("img",{src:A,alt:"Mercado Pago",style:{height:125,opacity:.95,filter:"drop-shadow(0 2px 6px rgba(0,0,0,0.45))"}})})}),(0,b.jsx)(ae.A,{textAlign:"center",children:(0,b.jsx)(r.A,{variant:"subtitle1",sx:{opacity:.8,textTransform:"uppercase",fontWeight:400,fontSize:"1.1rem"},children:"IMPORTAR MOVIMIENTOS POR MES"})}),(0,b.jsx)(S.A,{variant:"outlined",sx:{p:2,borderRadius:2},children:(0,b.jsx)(i.A,{spacing:1,children:(0,b.jsxs)(i.A,{direction:{xs:"column",sm:"row"},spacing:2,children:[(0,b.jsx)(w.A,{size:"small",select:!0,fullWidth:!0,label:"Mes",value:u,onChange:e=>h(e.target.value),children:re.map(e=>(0,b.jsx)(oe.A,{value:e.v,children:e.label},e.v))}),(0,b.jsx)(w.A,{size:"small",label:"A\xf1o",type:"number",fullWidth:!0,value:p,onChange:e=>m(e.target.value),inputProps:{min:2e3,max:2100,step:1}})]})})}),y&&(0,b.jsx)(l.A,{severity:"error",children:y})]})}),(0,b.jsxs)(ie.A,{children:[(0,b.jsx)(c.A,{onClick:t,disabled:v,children:"Cancelar"}),(0,b.jsx)(c.A,{variant:"contained",onClick:async()=>{if(j(null),u&&p){f(!0);try{await(null===o||void 0===o?void 0:o({mode:"preview",month:Number(u),year:Number(p)}))}catch(e){j((null===e||void 0===e?void 0:e.message)||"Error al obtener vista previa")}finally{f(!1)}}else j("Seleccion\xe1 mes y a\xf1o para importar por per\xedodo.")},disabled:v,children:v?"Buscando\u2026":"Vista Previa"})]})]})}var le=t(81911);function ce(e){let{open:n,onClose:t,previewData:o=[],loading:u=!1,onImportSelected:h}=e;const[p,m]=a.useState([]),[g,x]=a.useState(!1);a.useEffect(()=>{n&&m([])},[n]);const v=o.filter(e=>e.esDuplicado).length;o.length;return(0,b.jsxs)(ne.A,{open:n,onClose:t,maxWidth:"xl",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh"}},children:[(0,b.jsx)(le.A,{children:(0,b.jsxs)(i.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,b.jsx)(r.A,{variant:"h6",children:"Vista Previa de Pagos"}),o.length>0&&(0,b.jsxs)(r.A,{variant:"body2",color:"text.secondary",children:["(",o.length," pagos encontrados)"]})]})}),(0,b.jsx)(te.A,{dividers:!0,children:(0,b.jsxs)(i.A,{spacing:2,children:[u&&(0,b.jsx)(d.A,{}),0===o.length&&!u&&(0,b.jsx)(l.A,{severity:"info",children:"No se encontraron pagos para mostrar."}),o.length>0&&(0,b.jsxs)(b.Fragment,{children:[v>0&&(0,b.jsxs)(l.A,{severity:"warning",children:["Se encontraron ",(0,b.jsx)("strong",{children:v})," pago(s) duplicado(s). Estos pagos ya fueron importados anteriormente."]}),(0,b.jsx)(S.A,{variant:"outlined",sx:{borderRadius:2},children:(0,b.jsx)(ee,{rows:o,loading:!1,page:0,pageSize:o.length,total:o.length,selected:p,onSelectChange:m,onPageChange:()=>{},onPageSizeChange:()=>{}})}),(0,b.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsxs)(r.A,{variant:"body2",color:"text.secondary",children:[p.length," de ",o.length," pagos seleccionados"]}),(0,b.jsx)(c.A,{variant:"outlined",size:"small",onClick:()=>{p.length===o.length?m([]):m(o.map(e=>e.mpPaymentId).filter(Boolean))},disabled:0===o.length,children:p.length===o.length?"Deseleccionar todos":"Seleccionar todos"})]})]})]})}),(0,b.jsxs)(ie.A,{children:[(0,b.jsx)(c.A,{onClick:t,disabled:g,children:"Cancelar"}),(0,b.jsx)(c.A,{variant:"contained",onClick:async()=>{if(0!==p.length){x(!0);try{await(null===h||void 0===h?void 0:h(p)),m([]),null===t||void 0===t||t()}catch(e){console.error("Error importing selected payments:",e)}finally{x(!1)}}},disabled:0===p.length||g,children:g?"Importando...":"Importar ".concat(p.length," seleccionados")})]})]})}var de=t(53089),ue=t(17347);function he(e){let{open:n,onClose:t,onSaved:o,onUnlink:s}=e;const[d,p]=a.useState({autoBill:!1,timezone:"America/Argentina/Buenos_Aires",currency:"ARS"}),[m,x]=a.useState(!1),[v,f]=a.useState(!1),[y,A]=a.useState(null),j=a.useCallback(async()=>{if(n){x(!0),A(null);try{const e=await g.getConfig();p({autoBill:!(null===e||void 0===e||!e.autoBill),timezone:(null===e||void 0===e?void 0:e.timezone)||"America/Argentina/Buenos_Aires",currency:((null===e||void 0===e?void 0:e.currency)||"ARS").toUpperCase()})}catch(e){A((null===e||void 0===e?void 0:e.message)||"No se pudo cargar la configuraci\xf3n")}finally{x(!1)}}},[n]);a.useEffect(()=>{j()},[j]);const C=e=>{let{label:n,hint:t,control:a}=e;return(0,b.jsxs)(de.A,{container:!0,spacing:2,alignItems:"center",children:[(0,b.jsx)(de.A,{item:!0,xs:12,sm:4,children:(0,b.jsxs)(i.A,{direction:"row",spacing:.5,alignItems:"center",children:[(0,b.jsx)(r.A,{variant:"body2",sx:{fontWeight:600},children:n}),t&&(0,b.jsx)(I.A,{title:t,children:(0,b.jsx)(ue.A,{fontSize:"small",color:"action"})})]})}),(0,b.jsx)(de.A,{item:!0,xs:12,sm:8,children:a})]})};return(0,b.jsxs)(ne.A,{open:n,onClose:v?void 0:t,maxWidth:"sm",fullWidth:!0,children:[(0,b.jsx)(le.A,{sx:{pb:1},children:"CONFIGURAR"}),(0,b.jsx)(te.A,{dividers:!0,children:(0,b.jsx)(S.A,{variant:"outlined",sx:{p:2,borderRadius:2},children:(0,b.jsxs)(i.A,{spacing:2,children:[y&&(0,b.jsx)(l.A,{severity:"error",children:y}),m?(0,b.jsx)(u.A,{variant:"rounded",height:40}):(0,b.jsx)(C,{label:"Punto de Venta",hint:"Identificador de tu punto de venta.",control:(0,b.jsx)(w.A,{size:"small",placeholder:"0001",value:d.timezone,onChange:e=>p((0,h.A)((0,h.A)({},d),{},{timezone:e.target.value})),disabled:m,fullWidth:!0})}),m?(0,b.jsx)(u.A,{variant:"rounded",height:40}):(0,b.jsx)(C,{label:"Dep\xf3sito",hint:"Dep\xf3sito por defecto.",control:(0,b.jsx)(w.A,{size:"small",placeholder:"Dep\xf3sito Universal",value:d.currency,onChange:e=>p((0,h.A)((0,h.A)({},d),{},{currency:e.target.value.toUpperCase()})),inputProps:{maxLength:3},disabled:m,fullWidth:!0})}),(0,b.jsx)(C,{label:"Condici\xf3n de Pago",hint:"Solo visual por ahora.",control:(0,b.jsx)(w.A,{size:"small",placeholder:"Cuenta Corriente",value:d.condicionPago||"",onChange:e=>p((0,h.A)((0,h.A)({},d),{},{condicionPago:e.target.value})),disabled:m,fullWidth:!0})}),(0,b.jsx)(C,{label:"Cuenta de cobro",hint:"Solo visual por ahora.",control:(0,b.jsx)(w.A,{size:"small",placeholder:"Banco Santander",value:d.cuentaCobro||"",onChange:e=>p((0,h.A)((0,h.A)({},d),{},{cuentaCobro:e.target.value})),disabled:m,fullWidth:!0})})]})})}),(0,b.jsxs)(ie.A,{sx:{gap:1},children:[s&&(0,b.jsx)(c.A,{color:"inherit",onClick:s,disabled:v||m,children:"Desvincular"}),(0,b.jsx)(c.A,{onClick:t,disabled:v,children:"Cerrar"}),(0,b.jsx)(c.A,{variant:"contained",onClick:async()=>{f(!0),A(null);try{await g.updateConfig(d),null===o||void 0===o||o()}catch(e){A((null===e||void 0===e?void 0:e.message)||"No se pudo guardar")}finally{f(!1)}},disabled:v||m,children:v?"Guardando\u2026":"Guardar"})]})]})}function pe(e){var n,t,o;let{status:i,onRefreshStatus:r}=e;const[c,d]=a.useState({from:"",to:"",payStatus:"",q:""}),[u,p]=a.useState([]),[m,x]=a.useState(!1),[v,f]=a.useState(0),[y,A]=a.useState(E),[j,w]=a.useState(0),[P,k]=a.useState([]),[I,R]=a.useState(!1),[z,W]=a.useState(!1),[D,M]=a.useState([]),[O,B]=a.useState(!1),[N,L]=a.useState(!1),[U,F]=a.useState(!1),[Y,q]=a.useState({open:!1,severity:"success",message:""}),V=(null===i||void 0===i||null===(n=i.account)||void 0===n?void 0:n.nickname)||(null===i||void 0===i||null===(t=i.account)||void 0===t?void 0:t.email)||(null===i||void 0===i||null===(o=i.account)||void 0===o?void 0:o.legalName)||"Cuenta vinculada",G=function(e){return q({open:!0,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",message:e})},H=a.useCallback(async()=>{var e;const n=await g.listImportedPayments({from:c.from||void 0,to:c.to||void 0,q:c.q||void 0,payStatus:c.payStatus||void 0,page:v,pageSize:y,ts:Date.now()}),t=(null===n||void 0===n?void 0:n.content)||[];return{items:t,tot:null!==(e=null===n||void 0===n?void 0:n.totalElements)&&void 0!==e?e:t.length}},[c,v,y]),_=a.useCallback(async()=>{x(!0);try{const{items:e,tot:n}=await H();p(e),w(n),k([])}catch(e){G((null===e||void 0===e?void 0:e.message)||"No se pudieron cargar los pagos","error")}finally{x(!1)}},[H]);a.useEffect(()=>{_()},[_]),a.useEffect(()=>()=>{p([]),k([]),f(0),w(0),console.log("MainGrid: Componente desmontado, datos limpiados")},[]);const J=a.useCallback(async e=>{for(let o=0;o<6;o++)try{var n,t;const a=800+800*o;await new Promise(e=>setTimeout(e,a));const{items:i,tot:r}=await H();if(r!==e||null!==i&&void 0!==i&&i.length&&null!==u&&void 0!==u&&u.length&&(null===(n=i[0])||void 0===n?void 0:n.mpPaymentId)!==(null===(t=u[0])||void 0===t?void 0:t.mpPaymentId))return p(i),w(r),k([]),!0}catch(a){}return!1},[H,u]);return(0,b.jsxs)(s.A,{sx:{maxWidth:1200,mx:"auto",mt:3,px:2},children:[(0,b.jsx)(S.A,{variant:"outlined",sx:{mb:2,borderRadius:2,p:1,bgcolor:e=>"dark"===e.palette.mode?"background.default":"background.paper"},children:(0,b.jsx)(T,{accountLabel:V,filters:c,onFiltersChange:d,onOpenImport:()=>R(!0),onOpenConfig:()=>L(!0),onUnlink:async()=>{if(window.confirm("\xbfDesvincular la cuenta de Mercado Pago?")){F(!0);try{await g.unlink(),p([]),k([]),f(0),G("Cuenta desvinculada"),null===r||void 0===r||r()}catch(e){G((null===e||void 0===e?void 0:e.message)||"No se pudo desvincular","error")}finally{F(!1)}}},onRefresh:()=>{f(0),_()},onExport:()=>{const e=P.length?u.filter(e=>P.includes(e.mpPaymentId)):u;if(!e.length)return void G("No hay datos para exportar","warning");const n=e=>{if(!e)return"";const n=new Date(e);return n.getHours()+n.getMinutes()+n.getSeconds()!==0?n.toLocaleString("es-AR"):n.toLocaleDateString("es-AR")},t=e=>String(null!==e&&void 0!==e?e:"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),a=e.map(e=>{const a=[{t:"String",v:n(e.fecha||e.date)},{t:"String",v:e.mpPaymentId||e.id||""},{t:"String",v:e.detalle||e.description||""},{t:"String",v:e.comprador||e.buyer||""},{t:"String",v:e.comprobante||e.receipt||""},{t:"String",v:e.estado||e.status||""},(n=>{const t=null!==(n=e.total)&&void 0!==n?n:e.amount,a="number"===typeof t?t:Number(t);return Number.isFinite(a)?{t:"Number",v:a}:{t:"String",v:null!==t&&void 0!==t?t:""}})(),{t:"String",v:e.moneda||e.currency||"ARS"},{t:"String",v:e.externalReference||e.orderId||""},{t:"String",v:e.permalink||e.init_point||""}].map(e=>"Number"===e.t?'<Cell><Data ss:Type="Number">'.concat(e.v,"</Data></Cell>"):'<Cell><Data ss:Type="String">'.concat(t(e.v),"</Data></Cell>")).join("");return"<Row>".concat(a,"</Row>")}).join(""),o="<Row>"+["Fecha","Payment ID","Detalle","Comprador","Comprobante","Estado","Total","Moneda","Orden/Referencia","Link"].map(e=>'<Cell><Data ss:Type="String">'.concat(t(e),"</Data></Cell>")).join("")+"</Row>",i='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">'+'<Worksheet ss:Name="'.concat(t("Pagos_MP"),'">')+"<Table>"+o+a+"</Table></Worksheet></Workbook>",r=new Blob([i],{type:"application/vnd.ms-excel"}),s=document.createElement("a");s.href=URL.createObjectURL(r),s.download="pagos_mp_".concat((new Date).toISOString().slice(0,10),".xls"),s.click()},onBillSelected:async()=>{if(P.length&&window.confirm("\xbfFacturar ".concat(P.length," pago(s) seleccionados?")))try{await g.billPayments(P),G("Facturaci\xf3n en proceso/completada"),_()}catch(e){G((null===e||void 0===e?void 0:e.message)||"Error al facturar","error")}},selectedCount:P.length,unlinkBusy:U})}),(0,b.jsx)(S.A,{variant:"outlined",sx:{borderRadius:2},children:(0,b.jsx)(ee,{rows:u,loading:m,page:v,pageSize:y,total:j,selected:P,onSelectChange:k,onPageChange:f,onPageSizeChange:e=>{A(e),f(0)},onCategoryChange:async(e,n)=>{try{await g.updatePaymentCategory(e.id,n),p(t=>t.map(t=>t.id===e.id?(0,h.A)((0,h.A)({},t),{},{categoria:n}):t)),G("Categor\xeda actualizada a: ".concat(n))}catch(t){G((null===t||void 0===t?void 0:t.message)||"Error al actualizar categor\xeda","error")}}})}),(0,b.jsx)(se,{open:I,onClose:()=>R(!1),onImport:async e=>{try{var n;let t;if(B(!0),R(!1),"preview"!==e.mode){const n=j;"period"===e.mode?await g.importPaymentsByMonth({month:e.month,year:e.year}):await g.importPaymentById(e.paymentId),G("Importaci\xf3n solicitada. Buscando cambios\u2026"),f(0),await _();return void(await J(n)||G("No se detectaron cambios a\xfan. Prob\xe1 refrescar en unos segundos.","warning"))}t=e.paymentId?await g.previewPaymentById(e.paymentId):await g.previewPaymentsByMonth({month:e.month,year:e.year});const a=(null===(n=t)||void 0===n?void 0:n.preview)||[];M(a),W(!0),0===a.length?G("No se encontraron pagos para importar","warning"):G("".concat(a.length," pagos encontrados. Selecciona cu\xe1les importar."),"info")}catch(t){G((null===t||void 0===t?void 0:t.message)||"Error al obtener vista previa","error")}finally{B(!1)}}}),(0,b.jsx)(ce,{open:z,onClose:()=>{W(!1),M([])},previewData:D,loading:O,onImportSelected:async e=>{try{await g.importSelectedPayments(e),G("".concat(e.length," pagos importados exitosamente")),W(!1),M([]),f(0),await _()}catch(n){throw G((null===n||void 0===n?void 0:n.message)||"Error al importar pagos seleccionados","error"),n}}}),(0,b.jsx)(he,{open:N,onClose:()=>L(!1),onSaved:()=>{L(!1),G("Configuraci\xf3n guardada"),f(0),_()}}),(0,b.jsx)(C.A,{open:Y.open,autoHideDuration:4e3,onClose:()=>q(e=>(0,h.A)((0,h.A)({},e),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,b.jsx)(l.A,{onClose:()=>q(e=>(0,h.A)((0,h.A)({},e),{},{open:!1})),severity:Y.severity,variant:"filled",children:Y.message})})]})}function me(){const[e,n]=a.useState(!0),[t,h]=a.useState(null),[p,m]=a.useState(null),x=a.useCallback(async()=>{n(!0),h(null);try{const e=await g.getStatus();m(e)}catch(e){h((null===e||void 0===e?void 0:e.message)||"No se pudo cargar el estado")}finally{n(!1)}},[]);a.useEffect(()=>{x()},[x]),a.useEffect(()=>{const e=new URLSearchParams(window.location.search);"linked"!==e.get("mp")&&"1"!==e.get("linked")||(window.history.replaceState({},document.title,window.location.pathname),x())},[x]),a.useEffect(()=>{const e=()=>{},n=()=>{document.hidden?console.log("MercadoPago: P\xe1gina oculta, manteniendo sesi\xf3n"):(console.log("MercadoPago: P\xe1gina visible, verificando estado"),x())};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",n),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",n)}},[x]);return(0,b.jsxs)(o.A,{maxWidth:"xl",sx:{py:3},children:[(0,b.jsxs)(i.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:[(0,b.jsx)(r.A,{variant:"h4",children:"Mercado Pago"}),(0,b.jsx)(s.A,{sx:{minWidth:120}})]}),t&&(0,b.jsx)(l.A,{severity:"warning",sx:{mb:2},action:(0,b.jsx)(c.A,{color:"inherit",size:"small",onClick:x,children:"Reintentar"}),children:t}),e&&(0,b.jsxs)(i.A,{spacing:2,children:[(0,b.jsx)(d.A,{}),(0,b.jsx)(u.A,{variant:"rounded",height:140}),(0,b.jsx)(u.A,{variant:"rounded",height:420})]}),!e&&!t&&(0,b.jsx)(b.Fragment,{children:null!==p&&void 0!==p&&p.linked?(0,b.jsx)(pe,{status:p,onRefreshStatus:()=>x()}):(0,b.jsx)(j,{onLinked:x})})]})}},15474:(e,n,t)=>{t.d(n,{A:()=>y});var a=t(89379),o=(t(65043),t(60446)),i=t.n(o),r=t(8259),s=t.n(r),l=t(38348),c=t(12097),d=t(31777),u=t(28793),h=t(24793),p=t(63943),m=t(38068),g=t(67142),x=t(63199),v=t(70579);function f(e){var n;const{forwardedProps:t}=(0,m.o)(e,"date"),o=(0,x.T)(),i=(0,l.A)(o.triggerRef,o.rootRef),r=(0,g.U)(),s=null==o.value?r:o.value.format(o.fieldFormat);return(0,v.jsx)(c.A,(0,a.A)((0,a.A)({},t),{},{variant:"outlined",ref:i,size:"small",startIcon:(0,v.jsx)(d.A,{fontSize:"small"}),sx:{minWidth:"fit-content",width:"100%"},disabled:o.disabled||(null===t||void 0===t?void 0:t.disabled),onClick:()=>{o.disabled||null!==t&&void 0!==t&&t.disabled||o.setOpen(e=>!e)},children:null!==(n=o.label)&&void 0!==n?n:s}))}function y(e){let{value:n,onChange:t,disabled:a=!1}=e;return(0,v.jsx)(h.$J,{dateAdapter:u.R,children:(0,v.jsx)(p.l,{value:n?i()(n):null,label:null==n?null:i()(n).format("MMM DD, YYYY"),onChange:e=>{if(t)if(i().isDayjs(e)){const n=i().utc(e.startOf("day").format("YYYY-MM-DD"));t(n)}else t(e)},disabled:a,slots:{field:f},slotProps:{nextIconButton:{size:"small",disabled:a},previousIconButton:{size:"small",disabled:a},field:{disabled:a}},views:["day","month","year"],sx:{width:"100%"}})})}i().extend(s())},92659:(e,n,t)=>{t.d(n,{gd:()=>i});const a=["Alimentos y Bebidas","Transporte","Vivienda","Servicios B\xe1sicos","Ocio y Entretenimiento","Compras Personales","Salud","Educaci\xf3n","Impuestos y Tasas","Servicios Financieros","Compras de Negocio","Otros Egresos"],o=["Ventas de Productos","Prestaci\xf3n de Servicios","Cobranzas","Transferencias Recibidas","Inversiones y Rendimientos","Otros Ingresos"],i=[...a,...o]}}]);
//# sourceMappingURL=593.ed2b6315.chunk.js.map