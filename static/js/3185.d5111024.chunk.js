"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3185],{60450:(e,n,a)=>{a.d(n,{A:()=>s});var o=a(14057),t=a(70579);const s=(0,o.A)((0,t.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic")},93185:(e,n,a)=>{a.r(n),a.d(n,{default:()=>C});var o,t=a(89379),s=a(57528),r=a(65043),i=a(56647),l=a(53969),c=a(94799),d=a(80172),u=a(91449),p=a(55895),m=a(27421),x=a(5362),g=a(60450),b=a(23892),h=a(79722),v=a(83290),A=a(58128),f=a(70579);const j=(0,v.i7)(o||(o=(0,s.A)(["\n  0% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0.6); }\n  50% { box-shadow: 0 0 0 20px rgba(76, 175, 239, 0); }\n  100% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0); }\n"]))),w=(0,A.Ay)(i.A)(e=>{let{theme:n,recording:a}=e;return(0,t.A)({width:100,height:100,borderRadius:"50%",color:"#fff",backgroundColor:a?n.palette.error.main:n.palette.primary.main},a&&{animation:"".concat(j," 1.5s infinite")})}),y={Movimiento:"Movimiento",Ingreso:"Ingreso",Egreso:"Egreso",Deuda:"Deuda",Acreencia:"Acreencia",Factura:"Factura"};function C(e){let{tipoDoc:n,endpoint:a,onResultado:o,onFallback:t}=e;const[s,v]=(0,r.useState)(!1),[A,j]=(0,r.useState)(null),[C,S]=(0,r.useState)(null),[k,M]=(0,r.useState)(null),[R,D]=(0,r.useState)(null),[E,F]=(0,r.useState)(!1),[I,L]=(0,r.useState)(null);return(0,f.jsxs)(l.A,{sx:{mt:3,textAlign:"center"},children:[!E&&(0,f.jsx)(w,{sx:{mt:5},recording:s?1:0,onClick:s?()=>{A&&A.stop(),v(!1)}:async()=>{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new MediaRecorder(e);let a=[];n.ondataavailable=e=>a.push(e.data),n.onstop=()=>{const n=new Blob(a,{type:"audio/webm"});S(URL.createObjectURL(n)),M(new File([n],"grabacion.webm",{type:"audio/webm"})),e.getTracks().forEach(e=>e.stop())},L(null),D(null),j(n),n.start(),v(!0)},children:s?(0,f.jsx)(m.A,{}):(0,f.jsx)(g.A,{})}),!E&&C&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(c.A,{sx:{mt:1,p:1.5,display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid",borderColor:"grey.400",borderRadius:1},children:[(0,f.jsx)("audio",{controls:!0,src:C}),(0,f.jsx)(i.A,{onClick:()=>{S(null),M(null),D(null),L(null)},color:"error",children:(0,f.jsx)(x.A,{})})]}),(0,f.jsx)(b.A,{label:"Enviar audio",width:"100%",sx:{mt:2},onClick:async()=>{if(!k)return;const e=sessionStorage.getItem("sub");if(!e)return void D("No se encontr\xf3 la sesi\xf3n del usuario. Volv\xe9 a iniciar sesi\xf3n.");F(!0),D(null),L(null);const s=k,r=new FormData;r.append("file",s);const i=y[n];i&&a.includes("/movimientos/")&&r.append("tipoMovimiento",i),n&&r.append("tipoDoc",n),S(null),M(null);try{const n=await h.A.post(a,r,{headers:{"Content-Type":"multipart/form-data","X-Usuario-Sub":e}});console.log("Respuesta completa del audio:",n.data);const{campos:s,transcript:i,warnings:l}=n.data||{};null!==l&&void 0!==l&&l.length&&console.warn("Advertencias al procesar audio:",l);if(!(s&&Object.entries(s).some(e=>{let[n,a]=e;return!!n&&("moneda"!==n.toLowerCase()&&!!a)}))){const e={message:"No se pudo interpretar el audio. Por favor grabalo nuevamente procurando mayor claridad.",transcript:i||"Sin transcripci\xf3n disponible."};return L(e),console.warn("Procesamiento de audio sin campos detectados.",{transcript:i,warnings:l}),void(t&&t({origen:"audio",mensaje:"No pudimos interpretar el audio. Completa los datos manualmente.",detalle:e}))}o&&o(n.data)}catch(d){var l,c;console.error("\u274c Error en env\xedo:",d);const e=(null===(l=d.response)||void 0===l||null===(c=l.data)||void 0===c?void 0:c.message)||d.message||"Error desconocido al procesar el audio.";D(e),t&&t({origen:"audio",mensaje:e,detalle:d})}finally{F(!1)}}})]}),E&&(0,f.jsx)(l.A,{sx:{mt:4,display:"flex",justifyContent:"center"},children:(0,f.jsx)(d.A,{size:40})}),(0,f.jsxs)(l.A,{sx:{mt:3,textAlign:"left"},children:[R&&(0,f.jsx)(u.A,{severity:"error",sx:{mb:2},onClose:()=>D(null),children:R}),I&&(0,f.jsxs)(u.A,{severity:"warning",sx:{mb:2},onClose:()=>L(null),children:[(0,f.jsx)(p.A,{sx:{fontWeight:600,mb:1},children:I.message}),(0,f.jsxs)(p.A,{variant:"body2",children:["Transcripci\xf3n detectada: ",I.transcript]})]})]})]})}}}]);
//# sourceMappingURL=3185.d5111024.chunk.js.map