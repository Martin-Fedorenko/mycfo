"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4787],{38915:(e,s,o)=>{o.d(s,{A:()=>f});var r=o(79722),t=o(35644),n=o(29296),a=o(13658);const i=r.A.create(),l=a.A.PRONOSTICO,c={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let d=null,u=!1;const m=e=>Boolean(e&&l&&String(e).startsWith(String(l))),h=e=>{try{return sessionStorage.getItem(e)}catch(s){return console.warn("No se pudo leer sessionStorage:",s),null}},g=(e,s)=>{try{void 0!==s&&null!==s&&sessionStorage.setItem(e,s)}catch(o){console.warn("No se pudo escribir en sessionStorage:",o)}},x=()=>{if(!u){u=!0;try{sessionStorage.clear()}catch(e){}null!==n.m&&void 0!==n.m&&n.m.limpiarSesion&&n.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},j=()=>{const e=h("refreshToken"),s=(()=>{const e=h("email")||h("username");if(!e||!c.UserPoolId||!c.ClientId)return null;const s=new t.NE(c);return new t.TU({Username:e,Pool:s})})();if(!e||!s)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const o=new t.c9({RefreshToken:e});return new Promise((e,r)=>{s.refreshSession(o,(s,o)=>{if(s)return void r(s);const t=o.getAccessToken().getJwtToken(),n=o.getIdToken().getJwtToken(),a=o.getRefreshToken().getToken();g("accessToken",t),g("idToken",n),a&&g("refreshToken",a),e(t)})})};i.interceptors.request.use(e=>{const s=sessionStorage.getItem("accessToken");if(m(e.url)){var o;e.headers=null!==(o=e.headers)&&void 0!==o?o:{},s&&(e.headers.Authorization="Bearer ".concat(s));const r=sessionStorage.getItem("sub");r&&(e.headers["X-Usuario-Sub"]=r)}return e}),i.interceptors.response.use(e=>e,async e=>{const{config:s,response:o}=e;if(!s||!o||401!==o.status||!m(s.url))return Promise.reject(e);if(s.__isRetryRequest)return x(),Promise.reject(e);try{var r;const e=await(d||(d=j().then(e=>(d=null,e)).catch(e=>{throw d=null,e})),d);if(!e)throw new Error("No se obtuvo un token renovado.");return s.__isRetryRequest=!0,s.headers=null!==(r=s.headers)&&void 0!==r?r:{},s.headers.Authorization="Bearer ".concat(e),i(s)}catch(t){return x(),Promise.reject(t)}});const f=i},44787:(e,s,o)=>{o.r(s),o.d(s,{default:()=>E});var r=o(65043),t=o(53969),n=o(55895),a=o(94799),i=o(10256),l=o(3353),c=o(9446),d=o(88889),u=o(12097),m=o(91449),h=o(11840),g=o(82332),x=o(70095),j=o(80379),f=o(50108),v=o(73243),k=o(80768),p=o(87734),y=o(28791),b=o(52185),A=o(6026),S=o(75748),w=o(96470),N=o(13658),I=o(38915),W=o(70579);const T=[{label:"1 a\xf1o",value:12},{label:"2 a\xf1os",value:24},{label:"3 a\xf1os",value:36},{label:"4 a\xf1os",value:48},{label:"5 a\xf1os",value:60}];function E(){const[e,s]=r.useState(12),[o,E]=r.useState(!1),[K,P]=r.useState(null),[_,B]=r.useState(null),[C,F]=r.useState("todos"),[R,z]=r.useState(!1),O=(()=>{const e=(null===K||void 0===K?void 0:K.datos_combinados)||(null===K||void 0===K?void 0:K.forecast_mensual);return e?null!==K&&void 0!==K&&K.datos_combinados?e.map(e=>({mes:"".concat(e.mes,"/").concat(e.a\u00f1o),"a\xf1o":e.a\u00f1o,mesNum:e.mes,ingresos:e.ingresos,egresos:e.egresos,balance:e.balance,tipo:e.tipo})):e.map(e=>({mes:"".concat(e.Mes,"/").concat(e.A\u00f1o),"a\xf1o":e.A\u00f1o,mesNum:e.Mes,ingresos:e.Ingresos_Esperados,egresos:e.Egresos_Esperados,balance:e.Balance_Neto_Esperado})):[]})(),U=()=>{if(!O)return-1;for(let e=0;e<O.length;e++)if("estimado"===O[e].tipo)return e;return-1},q=()=>{var e;const s=U();return s<=0?null:null===(e=O[s])||void 0===e?void 0:e.mes};return(0,W.jsxs)(t.A,{sx:{width:"100%",minHeight:"100vh",p:3},children:[(0,W.jsx)(n.A,{variant:"h4",gutterBottom:!0,children:"Pron\xf3stico Continuo (Rolling Forecast)"}),(0,W.jsx)(n.A,{variant:"subtitle1",gutterBottom:!0,sx:{mb:3},children:"Gener\xe1 proyecciones financieras en tiempo real basadas en tu historial"}),(0,W.jsx)(a.A,{sx:{p:3,mb:3},children:(0,W.jsxs)(t.A,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"wrap"},children:[(0,W.jsxs)(i.A,{sx:{minWidth:200},children:[(0,W.jsx)(l.A,{children:"Horizonte"}),(0,W.jsx)(c.A,{value:e,onChange:e=>s(e.target.value),label:"Horizonte",size:"medium",children:T.map(e=>(0,W.jsx)(d.A,{value:e.value,children:e.label},e.value))})]}),(0,W.jsx)(u.A,{variant:"contained",color:"primary",onClick:async()=>{E(!0),B(null),z(!1);try{const s=await I.A.post("".concat(N.A.PRONOSTICO,"/api/forecasts/rolling?horizonteMeses=").concat(e));P(s.data),z(!0)}catch(r){var s,o;console.error("Error generando forecast:",r),B((null===(s=r.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||"Error al generar el forecast. Por favor intenta nuevamente.")}finally{E(!1)}},disabled:o,size:"large",sx:{height:56},children:o?"Generando...":"Generar Forecast"})]})}),_&&(0,W.jsx)(m.A,{severity:"error",sx:{mb:3},onClose:()=>B(null),children:_}),o&&(0,W.jsx)(w.A,{message:"Generando pron\xf3stico... Esto puede tomar unos momentos."}),R&&!o&&K&&(0,W.jsx)(W.Fragment,{children:(0,W.jsxs)(a.A,{sx:{p:3,mb:3},children:[(0,W.jsxs)(t.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(n.A,{variant:"h6",sx:{mr:3},children:"Visualizaci\xf3n"}),(0,W.jsxs)(h.A,{value:C,exclusive:!0,onChange:(e,s)=>s&&F(s),size:"small",children:[(0,W.jsx)(g.A,{value:"todos",children:"Todos"}),(0,W.jsx)(g.A,{value:"ingresos",children:"Solo Ingresos"}),(0,W.jsx)(g.A,{value:"egresos",children:"Solo Egresos"}),(0,W.jsx)(g.A,{value:"balance",children:"Solo Balance"})]})]}),(0,W.jsx)(f.u,{width:"100%",height:400,children:(0,W.jsxs)(S.b,{data:O,children:[(0,W.jsx)(p.d,{strokeDasharray:"3 3"}),(0,W.jsx)(b.W,{dataKey:"mes"}),(0,W.jsx)(A.h,{}),(0,W.jsx)(j.m,{formatter:e=>"$".concat(e.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}))}),(0,W.jsx)(x.s,{}),q()&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(v.e,{x:q(),stroke:"#9e9e9e",strokeWidth:2,strokeDasharray:"3 3",label:{value:"Estimado",position:"top",fill:"#9e9e9e"}}),(0,W.jsx)(k.T,{x1:q(),fill:"#e3f2fd",fillOpacity:.3})]}),(()=>{const e=U()>0;switch(C){case"ingresos":return e?(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(y.N,{dataKey:"ingresos",stroke:"#2e7d32",strokeWidth:2,name:"Ingresos",dot:!1})}):(0,W.jsx)(y.N,{type:"monotone",dataKey:"ingresos",stroke:"#4caf50",strokeWidth:2,name:"Ingresos"});case"egresos":return e?(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(y.N,{dataKey:"egresos",stroke:"#c62828",strokeWidth:2,name:"Egresos",dot:!1})}):(0,W.jsx)(y.N,{type:"monotone",dataKey:"egresos",stroke:"#f44336",strokeWidth:2,name:"Egresos"});case"balance":return e?(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(y.N,{dataKey:"balance",stroke:"#1565c0",strokeWidth:2,name:"Balance",dot:!1})}):(0,W.jsx)(y.N,{type:"monotone",dataKey:"balance",stroke:"#2196f3",strokeWidth:2,name:"Balance"});default:return e?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(y.N,{dataKey:"ingresos",stroke:"#2e7d32",strokeWidth:2,name:"Ingresos",dot:!1}),(0,W.jsx)(y.N,{dataKey:"egresos",stroke:"#c62828",strokeWidth:2,name:"Egresos",dot:!1}),(0,W.jsx)(y.N,{dataKey:"balance",stroke:"#1565c0",strokeWidth:2,name:"Balance",dot:!1})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(y.N,{type:"monotone",dataKey:"ingresos",stroke:"#4caf50",strokeWidth:2,name:"Ingresos"}),(0,W.jsx)(y.N,{type:"monotone",dataKey:"egresos",stroke:"#f44336",strokeWidth:2,name:"Egresos"}),(0,W.jsx)(y.N,{type:"monotone",dataKey:"balance",stroke:"#2196f3",strokeWidth:2,name:"Balance"})]})}})()]})})]})})]})}}}]);
//# sourceMappingURL=4787.83df91da.chunk.js.map