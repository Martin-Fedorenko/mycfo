"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5115,5619],{3241:(e,n,t)=>{t.d(n,{A:()=>g});var r=t(89379),s=t(80045),i=t(65043),a=t(58387),o=t(31807),l=t(97194),c=t(55895),d=t(98736),h=t(68700),A=t(58128),x=t(51612),u=t(28301),m=t(21657),p=t(70579);const v=["children","className","component","disablePointerEvents","disableTypography","position","variant"];var j;const f=(0,A.Ay)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:t}=e;return[n.root,n["position".concat((0,l.A)(t.position))],!0===t.disablePointerEvents&&n.disablePointerEvents,n[t.variant]]}})((0,x.A)(e=>{let{theme:n}=e;return{display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(n.vars||n).palette.action.active,variants:[{props:{variant:"filled"},style:{["&.".concat(m.A.positionStart,"&:not(.").concat(m.A.hiddenLabel,")")]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}})),g=i.forwardRef(function(e,n){const t=(0,u.b)({props:e,name:"MuiInputAdornment"}),{children:A,className:x,component:g="div",disablePointerEvents:y=!1,disableTypography:b=!1,position:C,variant:E}=t,w=(0,s.A)(t,v),S=(0,h.A)()||{};let M=E;E&&S.variant,S&&!M&&(M=S.variant);const k=(0,r.A)((0,r.A)({},t),{},{hiddenLabel:S.hiddenLabel,size:S.size,disablePointerEvents:y,position:C,variant:M}),L=(e=>{const{classes:n,disablePointerEvents:t,hiddenLabel:r,position:s,size:i,variant:a}=e,c={root:["root",t&&"disablePointerEvents",s&&"position".concat((0,l.A)(s)),a,r&&"hiddenLabel",i&&"size".concat((0,l.A)(i))]};return(0,o.A)(c,m.P,n)})(k);return(0,p.jsx)(d.A.Provider,{value:null,children:(0,p.jsx)(f,(0,r.A)((0,r.A)({as:g,ownerState:k,className:(0,a.A)(L.root,x),ref:n},w),{},{children:"string"!==typeof A||b?(0,p.jsxs)(i.Fragment,{children:["start"===C?j||(j=(0,p.jsx)("span",{className:"notranslate","aria-hidden":!0,children:"\u200b"})):null,A]}):(0,p.jsx)(c.A,{color:"textSecondary",children:A})}))})})},12043:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(14057),s=t(70579);const i=(0,r.A)((0,s.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},15115:(e,n,t)=>{t.r(n),t.d(n,{default:()=>T});var r=t(65043),s=t(53969),i=t(55895),a=t(94799),o=t(53089),l=t(24343),c=t(3241),d=t(10256),h=t(3353),A=t(9446),x=t(88889),u=t(70298),m=t(56647),p=t(46471),v=t(91244),j=t(16128),f=t(95563),g=t(12097),y=t(56465),b=t(63745),C=t(12043),E=t(16936),w=t(14057),S=t(70579);const M=(0,w.A)((0,S.jsx)("path",{d:"M12 19c0-3.87 3.13-7 7-7 1.08 0 2.09.25 3 .68V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h8.08c-.05-.33-.08-.66-.08-1M4 6l8 5 8-5v2l-8 5-8-5zm13.34 16-3.54-3.54 1.41-1.41 2.12 2.12 4.24-4.24L23 16.34z"}),"MarkEmailRead"),k=(0,w.A)((0,S.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckBox"),L=(0,w.A)((0,S.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"CheckBoxOutlineBlank");var R=t(29001),I=t(87984);var N=t(30342),P=t(18448);function T(){const[e,n]=r.useState(""),[w,T]=r.useState("all"),[z,B]=r.useState("all"),[_,O]=r.useState(0),[V,D]=r.useState(null),[F,H]=r.useState([]),W=(0,R.Zp)(),{userId:q,isAuthenticated:G}=(0,N.A)(),{items:U,unread:Y,loading:Z,error:X,reload:J,markOneRead:K}=function(e){const[n,s]=(0,r.useState)([]),[i,a]=(0,r.useState)(0),[o,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),h=(0,r.useCallback)(async()=>{if(!e)return s([]),void a(0);try{l(!0),d(null);const n=await(0,I.Tr)({userId:e,status:"unread",limit:50});s(n.items||[]),a("number"===typeof n.unread?n.unread:(n.items||[]).length)}catch(n){console.error("Error obteniendo notificaciones:",n),d(n)}finally{l(!1)}},[e]);(0,r.useEffect)(()=>{if(!e)return s([]),void a(0);let n=!1;const t=async()=>{await h(),n||setTimeout(t,1e4)};return t(),()=>{n=!0}},[h,e]),(0,r.useEffect)(()=>{const e=e=>{var n;const t=null===(n=e.detail)||void 0===n?void 0:n.id;t&&(s(e=>e.filter(e=>e.id!==t)),a(e=>Math.max(0,e-1)))},n=()=>{s([]),a(0)};return window.addEventListener("notification-mark-read",e),window.addEventListener("notification-mark-all-read",n),()=>{window.removeEventListener("notification-mark-read",e),window.removeEventListener("notification-mark-all-read",n)}},[]);const A=(0,r.useCallback)(async n=>{if(e)try{await(0,I.aI)({userId:e,notifId:n}),s(e=>e.filter(e=>e.id!==n)),a(e=>Math.max(0,e-1)),window.dispatchEvent(new CustomEvent("notification-mark-read",{detail:{id:n}}))}catch(c){console.error("Error marcando como le\xedda:",c)}},[e]),x=(0,r.useCallback)(async()=>{if(e)try{const{markAllRead:n}=await Promise.resolve().then(t.bind(t,87984));await n(e),s([]),a(0),window.dispatchEvent(new CustomEvent("notification-mark-all-read"))}catch(c){console.error("Error marcando todas como le\xeddas:",c)}},[e]);return{items:n,unread:i,loading:o,error:c,reload:h,markOneRead:A,markAllAsRead:x,isWebSocketConnected:!0}}(G?q:null),Q=r.useMemo(()=>{let n=U;return e&&(n=n.filter(n=>n.title.toLowerCase().includes(e.toLowerCase())||n.body.toLowerCase().includes(e.toLowerCase()))),"all"!==w&&(n=n.filter(e=>e.badge===w)),"all"!==z&&(n=n.filter(e=>e.badge===z)),n},[U,e,w,z]),$=Math.ceil(Q.length/10),ee=Q.slice(10*_,10*(_+1));return(0,S.jsxs)(s.A,{sx:{p:3},children:[(0,S.jsxs)(s.A,{sx:{mb:3},children:[(0,S.jsx)(i.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Centro de Notificaciones"}),(0,S.jsx)(i.A,{variant:"body1",sx:{color:"text.primary"},children:"Gestiona todas tus notificaciones y alertas"})]}),(0,S.jsxs)(a.A,{sx:{p:2,mb:3},children:[(0,S.jsxs)(o.A,{container:!0,spacing:2,alignItems:"center",children:[(0,S.jsx)(o.A,{item:!0,xs:12,md:4,children:(0,S.jsx)(l.A,{fullWidth:!0,placeholder:"Buscar notificaciones...",value:e,onChange:e=>{n(e.target.value),O(0)},InputProps:{startAdornment:(0,S.jsx)(c.A,{position:"start",children:(0,S.jsx)(b.A,{})})}})}),(0,S.jsx)(o.A,{item:!0,xs:12,md:3,children:(0,S.jsxs)(d.A,{fullWidth:!0,children:[(0,S.jsx)(h.A,{children:"Tipo"}),(0,S.jsxs)(A.A,{value:w,label:"Tipo",onChange:e=>{return n="type",t=e.target.value,"type"===n?T(t):"severity"===n&&B(t),void O(0);var n,t},children:[(0,S.jsx)(x.A,{value:"all",children:"Todos los tipos"}),(0,S.jsx)(x.A,{value:"MOVEMENT_NEW",children:"Nuevos Movimientos"}),(0,S.jsx)(x.A,{value:"BUDGET_EXCEEDED",children:"Presupuestos Excedidos"}),(0,S.jsx)(x.A,{value:"CASH_FLOW_ALERT",children:"Alertas Cash Flow"}),(0,S.jsx)(x.A,{value:"REPORT_READY",children:"Reportes Listos"}),(0,S.jsx)(x.A,{value:"REMINDER_CUSTOM",children:"Recordatorios"})]})]})}),(0,S.jsx)(o.A,{item:!0,xs:12,md:2,children:(0,S.jsxs)(u.A,{direction:"row",spacing:1,children:[(0,S.jsx)(m.A,{onClick:e=>{D(e.currentTarget)},children:(0,S.jsx)(C.A,{})}),(0,S.jsx)(m.A,{onClick:()=>W("/configuracion-notificaciones"),children:(0,S.jsx)(E.A,{})})]})})]}),(0,S.jsxs)(p.A,{anchorEl:V,open:Boolean(V),onClose:()=>{D(null)},children:[(0,S.jsx)(x.A,{onClick:()=>{F.length===Q.length?H([]):H(Q.map(e=>e.id))},children:F.length===Q.length?"Deseleccionar todo":"Seleccionar todo"}),F.length>0&&(0,S.jsxs)(x.A,{onClick:async()=>{try{for(const e of F)await K(e);H([])}catch(X){console.error("Error marcando como le\xeddas:",X)}},children:[(0,S.jsx)(M,{sx:{mr:1}}),"Marcar como le\xeddas"]})]})]}),(0,S.jsxs)(o.A,{container:!0,spacing:2,sx:{mb:3},children:[(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(i.A,{color:"text.secondary",gutterBottom:!0,children:"Total"}),(0,S.jsx)(i.A,{variant:"h5",children:U.length})]})})}),(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(i.A,{color:"text.secondary",gutterBottom:!0,children:"Sin leer"}),(0,S.jsx)(i.A,{variant:"h5",color:"error",children:Y})]})})}),(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(i.A,{color:"text.secondary",gutterBottom:!0,children:"Filtradas"}),(0,S.jsx)(i.A,{variant:"h5",children:Q.length})]})})}),(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(i.A,{color:"text.secondary",gutterBottom:!0,children:"Seleccionadas"}),(0,S.jsx)(i.A,{variant:"h5",children:F.length})]})})})]}),(0,S.jsx)(a.A,{children:Z?(0,S.jsx)(s.A,{sx:{p:4,textAlign:"center"},children:(0,S.jsx)(i.A,{children:"Cargando notificaciones..."})}):X?(0,S.jsx)(s.A,{sx:{p:4,textAlign:"center"},children:(0,S.jsxs)(i.A,{color:"error",children:["Error al cargar las notificaciones: ",X.message]})}):0===ee.length?(0,S.jsx)(s.A,{sx:{p:4,textAlign:"center"},children:(0,S.jsx)(i.A,{color:"text.secondary",children:"No hay notificaciones que coincidan con los filtros"})}):(0,S.jsxs)(S.Fragment,{children:[ee.map(e=>(0,S.jsxs)(v.A,{sx:{mb:1,opacity:e.is_read?.7:1,borderLeft:e.is_read?"none":"4px solid #2e7d67",backgroundColor:F.includes(e.id)?"action.selected":"background.paper"},children:[(0,S.jsx)(j.A,{children:(0,S.jsx)(s.A,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:(0,S.jsxs)(s.A,{sx:{flex:1},children:[(0,S.jsx)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:(0,S.jsx)(i.A,{variant:"h6",sx:{fontWeight:e.is_read?"normal":"bold",flex:1},children:e.title})}),(0,S.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:(0,P.ZV)(e.body)}),(0,S.jsx)(i.A,{variant:"caption",color:"text.secondary",children:(0,P.Yq)(e.date)})]})})}),(0,S.jsxs)(f.A,{children:[(0,S.jsx)(g.A,{size:"small",startIcon:F.includes(e.id)?(0,S.jsx)(k,{}):(0,S.jsx)(L,{}),onClick:()=>{return n=e.id,void H(e=>e.includes(n)?e.filter(e=>e!==n):[...e,n]);var n},color:F.includes(e.id)?"primary":"default",variant:F.includes(e.id)?"contained":"outlined",children:"Seleccionar"}),!e.is_read&&(0,S.jsx)(g.A,{size:"small",startIcon:(0,S.jsx)(M,{}),onClick:()=>K(e.id),color:"success",variant:"outlined",children:"Marcar como le\xedda"})]})]},e.id)),$>1&&(0,S.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,S.jsx)(y.A,{count:$,page:_+1,onChange:(e,n)=>O(n-1),color:"primary"})})]})})]})}},16128:(e,n,t)=>{t.d(n,{A:()=>p});var r=t(89379),s=t(80045),i=t(65043),a=t(58387),o=t(31807),l=t(58128),c=t(28301),d=t(79857),h=t(86061);function A(e){return(0,h.Ay)("MuiCardContent",e)}(0,d.A)("MuiCardContent",["root"]);var x=t(70579);const u=["className","component"],m=(0,l.Ay)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}}),p=i.forwardRef(function(e,n){const t=(0,c.b)({props:e,name:"MuiCardContent"}),{className:i,component:l="div"}=t,d=(0,s.A)(t,u),h=(0,r.A)((0,r.A)({},t),{},{component:l}),p=(e=>{const{classes:n}=e;return(0,o.A)({root:["root"]},A,n)})(h);return(0,x.jsx)(m,(0,r.A)({as:l,className:(0,a.A)(p.root,i),ownerState:h,ref:n},d))})},16936:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(14057),s=t(70579);const i=(0,r.A)((0,s.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings")},21657:(e,n,t)=>{t.d(n,{A:()=>a,P:()=>i});var r=t(79857),s=t(86061);function i(e){return(0,s.Ay)("MuiInputAdornment",e)}const a=(0,r.A)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"])},55619:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});t(65043);var r=t(15115),s=t(70579);function i(e){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r.default,{})})}},63745:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(14057),s=t(70579);const i=(0,r.A)((0,s.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search")},95563:(e,n,t)=>{t.d(n,{A:()=>p});var r=t(89379),s=t(80045),i=t(65043),a=t(58387),o=t(31807),l=t(58128),c=t(28301),d=t(79857),h=t(86061);function A(e){return(0,h.Ay)("MuiCardActions",e)}(0,d.A)("MuiCardActions",["root","spacing"]);var x=t(70579);const u=["disableSpacing","className"],m=(0,l.Ay)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:t}=e;return[n.root,!t.disableSpacing&&n.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),p=i.forwardRef(function(e,n){const t=(0,c.b)({props:e,name:"MuiCardActions"}),{disableSpacing:i=!1,className:l}=t,d=(0,s.A)(t,u),h=(0,r.A)((0,r.A)({},t),{},{disableSpacing:i}),p=(e=>{const{classes:n,disableSpacing:t}=e,r={root:["root",!t&&"spacing"]};return(0,o.A)(r,A,n)})(h);return(0,x.jsx)(m,(0,r.A)({className:(0,a.A)(p.root,l),ownerState:h,ref:n},d))})}}]);
//# sourceMappingURL=5619.2977fd3c.chunk.js.map