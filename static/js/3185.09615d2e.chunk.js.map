{"version":3,"file":"static/js/3185.09615d2e.chunk.js","mappings":"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","sources":["../node_modules/@mui/icons-material/esm/Mic.js","registro/carga-general/components/CargaAudio.js"],"sourcesContent":["\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z\"\n}), 'Mic');","import React, { useState } from \"react\";\r\nimport { Box, Paper, IconButton, Alert, CircularProgress, Typography } from \"@mui/material\";\r\nimport { Mic, Close, Delete } from \"@mui/icons-material\";\r\nimport CustomButton from \"../../../shared-components/CustomButton\";\r\nimport axios from \"axios\";\r\nimport { styled, keyframes } from \"@mui/material/styles\";\r\n\r\nconst pulse = keyframes`\r\n  0% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0.6); }\r\n  50% { box-shadow: 0 0 0 20px rgba(76, 175, 239, 0); }\r\n  100% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0); }\r\n`;\r\n\r\nconst BigRecordButton = styled(IconButton)(({ theme, recording }) => ({\r\n  width: 100,\r\n  height: 100,\r\n  borderRadius: \"50%\",\r\n  color: \"#fff\",\r\n  backgroundColor: recording ? theme.palette.error.main : theme.palette.primary.main,\r\n  ...(recording && { animation: `${pulse} 1.5s infinite` }),\r\n}));\r\n\r\nconst tipoMovimientoMap = {\r\n  Movimiento: \"Movimiento\",\r\n  Ingreso: \"Ingreso\",\r\n  Egreso: \"Egreso\",\r\n  Deuda: \"Deuda\",\r\n  Acreencia: \"Acreencia\",\r\n  Factura: \"Factura\",\r\n};\r\n\r\nexport default function CargaAudio({ tipoDoc, endpoint, onResultado }) {\r\n  const [grabando, setGrabando] = useState(false);\r\n  const [mediaRecorder, setMediaRecorder] = useState(null);\r\n  const [audioUrl, setAudioUrl] = useState(null);\r\n  const [audioFile, setAudioFile] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [cargando, setCargando] = useState(false);\r\n  const [parseWarning, setParseWarning] = useState(null);\r\n\r\n  const startRecording = async () => {\r\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n    const recorder = new MediaRecorder(stream);\r\n    let chunks = [];\r\n\r\n    recorder.ondataavailable = (e) => chunks.push(e.data);\r\n    recorder.onstop = () => {\r\n      const blob = new Blob(chunks, { type: \"audio/webm\" });\r\n      setAudioUrl(URL.createObjectURL(blob));\r\n      setAudioFile(new File([blob], \"grabacion.webm\", { type: \"audio/webm\" }));\r\n      stream.getTracks().forEach((t) => t.stop());\r\n    };\r\n\r\n    setParseWarning(null);\r\n    setError(null);\r\n    setMediaRecorder(recorder);\r\n    recorder.start();\r\n    setGrabando(true);\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorder) {\r\n      mediaRecorder.stop();\r\n    }\r\n    setGrabando(false);\r\n  };\r\n\r\n  const eliminarGrabacion = () => {\r\n    setAudioUrl(null);\r\n    setAudioFile(null);\r\n    setError(null);\r\n    setParseWarning(null);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!audioFile) return;\r\n    const usuarioSub = sessionStorage.getItem(\"sub\");\r\n    if (!usuarioSub) {\r\n      setError(\"No se encontró la sesión del usuario. Volvé a iniciar sesión.\");\r\n      return;\r\n    }\r\n\r\n    setCargando(true);\r\n    setError(null);\r\n    setParseWarning(null);\r\n    const archivo = audioFile;\r\n    const fd = new FormData();\r\n    fd.append(\"file\", archivo);\r\n    const tipoMovimiento = tipoMovimientoMap[tipoDoc];\r\n    if (tipoMovimiento && endpoint.includes(\"/movimientos/\")) {\r\n      fd.append(\"tipoMovimiento\", tipoMovimiento);\r\n    }\r\n    if (tipoDoc) {\r\n      fd.append(\"tipoDoc\", tipoDoc);\r\n    }\r\n    setAudioUrl(null);\r\n    setAudioFile(null);\r\n\r\n    try {\r\n      const response = await axios.post(endpoint, fd, {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n          \"X-Usuario-Sub\": usuarioSub,\r\n        },\r\n      });\r\n      console.log(\"Respuesta completa del audio:\", response.data);\r\n      const { campos, transcript, warnings } = response.data || {};\r\n      if (warnings?.length) {\r\n        console.warn(\"Advertencias al procesar audio:\", warnings);\r\n      }\r\n\r\n      const camposDetectados = campos && Object.entries(campos).some(([key, value]) => {\r\n        if (!key) return false;\r\n        if (key.toLowerCase() === \"moneda\") {\r\n          return false;\r\n        }\r\n        return !!value;\r\n      });\r\n\r\n      if (!camposDetectados) {\r\n        setParseWarning({\r\n          message: \"No se pudo interpretar el audio. Por favor grabalo nuevamente procurando mayor claridad.\",\r\n          transcript: transcript || \"Sin transcripción disponible.\",\r\n        });\r\n        console.warn(\"Procesamiento de audio sin campos detectados.\", { transcript, warnings });\r\n        return;\r\n      }\r\n\r\n      if (onResultado) {\r\n        onResultado(response.data);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"❌ Error en envío:\", err);\r\n      const mensaje = err.response?.data?.message || err.message || \"Error desconocido al procesar el audio.\";\r\n      setError(mensaje);\r\n    } finally {\r\n      setCargando(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ mt: 3, textAlign: \"center\" }}>\r\n      {!cargando && (\r\n        <BigRecordButton\r\n          sx={{ mt: 5 }}\r\n          recording={grabando ? 1 : 0}\r\n          onClick={grabando ? stopRecording : startRecording}\r\n        >\r\n          {grabando ? <Close /> : <Mic />}\r\n        </BigRecordButton>\r\n      )}\r\n\r\n      {!cargando && audioUrl && (\r\n        <>\r\n          <Paper\r\n            sx={{\r\n              mt: 1,\r\n              p: 1.5,\r\n              display: \"flex\",\r\n              justifyContent: \"space-between\",\r\n              alignItems: \"center\",\r\n              border: \"1px solid\",\r\n              borderColor: \"grey.400\",\r\n              borderRadius: 1,\r\n            }}\r\n          >\r\n            <audio controls src={audioUrl} />\r\n            <IconButton onClick={eliminarGrabacion} color=\"error\">\r\n              <Delete />\r\n            </IconButton>\r\n          </Paper>\r\n          <CustomButton\r\n            label=\"Enviar audio\"\r\n            width=\"100%\"\r\n            sx={{ mt: 2 }}\r\n            onClick={handleSubmit}\r\n          />\r\n        </>\r\n      )}\r\n\r\n      {cargando && (\r\n        <Box sx={{ mt: 4, display: \"flex\", justifyContent: \"center\" }}>\r\n          <CircularProgress size={40} />\r\n        </Box>\r\n      )}\r\n\r\n      <Box sx={{ mt: 3, textAlign: \"left\" }}>\r\n        {error && (\r\n          <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => setError(null)}>\r\n            {error}\r\n          </Alert>\r\n        )}\r\n\r\n        {parseWarning && (\r\n          <Alert severity=\"warning\" sx={{ mb: 2 }} onClose={() => setParseWarning(null)}>\r\n            <Typography sx={{ fontWeight: 600, mb: 1 }}>\r\n              {parseWarning.message}\r\n            </Typography>\r\n            <Typography variant=\"body2\">\r\n              Transcripción detectada: {parseWarning.transcript}\r\n            </Typography>\r\n          </Alert>\r\n        )}\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n"],"names":["createSvgIcon","_jsx","d","pulse","keyframes","_templateObject","_taggedTemplateLiteral","BigRecordButton","styled","IconButton","_ref","theme","recording","_objectSpread","width","height","borderRadius","color","backgroundColor","palette","error","main","primary","animation","concat","tipoMovimientoMap","Movimiento","Ingreso","Egreso","Deuda","Acreencia","Factura","CargaAudio","_ref2","tipoDoc","endpoint","onResultado","grabando","setGrabando","useState","mediaRecorder","setMediaRecorder","audioUrl","setAudioUrl","audioFile","setAudioFile","setError","cargando","setCargando","parseWarning","setParseWarning","_jsxs","Box","sx","mt","textAlign","children","onClick","stopRecording","stop","async","stream","navigator","mediaDevices","getUserMedia","audio","recorder","MediaRecorder","chunks","ondataavailable","e","push","data","onstop","blob","Blob","type","URL","createObjectURL","File","getTracks","forEach","t","start","Close","Mic","_Fragment","Paper","p","display","justifyContent","alignItems","border","borderColor","controls","src","eliminarGrabacion","Delete","CustomButton","label","usuarioSub","sessionStorage","getItem","archivo","fd","FormData","append","tipoMovimiento","includes","response","axios","post","headers","console","log","campos","transcript","warnings","length","warn","Object","entries","some","_ref3","key","value","toLowerCase","message","err","_err$response","_err$response$data","mensaje","CircularProgress","size","Alert","severity","mb","onClose","Typography","fontWeight","variant"],"sourceRoot":""}