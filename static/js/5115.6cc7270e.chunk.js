"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5115],{3241:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(89379),i=n(80045),s=n(65043),a=n(58387),o=n(31807),l=n(97194),c=n(55895),d=n(98736),x=n(68700),h=n(58128),m=n(51612),p=n(28301),A=n(21657),u=n(70579);const v=["children","className","component","disablePointerEvents","disableTypography","position","variant"];var j;const f=(0,h.Ay)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t["position".concat((0,l.A)(n.position))],!0===n.disablePointerEvents&&t.disablePointerEvents,t[n.variant]]}})((0,m.A)(e=>{let{theme:t}=e;return{display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(t.vars||t).palette.action.active,variants:[{props:{variant:"filled"},style:{["&.".concat(A.A.positionStart,"&:not(.").concat(A.A.hiddenLabel,")")]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}})),g=s.forwardRef(function(e,t){const n=(0,p.b)({props:e,name:"MuiInputAdornment"}),{children:h,className:m,component:g="div",disablePointerEvents:y=!1,disableTypography:b=!1,position:w,variant:C}=n,E=(0,i.A)(n,v),S=(0,x.A)()||{};let k=C;C&&S.variant,S&&!k&&(k=S.variant);const M=(0,r.A)((0,r.A)({},n),{},{hiddenLabel:S.hiddenLabel,size:S.size,disablePointerEvents:y,position:w,variant:k}),L=(e=>{const{classes:t,disablePointerEvents:n,hiddenLabel:r,position:i,size:s,variant:a}=e,c={root:["root",n&&"disablePointerEvents",i&&"position".concat((0,l.A)(i)),a,r&&"hiddenLabel",s&&"size".concat((0,l.A)(s))]};return(0,o.A)(c,A.P,t)})(M);return(0,u.jsx)(d.A.Provider,{value:null,children:(0,u.jsx)(f,(0,r.A)((0,r.A)({as:g,ownerState:M,className:(0,a.A)(L.root,m),ref:t},E),{},{children:"string"!==typeof h||b?(0,u.jsxs)(s.Fragment,{children:["start"===w?j||(j=(0,u.jsx)("span",{className:"notranslate","aria-hidden":!0,children:"\u200b"})):null,h]}):(0,u.jsx)(c.A,{color:"textSecondary",children:h})}))})})},12043:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(14057),i=n(70579);const s=(0,r.A)((0,i.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},15115:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var r=n(65043),i=n(53969),s=n(55895),a=n(94799),o=n(53089),l=n(24343),c=n(3241),d=n(10256),x=n(3353),h=n(9446),m=n(88889),p=n(70298),A=n(56647),u=n(46471),v=n(91244),j=n(16128),f=n(95563),g=n(12097),y=n(56465),b=n(63745),w=n(12043),C=n(16936),E=n(14057),S=n(70579);const k=(0,E.A)((0,S.jsx)("path",{d:"M12 19c0-3.87 3.13-7 7-7 1.08 0 2.09.25 3 .68V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h8.08c-.05-.33-.08-.66-.08-1M4 6l8 5 8-5v2l-8 5-8-5zm13.34 16-3.54-3.54 1.41-1.41 2.12 2.12 4.24-4.24L23 16.34z"}),"MarkEmailRead"),M=(0,E.A)((0,S.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckBox"),L=(0,E.A)((0,S.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"CheckBoxOutlineBlank");var R=n(29001),I=n(87984);var W=n(30342),N=n(18448);function P(){const[e,t]=r.useState(""),[E,P]=r.useState("all"),[B,T]=r.useState("all"),[z,_]=r.useState(0),[D,O]=r.useState(null),[V,H]=r.useState([]),F=(0,R.Zp)(),{userId:G,isAuthenticated:q}=(0,W.A)(),{items:U,unread:X,loading:Y,error:Z,reload:J,markOneRead:K}=function(e){const[t,i]=(0,r.useState)([]),[s,a]=(0,r.useState)(0),[o,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),x=(0,r.useCallback)(async()=>{if(!e)return i([]),void a(0);try{l(!0),d(null);const t=await(0,I.Tr)({userId:e,status:"unread",limit:50});i(t.items||[]),a("number"===typeof t.unread?t.unread:(t.items||[]).length)}catch(t){console.error("Error obteniendo notificaciones:",t),d(t)}finally{l(!1)}},[e]);(0,r.useEffect)(()=>{if(!e)return i([]),void a(0);let t=!1;const n=async()=>{await x(),t||setTimeout(n,1e4)};return n(),()=>{t=!0}},[x,e]),(0,r.useEffect)(()=>{const e=e=>{var t;const n=null===(t=e.detail)||void 0===t?void 0:t.id;n&&(i(e=>e.filter(e=>e.id!==n)),a(e=>Math.max(0,e-1)))},t=()=>{i([]),a(0)};return window.addEventListener("notification-mark-read",e),window.addEventListener("notification-mark-all-read",t),()=>{window.removeEventListener("notification-mark-read",e),window.removeEventListener("notification-mark-all-read",t)}},[]);const h=(0,r.useCallback)(async t=>{if(e)try{await(0,I.aI)({userId:e,notifId:t}),i(e=>e.filter(e=>e.id!==t)),a(e=>Math.max(0,e-1)),window.dispatchEvent(new CustomEvent("notification-mark-read",{detail:{id:t}}))}catch(c){console.error("Error marcando como le\xedda:",c)}},[e]),m=(0,r.useCallback)(async()=>{if(e)try{const{markAllRead:t}=await Promise.resolve().then(n.bind(n,87984));await t(e),i([]),a(0),window.dispatchEvent(new CustomEvent("notification-mark-all-read"))}catch(c){console.error("Error marcando todas como le\xeddas:",c)}},[e]);return{items:t,unread:s,loading:o,error:c,reload:x,markOneRead:h,markAllAsRead:m,isWebSocketConnected:!0}}(q?G:null),Q=r.useMemo(()=>{let t=U;return e&&(t=t.filter(t=>t.title.toLowerCase().includes(e.toLowerCase())||t.body.toLowerCase().includes(e.toLowerCase()))),"all"!==E&&(t=t.filter(e=>e.badge===E)),"all"!==B&&(t=t.filter(e=>e.badge===B)),t},[U,e,E,B]),$=Math.ceil(Q.length/10),ee=Q.slice(10*z,10*(z+1));return(0,S.jsxs)(i.A,{sx:{width:"100%",maxWidth:{sm:"100%",md:"1700px"},mx:"auto",p:3},children:[(0,S.jsxs)(i.A,{sx:{mb:3},children:[(0,S.jsx)(s.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Centro de Notificaciones"}),(0,S.jsx)(s.A,{variant:"body1",sx:{color:"text.primary"},children:"Gestiona todas tus notificaciones y alertas"})]}),(0,S.jsxs)(a.A,{sx:{p:2,mb:3},children:[(0,S.jsxs)(o.A,{container:!0,spacing:2,alignItems:"center",children:[(0,S.jsx)(o.A,{item:!0,xs:12,md:4,children:(0,S.jsx)(l.A,{fullWidth:!0,placeholder:"Buscar notificaciones...",value:e,onChange:e=>{t(e.target.value),_(0)},InputProps:{startAdornment:(0,S.jsx)(c.A,{position:"start",children:(0,S.jsx)(b.A,{})})}})}),(0,S.jsx)(o.A,{item:!0,xs:12,md:3,children:(0,S.jsxs)(d.A,{fullWidth:!0,children:[(0,S.jsx)(x.A,{children:"Tipo"}),(0,S.jsxs)(h.A,{value:E,label:"Tipo",onChange:e=>{return t="type",n=e.target.value,"type"===t?P(n):"severity"===t&&T(n),void _(0);var t,n},children:[(0,S.jsx)(m.A,{value:"all",children:"Todos los tipos"}),(0,S.jsx)(m.A,{value:"MOVEMENT_NEW",children:"Nuevos Movimientos"}),(0,S.jsx)(m.A,{value:"BUDGET_EXCEEDED",children:"Presupuestos Excedidos"}),(0,S.jsx)(m.A,{value:"CASH_FLOW_ALERT",children:"Alertas Cash Flow"}),(0,S.jsx)(m.A,{value:"REPORT_READY",children:"Reportes Listos"}),(0,S.jsx)(m.A,{value:"REMINDER_CUSTOM",children:"Recordatorios"})]})]})}),(0,S.jsx)(o.A,{item:!0,xs:12,md:2,children:(0,S.jsxs)(p.A,{direction:"row",spacing:1,children:[(0,S.jsx)(A.A,{onClick:e=>{O(e.currentTarget)},children:(0,S.jsx)(w.A,{})}),(0,S.jsx)(A.A,{onClick:()=>F("/configuracion-notificaciones"),children:(0,S.jsx)(C.A,{})})]})})]}),(0,S.jsxs)(u.A,{anchorEl:D,open:Boolean(D),onClose:()=>{O(null)},children:[(0,S.jsx)(m.A,{onClick:()=>{V.length===Q.length?H([]):H(Q.map(e=>e.id))},children:V.length===Q.length?"Deseleccionar todo":"Seleccionar todo"}),V.length>0&&(0,S.jsxs)(m.A,{onClick:async()=>{try{for(const e of V)await K(e);H([])}catch(Z){console.error("Error marcando como le\xeddas:",Z)}},children:[(0,S.jsx)(k,{sx:{mr:1}}),"Marcar como le\xeddas"]})]})]}),(0,S.jsxs)(o.A,{container:!0,spacing:2,sx:{mb:3},children:[(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(s.A,{color:"text.primary",gutterBottom:!0,children:"Total"}),(0,S.jsx)(s.A,{variant:"h5",children:U.length})]})})}),(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(s.A,{color:"text.primary",gutterBottom:!0,children:"Sin leer"}),(0,S.jsx)(s.A,{variant:"h5",color:"error",children:X})]})})}),(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(s.A,{color:"text.primary",gutterBottom:!0,children:"Filtradas"}),(0,S.jsx)(s.A,{variant:"h5",children:Q.length})]})})}),(0,S.jsx)(o.A,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(v.A,{children:(0,S.jsxs)(j.A,{children:[(0,S.jsx)(s.A,{color:"text.primary",gutterBottom:!0,children:"Seleccionadas"}),(0,S.jsx)(s.A,{variant:"h5",children:V.length})]})})})]}),(0,S.jsx)(i.A,{children:Y?(0,S.jsx)(i.A,{sx:{p:4,textAlign:"center"},children:(0,S.jsx)(s.A,{children:"Cargando notificaciones..."})}):Z?(0,S.jsx)(i.A,{sx:{p:4,textAlign:"center"},children:(0,S.jsxs)(s.A,{color:"error",children:["Error al cargar las notificaciones: ",Z.message]})}):0===ee.length?(0,S.jsx)(i.A,{sx:{p:4,textAlign:"center"},children:(0,S.jsx)(s.A,{color:"text.secondary",children:"No hay notificaciones que coincidan con los filtros"})}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(i.A,{sx:{position:"relative",p:2},children:[(0,S.jsx)(o.A,{container:!0,columnSpacing:{xs:0,md:3},rowSpacing:2,sx:{alignItems:"stretch"},children:ee.map((e,t)=>(0,S.jsx)(o.A,{item:!0,xs:12,md:6,sx:{display:"flex",minWidth:0,pr:{md:t%2===0?1.5:0},pl:{md:t%2===0?0:1.5},flexBasis:{md:"calc(50% - 12px)"},maxWidth:{md:"calc(50% - 12px)"}},children:(0,S.jsxs)(v.A,{sx:{height:"100%",width:"100%",minWidth:0,boxSizing:"border-box",display:"flex",flexDirection:"column",opacity:e.is_read?.7:1,borderLeft:e.is_read?"none":"4px solid #008375",backgroundColor:V.includes(e.id)?"action.selected":"background.paper"},children:[(0,S.jsx)(j.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,minWidth:0},children:(0,S.jsx)(i.A,{sx:{display:"flex",alignItems:"flex-start",gap:2,minWidth:0},children:(0,S.jsxs)(i.A,{sx:{flex:1,minWidth:0},children:[(0,S.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,minWidth:0},children:(0,S.jsx)(s.A,{variant:"h6",sx:{fontWeight:e.is_read?"normal":"bold",flex:1,minWidth:0,wordBreak:"break-word",overflowWrap:"anywhere"},children:e.title})}),(0,S.jsx)(s.A,{variant:"body2",color:"text.primary",sx:{mb:1,wordBreak:"break-word",overflowWrap:"anywhere"},children:(0,N.ZV)(e.body)}),(0,S.jsx)(s.A,{variant:"caption",color:"text.primary",children:(0,N.Yq)(e.date)})]})})}),(0,S.jsxs)(f.A,{sx:{flexWrap:"wrap",gap:1,rowGap:1,pt:0},children:[(0,S.jsx)(g.A,{size:"small",startIcon:V.includes(e.id)?(0,S.jsx)(M,{}):(0,S.jsx)(L,{}),onClick:()=>{return t=e.id,void H(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},color:V.includes(e.id)?"primary":"default",variant:V.includes(e.id)?"contained":"outlined",children:"Seleccionar"}),!e.is_read&&(0,S.jsx)(g.A,{size:"small",startIcon:(0,S.jsx)(k,{}),onClick:()=>K(e.id),color:"success",variant:"outlined",children:"Marcar como le\xedda"})]})]})},e.id))}),(0,S.jsx)(i.A,{sx:{position:"absolute",top:0,bottom:0,left:"50%",width:"1px",bgcolor:"divider",display:{xs:"none",md:"block"},pointerEvents:"none",transform:"translateX(-0.5px)"}})]}),$>1&&(0,S.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,S.jsx)(y.A,{count:$,page:z+1,onChange:(e,t)=>_(t-1),color:"primary"})})]})})]})}},16128:(e,t,n)=>{n.d(t,{A:()=>u});var r=n(89379),i=n(80045),s=n(65043),a=n(58387),o=n(31807),l=n(58128),c=n(28301),d=n(79857),x=n(86061);function h(e){return(0,x.Ay)("MuiCardContent",e)}(0,d.A)("MuiCardContent",["root"]);var m=n(70579);const p=["className","component"],A=(0,l.Ay)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}}),u=s.forwardRef(function(e,t){const n=(0,c.b)({props:e,name:"MuiCardContent"}),{className:s,component:l="div"}=n,d=(0,i.A)(n,p),x=(0,r.A)((0,r.A)({},n),{},{component:l}),u=(e=>{const{classes:t}=e;return(0,o.A)({root:["root"]},h,t)})(x);return(0,m.jsx)(A,(0,r.A)({as:l,className:(0,a.A)(u.root,s),ownerState:x,ref:t},d))})},16936:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(14057),i=n(70579);const s=(0,r.A)((0,i.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings")},21657:(e,t,n)=>{n.d(t,{A:()=>a,P:()=>s});var r=n(79857),i=n(86061);function s(e){return(0,i.Ay)("MuiInputAdornment",e)}const a=(0,r.A)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"])},63745:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(14057),i=n(70579);const s=(0,r.A)((0,i.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search")},95563:(e,t,n)=>{n.d(t,{A:()=>u});var r=n(89379),i=n(80045),s=n(65043),a=n(58387),o=n(31807),l=n(58128),c=n(28301),d=n(79857),x=n(86061);function h(e){return(0,x.Ay)("MuiCardActions",e)}(0,d.A)("MuiCardActions",["root","spacing"]);var m=n(70579);const p=["disableSpacing","className"],A=(0,l.Ay)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),u=s.forwardRef(function(e,t){const n=(0,c.b)({props:e,name:"MuiCardActions"}),{disableSpacing:s=!1,className:l}=n,d=(0,i.A)(n,p),x=(0,r.A)((0,r.A)({},n),{},{disableSpacing:s}),u=(e=>{const{classes:t,disableSpacing:n}=e,r={root:["root",!n&&"spacing"]};return(0,o.A)(r,h,t)})(x);return(0,m.jsx)(A,(0,r.A)({className:(0,a.A)(u.root,l),ownerState:x,ref:t},d))})}}]);
//# sourceMappingURL=5115.6cc7270e.chunk.js.map