"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[2195],{38915:(e,r,n)=>{n.d(r,{A:()=>v});var s=n(79722),o=n(35644),t=n(29296),a=n(13658);const i=s.A.create(),c=a.A.PRONOSTICO,l={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let u=null,d=!1;const m=e=>Boolean(e&&c&&String(e).startsWith(String(c))),h=e=>{try{return sessionStorage.getItem(e)}catch(r){return console.warn("No se pudo leer sessionStorage:",r),null}},f=(e,r)=>{try{void 0!==r&&null!==r&&sessionStorage.setItem(e,r)}catch(n){console.warn("No se pudo escribir en sessionStorage:",n)}},g=()=>{if(!d){d=!0;try{sessionStorage.clear()}catch(e){}null!==t.m&&void 0!==t.m&&t.m.limpiarSesion&&t.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},p=()=>{const e=h("refreshToken"),r=(()=>{const e=h("email")||h("username");if(!e||!l.UserPoolId||!l.ClientId)return null;const r=new o.NE(l);return new o.TU({Username:e,Pool:r})})();if(!e||!r)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const n=new o.c9({RefreshToken:e});return new Promise((e,s)=>{r.refreshSession(n,(r,n)=>{if(r)return void s(r);const o=n.getAccessToken().getJwtToken(),t=n.getIdToken().getJwtToken(),a=n.getRefreshToken().getToken();f("accessToken",o),f("idToken",t),a&&f("refreshToken",a),e(o)})})};i.interceptors.request.use(e=>{const r=sessionStorage.getItem("accessToken");if(m(e.url)){var n;e.headers=null!==(n=e.headers)&&void 0!==n?n:{},r&&(e.headers.Authorization="Bearer ".concat(r));const s=sessionStorage.getItem("sub");s&&(e.headers["X-Usuario-Sub"]=s)}return e}),i.interceptors.response.use(e=>e,async e=>{const{config:r,response:n}=e;if(!r||!n||401!==n.status||!m(r.url))return Promise.reject(e);if(r.__isRetryRequest)return g(),Promise.reject(e);try{var s;const e=await(u||(u=p().then(e=>(u=null,e)).catch(e=>{throw u=null,e})),u);if(!e)throw new Error("No se obtuvo un token renovado.");return r.__isRetryRequest=!0,r.headers=null!==(s=r.headers)&&void 0!==s?s:{},r.headers.Authorization="Bearer ".concat(e),i(r)}catch(o){return g(),Promise.reject(o)}});const v=i},42195:(e,r,n)=>{n.r(r),n.d(r,{default:()=>v});var s=n(89379),o=n(65043),t=n(53969),a=n(80172),i=n(55895),c=n(91449),l=n(94799),u=n(24343),d=n(88889),m=n(12097),h=n(29001),f=n(13658),g=n(38915),p=n(70579);function v(){const{id:e}=(0,h.g)(),r=(0,h.Zp)(),[n,v]=o.useState(!1),[x,A]=o.useState(!!e),[j,b]=o.useState(null),[y,C]=o.useState(null),[S,T]=o.useState({nombre:"",horizonteMeses:6,mesesFrecuencia:6});o.useEffect(()=>{e&&w()},[e]);const w=async()=>{A(!0);try{const r=await g.A.get("".concat(f.A.PRONOSTICO,"/api/forecast-config/").concat(e));T({nombre:r.data.nombre||"",horizonteMeses:r.data.horizonteMeses||6,mesesFrecuencia:r.data.mesesFrecuencia||6})}catch(s){var r,n;console.error("Error cargando configuraci\xf3n:",s),b((null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Error al cargar la configuraci\xf3n.")}finally{A(!1)}},k=e=>r=>{T((0,s.A)((0,s.A)({},S),{},{[e]:r.target.value})),b(null),C(null)};if(x)return(0,p.jsx)(t.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:(0,p.jsx)(a.A,{})});const P=Array.from({length:24},(e,r)=>r+1);return(0,p.jsxs)(t.A,{sx:{p:3,maxWidth:600,mx:"auto"},children:[(0,p.jsx)(i.A,{variant:"h4",component:"h1",sx:{mb:3},children:e?"Editar Configuraci\xf3n":"Nueva Configuraci\xf3n de Pron\xf3stico"}),j&&(0,p.jsx)(c.A,{severity:"error",sx:{mb:2},onClose:()=>b(null),children:j}),y&&(0,p.jsx)(c.A,{severity:"success",sx:{mb:2},children:y}),(0,p.jsx)(l.A,{sx:{p:3},children:(0,p.jsxs)("form",{onSubmit:async n=>{if(n.preventDefault(),v(!0),b(null),C(null),!S.nombre||""===S.nombre.trim())return b("El nombre es requerido"),void v(!1);if(S.horizonteMeses<=0||S.mesesFrecuencia<=0)return b("El horizonte y la frecuencia deben ser mayores a 0"),void v(!1);try{e?(await g.A.put("".concat(f.A.PRONOSTICO,"/api/forecast-config/").concat(e),S),C("Configuraci\xf3n actualizada exitosamente"),setTimeout(()=>{r("/pronostico-fijo")},1500)):(await g.A.post("".concat(f.A.PRONOSTICO,"/api/forecast-config"),S),C("Configuraci\xf3n creada exitosamente"),setTimeout(()=>{r("/pronostico-fijo")},1500))}catch(t){var s,o;console.error("Error guardando configuraci\xf3n:",t),b((null===(s=t.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||"Error al guardar la configuraci\xf3n. Por favor intenta nuevamente.")}finally{v(!1)}},children:[(0,p.jsx)(u.A,{fullWidth:!0,label:"Nombre de la Configuraci\xf3n",value:S.nombre,onChange:k("nombre"),margin:"normal",required:!0,helperText:"Ej: Pron\xf3stico Semestral"}),(0,p.jsx)(u.A,{fullWidth:!0,select:!0,label:"Frecuencia de Generaci\xf3n",value:S.mesesFrecuencia,onChange:k("mesesFrecuencia"),margin:"normal",required:!0,helperText:"Cada cu\xe1ntos meses se generar\xe1 el pron\xf3stico autom\xe1ticamente",children:P.map(e=>(0,p.jsxs)(d.A,{value:e,children:["Cada ",e," ",1===e?"mes":"meses"]},e))}),(0,p.jsx)(u.A,{fullWidth:!0,select:!0,label:"Horizonte de Pron\xf3stico",value:S.horizonteMeses,onChange:k("horizonteMeses"),margin:"normal",required:!0,helperText:"Cantidad de meses a pronosticar hacia adelante",children:P.map(e=>(0,p.jsxs)(d.A,{value:e,children:[e," ",1===e?"mes":"meses"]},e))}),(0,p.jsxs)(t.A,{sx:{display:"flex",gap:2,mt:3,justifyContent:"flex-end"},children:[(0,p.jsx)(m.A,{variant:"outlined",onClick:()=>{r("/pronostico-fijo")},disabled:n,children:"Cancelar"}),(0,p.jsx)(m.A,{type:"submit",variant:"contained",disabled:n,children:n?(0,p.jsx)(a.A,{size:24}):e?"Actualizar":"Crear"})]})]})})]})}}}]);
//# sourceMappingURL=2195.39f373da.chunk.js.map