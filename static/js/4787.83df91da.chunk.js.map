{"version":3,"file":"static/js/4787.83df91da.chunk.js","mappings":"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","sources":["api/http.js","pronostico/pronostico-continuo/PronosticoContinuo.js"],"sourcesContent":["import axios from \"axios\";\r\nimport {\r\n  CognitoUserPool,\r\n  CognitoUser,\r\n  CognitoRefreshToken,\r\n} from \"amazon-cognito-identity-js\";\r\nimport { sessionService } from \"../shared-services/sessionService\";\r\nimport URL_CONFIG from \"../config/api-config\";\r\n\r\nconst http = axios.create();\r\nconst PRONOSTICO_BASE_URL = URL_CONFIG.PRONOSTICO;\r\nconst cognitoPoolConfig = {\r\n  UserPoolId: process.env.REACT_APP_COGNITO_USER_POOL_ID,\r\n  ClientId: process.env.REACT_APP_COGNITO_CLIENT_ID,\r\n};\r\n\r\nlet refreshPromise = null;\r\nlet hasForcedLogout = false;\r\n\r\nconst isPronosticoRequest = (url) =>\r\n  Boolean(\r\n    url &&\r\n      PRONOSTICO_BASE_URL &&\r\n      String(url).startsWith(String(PRONOSTICO_BASE_URL)),\r\n  );\r\n\r\nconst safeSessionGet = (key) => {\r\n  try {\r\n    return sessionStorage.getItem(key);\r\n  } catch (err) {\r\n    console.warn(\"No se pudo leer sessionStorage:\", err);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst safeSessionSet = (key, value) => {\r\n  try {\r\n    if (value !== undefined && value !== null) {\r\n      sessionStorage.setItem(key, value);\r\n    }\r\n  } catch (err) {\r\n    console.warn(\"No se pudo escribir en sessionStorage:\", err);\r\n  }\r\n};\r\n\r\nconst clearSessionAndRedirect = () => {\r\n  if (hasForcedLogout) {\r\n    return;\r\n  }\r\n  hasForcedLogout = true;\r\n  try {\r\n    sessionStorage.clear();\r\n  } catch {\r\n    /* noop */\r\n  }\r\n  if (sessionService?.limpiarSesion) {\r\n    sessionService.limpiarSesion();\r\n  }\r\n  if (typeof window !== \"undefined\") {\r\n    window.location.href = \"/#/signin\";\r\n  }\r\n};\r\n\r\nconst buildCognitoUser = () => {\r\n  const username = safeSessionGet(\"email\") || safeSessionGet(\"username\");\r\n  if (\r\n    !username ||\r\n    !cognitoPoolConfig.UserPoolId ||\r\n    !cognitoPoolConfig.ClientId\r\n  ) {\r\n    return null;\r\n  }\r\n  const pool = new CognitoUserPool(cognitoPoolConfig);\r\n  return new CognitoUser({\r\n    Username: username,\r\n    Pool: pool,\r\n  });\r\n};\r\n\r\nconst refreshTokens = () => {\r\n  const refreshTokenValue = safeSessionGet(\"refreshToken\");\r\n  const cognitoUser = buildCognitoUser();\r\n  if (!refreshTokenValue || !cognitoUser) {\r\n    return Promise.reject(new Error(\"No hay datos para renovar la sesión.\"));\r\n  }\r\n  const refreshToken = new CognitoRefreshToken({\r\n    RefreshToken: refreshTokenValue,\r\n  });\r\n  return new Promise((resolve, reject) => {\r\n    cognitoUser.refreshSession(refreshToken, (err, session) => {\r\n      if (err) {\r\n        reject(err);\r\n        return;\r\n      }\r\n      const nextAccessToken = session.getAccessToken().getJwtToken();\r\n      const nextIdToken = session.getIdToken().getJwtToken();\r\n      const nextRefreshToken = session.getRefreshToken().getToken();\r\n      safeSessionSet(\"accessToken\", nextAccessToken);\r\n      safeSessionSet(\"idToken\", nextIdToken);\r\n      if (nextRefreshToken) {\r\n        safeSessionSet(\"refreshToken\", nextRefreshToken);\r\n      }\r\n      resolve(nextAccessToken);\r\n    });\r\n  });\r\n};\r\n\r\nconst getRefreshPromise = () => {\r\n  if (!refreshPromise) {\r\n    refreshPromise = refreshTokens()\r\n      .then((token) => {\r\n        refreshPromise = null;\r\n        return token;\r\n      })\r\n      .catch((error) => {\r\n        refreshPromise = null;\r\n        throw error;\r\n      });\r\n  }\r\n  return refreshPromise;\r\n};\r\n\r\nhttp.interceptors.request.use((config) => {\r\n  const accessToken = sessionStorage.getItem(\"accessToken\");\r\n  if (isPronosticoRequest(config.url)) {\r\n    config.headers = config.headers ?? {};\r\n    if (accessToken) {\r\n      config.headers.Authorization = `Bearer ${accessToken}`;\r\n    }\r\n    const usuarioSub = sessionStorage.getItem(\"sub\");\r\n    if (usuarioSub) {\r\n      config.headers[\"X-Usuario-Sub\"] = usuarioSub;\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\nhttp.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    const { config, response } = error;\r\n    if (\r\n      !config ||\r\n      !response ||\r\n      response.status !== 401 ||\r\n      !isPronosticoRequest(config.url)\r\n    ) {\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    if (config.__isRetryRequest) {\r\n      clearSessionAndRedirect();\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    try {\r\n      const newAccessToken = await getRefreshPromise();\r\n      if (!newAccessToken) {\r\n        throw new Error(\"No se obtuvo un token renovado.\");\r\n      }\r\n      config.__isRetryRequest = true;\r\n      config.headers = config.headers ?? {};\r\n      config.headers.Authorization = `Bearer ${newAccessToken}`;\r\n      return http(config);\r\n    } catch (refreshError) {\r\n      clearSessionAndRedirect();\r\n      return Promise.reject(refreshError);\r\n    }\r\n  },\r\n);\r\n\r\nexport default http;\r\n","import * as React from 'react';\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Button,\r\n  Paper,\r\n  MenuItem,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  ToggleButton,\r\n  ToggleButtonGroup,\r\n  Alert\r\n} from '@mui/material';\r\nimport {\r\n  LineChart,\r\n  Line,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip,\r\n  CartesianGrid,\r\n  Legend,\r\n  ResponsiveContainer,\r\n  ReferenceLine,\r\n  ReferenceArea\r\n} from 'recharts';\r\nimport LoadingSpinner from '../../shared-components/LoadingSpinner';\r\nimport API_CONFIG from '../../config/api-config';\r\nimport http from '../../api/http';\r\n\r\n// Opciones de horizonte (en años)\r\nconst HORIZONTES = [\r\n  { label: '1 año', value: 12 },\r\n  { label: '2 años', value: 24 },\r\n  { label: '3 años', value: 36 },\r\n  { label: '4 años', value: 48 },\r\n  { label: '5 años', value: 60 }\r\n];\r\n\r\nexport default function PronosticoContinuo() {\r\n  const [horizonteMeses, setHorizonteMeses] = React.useState(12);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [forecastData, setForecastData] = React.useState(null);\r\n  const [error, setError] = React.useState(null);\r\n  const [viewMode, setViewMode] = React.useState('todos'); // 'todos', 'ingresos', 'egresos', 'balance'\r\n  const [hasGenerated, setHasGenerated] = React.useState(false);\r\n\r\n  const handleGenerarForecast = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    setHasGenerated(false);\r\n\r\n    try {\r\n      const response = await http.post(\r\n        `${API_CONFIG.PRONOSTICO}/api/forecasts/rolling?horizonteMeses=${horizonteMeses}`\r\n      );\r\n      \r\n      setForecastData(response.data);\r\n      setHasGenerated(true);\r\n    } catch (err) {\r\n      console.error('Error generando forecast:', err);\r\n      setError(err.response?.data?.message || 'Error al generar el forecast. Por favor intenta nuevamente.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const prepareChartData = () => {\r\n    // Usar datos_combinados si existe, sino forecast_mensual (retrocompatibilidad)\r\n    const datos = forecastData?.datos_combinados || forecastData?.forecast_mensual;\r\n    if (!datos) return [];\r\n\r\n    // Si usamos datos_combinados, ya tienen la estructura correcta\r\n    if (forecastData?.datos_combinados) {\r\n      return datos.map(item => ({\r\n        mes: `${item.mes}/${item.año}`,\r\n        año: item.año,\r\n        mesNum: item.mes,\r\n        ingresos: item.ingresos,\r\n        egresos: item.egresos,\r\n        balance: item.balance,\r\n        tipo: item.tipo // 'real' o 'estimado'\r\n      }));\r\n    }\r\n\r\n    // Retrocompatibilidad con forecast_mensual\r\n    return datos.map(item => ({\r\n      mes: `${item.Mes}/${item.Año}`,\r\n      año: item.Año,\r\n      mesNum: item.Mes,\r\n      ingresos: item.Ingresos_Esperados,\r\n      egresos: item.Egresos_Esperados,\r\n      balance: item.Balance_Neto_Esperado\r\n    }));\r\n  };\r\n\r\n  const chartData = prepareChartData();\r\n  \r\n  // Determinar el punto de cambio entre real y estimado\r\n  const getSplitPoint = () => {\r\n    if (!chartData) return -1;\r\n    for (let i = 0; i < chartData.length; i++) {\r\n      if (chartData[i].tipo === 'estimado') {\r\n        return i;\r\n      }\r\n    }\r\n    return -1;\r\n  };\r\n\r\n  const getLinesToDisplay = () => {\r\n    const splitPoint = getSplitPoint();\r\n    const hasRealAndEstimated = splitPoint > 0;\r\n\r\n    switch (viewMode) {\r\n      case 'ingresos':\r\n        if (hasRealAndEstimated) {\r\n          return (\r\n            <>\r\n              <Line \r\n                dataKey=\"ingresos\" \r\n                stroke=\"#2e7d32\" \r\n                strokeWidth={2} \r\n                name=\"Ingresos\" \r\n                dot={false}\r\n              />\r\n            </>\r\n          );\r\n        }\r\n        return <Line type=\"monotone\" dataKey=\"ingresos\" stroke=\"#4caf50\" strokeWidth={2} name=\"Ingresos\" />;\r\n      case 'egresos':\r\n        if (hasRealAndEstimated) {\r\n          return (\r\n            <>\r\n              <Line \r\n                dataKey=\"egresos\" \r\n                stroke=\"#c62828\" \r\n                strokeWidth={2} \r\n                name=\"Egresos\" \r\n                dot={false}\r\n              />\r\n            </>\r\n          );\r\n        }\r\n        return <Line type=\"monotone\" dataKey=\"egresos\" stroke=\"#f44336\" strokeWidth={2} name=\"Egresos\" />;\r\n      case 'balance':\r\n        if (hasRealAndEstimated) {\r\n          return (\r\n            <>\r\n              <Line \r\n                dataKey=\"balance\" \r\n                stroke=\"#1565c0\" \r\n                strokeWidth={2} \r\n                name=\"Balance\" \r\n                dot={false}\r\n              />\r\n            </>\r\n          );\r\n        }\r\n        return <Line type=\"monotone\" dataKey=\"balance\" stroke=\"#2196f3\" strokeWidth={2} name=\"Balance\" />;\r\n      case 'todos':\r\n      default:\r\n        if (hasRealAndEstimated) {\r\n          return (\r\n            <>\r\n              <Line dataKey=\"ingresos\" stroke=\"#2e7d32\" strokeWidth={2} name=\"Ingresos\" dot={false} />\r\n              <Line dataKey=\"egresos\" stroke=\"#c62828\" strokeWidth={2} name=\"Egresos\" dot={false} />\r\n              <Line dataKey=\"balance\" stroke=\"#1565c0\" strokeWidth={2} name=\"Balance\" dot={false} />\r\n            </>\r\n          );\r\n        }\r\n        return (\r\n          <>\r\n            <Line type=\"monotone\" dataKey=\"ingresos\" stroke=\"#4caf50\" strokeWidth={2} name=\"Ingresos\" />\r\n            <Line type=\"monotone\" dataKey=\"egresos\" stroke=\"#f44336\" strokeWidth={2} name=\"Egresos\" />\r\n            <Line type=\"monotone\" dataKey=\"balance\" stroke=\"#2196f3\" strokeWidth={2} name=\"Balance\" />\r\n          </>\r\n        );\r\n    }\r\n  };\r\n\r\n  const getSplitPointMes = () => {\r\n    const splitPoint = getSplitPoint();\r\n    if (splitPoint <= 0) return null;\r\n    return chartData[splitPoint]?.mes;\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ width: '100%', minHeight: '100vh', p: 3 }}>\r\n      <Typography variant=\"h4\" gutterBottom>\r\n        Pronóstico Continuo (Rolling Forecast)\r\n      </Typography>\r\n\r\n      <Typography variant=\"subtitle1\" gutterBottom sx={{ mb: 3 }}>\r\n        Generá proyecciones financieras en tiempo real basadas en tu historial\r\n      </Typography>\r\n\r\n      {/* Selector de horizonte y botón generar */}\r\n      <Paper sx={{ p: 3, mb: 3 }}>\r\n        <Box sx={{ display: 'flex', gap: 2, alignItems: 'center', flexWrap: 'wrap' }}>\r\n          <FormControl sx={{ minWidth: 200 }}>\r\n            <InputLabel>Horizonte</InputLabel>\r\n            <Select\r\n              value={horizonteMeses}\r\n              onChange={(e) => setHorizonteMeses(e.target.value)}\r\n              label=\"Horizonte\"\r\n              size=\"medium\"\r\n            >\r\n              {HORIZONTES.map((hor) => (\r\n                <MenuItem key={hor.value} value={hor.value}>\r\n                  {hor.label}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n          </FormControl>\r\n\r\n          <Button\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            onClick={handleGenerarForecast}\r\n            disabled={loading}\r\n            size=\"large\"\r\n            sx={{ height: 56 }}\r\n          >\r\n            {loading ? 'Generando...' : 'Generar Forecast'}\r\n          </Button>\r\n        </Box>\r\n      </Paper>\r\n\r\n      {/* Error message */}\r\n      {error && (\r\n        <Alert severity=\"error\" sx={{ mb: 3 }} onClose={() => setError(null)}>\r\n          {error}\r\n        </Alert>\r\n      )}\r\n\r\n      {/* Loading spinner */}\r\n      {loading && <LoadingSpinner message=\"Generando pronóstico... Esto puede tomar unos momentos.\" />}\r\n\r\n      {/* Contenido del forecast - solo mostrar si ya se generó */}\r\n      {hasGenerated && !loading && forecastData && (\r\n        <>\r\n          {/* Controles de visualización del gráfico */}\r\n          <Paper sx={{ p: 3, mb: 3 }}>\r\n            <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>\r\n              <Typography variant=\"h6\" sx={{ mr: 3 }}>\r\n                Visualización\r\n              </Typography>\r\n              <ToggleButtonGroup\r\n                value={viewMode}\r\n                exclusive\r\n                onChange={(e, newMode) => newMode && setViewMode(newMode)}\r\n                size=\"small\"\r\n              >\r\n                <ToggleButton value=\"todos\">\r\n                  Todos\r\n                </ToggleButton>\r\n                <ToggleButton value=\"ingresos\">\r\n                  Solo Ingresos\r\n                </ToggleButton>\r\n                <ToggleButton value=\"egresos\">\r\n                  Solo Egresos\r\n                </ToggleButton>\r\n                <ToggleButton value=\"balance\">\r\n                  Solo Balance\r\n                </ToggleButton>\r\n              </ToggleButtonGroup>\r\n            </Box>\r\n\r\n            {/* Gráfico */}\r\n            <ResponsiveContainer width=\"100%\" height={400}>\r\n              <LineChart data={chartData}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" />\r\n                <XAxis dataKey=\"mes\" />\r\n                <YAxis />\r\n                <Tooltip formatter={(value) => `$${value.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`} />\r\n                <Legend />\r\n                {getSplitPointMes() && (\r\n                  <>\r\n                    <ReferenceLine \r\n                      x={getSplitPointMes()} \r\n                      stroke=\"#9e9e9e\" \r\n                      strokeWidth={2} \r\n                      strokeDasharray=\"3 3\"\r\n                      label={{ value: \"Estimado\", position: \"top\", fill: \"#9e9e9e\" }}\r\n                    />\r\n                    <ReferenceArea \r\n                      x1={getSplitPointMes()} \r\n                      fill=\"#e3f2fd\" \r\n                      fillOpacity={0.3}\r\n                    />\r\n                  </>\r\n                )}\r\n                {getLinesToDisplay()}\r\n              </LineChart>\r\n            </ResponsiveContainer>\r\n          </Paper>\r\n        </>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n\r\n"],"names":["http","axios","create","PRONOSTICO_BASE_URL","URL_CONFIG","PRONOSTICO","cognitoPoolConfig","UserPoolId","process","ClientId","refreshPromise","hasForcedLogout","isPronosticoRequest","url","Boolean","String","startsWith","safeSessionGet","key","sessionStorage","getItem","err","console","warn","safeSessionSet","value","undefined","setItem","clearSessionAndRedirect","clear","_unused","sessionService","limpiarSesion","window","location","href","refreshTokens","refreshTokenValue","cognitoUser","buildCognitoUser","username","pool","CognitoUserPool","CognitoUser","Username","Pool","Promise","reject","Error","refreshToken","CognitoRefreshToken","RefreshToken","resolve","refreshSession","session","nextAccessToken","getAccessToken","getJwtToken","nextIdToken","getIdToken","nextRefreshToken","getRefreshToken","getToken","interceptors","request","use","config","accessToken","_config$headers","headers","Authorization","concat","usuarioSub","response","async","error","status","__isRetryRequest","_config$headers2","newAccessToken","then","token","catch","refreshError","HORIZONTES","label","PronosticoContinuo","horizonteMeses","setHorizonteMeses","React","loading","setLoading","forecastData","setForecastData","setError","viewMode","setViewMode","hasGenerated","setHasGenerated","chartData","prepareChartData","datos","datos_combinados","forecast_mensual","map","item","mes","año","mesNum","ingresos","egresos","balance","tipo","Mes","Año","Ingresos_Esperados","Egresos_Esperados","Balance_Neto_Esperado","getSplitPoint","i","length","getSplitPointMes","_chartData$splitPoint","splitPoint","_jsxs","Box","sx","width","minHeight","p","children","_jsx","Typography","variant","gutterBottom","mb","Paper","display","gap","alignItems","flexWrap","FormControl","minWidth","InputLabel","Select","onChange","e","target","size","hor","MenuItem","Button","color","onClick","post","API_CONFIG","data","_err$response","_err$response$data","message","disabled","height","Alert","severity","onClose","LoadingSpinner","_Fragment","mr","ToggleButtonGroup","exclusive","newMode","ToggleButton","ResponsiveContainer","LineChart","CartesianGrid","strokeDasharray","XAxis","dataKey","YAxis","Tooltip","formatter","toLocaleString","minimumFractionDigits","maximumFractionDigits","Legend","ReferenceLine","x","stroke","strokeWidth","position","fill","ReferenceArea","x1","fillOpacity","getLinesToDisplay","hasRealAndEstimated","Line","name","dot","type"],"sourceRoot":""}