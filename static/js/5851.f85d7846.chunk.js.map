{"version":3,"file":"static/js/5851.f85d7846.chunk.js","mappings":"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","sources":["utils/currency.js","pronostico/presupuesto/components/MonthRangeSelect.js","pronostico/presupuesto/components/PresupuestoNuevo.js","api/http.js","shared-components/tipoSelectStyles.js","shared-components/categorias.js"],"sourcesContent":["export const numberFormatter = new Intl.NumberFormat('es-AR', {\r\n  minimumFractionDigits: 0,\r\n  maximumFractionDigits: 2,\r\n});\r\n\r\nexport const formatCurrency = (value, { allowEmpty = false } = {}) => {\r\n  if (value === '' || value === null || typeof value === 'undefined') {\r\n    return allowEmpty ? '' : '$ 0';\r\n  }\r\n  const num = Number(value);\r\n  if (Number.isNaN(num)) {\r\n    return allowEmpty ? '' : '$ 0';\r\n  }\r\n  const sign = num < 0 ? '-' : '';\r\n  return `${sign}$ ${numberFormatter.format(Math.abs(num))}`;\r\n};\r\n\r\nexport const formatCurrencyInput = (value) => formatCurrency(value, { allowEmpty: true });\r\n\r\nexport const parseCurrency = (raw, { returnEmpty = false } = {}) => {\r\n  if (raw == null) return returnEmpty ? '' : 0;\r\n  const str = raw.toString().trim();\r\n  if (!str) return returnEmpty ? '' : 0;\r\n  const cleaned = str.replace(/\\s+/g, '').replace(/\\$/g, '');\r\n  const negative = cleaned.startsWith('-');\r\n  const numeric = cleaned.replace(/[^0-9,.-]/g, '');\r\n  if (!numeric || numeric === '-') return returnEmpty ? '' : 0;\r\n  const normalized = numeric\r\n    .replace(/-/g, '')\r\n    .replace(/\\./g, '')\r\n    .replace(',', '.');\r\n  const num = Number(normalized);\r\n  if (Number.isNaN(num)) return returnEmpty ? '' : 0;\r\n  return negative ? -num : num;\r\n};\r\n","import * as React from 'react';\r\nimport {\r\n  Box,\r\n  Button,\r\n  Popover,\r\n  Typography,\r\n  styled\r\n} from '@mui/material';\r\nimport { alpha } from '@mui/material/styles';\r\nimport ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown';\r\n\r\nconst SHORT_MONTH_LABELS = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];\r\n\r\nconst SelectButton = styled(Button)(({ theme }) => ({\r\n  width: '100%',\r\n  justifyContent: 'flex-start',\r\n  textTransform: 'none',\r\n  color: (theme.vars || theme).palette.text.primary,\r\n  backgroundColor: (theme.vars || theme).palette.background.default,\r\n  border: `1px solid ${(theme.vars || theme).palette.divider}`,\r\n  '&:hover': {\r\n    backgroundColor: (theme.vars || theme).palette.action.hover,\r\n  },\r\n  padding: theme.spacing(1),\r\n}));\r\n\r\nfunction formatMonthLabel(ym) {\r\n  if (!ym) return '';\r\n  const [year, month] = ym.split('-');\r\n  const monthIndex = Number(month) - 1;\r\n  return `${SHORT_MONTH_LABELS[monthIndex]} ${year}`;\r\n}\r\n\r\nfunction formatRangeLabel(from, to) {\r\n  if (!from && !to) return 'Mes inicial - Mes final';\r\n  if (!to) return `${formatMonthLabel(from)} - ...`;\r\n  return `${formatMonthLabel(from)} - ${formatMonthLabel(to)}`;\r\n}\r\n\r\nexport default function MonthRangeSelect({ value = {}, onChange }) {\r\n  const [anchorEl, setAnchorEl] = React.useState(null);\r\n  const [tempSelection, setTempSelection] = React.useState({ from: value.from, to: value.to });\r\n  const [yearOffset, setYearOffset] = React.useState(0);\r\n  \r\n  // Reset temp selection when value changes externally\r\n  React.useEffect(() => {\r\n    setTempSelection({ from: value.from, to: value.to });\r\n  }, [value.from, value.to]);\r\n\r\n  const handleOpen = (event) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n    // Reset temp selection to current value when closing without confirming\r\n    setTempSelection({ from: value.from, to: value.to });\r\n  };\r\n\r\n  const handleMonthClick = (yearMonth) => {\r\n    if (!tempSelection.from || tempSelection.to) {\r\n      // Start new selection\r\n      setTempSelection({ from: yearMonth, to: null });\r\n    } else {\r\n      // Complete selection\r\n      const fromDate = new Date(tempSelection.from + '-01');\r\n      const clickedDate = new Date(yearMonth + '-01');\r\n      \r\n      if (clickedDate < fromDate) {\r\n        // If clicking before current from, restart selection\r\n        setTempSelection({ from: yearMonth, to: null });\r\n      } else {\r\n        setTempSelection({ from: tempSelection.from, to: yearMonth });\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (tempSelection.from && tempSelection.to) {\r\n      onChange(tempSelection);\r\n      handleClose();\r\n    }\r\n  };\r\n\r\n  const handleClear = () => {\r\n    const emptySelection = { from: null, to: null };\r\n    setTempSelection(emptySelection);\r\n    onChange(emptySelection);\r\n  };\r\n\r\n  // Mostrar solo 2 años basados en el offset\r\n  const years = React.useMemo(() => {\r\n    const currentYear = new Date().getFullYear();\r\n    return Array.from({ length: 2 }, (_, i) => currentYear + yearOffset + i);\r\n  }, [yearOffset]);\r\n\r\n  const handleNavigateYears = (direction) => {\r\n    setYearOffset(prev => prev + (direction === 'up' ? -2 : 2));\r\n  };\r\n\r\n  const isBetween = (key, from, to) => {\r\n    if (!from || !to) return false;\r\n    return key > from && key < to;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <SelectButton \r\n        onClick={handleOpen}\r\n        endIcon={<ArrowDropDownIcon />}\r\n        sx={{\r\n          display: 'flex',\r\n          justifyContent: 'space-between',\r\n          '& .MuiButton-endIcon': {\r\n            marginLeft: 'auto',\r\n            marginRight: 0\r\n          }\r\n        }}\r\n      >\r\n        <Typography\r\n          sx={{\r\n            color: (!value.from && !value.to) ? 'text.secondary' : 'text.primary',\r\n            flex: 1,\r\n            textAlign: 'left'\r\n          }}\r\n        >\r\n          {formatRangeLabel(value.from, value.to)}\r\n        </Typography>\r\n      </SelectButton>\r\n      \r\n      <Popover\r\n        open={Boolean(anchorEl)}\r\n        anchorEl={anchorEl}\r\n        onClose={handleClose}\r\n        anchorOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'left',\r\n        }}\r\n        transformOrigin={{\r\n          vertical: 'top',\r\n          horizontal: 'left',\r\n        }}\r\n        slotProps={{\r\n          paper: {\r\n            sx: {\r\n              width: 'fit-content',\r\n              minWidth: 'unset',\r\n              maxWidth: 'none',\r\n              p: 1.5,\r\n            }\r\n          }\r\n        }}\r\n      >\r\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\r\n          {/* Botón navegación arriba */}\r\n          <Button\r\n            fullWidth\r\n            size=\"small\"\r\n            onClick={() => handleNavigateYears('up')}\r\n            sx={{ \r\n              borderRadius: 1,\r\n              minHeight: '20px',\r\n              height: '20px',\r\n              py: 0,\r\n              color: 'text.secondary'\r\n            }}\r\n          >\r\n            ⮝\r\n          </Button>\r\n\r\n          {/* Años visibles */}\r\n          {years.map(year => (\r\n            <Box \r\n              key={year} \r\n              sx={{ \r\n                mb: 0.5,\r\n                animation: 'fadeIn 0.3s ease-in-out',\r\n                '@keyframes fadeIn': {\r\n                  '0%': {\r\n                    opacity: 0,\r\n                    transform: 'translateY(10px)'\r\n                  },\r\n                  '100%': {\r\n                    opacity: 1,\r\n                    transform: 'translateY(0)'\r\n                  }\r\n                }\r\n              }}\r\n            >\r\n              <Typography variant=\"subtitle2\" sx={{ mb: 0.5, fontWeight: 'bold' }}>\r\n                {year}\r\n              </Typography>\r\n              <Box sx={{ display: 'grid', gridTemplateColumns: 'repeat(3, auto)', gap: 1 }}>\r\n                {Array.from({ length: 12 }, (_, monthIndex) => {\r\n                  const month = String(monthIndex + 1).padStart(2, '0');\r\n                  const yearMonth = `${year}-${month}`;\r\n                  \r\n                  return (\r\n                    <Button\r\n                      key={monthIndex}\r\n                      size=\"small\"\r\n                      onClick={() => handleMonthClick(yearMonth)}\r\n                      variant={yearMonth === tempSelection.from || yearMonth === tempSelection.to ? \"contained\" : \"outlined\"}\r\n                      color={yearMonth === tempSelection.from || yearMonth === tempSelection.to ? \"primary\" : \"inherit\"}\r\n                      sx={[\r\n                        { minWidth: 72 },\r\n                        isBetween(yearMonth, tempSelection.from, tempSelection.to)\r\n                          ? ((t) => {\r\n                              const p = (t.vars || t).palette;\r\n                              const dark = t.palette.mode === 'dark';\r\n\r\n                              // 1) Mejor caso: usar el canal para rgba(... / opacity)\r\n                              const bg =\r\n                                p.primary && p.primary.mainChannel\r\n                                  ? `rgba(${p.primary.mainChannel} / ${dark ? 0.22 : 0.15})`\r\n                                  // 2) Fallback seguro sin alpha() (usa un seleccionado neutro del theme)\r\n                                  : p.action?.selected ?? (dark ? 'rgba(255,255,255,0.12)' : 'rgba(0,0,0,0.06)');\r\n\r\n                              return {\r\n                                bgcolor: bg,\r\n                                color: p.primary.main,        // soporta var(...)\r\n                                borderColor: p.primary.main,  // soporta var(...)\r\n                                // resalta el “marco” en dark sin romper layout\r\n                                boxShadow: `inset 0 0 0 1.5px ${p.primary.main}`,\r\n                              };\r\n                            })\r\n                          : {}\r\n                      ]}\r\n                    >\r\n                      {SHORT_MONTH_LABELS[monthIndex]}\r\n                    </Button>\r\n                  );\r\n                })}\r\n              </Box>\r\n            </Box>\r\n          ))}\r\n\r\n          {/* Botón navegación abajo */}\r\n          <Button\r\n            fullWidth\r\n            size=\"small\"\r\n            onClick={() => handleNavigateYears('down')}\r\n            sx={{ \r\n              borderRadius: 1,\r\n              minHeight: '20px',\r\n              height: '20px',\r\n              py: 0,\r\n              color: 'text.secondary'\r\n            }}\r\n          >\r\n            ⮟\r\n          </Button>\r\n\r\n          {/* Botones de acción siempre visibles */}\r\n          <Box sx={{ \r\n            display: 'flex', \r\n            gap: 1, \r\n            mt: 1, \r\n            justifyContent: 'flex-end',\r\n            borderTop: 1,\r\n            borderColor: 'divider',\r\n            pt: 1\r\n          }}>\r\n            <Button \r\n              size=\"small\"\r\n              onClick={handleClear}\r\n              color=\"inherit\"\r\n            >\r\n              Limpiar\r\n            </Button>\r\n            <Button\r\n              size=\"small\"\r\n              variant=\"contained\"\r\n              onClick={handleConfirm}\r\n              disabled={!tempSelection.from || !tempSelection.to}\r\n              sx={{\r\n                minWidth: '100px',\r\n                '&.Mui-disabled': {\r\n                  backgroundColor: 'grey.200',\r\n                  color: 'grey.600',\r\n                  boxShadow: 'none',\r\n                  '&:hover': {\r\n                    backgroundColor: 'grey.200'\r\n                  }\r\n                }\r\n              }}\r\n            >\r\n              Confirmar\r\n            </Button>\r\n          </Box>\r\n        </Box>\r\n      </Popover>\r\n    </>\r\n  );\r\n}","import * as React from 'react';\r\nimport {\r\n  Box, Typography, Button, Paper, Table, TableHead, TableRow,\r\n  TableCell, TableBody, Grid, TextField, MenuItem, IconButton,\r\n  Stepper, Step, StepLabel, Alert, AlertTitle, Divider, Tooltip, Chip, Stack, FormControlLabel, Switch, CircularProgress, Autocomplete\r\n} from '@mui/material';\r\nimport { TODAS_LAS_CATEGORIAS } from '../../../shared-components/categorias';\r\nimport { buildTipoSelectSx } from '../../../shared-components/tipoSelectStyles';\r\nimport MonthRangeSelect from './MonthRangeSelect';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport CalculateIcon from '@mui/icons-material/Calculate';\r\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\r\nimport http from '../../../api/http';\r\nimport { formatCurrency, formatCurrencyInput, parseCurrency } from '../../../utils/currency';\r\nimport API_CONFIG from '../../../config/api-config';\r\n\r\nconst tableRowStyle = {\r\n  backgroundColor: 'rgba(255, 255, 255, 0.02)',\r\n  '&:hover': { backgroundColor: 'rgba(255, 255, 255, 0.05)' },\r\n};\r\n\r\nconst tableCellStyle = (theme) => ({\r\n  border: `1px solid ${(theme.vars || theme).palette.divider}`,\r\n  maxWidth: 110,\r\n  minWidth: 90,\r\n  whiteSpace: 'nowrap',\r\n  overflow: 'hidden',\r\n  textOverflow: 'ellipsis',\r\n  padding: '4px 6px',\r\n  textAlign: 'center',\r\n});\r\n\r\nconst headerCellStyle = (theme) => ({\r\n  ...tableCellStyle(theme),\r\n  fontWeight: 600,\r\n});\r\n\r\nfunction startOfMonthUTC(year, monthZeroBased) {\r\n  return new Date(Date.UTC(year, monthZeroBased, 1));\r\n}\r\n\r\nfunction addMonthsUTC(date, count) {\r\n  return new Date(Date.UTC(date.getUTCFullYear(), date.getUTCMonth() + count, 1));\r\n}\r\n\r\nfunction formatUTCToYearMonth(date) {\r\n  const year = date.getUTCFullYear();\r\n  const month = String(date.getUTCMonth() + 1).padStart(2, '0');\r\n  return `${year}-${month}`;\r\n}\r\n\r\nconst SHORT_MONTH_LABELS = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];\r\n\r\nfunction formatMonthLabel(ym) {\r\n  if (!ym) return '';\r\n  const [rawYear, rawMonth] = ym.split('-');\r\n  const year = rawYear ?? '';\r\n  const monthIndex = Number(rawMonth) - 1;\r\n  if (!Number.isFinite(monthIndex) || monthIndex < 0 || monthIndex > 11) {\r\n    return ym;\r\n  }\r\n  const label = SHORT_MONTH_LABELS[monthIndex] ?? rawMonth;\r\n  return `${label} ${year}`.trim();\r\n}\r\n\r\n// Generar lista de meses entre dos fechas (YYYY-MM)\r\nfunction generarMesesEntre(desde, hasta) {\r\n  const meses = [];\r\n  if (!desde || !hasta) return meses;\r\n\r\n  const [desdeYear, desdeMonth] = desde.split('-').map(Number);\r\n  const [hastaYear, hastaMonth] = hasta.split('-').map(Number);\r\n  if (\r\n    !Number.isFinite(desdeYear) ||\r\n    !Number.isFinite(desdeMonth) ||\r\n    !Number.isFinite(hastaYear) ||\r\n    !Number.isFinite(hastaMonth)\r\n  ) {\r\n    return meses;\r\n  }\r\n\r\n  let cursor = startOfMonthUTC(desdeYear, desdeMonth - 1);\r\n  const end = startOfMonthUTC(hastaYear, hastaMonth - 1);\r\n\r\n  while (cursor.getTime() <= end.getTime()) {\r\n    meses.push(formatUTCToYearMonth(cursor));\r\n    cursor = addMonthsUTC(cursor, 1);\r\n  }\r\n  return meses;\r\n}\r\n\r\nconst roundTo2 = (value) => {\r\n  const num = Number(value);\r\n  if (!Number.isFinite(num)) return 0;\r\n  return Math.round((num + Number.EPSILON) * 100) / 100;\r\n};\r\n\r\n// Helper ARS\r\nconst fmtARS = (n) => formatCurrency(n);\r\n\r\n/**\r\n * Modo de regla por categoría:\r\n *  - FIJO: mismo importe todos los meses entre rango\r\n *  - AJUSTE: importe inicial + % mensual compuesto\r\n *  - UNICO: un solo mes\r\n *  - CUOTAS: monto total dividido en N cuotas, con interés opcional mensual\r\n */\r\nconst REGLAS = [\r\n  { value: 'FIJO', label: 'Fijo mensual' },\r\n  { value: 'AJUSTE', label: 'Ajuste % mensual' },\r\n  { value: 'UNICO', label: 'Único (1 mes)' },\r\n  { value: 'CUOTAS', label: 'En cuotas' },\r\n];\r\n\r\nexport default function PresupuestoNuevo() {\r\n  const navigate = useNavigate();\r\n\r\n  // Wizard\r\n  const [step, setStep] = React.useState(0);\r\n  const [creating, setCreating] = React.useState(false);\r\n\r\n  // Paso 1\r\n  const [nombre, setNombre] = React.useState('Presupuesto Demo');\r\n  const [fechaDesde, setFechaDesde] = React.useState('2025-01');\r\n  const [fechaHasta, setFechaHasta] = React.useState('2025-06');\r\n\r\n  // Paso 2: categorías + reglas\r\n  const [categorias, setCategorias] = React.useState([\r\n    { categoria: 'Ventas', tipo: 'Ingreso', regla: { modo: 'FIJO', importe: 500000 } },\r\n    { categoria: 'Marketing', tipo: 'Egreso', regla: { modo: 'AJUSTE', importe: 80000, porcentaje: 5 } },\r\n    { categoria: 'Operaciones', tipo: 'Egreso', regla: { modo: 'FIJO', importe: 120000 } },\r\n  ]);\r\n  const [categoriasOptions, setCategoriasOptions] = React.useState(TODAS_LAS_CATEGORIAS);\r\n\r\n  React.useEffect(() => {\r\n    const fetchCategorias = async () => {\r\n      try {\r\n        const response = await http.get(`${API_CONFIG.REGISTRO}/api/categorias`);\r\n        if (response.data && response.data.length > 0) {\r\n          setCategoriasOptions(response.data);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching categories, using fallback\", error);\r\n      }\r\n    };\r\n\r\n    fetchCategorias();\r\n  }, []);\r\n\r\n  // Paso 3: tabla generada + editable\r\n  const [presupuestoDataMes, setPresupuestoDataMes] = React.useState({});\r\n  const [errors, setErrors] = React.useState(null);\r\n  const [lockNegative, setLockNegative] = React.useState(true); // bloquear negativos opcional\r\n\r\n  const meses = React.useMemo(() => {\r\n    if (!fechaDesde || !fechaHasta) return [];\r\n    return generarMesesEntre(fechaDesde, fechaHasta);\r\n  }, [fechaDesde, fechaHasta]);\r\n\r\n  // Mantener coherencia de estructura al cambiar meses/categorías\r\n  React.useEffect(() => {\r\n    if (meses.length === 0) {\r\n      setPresupuestoDataMes({});\r\n      return;\r\n    }\r\n    setPresupuestoDataMes(oldData => {\r\n      const newData = { ...oldData };\r\n      // Crear meses faltantes\r\n      meses.forEach(mes => {\r\n        if (!newData[mes]) newData[mes] = {};\r\n        categorias.forEach(cat => {\r\n          if (!cat.categoria?.trim()) return;\r\n          if (!newData[mes][cat.categoria]) {\r\n            newData[mes][cat.categoria] = { sugerido: 0, tipo: cat.tipo };\r\n          } else {\r\n            newData[mes][cat.categoria].tipo = cat.tipo;\r\n          }\r\n        });\r\n        // Remover categorías eliminadas\r\n        Object.keys(newData[mes]).forEach(catKey => {\r\n          if (!categorias.find(c => c.categoria === catKey)) {\r\n            delete newData[mes][catKey];\r\n          }\r\n        });\r\n      });\r\n      // Remover meses fuera de rango\r\n      Object.keys(newData).forEach(mesKey => {\r\n        if (!meses.includes(mesKey)) delete newData[mesKey];\r\n      });\r\n      return newData;\r\n    });\r\n  }, [meses, categorias]);\r\n\r\n  // Validaciones básicas\r\n  const validarPaso1 = () => {\r\n    if (!nombre) return 'Ingresá un nombre para el presupuesto.';\r\n    if (!fechaDesde || !fechaHasta) return 'Completá los meses.';\r\n    if (fechaDesde > fechaHasta) return 'El mes \"Desde\" no puede ser posterior a \"Hasta\".';\r\n    return null;\r\n  };\r\n  const validarPaso2 = () => {\r\n    if (categorias.length === 0) return 'Agregá al menos una categoría.';\r\n    if (categorias.some(c => !c.categoria?.trim())) return 'Todas las categorías deben tener nombre.';\r\n    if (categorias.some(c => !c.tipo?.trim())) return 'Todas las categorías deben tener tipo.';\r\n    \r\n    // Helper numérico\r\n    const isBlankNum = (v) => v === '' || v == null || Number.isNaN(Number(v));\r\n    const isPositiveInt = (v) => Number.isInteger(Number(v)) && Number(v) >= 1;\r\n\r\n    // Validación de parámetros por modo\r\n    for (let i = 0; i < categorias.length; i++) {\r\n      const c = categorias[i];\r\n      // si el nombre está vacío, ya lo validamos arriba\r\n      if (!c.categoria?.trim()) continue;\r\n      const nombre = c.categoria.trim() || `Categoría #${i + 1}`;\r\n      const regla = c.regla || {};\r\n      const modo = (regla.modo || 'FIJO').toUpperCase();\r\n\r\n      if (modo === 'FIJO') {\r\n        if (isBlankNum(regla.importe)) {\r\n          return `Completá el importe en \"${nombre}\" (Regla: Fijo mensual).`;\r\n        }\r\n      }\r\n\r\n      if (modo === 'AJUSTE') {\r\n        if (isBlankNum(regla.importe)) {\r\n          return `Completá el importe inicial en \"${nombre}\" (Regla: Ajuste % mensual).`;\r\n        }\r\n        if (isBlankNum(regla.porcentaje)) {\r\n          return `Completá el porcentaje mensual en \"${nombre}\" (Regla: Ajuste % mensual).`;\r\n        }\r\n      }\r\n\r\n      if (modo === 'UNICO') {\r\n        if (!regla.mesUnico) {\r\n          return `Elegí el mes en \"${nombre}\" (Regla: Único).`;\r\n        }\r\n        if (isBlankNum(regla.importe)) {\r\n          return `Completá el importe en \"${nombre}\" (Regla: Único).`;\r\n        }\r\n      }\r\n\r\n      if (modo === 'CUOTAS') {\r\n        if (isBlankNum(regla.montoTotal)) {\r\n          return `Completá el monto total en \"${nombre}\" (Regla: En cuotas).`;\r\n        }\r\n        if (!isPositiveInt(regla.cuotas)) {\r\n          return `Indicá la cantidad de cuotas (>= 1) en \"${nombre}\" (Regla: En cuotas).`;\r\n        }\r\n        // interés puede ser 0; sólo marcamos error si no es número\r\n        if (regla.interesMensual !== '' && regla.interesMensual != null && Number.isNaN(Number(regla.interesMensual))) {\r\n          return `El interés mensual debe ser numérico en \"${nombre}\" (Regla: En cuotas).`;\r\n        }\r\n        if (!regla.comienza) {\r\n          return `Elegí el mes de inicio en \"${nombre}\" (Regla: En cuotas).`;\r\n        }\r\n      }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  // Paso entre secciones\r\n  const next = () => {\r\n    setErrors(null); // navegación libre entre pasos\r\n    setStep(s => Math.min(2, s + 1));\r\n  };\r\n  const back = () => {\r\n    setErrors(null);\r\n    setStep(s => Math.max(0, s - 1));\r\n  };\r\n\r\n  // Acciones categorías\r\n  const handleAgregarCategoria = () => {\r\n    setCategorias([...categorias, { categoria: '', tipo: 'Egreso', regla: { modo: 'FIJO', importe: 0 } }]);\r\n  };\r\n  const handleEliminarCategoria = (index) => {\r\n    const catEliminada = categorias[index];\r\n    setCategorias(categorias.filter((_, i) => i !== index));\r\n    setPresupuestoDataMes(oldData => {\r\n      const newData = { ...oldData };\r\n      Object.keys(newData).forEach(mes => {\r\n        delete newData[mes][catEliminada.categoria];\r\n      });\r\n      return newData;\r\n    });\r\n  };\r\n  const handleDuplicarCategoria = (index) => {\r\n    const c = categorias[index];\r\n    const copia = {\r\n      categoria: `${c.categoria} copia`,\r\n      tipo: c.tipo,\r\n      regla: JSON.parse(JSON.stringify(c.regla)),\r\n    };\r\n    setCategorias([...categorias, copia]);\r\n  };\r\n\r\n  const handleCambioCategoriaCampo = (index, campo, valor) => {\r\n    const newCats = [...categorias];\r\n    const oldNombre = newCats[index].categoria;\r\n    newCats[index][campo] = valor;\r\n\r\n    // Reflejar cambios en la tabla\r\n    if (campo === 'categoria') {\r\n      setPresupuestoDataMes(oldData => {\r\n        const newData = {};\r\n        Object.entries(oldData).forEach(([mes, cats]) => {\r\n          newData[mes] = {};\r\n          Object.entries(cats).forEach(([catName, valores]) => {\r\n            if (catName === oldNombre) {\r\n              newData[mes][valor] = { ...valores, tipo: newCats[index].tipo };\r\n            } else {\r\n              newData[mes][catName] = valores;\r\n            }\r\n          });\r\n        });\r\n        return newData;\r\n      });\r\n    } else if (campo === 'tipo') {\r\n      setPresupuestoDataMes(oldData => {\r\n        const newData = { ...oldData };\r\n        Object.keys(newData).forEach(mes => {\r\n          if (newData[mes][newCats[index].categoria]) {\r\n            newData[mes][newCats[index].categoria].tipo = valor;\r\n          }\r\n        });\r\n        return newData;\r\n      });\r\n    }\r\n    setCategorias(newCats);\r\n  };\r\n\r\n  const handleCambioRegla = (index, campo, valor) => {\r\n    const newCats = [...categorias];\r\n    newCats[index].regla = { ...(newCats[index].regla || { modo: 'FIJO' }), [campo]: valor };\r\n    // Coherencia por modo\r\n    if (campo === 'modo') {\r\n      if (valor === 'FIJO') newCats[index].regla = { modo: 'FIJO', importe: 0 };\r\n      if (valor === 'AJUSTE') newCats[index].regla = { modo: 'AJUSTE', importe: 0, porcentaje: 0 };\r\n      if (valor === 'UNICO') newCats[index].regla = { modo: 'UNICO', importe: 0, mesUnico: '' };\r\n      if (valor === 'CUOTAS') newCats[index].regla = { modo: 'CUOTAS', montoTotal: 0, cuotas: 2, interesMensual: 0, comienza: meses[0] || '' };\r\n    }\r\n    setCategorias(newCats);\r\n  };\r\n\r\n  // Aplicar reglas a la grilla\r\n  const aplicarReglas = () => {\r\n    if (meses.length === 0) {\r\n      setErrors('Definí el rango de meses primero.');\r\n      return;\r\n    }\r\n    setErrors(null);\r\n\r\n    setPresupuestoDataMes(old => {\r\n      const nuevo = { ...old };\r\n      categorias.forEach(cat => {\r\n        if (!cat.categoria?.trim()) return;\r\n        const { tipo, categoria, regla } = cat;\r\n        const modo = (regla?.modo || 'FIJO').toUpperCase();\r\n\r\n        if (modo === 'FIJO') {\r\n          const importe = Number(regla?.importe || 0);\r\n          meses.forEach(m => {\r\n            if (!nuevo[m]) nuevo[m] = {};\r\n            if (!nuevo[m][categoria]) nuevo[m][categoria] = { sugerido: 0, tipo };\r\n            nuevo[m][categoria].sugerido = importe;\r\n            nuevo[m][categoria].tipo = tipo;\r\n          });\r\n        }\r\n\r\n        if (modo === 'AJUSTE') {\r\n          const base = Number(regla?.importe || 0);\r\n          const p = Number(regla?.porcentaje || 0) / 100;\r\n          meses.forEach((m, idx) => {\r\n            const valor = roundTo2(base * Math.pow(1 + p, idx));\r\n            if (!nuevo[m]) nuevo[m] = {};\r\n            if (!nuevo[m][categoria]) nuevo[m][categoria] = { sugerido: 0, tipo };\r\n            nuevo[m][categoria].sugerido = valor;\r\n            nuevo[m][categoria].tipo = tipo;\r\n          });\r\n        }\r\n\r\n        if (modo === 'UNICO') {\r\n          const mesU = regla?.mesUnico;\r\n          const importe = Number(regla?.importe || 0);\r\n          meses.forEach(m => {\r\n            if (!nuevo[m]) nuevo[m] = {};\r\n            if (!nuevo[m][categoria]) nuevo[m][categoria] = { sugerido: 0, tipo };\r\n            nuevo[m][categoria].sugerido = (m === mesU ? importe : 0);\r\n            nuevo[m][categoria].tipo = tipo;\r\n          });\r\n        }\r\n\r\n        if (modo === 'CUOTAS') {\r\n          const total = Number(regla?.montoTotal || 0);\r\n          const n = Math.max(1, Number(regla?.cuotas || 1));\r\n          const r = Number(regla?.interesMensual || 0) / 100;\r\n          const inicio = regla?.comienza || meses[0];\r\n\r\n          // Si hay interés, cuota de sistema francés: A = P * [ r(1+r)^n / ((1+r)^n - 1) ]\r\n          let cuota = 0;\r\n          // helper\r\n          const round2 = (x) => Math.round((x + Number.EPSILON) * 100) / 100;\r\n\r\n          // reemplazar el bloque por:\r\n          if (r > 0) {\r\n            const rn = Math.pow(1 + r, n);\r\n            cuota = round2(total * ((r * rn) / (rn - 1)));\r\n          } else {\r\n            cuota = round2(total / n);\r\n          }\r\n          // Distribuir a partir de \"inicio\"\r\n          const startIdx = meses.findIndex(m => m === inicio);\r\n          meses.forEach((m, idx) => {\r\n            if (!nuevo[m]) nuevo[m] = {};\r\n            if (!nuevo[m][categoria]) nuevo[m][categoria] = { sugerido: 0, tipo };\r\n            const i = idx - startIdx;\r\n            nuevo[m][categoria].sugerido = (i >= 0 && i < n) ? cuota : 0;\r\n            nuevo[m][categoria].tipo = tipo;\r\n          });\r\n        }\r\n      });\r\n      return nuevo;\r\n    });\r\n  };\r\n\r\n  // Edición manual de la grilla\r\n  const handleCambioMonto = (mes, categoria, campo, valor) => {\r\n    const num = valor === '' ? 0 : Number(valor);\r\n    if (Number.isNaN(num)) return;\r\n    if (lockNegative && num < 0) return;\r\n    setPresupuestoDataMes(oldData => {\r\n      const newData = { ...oldData };\r\n      if (!newData[mes]) newData[mes] = {};\r\n      if (!newData[mes][categoria]) newData[mes][categoria] = { sugerido: 0, tipo: 'Egreso' };\r\n      newData[mes][categoria][campo] = num;\r\n      return newData;\r\n    });\r\n  };\r\n\r\n  const { monthTotals, negativeMonths, totalIngresos, totalEgresos } = React.useMemo(() => {\r\n    const totals = {};\r\n    const negatives = [];\r\n    let ingresosAcumulados = 0;\r\n    let egresosAcumulados = 0;\r\n\r\n    meses.forEach((mes) => {\r\n      const cats = presupuestoDataMes[mes] || {};\r\n      let ingresosMes = 0;\r\n      let egresosMes = 0;\r\n\r\n      Object.values(cats).forEach((cat) => {\r\n        const valor = Number(cat?.sugerido ?? 0);\r\n        if (!Number.isFinite(valor)) {\r\n          return;\r\n        }\r\n        const tipo = (cat?.tipo || '').toString().toUpperCase();\r\n        if (tipo === 'INGRESO') {\r\n          ingresosMes += valor;\r\n        } else if (tipo === 'EGRESO') {\r\n          egresosMes += valor;\r\n        }\r\n      });\r\n\r\n      const resultado = ingresosMes - egresosMes;\r\n      totals[mes] = { ingresos: ingresosMes, egresos: egresosMes, resultado };\r\n      ingresosAcumulados += ingresosMes;\r\n      egresosAcumulados += egresosMes;\r\n      if (resultado < 0) {\r\n        negatives.push({ mes, resultado });\r\n      }\r\n    });\r\n\r\n    return {\r\n      monthTotals: totals,\r\n      negativeMonths: negatives,\r\n      totalIngresos: ingresosAcumulados,\r\n      totalEgresos: egresosAcumulados\r\n    };\r\n  }, [meses, presupuestoDataMes]);\r\n\r\n  const resultadoTotal = React.useMemo(() => totalIngresos - totalEgresos, [totalIngresos, totalEgresos]);\r\n  const hasLosses = negativeMonths.length > 0;\r\n\r\n  const lossSummaryText = React.useMemo(() => {\r\n    if (!negativeMonths.length) {\r\n      return '';\r\n    }\r\n    const labels = negativeMonths\r\n      .slice(0, 6)\r\n      .map((item) => formatMonthLabel(item.mes));\r\n    let summary = labels.join(', ');\r\n    if (negativeMonths.length > 6) {\r\n      summary += ` y ${negativeMonths.length - 6} más`;\r\n    }\r\n    return summary;\r\n  }, [negativeMonths]);\r\n\r\n\r\n  // Guardar (CAMBIO MÍNIMO: enviar payload nuevo con `plantilla`)\r\n  const handleGuardar = async () => {\r\n    if (creating) {\r\n      return;\r\n    }\r\n    // Validaciones finales\r\n    const v1 = validarPaso1(); if (v1) return setErrors(v1);\r\n    const v2 = validarPaso2(); if (v2) return setErrors(v2);\r\n\r\n    setCreating(true);\r\n    try {\r\n      // Normalizo meses a YYYY-MM (ya vienen así desde el input type=\"month\")\r\n      const dDesde = fechaDesde;\r\n      const dHasta = fechaHasta;\r\n\r\n      // Tomo como base el PRIMER mes para cada categoría (si hay grilla calculada),\r\n      // y si no existe, uso el importe de la regla (FIJO/UNICO/etc.).\r\n      const firstMonth = meses[0];\r\n      const plantilla = categorias.map((c) => {\r\n        const catName = (c.categoria || '').trim();\r\n        const tipo = (c.tipo || '').toString().toUpperCase(); // \"INGRESO\"/\"EGRESO\"\r\n\r\n        const fallbackDeRegla = c?.regla?.importe ?? c?.regla?.montoTotal ?? 0;\r\n\r\n        const detalles = meses.map((mes) => {\r\n          const registroMes = presupuestoDataMes?.[mes]?.[catName];\r\n          const sugerido = registroMes?.sugerido ?? 0;\r\n          const real = registroMes?.montoReal ?? registroMes?.real ?? null;\r\n          const estimadoRedondeado = roundTo2(sugerido);\r\n          const realRedondeado = real == null ? null : roundTo2(real);\r\n          return {\r\n            mes,\r\n            montoEstimado: estimadoRedondeado,\r\n            montoReal: realRedondeado,\r\n          };\r\n        });\r\n\r\n        const montoBase = firstMonth\r\n          ? presupuestoDataMes?.[firstMonth]?.[catName]?.sugerido\r\n          : undefined;\r\n\r\n        const montoEstimadoPrincipal =\r\n          montoBase != null ? roundTo2(montoBase) : roundTo2(fallbackDeRegla || 0);\r\n\r\n        return {\r\n          categoria: catName,\r\n          tipo,\r\n          montoEstimado: montoEstimadoPrincipal,\r\n          montoReal: null,\r\n          meses: detalles,\r\n        };\r\n      });\r\n\r\n      const payload = {\r\n        nombre,\r\n        desde: dDesde,\r\n        hasta: dHasta,\r\n        autogenerarCeros: false,\r\n        plantilla\r\n      };\r\n\r\n      const res = await http.post(\r\n        `${API_CONFIG.PRONOSTICO}/api/presupuestos`,\r\n        payload\r\n      );\r\n\r\n      const nombreFuente = res?.data?.nombre || nombre;\r\n      const slug = encodeURIComponent(\r\n        nombreFuente.trim().toLowerCase().replace(/\\s+/g, '-')\r\n      );\r\n      navigate(`/presupuestos/${slug}`);\r\n    } catch (error) {\r\n      console.error(\"Error guardando presupuesto\", error);\r\n      if (error?.response?.status === 409) {\r\n        setErrors(\"Ya existe un presupuesto con el mismo nombre y período.\");\r\n      } else {\r\n        setErrors(\"No se pudo guardar el presupuesto. Probá de nuevo.\");\r\n      }\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ width: '100%', minHeight: '100vh', p: 3 }}>\r\n      <Typography variant=\"h4\" gutterBottom>Nuevo Presupuesto</Typography>\r\n      <Typography variant=\"subtitle1\" gutterBottom>Planificá tus ingresos y egresos esperados</Typography>\r\n\r\n      <Stepper activeStep={step} alternativeLabel sx={{ mb: 3 }}>\r\n        <Step><StepLabel>Datos básicos</StepLabel></Step>\r\n        <Step><StepLabel>Categorías & Reglas</StepLabel></Step>\r\n        <Step><StepLabel>Vista previa & Guardar</StepLabel></Step>\r\n      </Stepper>\r\n\r\n      {errors && <Alert severity=\"warning\" sx={{ mb: 2 }}>{errors}</Alert>}\r\n\r\n      {/* PASO 1: Datos básicos */}\r\n      {step === 0 && (\r\n        <>\r\n          <Box sx={{ display: 'flex', gap: 2, mb: 3, flexDirection: 'column' }}>\r\n            <TextField \r\n              label=\"Nombre del presupuesto\" \r\n              value={nombre} \r\n              onChange={e => setNombre(e.target.value)} \r\n              fullWidth \r\n              variant=\"outlined\" \r\n            />\r\n            <Box sx={{ maxWidth: 300 }}>\r\n              <MonthRangeSelect\r\n                value={{\r\n                  from: fechaDesde,\r\n                  to: fechaHasta\r\n                }}\r\n                onChange={(range) => {\r\n                  setFechaDesde(range.from);\r\n                  setFechaHasta(range.to);\r\n                }}\r\n              />\r\n            </Box>\r\n          </Box>\r\n\r\n          <Divider sx={{ my: 2 }} />\r\n          <Box display=\"flex\" gap={2}>\r\n            <Button variant=\"contained\" onClick={next}>Continuar</Button>\r\n            <Button variant=\"outlined\" onClick={() => navigate(-1)}>Cancelar</Button>\r\n          </Box>\r\n        </>\r\n      )}\r\n\r\n      {/* PASO 2: Categorías + reglas */}\r\n      {step === 1 && (\r\n        <>\r\n          <Box mt={1} mb={2} display=\"flex\" gap={1} alignItems=\"center\">\r\n            <Button startIcon={<AddIcon />} variant=\"outlined\" onClick={handleAgregarCategoria}>Nueva categoría</Button>\r\n            <Tooltip title=\"Bloquear montos negativos\">\r\n              <FormControlLabel\r\n                control={<Switch size=\"small\" checked={lockNegative} onChange={(_, v) => setLockNegative(v)} />}\r\n                label=\"Bloquear negativos\"\r\n              />\r\n            </Tooltip>\r\n          </Box>\r\n\r\n          <Paper variant=\"outlined\" sx={{ p: 0, mb: 2, overflowX: 'auto', borderColor: (t) => (t.vars || t).palette.divider, }}>\r\n            <Table size=\"small\" sx={{ tableLayout: 'auto', width: '100%', minWidth: 720 }}>\r\n              <TableHead>\r\n                <TableRow sx={tableRowStyle}>\r\n                  <TableCell sx={headerCellStyle}>Categoría</TableCell>\r\n                  <TableCell sx={headerCellStyle}>Tipo</TableCell>\r\n                  <TableCell sx={headerCellStyle}>Regla</TableCell>\r\n                  <TableCell sx={headerCellStyle}>Parámetros</TableCell>\r\n                  <TableCell\r\n                    sx={(theme) => ({\r\n                      ...headerCellStyle(theme),\r\n                      width: 96,\r\n                      minWidth: 96,\r\n                      maxWidth: 96,\r\n                    })}\r\n                  >\r\n                    Acciones\r\n                  </TableCell>\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {categorias.map((cat, idx) => {\r\n                  const r = cat.regla || { modo: 'FIJO' };\r\n                  return (\r\n                    <TableRow key={idx} sx={tableRowStyle}>\r\n                      <TableCell sx={tableCellStyle}>\r\n                        <Autocomplete\r\n                          value={cat.categoria || null}\r\n                          onChange={(e, newValue) =>\r\n                            handleCambioCategoriaCampo(idx, 'categoria', newValue || '')\r\n                          }\r\n                          options={categoriasOptions}\r\n                          freeSolo={false}\r\n                          disableClearable\r\n                          forcePopupIcon\r\n                          popupIcon={<KeyboardArrowDownIcon />}            // mismo ícono que Select\r\n                          componentsProps={{\r\n                            popupIndicator: {\r\n                              disableRipple: true,\r\n                              disableFocusRipple: true,\r\n                              sx: {\r\n                                p: 0,\r\n                                m: 0,\r\n                                bgcolor: 'transparent',                    // sin fondo\r\n                                border: 'none',\r\n                                boxShadow: 'none',\r\n                                '&:hover': { bgcolor: 'transparent' },\r\n                                '& .MuiTouchRipple-root': { display: 'none' },\r\n                                '& .MuiSvgIcon-root': { fontSize: 24 },    // igual que Select\r\n                              },\r\n                            },\r\n                            clearIndicator: { sx: { display: 'none' } },\r\n                          }}\r\n                          sx={{\r\n                            // misma posición del ícono que el Select estándar\r\n                            '& .MuiAutocomplete-endAdornment': { right: 0, top: '50%', transform: 'translateY(-50%)' },\r\n                            '& .MuiAutocomplete-popupIndicator': { p: 0 }, // sin padding extra\r\n                            // no gires la flecha al abrir\r\n                            '& .MuiAutocomplete-popupIndicatorOpen .MuiSvgIcon-root': { transform: 'none' },\r\n                          }}\r\n                          renderInput={(params) => (\r\n                            <TextField\r\n                              {...params}\r\n                              variant=\"standard\"\r\n                              size=\"small\"\r\n                              placeholder=\"Categoría\"\r\n                              sx={{ minWidth: 140, maxWidth: 220 }}\r\n                            />\r\n                          )}\r\n                        />\r\n                      </TableCell>\r\n                      <TableCell sx={tableCellStyle}>\r\n                        <TextField\r\n                          select\r\n                          value={cat.tipo}\r\n                          onChange={(e) => handleCambioCategoriaCampo(idx, 'tipo', e.target.value)}\r\n                          variant=\"outlined\"\r\n                          size=\"small\"\r\n                          sx={[\r\n                            { minWidth: 100 },\r\n                            buildTipoSelectSx(cat.tipo),\r\n                          ]}\r\n                        >\r\n                          <MenuItem value=\"Ingreso\">INGRESO</MenuItem>\r\n                          <MenuItem value=\"Egreso\">EGRESO</MenuItem>\r\n                        </TextField>\r\n                      </TableCell>\r\n                      <TableCell sx={tableCellStyle}>\r\n                        <TextField\r\n                          select value={r.modo}\r\n                          onChange={e => handleCambioRegla(idx, 'modo', e.target.value)}\r\n                          variant=\"standard\" size=\"small\" sx={{ minWidth: 160 }}\r\n                        >\r\n                          {REGLAS.map(op => <MenuItem key={op.value} value={op.value}>{op.label}</MenuItem>)}\r\n                        </TextField>\r\n                      </TableCell>\r\n\r\n                      {/* Parámetros por modo */}\r\n                      <TableCell\r\n                        sx={(theme) => ({\r\n                          ...tableCellStyle(theme),\r\n                          textAlign: 'left',\r\n                          whiteSpace: 'normal',\r\n                          overflow: 'visible',\r\n                          textOverflow: 'unset',\r\n                          minWidth: 220,\r\n                          maxWidth: 420,\r\n                        })}\r\n                      >\r\n                        {r.modo === 'FIJO' && (\r\n                          <Stack spacing={0.75} alignItems=\"flex-start\">\r\n                            <TextField\r\n                              type=\"text\"\r\n                              label=\"Importe\"\r\n                              placeholder=\"$ 0\"\r\n                              value={\r\n                                r.importe === 0 || r.importe === '0' || r.importe === ''\r\n                                  ? ''\r\n                                  : formatCurrencyInput(r.importe)\r\n                              }\r\n                              onChange={(e) => {\r\n                                const parsed = parseCurrency(e.target.value, { returnEmpty: true });\r\n                                handleCambioRegla(idx, 'importe', parsed === '' ? '' : parsed);\r\n                              }}\r\n                              size=\"small\"\r\n                              variant=\"standard\"\r\n                              InputLabelProps={{ shrink: true }}\r\n                              sx={{ maxWidth: 180 }}\r\n                              inputProps={{ inputMode: 'numeric' }}\r\n                            />\r\n                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                              Mismo importe para cada mes del rango\r\n                            </Typography>\r\n                          </Stack>\r\n                        )}\r\n                        {r.modo === 'AJUSTE' && (\r\n                          <Stack spacing={0.75} alignItems=\"flex-start\">\r\n                            <Stack direction=\"row\" spacing={1} flexWrap=\"wrap\" sx={{ width: '100%' }}>\r\n                              <TextField\r\n                                type=\"text\"\r\n                                label=\"Importe inicial\"\r\n                                placeholder=\"$ 0\"\r\n                                value={\r\n                                  r.importe === 0 || r.importe === '0' || r.importe === ''\r\n                                    ? ''\r\n                                    : formatCurrencyInput(r.importe)\r\n                                }\r\n                                onChange={(e) => {\r\n                                  const parsed = parseCurrency(e.target.value, { returnEmpty: true });\r\n                                  handleCambioRegla(idx, 'importe', parsed === '' ? '' : parsed);\r\n                                }}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                InputLabelProps={{ shrink: true }}\r\n                                sx={{ flex: '1 1 140px', minWidth: 140 }}\r\n                                inputProps={{ inputMode: 'numeric' }}\r\n                              />\r\n                              <TextField\r\n                                type=\"number\"\r\n                                label=\"% mensual\"\r\n                                placeholder=\"% 0\"\r\n                                value={\r\n                                  r.porcentaje === 0 || r.porcentaje === '0' || r.porcentaje === ''\r\n                                    ? ''\r\n                                    : r.porcentaje\r\n                                }\r\n                                onChange={(e) => handleCambioRegla(idx, 'porcentaje', e.target.value)}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                InputLabelProps={{ shrink: true }}\r\n                                sx={{ flex: '1 1 120px', minWidth: 120 }}\r\n                                inputProps={{ step: 0.1, inputMode: 'decimal' }}\r\n                              />\r\n                            </Stack>\r\n                            <Typography variant=\"caption\" color=\"info.main\">\r\n                              Crecimiento compuesto mes a mes\r\n                            </Typography>\r\n                          </Stack>\r\n                        )}\r\n                        {r.modo === 'UNICO' && (\r\n                          <Stack spacing={0.75} alignItems=\"flex-start\">\r\n                            <Stack direction=\"row\" spacing={1} flexWrap=\"wrap\" sx={{ width: '100%' }}>\r\n                              <TextField\r\n                                select\r\n                                label=\"Mes\"\r\n                                value={r.mesUnico || ''}\r\n                                onChange={e => handleCambioRegla(idx, 'mesUnico', e.target.value)}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                sx={{ flex: '1 1 140px', minWidth: 140 }}\r\n                              >\r\n                                {meses.map(m => (\r\n                                  <MenuItem key={m} value={m}>\r\n                                    {m}\r\n                                  </MenuItem>\r\n                                ))}\r\n                              </TextField>\r\n                              <TextField\r\n                                type=\"text\"\r\n                                label=\"Importe\"\r\n                                placeholder=\"$ 0\"\r\n                                value={\r\n                                  r.importe === 0 || r.importe === '0' || r.importe === ''\r\n                                    ? ''\r\n                                    : formatCurrencyInput(r.importe)\r\n                                }\r\n                                onChange={(e) => {\r\n                                  const parsed = parseCurrency(e.target.value, { returnEmpty: true });\r\n                                  handleCambioRegla(idx, 'importe', parsed === '' ? '' : parsed);\r\n                                }}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                InputLabelProps={{ shrink: true }}\r\n                                sx={{ flex: '1 1 140px', minWidth: 140 }}\r\n                                inputProps={{ inputMode: 'numeric' }}\r\n                              />\r\n                            </Stack>\r\n                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                              Se aplica solo al mes seleccionado\r\n                            </Typography>\r\n                          </Stack>\r\n                        )}\r\n                        {r.modo === 'CUOTAS' && (\r\n                          <Stack spacing={0.75} alignItems=\"flex-start\">\r\n                            <Stack direction=\"row\" spacing={1} flexWrap=\"wrap\" sx={{ width: '100%' }}>\r\n                              <TextField\r\n                                type=\"text\"\r\n                                label=\"Monto total\"\r\n                                placeholder=\"$ 0\"\r\n                                value={\r\n                                  r.montoTotal === 0 || r.montoTotal === '0' || r.montoTotal === ''\r\n                                    ? ''\r\n                                    : formatCurrencyInput(r.montoTotal)\r\n                                }\r\n                                onChange={(e) => {\r\n                                  const parsed = parseCurrency(e.target.value, { returnEmpty: true });\r\n                                  handleCambioRegla(idx, 'montoTotal', parsed === '' ? '' : parsed);\r\n                                }}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                InputLabelProps={{ shrink: true }}\r\n                                sx={{ flex: '1 1 150px', minWidth: 150 }}\r\n                                inputProps={{ inputMode: 'numeric' }}\r\n                              />\r\n                              <TextField\r\n                                type=\"number\"\r\n                                label=\"Cuotas\"\r\n                                value={r.cuotas ?? ''}\r\n                                onChange={e => handleCambioRegla(idx, 'cuotas', e.target.value)}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                sx={{ flex: '1 1 110px', minWidth: 110 }}\r\n                                inputProps={{ min: 1, step: 1, inputMode: 'numeric' }}\r\n                              />\r\n                              <TextField\r\n                                type=\"number\"\r\n                                label=\"% interés\"\r\n                                placeholder=\"% 0\"\r\n                                value={\r\n                                  r.interesMensual === 0 || r.interesMensual === '0' || r.interesMensual === ''\r\n                                    ? ''\r\n                                    : r.interesMensual\r\n                                }\r\n                                onChange={(e) => handleCambioRegla(idx, 'interesMensual', e.target.value)}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                InputLabelProps={{ shrink: true }}\r\n                                sx={{ flex: '1 1 120px', minWidth: 120 }}\r\n                                inputProps={{ step: 0.1, inputMode: 'decimal' }}\r\n                              />\r\n                              <TextField\r\n                                select\r\n                                label=\"Comienza\"\r\n                                value={r.comienza || meses[0] || ''}\r\n                                onChange={e => handleCambioRegla(idx, 'comienza', e.target.value)}\r\n                                size=\"small\"\r\n                                variant=\"standard\"\r\n                                sx={{ flex: '1 1 140px', minWidth: 140 }}\r\n                              >\r\n                                {meses.map(m => (\r\n                                  <MenuItem key={m} value={m}>\r\n                                    {m}\r\n                                  </MenuItem>\r\n                                ))}\r\n                              </TextField>\r\n                            </Stack>\r\n                            <Typography variant=\"caption\" color=\"warning.main\">\r\n                              Calcula cuotas estilo francés cuando hay interés\r\n                            </Typography>\r\n                          </Stack>\r\n                        )}\r\n                      </TableCell>\r\n\r\n                      <TableCell sx={(theme) => ({ ...tableCellStyle(theme), width: 96, minWidth: 96, maxWidth: 96, px: 0.5 })}>\r\n                        <Stack direction=\"row\" spacing={0.5} justifyContent=\"center\">\r\n                          <Tooltip title=\"Duplicar categoría\">\r\n                            <IconButton onClick={() => handleDuplicarCategoria(idx)} size=\"small\"><ContentCopyIcon fontSize=\"small\" /></IconButton>\r\n                          </Tooltip>\r\n                          <Tooltip title=\"Eliminar\">\r\n                            <IconButton onClick={() => handleEliminarCategoria(idx)} size=\"small\"><DeleteIcon color=\"error\" fontSize=\"small\" /></IconButton>\r\n                          </Tooltip>\r\n                        </Stack>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  );\r\n                })}\r\n              </TableBody>\r\n            </Table>\r\n          </Paper>\r\n\r\n          <Box display=\"flex\" gap={1} mb={2}>\r\n            <Button startIcon={<CalculateIcon />} variant=\"contained\" color=\"primary\" onClick={aplicarReglas}>\r\n              Aplicar reglas a los meses\r\n            </Button>\r\n            <Button variant=\"outlined\" onClick={next}>Continuar</Button>\r\n            <Button variant=\"text\" onClick={back}>Volver</Button>\r\n          </Box>\r\n        </>\r\n      )}\r\n\r\n      {/* PASO 3: Vista previa/edición (tu grilla + columnas de totales por mes) */}\r\n      {step === 2 && (\r\n        <>\r\n          <Box mb={1} display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" flexWrap=\"wrap\" gap={1}>\r\n            <Typography variant=\"subtitle1\">Revisá y ajustá los montos estimados por mes y categoría</Typography>\r\n            <Stack direction=\"row\" spacing={1} alignItems=\"center\">\r\n              <Chip label={`Ingresos: ${fmtARS(totalIngresos)}`} color=\"success\" />\r\n              <Chip label={`Egresos: ${fmtARS(totalEgresos)}`} color=\"error\" />\r\n              <Chip label={`Resultado: ${fmtARS(resultadoTotal)}`} color={resultadoTotal >= 0 ? 'info' : 'error'} />\r\n            </Stack>\r\n          </Box>\r\n\r\n          {hasLosses && (\r\n            <Alert\r\n              severity=\"error\"\r\n              variant=\"filled\"\r\n              role=\"alert\"\r\n              aria-live=\"polite\"\r\n              sx={{ mb: 2 }}\r\n            >\r\n              <AlertTitle>Atención: hay meses en pérdida (resultado negativo).</AlertTitle>\r\n              Revisá los montos. Meses afectados: {lossSummaryText || 'ver detalle en la grilla.'}\r\n            </Alert>\r\n          )}\r\n\r\n          <Paper variant=\"outlined\" sx={{ mt: 1, width: '100%', overflowX: 'auto', p: 0, borderColor: (t) => (t.vars || t).palette.divider, }}>\r\n            <Table size=\"small\" sx={{ tableLayout: 'fixed', width: '100%' }}>\r\n              <TableHead>\r\n                {/* Primera fila: nombres de categorías */}\r\n                <TableRow sx={tableRowStyle}>\r\n                  {/* Mes */}\r\n                  <TableCell sx={headerCellStyle}>Mes</TableCell>\r\n\r\n                  {/* Categorías creadas por el cliente */}\r\n                  {categorias.map((cat, idx) => (\r\n                    <TableCell key={idx} sx={headerCellStyle}>\r\n                      <Stack alignItems=\"center\" spacing={0.5}>\r\n                        <Typography\r\n                          variant=\"body2\"\r\n                          noWrap\r\n                          title={cat.categoria}\r\n                          sx={{ fontWeight: 600 }}   // negrita del título de la categoría\r\n                        >\r\n                          {cat.categoria}\r\n                        </Typography>\r\n                        <Chip\r\n                          size=\"small\"\r\n                          label={cat.tipo}\r\n                          color={cat.tipo === 'Ingreso' ? 'success' : 'error'}\r\n                        />\r\n                      </Stack>\r\n                    </TableCell>\r\n                  ))}\r\n\r\n                  {/* Columnas de totales por mes */}\r\n                  <TableCell sx={(theme) => ({ ...headerCellStyle(theme), minWidth: 120 })}>\r\n                    Ingresos (mes)\r\n                  </TableCell>\r\n                  <TableCell sx={(theme) => ({ ...headerCellStyle(theme), minWidth: 120 })}>\r\n                    Egresos (mes)\r\n                  </TableCell>\r\n                  <TableCell sx={(theme) => ({ ...headerCellStyle(theme), minWidth: 130 })}>\r\n                    Resultado (mes)\r\n                  </TableCell>\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {meses.map(mes => {\r\n                  const resumenMes = monthTotals[mes] || { ingresos: 0, egresos: 0, resultado: 0 };\r\n                  const esPerdidaMes = resumenMes.resultado < 0;\r\n\r\n                  return (\r\n                    <TableRow\r\n                      key={mes}\r\n                      sx={tableRowStyle}\r\n                    >\r\n                      <TableCell sx={tableCellStyle}>{mes}</TableCell>\r\n                      {categorias.map((cat, idx) => {\r\n                        const valores = presupuestoDataMes[mes]?.[cat.categoria] || { sugerido: 0 };\r\n                        return (\r\n                          <TableCell key={idx} sx={tableCellStyle}>\r\n                            <TextField\r\n                              type=\"text\"\r\n                              variant=\"standard\"\r\n                              size=\"small\"\r\n                              value={formatCurrencyInput(valores.sugerido)}\r\n                              onChange={(e) => handleCambioMonto(mes, cat.categoria, 'sugerido', parseCurrency(e.target.value, { returnEmpty: true }))}\r\n                              inputProps={{ inputMode: 'numeric', style: { padding: '4px 6px', textAlign: 'right' } }}\r\n                              sx={{ maxWidth: 90 }}\r\n                            />\r\n                          </TableCell>\r\n                        );\r\n                      })}\r\n                      {/* CELDAS DE TOTALES POR MES */}\r\n                      <TableCell sx={(theme) => ({ ...tableCellStyle(theme), fontWeight: 700, color: '#66bb6a' })}>\r\n                        {fmtARS(resumenMes.ingresos)}\r\n                      </TableCell>\r\n                      <TableCell sx={(theme) => ({ ...tableCellStyle(theme), fontWeight: 700, color: '#ef5350' })}>\r\n                        {fmtARS(resumenMes.egresos)}\r\n                      </TableCell>\r\n                      <TableCell sx={tableCellStyle}>\r\n                        <Tooltip\r\n                          title={esPerdidaMes ? 'Este mes los egresos superan a los ingresos.' : ''}\r\n                          disableHoverListener={!esPerdidaMes}\r\n                        >\r\n                          <Stack direction=\"row\" spacing={1} alignItems=\"center\" justifyContent=\"center\">\r\n                            <Typography\r\n                              component=\"span\"\r\n                              sx={{\r\n                                fontWeight: 700,\r\n                                color: esPerdidaMes ? 'error.main' : 'info.main'\r\n                              }}\r\n                            >\r\n                              {fmtARS(resumenMes.resultado)}\r\n                            </Typography>\r\n                            {esPerdidaMes && (\r\n                              <Chip\r\n                                size=\"small\"\r\n                                color=\"error\"\r\n                                label=\"En pérdida\"\r\n                              />\r\n                            )}\r\n                          </Stack>\r\n                        </Tooltip>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  );\r\n                })}\r\n\r\n                {/* Fila de totales por categoría en el período (se mantiene igual) */}\r\n                <TableRow>\r\n                  <TableCell sx={(theme) => ({ ...tableCellStyle(theme), fontWeight: 700 })}>\r\n                    Totales mes\r\n                  </TableCell>\r\n\r\n                  {categorias.map((cat, idx) => {\r\n                    const totalCat = meses.reduce((acc, m) => {\r\n                      const v = presupuestoDataMes[m]?.[cat.categoria]?.sugerido || 0;\r\n                      return acc + Number(v || 0);\r\n                    }, 0);\r\n                    return (\r\n                      <TableCell\r\n                        key={idx}\r\n                        sx={(theme) => ({ ...tableCellStyle(theme), fontWeight: 700 })}\r\n                      >\r\n                        {fmtARS(totalCat)}\r\n                      </TableCell>\r\n                    );\r\n                  })}\r\n\r\n                  {/* Columnas de totales por mes no tienen agregados en esta fila */}\r\n                  <TableCell sx={tableCellStyle} />\r\n                  <TableCell sx={tableCellStyle} />\r\n                  <TableCell sx={tableCellStyle} />\r\n                </TableRow>\r\n              </TableBody>\r\n            </Table>\r\n          </Paper>\r\n\r\n          <Box mt={3} display=\"flex\" gap={2} flexWrap=\"wrap\">\r\n            <Button\r\n              variant=\"contained\"\r\n              onClick={handleGuardar}\r\n              disabled={creating}\r\n              startIcon={creating ? <CircularProgress size={16} color=\"inherit\" /> : null}\r\n              disableElevation\r\n              sx={{\r\n                \"&.Mui-disabled\": {\r\n                  backgroundColor: (theme) =>\r\n                    `${theme.palette.action.disabledBackground} !important`,\r\n                  color: (theme) => `${theme.palette.text.disabled} !important`,\r\n                  backgroundImage: \"none !important\", // anula gradiente\r\n                  boxShadow: \"none\",\r\n                  borderColor: \"transparent\",\r\n                },\r\n              }}\r\n            >\r\n              {creating ? \"Guardando…\" : \"Guardar presupuesto\"}\r\n            </Button>\r\n            <Button variant=\"outlined\" onClick={back}>Volver</Button>\r\n            <Button variant=\"text\" onClick={() => navigate(-1)}>Cancelar</Button>\r\n          </Box>\r\n        </>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n","import axios from \"axios\";\r\nimport {\r\n  CognitoUserPool,\r\n  CognitoUser,\r\n  CognitoRefreshToken,\r\n} from \"amazon-cognito-identity-js\";\r\nimport { sessionService } from \"../shared-services/sessionService\";\r\nimport URL_CONFIG from \"../config/api-config\";\r\n\r\nconst http = axios.create();\r\nconst PRONOSTICO_BASE_URL = URL_CONFIG.PRONOSTICO;\r\nconst cognitoPoolConfig = {\r\n  UserPoolId: process.env.REACT_APP_COGNITO_USER_POOL_ID,\r\n  ClientId: process.env.REACT_APP_COGNITO_CLIENT_ID,\r\n};\r\n\r\nlet refreshPromise = null;\r\nlet hasForcedLogout = false;\r\n\r\nconst isPronosticoRequest = (url) =>\r\n  Boolean(\r\n    url &&\r\n      PRONOSTICO_BASE_URL &&\r\n      String(url).startsWith(String(PRONOSTICO_BASE_URL)),\r\n  );\r\n\r\nconst safeSessionGet = (key) => {\r\n  try {\r\n    return sessionStorage.getItem(key);\r\n  } catch (err) {\r\n    console.warn(\"No se pudo leer sessionStorage:\", err);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst safeSessionSet = (key, value) => {\r\n  try {\r\n    if (value !== undefined && value !== null) {\r\n      sessionStorage.setItem(key, value);\r\n    }\r\n  } catch (err) {\r\n    console.warn(\"No se pudo escribir en sessionStorage:\", err);\r\n  }\r\n};\r\n\r\nconst clearSessionAndRedirect = () => {\r\n  if (hasForcedLogout) {\r\n    return;\r\n  }\r\n  hasForcedLogout = true;\r\n  try {\r\n    sessionStorage.clear();\r\n  } catch {\r\n    /* noop */\r\n  }\r\n  if (sessionService?.limpiarSesion) {\r\n    sessionService.limpiarSesion();\r\n  }\r\n  if (typeof window !== \"undefined\") {\r\n    window.location.href = \"/#/signin\";\r\n  }\r\n};\r\n\r\nconst buildCognitoUser = () => {\r\n  const username = safeSessionGet(\"email\") || safeSessionGet(\"username\");\r\n  if (\r\n    !username ||\r\n    !cognitoPoolConfig.UserPoolId ||\r\n    !cognitoPoolConfig.ClientId\r\n  ) {\r\n    return null;\r\n  }\r\n  const pool = new CognitoUserPool(cognitoPoolConfig);\r\n  return new CognitoUser({\r\n    Username: username,\r\n    Pool: pool,\r\n  });\r\n};\r\n\r\nconst refreshTokens = () => {\r\n  const refreshTokenValue = safeSessionGet(\"refreshToken\");\r\n  const cognitoUser = buildCognitoUser();\r\n  if (!refreshTokenValue || !cognitoUser) {\r\n    return Promise.reject(new Error(\"No hay datos para renovar la sesión.\"));\r\n  }\r\n  const refreshToken = new CognitoRefreshToken({\r\n    RefreshToken: refreshTokenValue,\r\n  });\r\n  return new Promise((resolve, reject) => {\r\n    cognitoUser.refreshSession(refreshToken, (err, session) => {\r\n      if (err) {\r\n        reject(err);\r\n        return;\r\n      }\r\n      const nextAccessToken = session.getAccessToken().getJwtToken();\r\n      const nextIdToken = session.getIdToken().getJwtToken();\r\n      const nextRefreshToken = session.getRefreshToken().getToken();\r\n      safeSessionSet(\"accessToken\", nextAccessToken);\r\n      safeSessionSet(\"idToken\", nextIdToken);\r\n      if (nextRefreshToken) {\r\n        safeSessionSet(\"refreshToken\", nextRefreshToken);\r\n      }\r\n      resolve(nextAccessToken);\r\n    });\r\n  });\r\n};\r\n\r\nconst getRefreshPromise = () => {\r\n  if (!refreshPromise) {\r\n    refreshPromise = refreshTokens()\r\n      .then((token) => {\r\n        refreshPromise = null;\r\n        return token;\r\n      })\r\n      .catch((error) => {\r\n        refreshPromise = null;\r\n        throw error;\r\n      });\r\n  }\r\n  return refreshPromise;\r\n};\r\n\r\nhttp.interceptors.request.use((config) => {\r\n  const accessToken = sessionStorage.getItem(\"accessToken\");\r\n  if (isPronosticoRequest(config.url)) {\r\n    config.headers = config.headers ?? {};\r\n    if (accessToken) {\r\n      config.headers.Authorization = `Bearer ${accessToken}`;\r\n    }\r\n    const usuarioSub = sessionStorage.getItem(\"sub\");\r\n    if (usuarioSub) {\r\n      config.headers[\"X-Usuario-Sub\"] = usuarioSub;\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\nhttp.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    const { config, response } = error;\r\n    if (\r\n      !config ||\r\n      !response ||\r\n      response.status !== 401 ||\r\n      !isPronosticoRequest(config.url)\r\n    ) {\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    if (config.__isRetryRequest) {\r\n      clearSessionAndRedirect();\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    try {\r\n      const newAccessToken = await getRefreshPromise();\r\n      if (!newAccessToken) {\r\n        throw new Error(\"No se obtuvo un token renovado.\");\r\n      }\r\n      config.__isRetryRequest = true;\r\n      config.headers = config.headers ?? {};\r\n      config.headers.Authorization = `Bearer ${newAccessToken}`;\r\n      return http(config);\r\n    } catch (refreshError) {\r\n      clearSessionAndRedirect();\r\n      return Promise.reject(refreshError);\r\n    }\r\n  },\r\n);\r\n\r\nexport default http;\r\n","import { alpha } from '@mui/material/styles';\r\n\r\nconst GREEN = '#2e7d32';\r\nconst RED = '#d32f2f';\r\n\r\nexport const buildTipoSelectSx = (tipo) => (theme) => {\r\n  const isIngreso = String(tipo).toLowerCase() === 'ingreso';\r\n  const base = isIngreso ? GREEN : RED;\r\n\r\n  const bg = alpha(base, 0.12);\r\n  const bgHover = alpha(base, 0.16);\r\n  const bgFocus = alpha(base, 0.20);\r\n\r\n  const palette = (theme.vars || theme).palette;\r\n  const textColor = palette.text.primary;\r\n  const textChannel =\r\n  palette.text?.primaryChannel ?? (theme.palette.mode === 'dark' ? '255 255 255' : '0 0 0');\r\n  \r\n  const rootSelector = '&& .MuiOutlinedInput-root';\r\n  //const textChannel = theme.palette.mode === 'dark' ? '255 255 255' : '0 0 0';\r\n  const inputSelectors = [\r\n    `${rootSelector} .MuiSelect-select`,\r\n    `${rootSelector} .MuiSelect-select.MuiSelect-outlined`,\r\n    `${rootSelector} .MuiSelect-select.MuiSelect-outlined.MuiInputBase-input`,\r\n    `${rootSelector} .MuiInputBase-input`,\r\n    `${rootSelector} .MuiOutlinedInput-input`,\r\n  ].join(', ');\r\n  const iconSelectors = [\r\n    `${rootSelector} .MuiSelect-icon`,\r\n    `${rootSelector} .MuiSelect-iconOutlined`,\r\n    `${rootSelector} .MuiSvgIcon-root`,\r\n  ].join(', ');\r\n\r\n  return {\r\n    [rootSelector]: {\r\n      borderRadius: 1,\r\n      color: textColor,\r\n      backgroundColor: bg,\r\n      '--mui-palette-text-primary': textColor,\r\n      '--mui-palette-text-secondary': textColor,\r\n      '--mui-palette-action-active': textColor,\r\n      '--mui-palette-text-primaryChannel': textChannel,\r\n      '--mui-palette-text-secondaryChannel': textChannel,\r\n      '--mui-palette-action-activeChannel': textChannel,\r\n      '&:hover': { backgroundColor: bgHover },\r\n      '&.Mui-focused': { backgroundColor: bgFocus },\r\n      '& fieldset': { borderColor: palette.divider },\r\n      '&:hover fieldset': { borderColor: palette.divider },\r\n      '&.Mui-focused fieldset': { borderColor: palette.divider },\r\n    },\r\n    [inputSelectors]: {\r\n      color: textColor,\r\n      WebkitTextFillColor: textColor,\r\n      fontWeight: 200,\r\n    },\r\n    [iconSelectors]: {\r\n      color: textColor,\r\n    },\r\n    '&& .MuiInputLabel-root, && .MuiInputLabel-root.Mui-focused': {\r\n      color: textColor,\r\n      WebkitTextFillColor: textColor,\r\n    },\r\n  };\r\n};\r\n","/**\r\n * Categorías unificadas para toda la aplicación\r\n * Estas categorías están sincronizadas con el backend\r\n */\r\n\r\n// Categorías de EGRESOS\r\nexport const CATEGORIAS_EGRESO = [\r\n  \"Alimentos y Bebidas\",\r\n  \"Transporte\",\r\n  \"Vivienda\",\r\n  \"Servicios Básicos\",\r\n  \"Ocio y Entretenimiento\",\r\n  \"Compras Personales\",\r\n  \"Salud\",\r\n  \"Educación\",\r\n  \"Impuestos y Tasas\",\r\n  \"Servicios Financieros\",\r\n  \"Compras de Negocio\",\r\n  \"Otros Egresos\",\r\n];\r\n\r\n// Categorías de INGRESOS\r\nexport const CATEGORIAS_INGRESO = [\r\n  \"Ventas de Productos\",\r\n  \"Prestación de Servicios\",\r\n  \"Cobranzas\",\r\n  \"Transferencias Recibidas\",\r\n  \"Inversiones y Rendimientos\",\r\n  \"Otros Ingresos\",\r\n];\r\n\r\n// Todas las categorías (para uso genérico)\r\nexport const TODAS_LAS_CATEGORIAS = [\r\n  ...CATEGORIAS_EGRESO,\r\n  ...CATEGORIAS_INGRESO,\r\n];\r\n\r\n/**\r\n * Obtiene las categorías según el tipo de registro\r\n * @param {string} tipo - 'Ingreso', 'Egreso', o null para todas\r\n * @returns {string[]} Array de categorías\r\n */\r\nexport function obtenerCategorias(tipo) {\r\n  if (!tipo) return TODAS_LAS_CATEGORIAS;\r\n  if (tipo === \"Ingreso\") return CATEGORIAS_INGRESO;\r\n  if (tipo === \"Egreso\") return CATEGORIAS_EGRESO;\r\n  return TODAS_LAS_CATEGORIAS;\r\n}\r\n"],"names":["numberFormatter","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","formatCurrency","value","allowEmpty","arguments","length","undefined","num","Number","isNaN","concat","format","Math","abs","formatCurrencyInput","parseCurrency","raw","returnEmpty","str","toString","trim","cleaned","replace","negative","startsWith","numeric","normalized","SHORT_MONTH_LABELS","SelectButton","styled","Button","_ref","theme","width","justifyContent","textTransform","color","vars","palette","text","primary","backgroundColor","background","default","border","divider","action","hover","padding","spacing","formatMonthLabel","ym","year","month","split","monthIndex","MonthRangeSelect","_ref2","onChange","anchorEl","setAnchorEl","React","tempSelection","setTempSelection","from","to","yearOffset","setYearOffset","handleClose","years","currentYear","Date","getFullYear","Array","_","i","handleNavigateYears","direction","prev","isBetween","key","_jsxs","_Fragment","children","_jsx","onClick","event","currentTarget","endIcon","ArrowDropDownIcon","sx","display","marginLeft","marginRight","Typography","flex","textAlign","Popover","open","Boolean","onClose","anchorOrigin","vertical","horizontal","transformOrigin","slotProps","paper","minWidth","maxWidth","p","Box","flexDirection","gap","fullWidth","size","borderRadius","minHeight","height","py","map","mb","animation","opacity","transform","variant","fontWeight","gridTemplateColumns","String","padStart","yearMonth","fromDate","clickedDate","handleMonthClick","t","_p$action$selected","_p$action","dark","mode","bgcolor","mainChannel","selected","main","borderColor","boxShadow","mt","borderTop","pt","handleClear","emptySelection","handleConfirm","disabled","tableRowStyle","tableCellStyle","whiteSpace","overflow","textOverflow","headerCellStyle","_objectSpread","startOfMonthUTC","monthZeroBased","UTC","addMonthsUTC","date","count","getUTCFullYear","getUTCMonth","formatUTCToYearMonth","roundTo2","isFinite","round","EPSILON","fmtARS","n","REGLAS","label","PresupuestoNuevo","navigate","useNavigate","step","setStep","creating","setCreating","nombre","setNombre","fechaDesde","setFechaDesde","fechaHasta","setFechaHasta","categorias","setCategorias","categoria","tipo","regla","modo","importe","porcentaje","categoriasOptions","setCategoriasOptions","TODAS_LAS_CATEGORIAS","async","response","http","get","API_CONFIG","REGISTRO","data","error","console","fetchCategorias","presupuestoDataMes","setPresupuestoDataMes","errors","setErrors","lockNegative","setLockNegative","meses","desde","hasta","desdeYear","desdeMonth","hastaYear","hastaMonth","cursor","end","getTime","push","generarMesesEntre","oldData","newData","forEach","mes","cat","_cat$categoria","sugerido","Object","keys","catKey","find","c","mesKey","includes","next","s","min","back","max","handleCambioCategoriaCampo","index","campo","valor","newCats","oldNombre","entries","cats","catName","valores","handleCambioRegla","mesUnico","montoTotal","cuotas","interesMensual","comienza","monthTotals","negativeMonths","totalIngresos","totalEgresos","totals","negatives","ingresosAcumulados","egresosAcumulados","ingresosMes","egresosMes","values","_cat$sugerido","toUpperCase","resultado","ingresos","egresos","resultadoTotal","hasLosses","lossSummaryText","summary","slice","item","_SHORT_MONTH_LABELS$m","rawYear","rawMonth","join","gutterBottom","Stepper","activeStep","alternativeLabel","Step","StepLabel","Alert","severity","TextField","e","target","range","Divider","my","alignItems","startIcon","AddIcon","handleAgregarCategoria","Tooltip","title","FormControlLabel","control","Switch","checked","v","Paper","overflowX","Table","tableLayout","TableHead","TableRow","TableCell","TableBody","idx","_r$cuotas","r","Autocomplete","newValue","options","freeSolo","disableClearable","forcePopupIcon","popupIcon","KeyboardArrowDownIcon","componentsProps","popupIndicator","disableRipple","disableFocusRipple","m","fontSize","clearIndicator","right","top","renderInput","params","placeholder","select","buildTipoSelectSx","MenuItem","op","Stack","type","parsed","InputLabelProps","shrink","inputProps","inputMode","flexWrap","px","IconButton","copia","JSON","parse","stringify","handleDuplicarCategoria","ContentCopyIcon","catEliminada","filter","handleEliminarCategoria","DeleteIcon","CalculateIcon","aplicarReglas","old","nuevo","_cat$categoria2","base","pow","mesU","total","inicio","cuota","round2","x","rn","startIdx","findIndex","Chip","role","AlertTitle","noWrap","resumenMes","esPerdidaMes","_presupuestoDataMes$m2","handleCambioMonto","style","disableHoverListener","component","totalCat","reduce","acc","_presupuestoDataMes$m3","_presupuestoDataMes$m4","v1","v2","validarPaso2","some","_c$categoria","_c$tipo","isBlankNum","isPositiveInt","isInteger","_c$categoria2","_res$data","dDesde","dHasta","firstMonth","plantilla","_ref3","_c$regla$importe","_c$regla","_c$regla2","_presupuestoDataMes$f","_presupuestoDataMes$f2","fallbackDeRegla","detalles","_presupuestoDataMes$m","_registroMes$sugerido","_ref4","_registroMes$montoRea","registroMes","real","montoReal","montoEstimado","montoBase","montoEstimadoPrincipal","payload","autogenerarCeros","res","post","PRONOSTICO","nombreFuente","slug","encodeURIComponent","toLowerCase","_error$response","status","CircularProgress","disableElevation","disabledBackground","backgroundImage","axios","create","PRONOSTICO_BASE_URL","URL_CONFIG","cognitoPoolConfig","UserPoolId","process","ClientId","refreshPromise","hasForcedLogout","isPronosticoRequest","url","safeSessionGet","sessionStorage","getItem","err","warn","safeSessionSet","setItem","clearSessionAndRedirect","clear","_unused","sessionService","limpiarSesion","window","location","href","refreshTokens","refreshTokenValue","cognitoUser","buildCognitoUser","username","pool","CognitoUserPool","CognitoUser","Username","Pool","Promise","reject","Error","refreshToken","CognitoRefreshToken","RefreshToken","resolve","refreshSession","session","nextAccessToken","getAccessToken","getJwtToken","nextIdToken","getIdToken","nextRefreshToken","getRefreshToken","getToken","interceptors","request","use","config","accessToken","_config$headers","headers","Authorization","usuarioSub","__isRetryRequest","_config$headers2","newAccessToken","then","token","catch","refreshError","_palette$text$primary","_palette$text","bg","alpha","bgHover","bgFocus","textColor","textChannel","primaryChannel","rootSelector","inputSelectors","iconSelectors","WebkitTextFillColor","CATEGORIAS_EGRESO","CATEGORIAS_INGRESO"],"sourceRoot":""}