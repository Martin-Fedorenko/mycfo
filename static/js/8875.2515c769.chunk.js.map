{"version":3,"file":"static/js/8875.2515c769.chunk.js","mappings":"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","sources":["registro/carga-general/components/LazyFormWrapper.js","registro/carga-general/components/CargaFormulario.js"],"sourcesContent":["import React, { Suspense } from 'react';\r\nimport { Box, CircularProgress } from '@mui/material';\r\n\r\n/**\r\n * Componente wrapper para lazy loading de formularios\r\n * Evita cargar todos los formularios al inicio\r\n */\r\nconst LazyFormWrapper = ({ children }) => {\r\n  return (\r\n    <Suspense fallback={\r\n      <Box sx={{ \r\n        display: 'flex', \r\n        justifyContent: 'center', \r\n        alignItems: 'center', \r\n        height: 200,\r\n        width: '100%'\r\n      }}>\r\n        <CircularProgress size={40} />\r\n      </Box>\r\n    }>\r\n      {children}\r\n    </Suspense>\r\n  );\r\n};\r\n\r\nexport default LazyFormWrapper;\r\n","import React from \"react\";\r\nimport { Typography, Grid, Snackbar, Alert } from \"@mui/material\";\r\nimport axios from \"axios\";\r\nimport CustomButton from \"../../../shared-components/CustomButton\";\r\nimport LazyFormWrapper from \"./LazyFormWrapper\";\r\nimport API_CONFIG from \"../../../config/api-config\";\r\nimport dayjs from \"dayjs\";\r\n\r\n// Lazy loading para formularios especÃ­ficos\r\nconst FormFactura = React.lazy(() => import(\"./forms/FormFactura\"));\r\nconst FormRegistro = React.lazy(() => import(\"./forms/FormRegistro\"));\r\nconst FormIngreso = React.lazy(() => import(\"./forms/FormIngreso\"));\r\nconst FormEgreso = React.lazy(() => import(\"./forms/FormEgreso\"));\r\nconst FormDeuda = React.lazy(() => import(\"./forms/FormDeuda\"));\r\nconst FormAcreencia = React.lazy(() => import(\"./forms/FormAcreencia\"));\r\n\r\n// ðŸ“Œ Campos obligatorios por tipo de documento\r\nconst requiredFieldsMap = {\r\n  Factura: [\r\n    \"numeroDocumento\",\r\n    \"versionDocumento\",\r\n    \"tipoFactura\",\r\n    \"fechaEmision\",\r\n    \"montoTotal\",\r\n    \"categoria\",\r\n    \"vendedorNombre\",\r\n    \"compradorNombre\",\r\n  ],\r\n  Movimiento: [\"montoTotal\", \"fechaEmision\"],\r\n  Ingreso: [\"montoTotal\", \"fechaEmision\"],\r\n  Egreso: [\"montoTotal\", \"fechaEmision\"],\r\n  Deuda: [\"montoTotal\", \"fechaEmision\"],\r\n  Acreencia: [\"montoTotal\", \"fechaEmision\"],\r\n};\r\n\r\nexport default function CargaFormulario({\r\n  tipoDoc,\r\n  endpoint,\r\n  formData,\r\n  setFormData,\r\n  errors,\r\n  setErrors,\r\n}) {\r\n  const [localErrors, setLocalErrors] = React.useState(errors);\r\n  const [snackbar, setSnackbar] = React.useState({ open: false, severity: \"info\", message: \"\" });\r\n  const [successSnackbar, setSuccessSnackbar] = React.useState({ open: false, message: \"\" });\r\n\r\n  React.useEffect(() => {\r\n    setFormData((prev) => {\r\n      const actual = prev || {};\r\n      if (actual.moneda === \"ARS\") {\r\n        return actual;\r\n      }\r\n      return { ...actual, moneda: \"ARS\" };\r\n    });\r\n  }, [setFormData]);\r\n\r\n  React.useEffect(() => {\r\n    if (!successSnackbar.open) return;\r\n    const timer = setTimeout(\r\n      () => setSuccessSnackbar({ open: false, message: \"\" }),\r\n      3500\r\n    );\r\n    return () => clearTimeout(timer);\r\n  }, [successSnackbar.open]);\r\n\r\n  React.useEffect(() => {\r\n    setLocalErrors(errors);\r\n  }, [errors]);\r\n\r\n  React.useEffect(() => {\r\n    setErrors(localErrors);\r\n  }, [localErrors, setErrors]);\r\n\r\n  const normalizarDatos = React.useCallback(\r\n    (datos) => {\r\n      const resultado = {};\r\n      Object.entries(datos || {}).forEach(([clave, valor]) => {\r\n        if (dayjs.isDayjs(valor)) {\r\n          resultado[clave] = valor.format(\"YYYY-MM-DD\");\r\n        } else if (Array.isArray(valor)) {\r\n          resultado[clave] = valor.map((item) =>\r\n            dayjs.isDayjs(item) ? item.format(\"YYYY-MM-DD\") : item ?? \"\"\r\n          );\r\n        } else if (valor && typeof valor === \"object\") {\r\n          resultado[clave] = valor;\r\n        } else {\r\n          resultado[clave] = valor ?? \"\";\r\n        }\r\n      });\r\n      resultado.moneda = \"ARS\";\r\n      return resultado;\r\n    },\r\n    []\r\n  );\r\n\r\n  const handleSubmit = async () => {\r\n    // âœ… ValidaciÃ³n dinÃ¡mica\r\n    const newErrors = {};\r\n    const requiredFields = requiredFieldsMap[tipoDoc] || [];\r\n\r\n    requiredFields.forEach((field) => {\r\n      if (!formData[field]) {\r\n        newErrors[field] = \"Campo obligatorio\";\r\n      }\r\n    });\r\n\r\n    setErrors(newErrors);\r\n\r\n    if (Object.keys(newErrors).length > 0) {\r\n      alert(\"âš ï¸ Por favor completa todos los campos obligatorios\");\r\n      return; // ðŸš« No enviar si hay errores\r\n    }\r\n\r\n    try {\r\n      // Obtener sub del usuario (REQUERIDO)\r\n      const usuarioSub = sessionStorage.getItem(\"sub\");\r\n      \r\n      if (!usuarioSub) {\r\n        alert(\"âŒ Error: No se encontrÃ³ el usuario en la sesiÃ³n. Por favor, inicia sesiÃ³n nuevamente.\");\r\n        return;\r\n      }\r\n      \r\n      // Configurar headers - SOLO necesitamos X-Usuario-Sub\r\n      const headers = {\r\n        \"X-Usuario-Sub\": usuarioSub\r\n      };\r\n\r\n      const datosParaEnviar = normalizarDatos(formData);\r\n\r\n      // Preparar payload para el endpoint unificado /api/carga-datos\r\n      let payload;\r\n      let tipoMovimiento = null;\r\n\r\n      // Determinar tipo y tipoMovimiento\r\n      if ([\"ingreso\", \"egreso\", \"deuda\", \"acreencia\"].includes(tipoDoc.toLowerCase())) {\r\n        // Es un movimiento\r\n        tipoMovimiento = tipoDoc.charAt(0).toUpperCase() + tipoDoc.slice(1); // Ingreso, Egreso, Deuda, Acreencia\r\n        \r\n        payload = {\r\n          tipo: \"movimiento\",\r\n          metodo: \"formulario\",\r\n          datos: datosParaEnviar,\r\n          tipoMovimiento: tipoMovimiento\r\n        };\r\n      } else if (tipoDoc.toLowerCase() === \"factura\") {\r\n        // Es una factura\r\n        payload = {\r\n          tipo: \"factura\",\r\n          metodo: \"formulario\",\r\n          datos: datosParaEnviar\r\n        };\r\n      } else {\r\n        // Movimiento genÃ©rico\r\n        payload = {\r\n          tipo: \"movimiento\",\r\n          metodo: \"formulario\",\r\n          datos: datosParaEnviar\r\n        };\r\n      }\r\n      \r\n      console.log(\"ðŸ“¤ Enviando datos:\", payload);\r\n      console.log(\"ðŸ” Headers:\", headers);\r\n      \r\n      // Usar endpoint unificado\r\n      const ENDPOINT_UNIFICADO = `${API_CONFIG.REGISTRO}/api/carga-datos`;\r\n      const response = await axios.post(ENDPOINT_UNIFICADO, payload, { headers });\r\n\r\n      console.log(\"âœ… Respuesta del servidor:\", response.data);\r\n      setSuccessSnackbar({ open: true, message: response.data.mensaje || \"Datos guardados exitosamente\" });\r\n      setFormData({});\r\n      setLocalErrors({});\r\n\r\n    } catch (err) {\r\n      console.error(\"âŒ Error en envÃ­o:\", err);\r\n      const mensaje = err.response?.data?.mensaje || err.message || \"Error desconocido\";\r\n      setSnackbar({ open: true, severity: \"error\", message: mensaje });\r\n    }\r\n  };\r\n\r\n  const renderFormulario = () => {\r\n    switch (tipoDoc) {\r\n      case \"factura\":\r\n        return (\r\n          <LazyFormWrapper>\r\n            <FormFactura\r\n              formData={formData}\r\n              setFormData={setFormData}\r\n              errors={localErrors}\r\n            />\r\n          </LazyFormWrapper>\r\n        );\r\n      case \"movimiento\":\r\n        return (\r\n          <LazyFormWrapper>\r\n            <FormRegistro\r\n              tipoDoc={tipoDoc}\r\n              formData={formData}\r\n              setFormData={setFormData}\r\n              errors={localErrors}\r\n            />\r\n          </LazyFormWrapper>\r\n        );\r\n      case \"ingreso\":\r\n        return (\r\n          <LazyFormWrapper>\r\n            <FormIngreso\r\n              formData={formData}\r\n              setFormData={setFormData}\r\n              errors={localErrors}\r\n            />\r\n          </LazyFormWrapper>\r\n        );\r\n      case \"egreso\":\r\n        return (\r\n          <LazyFormWrapper>\r\n            <FormEgreso\r\n              formData={formData}\r\n              setFormData={setFormData}\r\n              errors={localErrors}\r\n            />\r\n          </LazyFormWrapper>\r\n        );\r\n      case \"deuda\":\r\n        return (\r\n          <LazyFormWrapper>\r\n            <FormDeuda\r\n              formData={formData}\r\n              setFormData={setFormData}\r\n              errors={localErrors}\r\n            />\r\n          </LazyFormWrapper>\r\n        );\r\n      case \"acreencia\":\r\n        return (\r\n          <LazyFormWrapper>\r\n            <FormAcreencia\r\n              formData={formData}\r\n              setFormData={setFormData}\r\n              errors={localErrors}\r\n            />\r\n          </LazyFormWrapper>\r\n        );\r\n      default:\r\n        return <Typography>No hay formulario definido para {tipoDoc}</Typography>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Grid sx={{ mt: 3, width: \"100%\" }}>\r\n      \r\n\r\n      {renderFormulario()}\r\n\r\n      <CustomButton\r\n        label={`Enviar ${tipoDoc}`}\r\n        width=\"100%\"\r\n        onClick={handleSubmit}\r\n      />\r\n      {successSnackbar.open && (\r\n        <Alert\r\n          severity=\"success\"\r\n          variant=\"outlined\"\r\n          sx={{ width: \"100%\", mt: 2 }}\r\n          onClose={() => setSuccessSnackbar({ open: false, message: \"\" })}\r\n        >\r\n          {successSnackbar.message}\r\n        </Alert>\r\n      )}\r\n      <Snackbar\r\n        open={snackbar.open}\r\n        autoHideDuration={4000}\r\n        onClose={() => setSnackbar({ open: false, severity: \"info\", message: \"\" })}\r\n        anchorOrigin={{ vertical: \"bottom\", horizontal: \"center\" }}\r\n      >\r\n        <Alert\r\n          onClose={() => setSnackbar({ open: false, severity: \"info\", message: \"\" })}\r\n          severity={snackbar.severity}\r\n          variant=\"filled\"\r\n          sx={{ width: \"100%\" }}\r\n        >\r\n          {snackbar.message}\r\n        </Alert>\r\n      </Snackbar>\r\n    </Grid>\r\n  );\r\n}\r\n"],"names":["_ref","children","_jsx","Suspense","fallback","Box","sx","display","justifyContent","alignItems","height","width","CircularProgress","size","FormFactura","React","FormRegistro","FormIngreso","FormEgreso","FormDeuda","FormAcreencia","requiredFieldsMap","Factura","Movimiento","Ingreso","Egreso","Deuda","Acreencia","CargaFormulario","tipoDoc","endpoint","formData","setFormData","errors","setErrors","localErrors","setLocalErrors","snackbar","setSnackbar","open","severity","message","successSnackbar","setSuccessSnackbar","prev","actual","moneda","_objectSpread","timer","setTimeout","clearTimeout","normalizarDatos","datos","resultado","Object","entries","forEach","_ref2","clave","valor","dayjs","format","Array","isArray","map","item","_jsxs","Grid","mt","renderFormulario","LazyFormWrapper","Typography","CustomButton","label","concat","onClick","async","newErrors","field","keys","length","alert","usuarioSub","sessionStorage","getItem","headers","datosParaEnviar","payload","tipoMovimiento","includes","toLowerCase","charAt","toUpperCase","slice","tipo","metodo","console","log","ENDPOINT_UNIFICADO","API_CONFIG","REGISTRO","response","axios","post","data","mensaje","err","_err$response","_err$response$data","error","Alert","variant","onClose","Snackbar","autoHideDuration","anchorOrigin","vertical","horizontal"],"sourceRoot":""}