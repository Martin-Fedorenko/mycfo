"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[6562],{6562:(e,t,s)=>{s.r(t),s.d(t,{default:()=>be});var o=s(89379),r=s(65043),a=s(53969),l=s(55895),n=s(76943),i=s(26687),c=s(70298),d=s(26529),h=s(56647),u=s(46471),m=s(45847),x=s(85030),g=s(24343),p=s(53089),v=s(94799),A=s(17873),j=s(76072),b=s(94527),f=s(87443),y=s(10756),E=s(86172),w=s(81341),R=s(34375),C=s(12097),M=s(2990),S=s(95315),k=s(82394),I=s(66185),N=s(60267),D=s(29001),T=s(34955),F=s(38915),z=s(20475),P=s(92275),W=s(37426),_=s(69516),O=s(47436),B=s(50108),U=s(82291),H=s(52185),K=s(6026),q=s(80379),L=s(66163),V=s(75748),G=s(35963),J=s(28791),$=s(73243),X=s(70095),Z=s(14057),Q=s(70579);const Y=(0,Z.A)((0,Q.jsx)("path",{d:"M7 6h10l-5.01 6.3zm-2.75-.39C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAltOutlined"),ee=(0,Z.A)((0,Q.jsx)("path",{d:"M16.54 11 13 7.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41zM11 7H2v2h9zm10 6.41L19.59 12 17 14.59 14.41 12 13 13.41 15.59 16 13 18.59 14.41 20 17 17.41 19.59 20 21 18.59 18.41 16zM11 15H2v2h9z"}),"RuleOutlined"),te=(0,Z.A)((0,Q.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.25 2.52.77-1.28-3.52-2.09V8z"}),"HistoryOutlined"),se=(0,Z.A)((0,Q.jsx)("path",{d:"M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.09-.16-.26-.25-.44-.25-.06 0-.12.01-.17.03l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1q-.09-.03-.18-.03c-.17 0-.34.09-.43.25l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.09.16.26.25.44.25.06 0 .12-.01.17-.03l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1q.09.03.18.03c.17 0 .34-.09.43-.25l2-3.46c.12-.22.07-.49-.12-.64zm-1.98-1.71c.04.31.05.52.05.73s-.02.43-.05.73l-.14 1.13.89.7 1.08.84-.7 1.21-1.27-.51-1.04-.42-.9.68c-.43.32-.84.56-1.25.73l-1.06.43-.16 1.13-.2 1.35h-1.4l-.19-1.35-.16-1.13-1.06-.43c-.43-.18-.83-.41-1.23-.71l-.91-.7-1.06.43-1.27.51-.7-1.21 1.08-.84.89-.7-.14-1.13c-.03-.31-.05-.54-.05-.74s.02-.43.05-.73l.14-1.13-.89-.7-1.08-.84.7-1.21 1.27.51 1.04.42.9-.68c.43-.32.84-.56 1.25-.73l1.06-.43.16-1.13.2-1.35h1.39l.19 1.35.16 1.13 1.06.43c.43.18.83.41 1.23.71l.91.7 1.06-.43 1.27-.51.7 1.21-1.07.85-.89.7zM12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"SettingsOutlined");var oe=s(27421),re=s(73456),ae=s(13658),le=s(96470);const ne=e=>"number"===typeof e?e:null==e||isNaN(Number(e))?0:Number(e),ie="#a5d6a7",ce="#4caf50",de="#ef9a9a",he="#f44336",ue="#4caf50",me="#f44336",xe={fontWeight:500,bgcolor:"#FFDE70",backgroundColor:"#FFDE70",color:"#000",border:"1px solid #F5C16C","& .MuiChip-label":{color:"#000"},"& .MuiChip-icon":{color:"#000"},"&.MuiChip-filled":{backgroundColor:"#FFDE70"}},ge=e=>({borderCollapse:"collapse",border:"1px solid ".concat((e.vars||e).palette.divider)}),pe=e=>({border:"1px solid ".concat((e.vars||e).palette.divider),padding:"12px"}),ve=e=>(0,o.A)((0,o.A)({},pe(e)),{},{fontWeight:700}),Ae=e=>["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][parseInt(e,10)-1]||e;const je=e=>{if(!e||"string"!==typeof e)return null;const[t,s,o]=e.split("-"),r=Number(t),a=Number(s),l=Number(o);if(!Number.isFinite(r)||!Number.isFinite(a)||!Number.isFinite(l))return null;const n=new Date(r,a-1,l);return(e=>e instanceof Date&&!Number.isNaN(e.getTime()))(n)?n:null};function be(){var e,t,Z,be,fe,ye;const{nombre:Ee}=(0,D.g)(),we=(0,D.Zp)(),Re=(0,N.A)(),Ce="light"===Re.palette.mode,Me=null!==(e=null===(t=Re.vars)||void 0===t?void 0:t.palette)&&void 0!==e?e:Re.palette,Se=r.useMemo(()=>({ingresos:Ce?"hsl(120, 44%, 53%)":Me.success.light,egresos:Ce?"hsl(0, 90%, 40%)":Me.error.light,resultadoPos:Ce?"hsl(210, 98%, 42%)":Me.info.light,resultadoNeg:Ce?"hsl(45, 90%, 40%)":Me.warning.light}),[Ce,Me.error.light,Me.info.light,Me.success.light,Me.warning.light]),ke=Ce?null!==(Z=null===(be=Me.text)||void 0===be?void 0:be.primary)&&void 0!==Z?Z:"#000":null!==(fe=null===(ye=Me.common)||void 0===ye?void 0:ye.white)&&void 0!==fe?fe:"#fff",[Ie,Ne]=r.useState({id:null,nombre:"",detalleMensual:[]}),[De,Te]=r.useState(!0),[Fe,ze]=r.useState(null),[Pe,We]=r.useState(0),[_e,Oe]=r.useState(!1),[Be,Ue]=r.useState(!1),[He,Ke]=r.useState(0),[qe,Le]=r.useState(null),[Ve,Ge]=r.useState(!1),[Je,$e]=r.useState("Ingresos");r.useEffect(()=>{Ee&&(async()=>{try{Te(!0),ze(null);const l=await F.A.get("".concat(ae.A.PRONOSTICO,"/api/presupuestos")),n=null===l||void 0===l?void 0:l.data;let i=[];Array.isArray(n)?i=n:Array.isArray(null===n||void 0===n?void 0:n.content)&&(i=n.content);const c=decodeURIComponent(Ee||"").trim().toLowerCase().replace(/\s+/g,"-"),d=i.find(e=>((null===e||void 0===e?void 0:e.nombre)||"").trim().toLowerCase().replace(/\s+/g,"-")===c);if(null===d||void 0===d||!d.id)return Ne({id:null,nombre:"No encontrado",detalleMensual:[]}),void Te(!1);let h=d.nombre;try{var e;const t=await F.A.get("".concat(ae.A.PRONOSTICO,"/api/presupuestos/").concat(d.id));null!==t&&void 0!==t&&null!==(e=t.data)&&void 0!==e&&e.nombre&&(h=t.data.nombre)}catch(r){}const u=await F.A.get("".concat(ae.A.PRONOSTICO,"/api/presupuestos/").concat(d.id,"/totales")),m=(Array.isArray(u.data)?u.data:[]).map((e,t)=>{const s=ne(e.ingresoEstimado),o=ne(e.egresoEstimado);return{id:t+1,mes:e.mes,ingresoEst:s,ingresoReal:0,egresoEst:o,egresoReal:0,totalEst:s-o,totalReal:0}});let x={},g={};try{const e=m.map(e=>{const t=((null===e||void 0===e?void 0:e.mes)||"").slice(0,7);return t?je("".concat(t,"-01")):null}).filter(Boolean);if(e.length>0){const o=Math.min(...e.map(e=>e.getTime())),r=Math.max(...e.map(e=>e.getTime())),a=(0,P.w)(new Date(o)),l=(0,W.p)(new Date(r));console.log("\ud83d\ude80 Usando endpoint optimizado para obtener movimientos del presupuesto");const n=(0,_.GP)(a,"yyyy-MM-dd"),i=(0,_.GP)(l,"yyyy-MM-dd"),c=await(0,O.c)({fechaDesde:n,fechaHasta:i});var t,s;if(null!==c&&void 0!==c&&c.datosMensuales)c.datosMensuales.forEach(e=>{const t=e.mes;x[t]=Number(e.totalIngresos||0),g[t]=Number(e.totalEgresos||0)}),console.log("\u2705 Datos obtenidos con endpoint optimizado:",{meses:Object.keys(x).length,totalIngresos:null===(t=c.resumenTotal)||void 0===t?void 0:t.totalIngresos,totalEgresos:null===(s=c.resumenTotal)||void 0===s?void 0:s.totalEgresos})}}catch(a){console.error("\u274c Error al obtener datos reales del presupuesto:",a),ze(e=>null!==e&&void 0!==e?e:"No se pudieron cargar los datos reales del presupuesto.")}const p=m.map(e=>{const t=((null===e||void 0===e?void 0:e.mes)||"").slice(0,7),s=ne(g[t]||0),r=ne(x[t]||0);return(0,o.A)((0,o.A)({},e),{},{ingresoReal:r,egresoReal:s,totalReal:r-s})});Ne({id:d.id,nombre:h,detalleMensual:p})}catch(Fe){console.error("Error al cargar presupuesto:",Fe),ze("Error al cargar el presupuesto"),Ne({id:null,nombre:"Error",detalleMensual:[]})}finally{Te(!1)}})()},[Ee]);const Xe=Array.isArray(Ie.detalleMensual)?Ie.detalleMensual.filter(e=>!(null===e||void 0===e||!e.mes)):[],Ze=r.useMemo(()=>{let e=[...Xe];if(e=e.map(e=>{var t,s;const r=ne(null!==(t=e.totalEst)&&void 0!==t?t:ne(e.ingresoEst)-ne(e.egresoEst)),a=ne(null!==(s=e.totalReal)&&void 0!==s?s:ne(e.ingresoReal)-ne(e.egresoReal)),l=(a-r)/(Math.abs(r)>0?Math.abs(r):1),n=a<0;return(0,o.A)((0,o.A)({},e),{},{_estTotal:r,_realTotal:a,_pctDesvio:l,_deficit:n})}),_e&&(e=e.filter(e=>e._realTotal<0)),Number.isFinite(He)&&He>0){const t=He/100;e=e.filter(e=>Math.abs(e._pctDesvio)>=t||!Number.isFinite(e._pctDesvio))}return e},[Xe,_e,He]),Qe=Xe.reduce((e,t)=>e+ne(t.ingresoEst),0),Ye=Xe.reduce((e,t)=>e+ne(t.ingresoReal),0),et=Xe.reduce((e,t)=>e+ne(t.egresoEst),0),tt=Xe.reduce((e,t)=>e+ne(t.egresoReal),0),st=Ye-tt,ot=Qe-et,rt=(()=>{const e=Math.abs(ot)>0?Math.abs(ot):1;return Math.max(0,Math.min(1.2,st/e))})(),at=(lt=rt)>=.95?{label:"Salud: Verde",color:"success"}:lt>=.8?{label:"Salud: Amarillo",color:"warning"}:{label:"Salud: Rojo",color:"error"};var lt;const nt=Ze.map(e=>{const t=((null===e||void 0===e?void 0:e.mes)||"0000-01").split("-")[1];return{mes:Ae(t),estimado:ne(e.ingresoEst),real:ne(e.ingresoReal)}}),it=Ze.map(e=>{const t=((null===e||void 0===e?void 0:e.mes)||"0000-01").split("-")[1];return{mes:Ae(t),estimado:ne(e.egresoEst),real:ne(e.egresoReal)}}),ct=Ze.map(e=>{var t;const s=ne(null!==(t=e.totalReal)&&void 0!==t?t:ne(e.ingresoReal)-ne(e.egresoReal)),o=((null===e||void 0===e?void 0:e.mes)||"0000-01").split("-")[1];return{mes:Ae(o),superavit:s,fill:s>=0?ue:me}}),dt=e=>{if(null===e||void 0===e||!e.mes)return void alert("Mes no v\xe1lido");const t=encodeURIComponent((Ie.nombre||"").trim().toLowerCase().replace(/\s+/g,"-")),s=(e.mes||"0000-01").split("-"),o=parseInt(s[1]||"1",10),r=new Intl.DateTimeFormat("es-ES",{month:"long"}).format(new Date(2025,(o||1)-1));we("/presupuestos/".concat(t,"/detalle/").concat(r))},ht=r.useMemo(()=>Xe.map(e=>{var t,s;const r=ne(null!==(t=e.totalEst)&&void 0!==t?t:ne(e.ingresoEst)-ne(e.egresoEst)),a=ne(null!==(s=e.totalReal)&&void 0!==s?s:ne(e.ingresoReal)-ne(e.egresoReal))-r;return(0,o.A)((0,o.A)({},e),{},{_delta:a,_absDelta:Math.abs(a)})}).sort((e,t)=>t._absDelta-e._absDelta),[Xe]),ut=Boolean(qe);return De?(0,Q.jsx)(a.A,{sx:{width:"100%",p:3},children:(0,Q.jsx)(le.A,{message:"Cargando presupuesto..."})}):(0,Q.jsxs)(a.A,{id:"presupuesto-detalle-content",sx:{width:"100%",p:3},children:[(0,Q.jsxs)(l.A,{variant:"h4",gutterBottom:!0,fontWeight:"600",children:["Detalle de ",Ie.nombre]}),(0,Q.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,sx:{color:"text.primary"},children:"Compar\xe1 tu planificaci\xf3n con lo real"}),(0,Q.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,mt:1,gap:1,flexWrap:"wrap"},children:[(0,Q.jsxs)(n.A,{value:Pe,onChange:(e,t)=>We(t),indicatorColor:"primary",children:[(0,Q.jsx)(i.A,{label:"Resumen",sx:{color:ke,"&.Mui-selected":{color:ke},"& .MuiTab-wrapper":{color:ke}}}),(0,Q.jsx)(i.A,{label:"Datos brutos",sx:{color:ke,"&.Mui-selected":{color:ke},"& .MuiTab-wrapper":{color:ke}}})]}),(0,Q.jsxs)(c.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,Q.jsx)(d.A,{title:"Filtros",children:(0,Q.jsx)(h.A,{onClick:e=>Le(e.currentTarget),children:(0,Q.jsx)(Y,{})})}),(0,Q.jsx)(T.A,{onExportPdf:()=>{Promise.all([s.e(1389),s.e(74)]).then(s.t.bind(s,90074,23)).then(e=>{const t=document.getElementById("presupuesto-detalle-content"),s={margin:.5,filename:"Presupuesto_".concat(Ie.nombre||"","_").concat(Ie.id||"",".pdf"),image:{type:"jpeg",quality:.95},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"landscape"}};e.default().from(t).set(s).save()})},onExportExcel:()=>{const e=[["Mes","Ingreso Estimado","Ingreso Real","Desv\xedo Ingresos","Egreso Estimado","Egreso Real","Desv\xedo Egresos","Total Estimado","Total Real","Total Desv\xedo"],...Xe.map(e=>{var t;return[null!==(t=e.mes)&&void 0!==t?t:"\u2014",ne(e.ingresoEst),ne(e.ingresoReal),ne(e.ingresoReal)-ne(e.ingresoEst),ne(e.egresoEst),ne(e.egresoReal),ne(e.egresoReal)-ne(e.egresoEst),ne(e.totalEst),ne(e.totalReal),ne(e.totalReal)-ne(e.totalEst)]})];e.push(["","","","","","","","","",""]),e.push(["Totales:","","","","","","","","",""]),e.push(["",Qe,Ye,Ye-Qe,et,tt,tt-et,ot,st,st-ot]),Promise.all([s.e(1652),s.e(2514)]).then(s.t.bind(s,81652,23)).then(t=>{let{utils:s,writeFile:o}=t;const r=s.aoa_to_sheet(e,{cellStyles:!0}),a=s.book_new();s.book_append_sheet(a,r,"Detalle Presupuesto"),o(a,"Presupuesto_".concat(Ie.nombre||"","_").concat(Ie.id||"",".xlsx"),{cellStyles:!0})})}})]})]}),(0,Q.jsx)(u.A,{anchorEl:qe,open:ut,onClose:()=>Le(null),children:(0,Q.jsx)(a.A,{sx:{p:2,width:280},children:(0,Q.jsxs)(c.A,{spacing:1.5,children:[(0,Q.jsx)(m.A,{control:(0,Q.jsx)(x.A,{checked:_e,onChange:(e,t)=>Oe(t)}),label:"Ver solo meses con d\xe9ficit"}),(0,Q.jsx)(m.A,{control:(0,Q.jsx)(x.A,{checked:Be,onChange:(e,t)=>Ue(t)}),label:"Mostrar foco en estimados (oculta \u2018Real\u2019 en gr\xe1ficas)"}),(0,Q.jsx)(g.A,{label:"Umbral de desv\xedo (%)",type:"number",size:"small",value:He,onChange:e=>Ke(Math.max(0,Number(e.target.value)))})]})})}),0===Pe&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)(p.A,{container:!0,spacing:2,mb:2,children:[(0,Q.jsx)(p.A,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsxs)(v.A,{sx:{p:3,textAlign:"center",bgcolor:Se.ingresos,color:"white",position:"relative",height:"100%"},children:[(0,Q.jsx)(A.A,{sx:{width:56,height:56,bgcolor:"white",color:"success.main",mx:"auto",mb:1},children:"+"}),(0,Q.jsx)(l.A,{variant:"h6",children:"Ingresos"}),(0,Q.jsx)(l.A,{variant:"body2",sx:{display:"block",color:"rgba(255,255,255,0.9)"},children:"Real acumulado"}),(0,Q.jsx)(l.A,{variant:"h4",fontWeight:"bold",children:(0,z.vv)(Ye)}),(0,Q.jsxs)(l.A,{variant:"body2",sx:{color:"rgba(255,255,255,0.9)"},children:["Estimado: ",(0,z.vv)(Qe)]}),(0,Q.jsx)(d.A,{title:"Ver meses con mayor desv\xedo en ingresos",children:(0,Q.jsx)(h.A,{size:"small",onClick:()=>Ge(!0)||$e("Ingresos"),sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(255,255,255,0.9)"},children:(0,Q.jsx)(ee,{fontSize:"small"})})})]})}),(0,Q.jsx)(p.A,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsxs)(v.A,{sx:{p:3,textAlign:"center",bgcolor:Se.egresos,color:"white",position:"relative",height:"100%"},children:[(0,Q.jsx)(A.A,{sx:{width:56,height:56,bgcolor:"white",color:"error.main",mx:"auto",mb:1},children:"-"}),(0,Q.jsx)(l.A,{variant:"h6",children:"Egresos"}),(0,Q.jsx)(l.A,{variant:"body2",sx:{display:"block",color:"rgba(255,255,255,0.9)"},children:"Real acumulado"}),(0,Q.jsx)(l.A,{variant:"h4",fontWeight:"bold",children:(0,z.vv)(tt)}),(0,Q.jsxs)(l.A,{variant:"body2",sx:{color:"rgba(255,255,255,0.9)"},children:["Estimado: ",(0,z.vv)(et)]}),(0,Q.jsx)(d.A,{title:"Ver meses con mayor desv\xedo en egresos",children:(0,Q.jsx)(h.A,{size:"small",onClick:()=>Ge(!0)||$e("egresos"),sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(255,255,255,0.9)"},children:(0,Q.jsx)(se,{fontSize:"small"})})})]})}),(0,Q.jsx)(p.A,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsxs)(v.A,{sx:{p:3,textAlign:"center",bgcolor:st>=0?Se.resultadoPos:Se.resultadoNeg,color:"white",position:"relative",height:"100%"},children:[(0,Q.jsx)(A.A,{sx:{width:56,height:56,bgcolor:"white",color:st>=0?"info.main":"warning.main",mx:"auto",mb:1},children:st>=0?"\u2713":"\u26a0"}),(0,Q.jsx)(l.A,{variant:"h6",children:"Resultado"}),(0,Q.jsx)(l.A,{variant:"h4",fontWeight:"bold",children:(0,z.vv)(st)}),(0,Q.jsx)(l.A,{variant:"body2",children:st>=0?"Super\xe1vit":"D\xe9ficit"}),(0,Q.jsx)(d.A,{title:"Ver meses ordenados por impacto en resultado",children:(0,Q.jsx)(h.A,{size:"small",onClick:()=>Ge(!0)||$e("resultado"),sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(255,255,255,0.9)"},children:(0,Q.jsx)(te,{fontSize:"small"})})})]})}),(0,Q.jsx)(p.A,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsxs)(v.A,{sx:{p:3,textAlign:"center"},children:[(0,Q.jsx)(l.A,{variant:"overline",children:"Marcador de salud"}),(0,Q.jsxs)(c.A,{alignItems:"center",spacing:1,children:[(0,Q.jsx)(j.A,{label:"".concat(at.label),color:at.color}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Cumplimiento: ",(100*rt).toFixed(0),"%"]})]})]})})]}),(0,Q.jsx)(b.A,{sx:{mb:2}}),(0,Q.jsxs)(v.A,{sx:{p:3,mb:3},children:[(0,Q.jsxs)(c.A,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,Q.jsx)(l.A,{variant:"h6",fontWeight:"600",children:"Ingresos: Estimado vs Real"}),(0,Q.jsx)(j.A,{size:"small",label:Be?"Foco: Estimados":"Todos"})]}),(0,Q.jsx)(a.A,{sx:{mt:2},children:nt.map((e,t)=>{const s=1.2*Math.max(e.estimado,e.real)||1,o=Ze[t];return(0,Q.jsxs)(a.A,{sx:{mb:3},children:[(0,Q.jsx)(l.A,{variant:"subtitle1",fontWeight:"600",gutterBottom:!0,children:e.mes}),(0,Q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2,cursor:"pointer"},onClick:()=>o&&dt(o),children:[(0,Q.jsx)(l.A,{variant:"body2",sx:{minWidth:80},children:"Estimado:"}),(0,Q.jsx)(a.A,{sx:{flex:1,height:30},children:(0,Q.jsx)(B.u,{width:"100%",height:30,children:(0,Q.jsxs)(U.E,{data:[{name:e.mes,valor:e.estimado}],layout:"vertical",children:[(0,Q.jsx)(H.W,{type:"number",domain:[0,s],hide:!0}),(0,Q.jsx)(K.h,{type:"category",dataKey:"name",hide:!0}),(0,Q.jsx)(q.m,{formatter:e=>[(0,z.vv)(e),""]}),(0,Q.jsx)(L.y,{dataKey:"valor",fill:ie,radius:[4,4,4,4],label:{position:"right",formatter:e=>(0,z.vv)(e)}})]})})})]}),!Be&&(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2,cursor:"pointer"},onClick:()=>o&&dt(o),children:[(0,Q.jsx)(l.A,{variant:"body2",sx:{minWidth:80},children:"Real:"}),(0,Q.jsx)(a.A,{sx:{flex:1,height:30},children:(0,Q.jsx)(B.u,{width:"100%",height:30,children:(0,Q.jsxs)(U.E,{data:[{name:e.mes,valor:e.real}],layout:"vertical",children:[(0,Q.jsx)(H.W,{type:"number",domain:[0,s],hide:!0}),(0,Q.jsx)(K.h,{type:"category",dataKey:"name",hide:!0}),(0,Q.jsx)(q.m,{formatter:e=>[(0,z.vv)(e),""]}),(0,Q.jsx)(L.y,{dataKey:"valor",fill:ce,radius:[4,4,4,4],label:{position:"right",formatter:e=>(0,z.vv)(e)}})]})})})]})]})]},"".concat(e.mes,"-").concat(t))})})]}),(0,Q.jsxs)(v.A,{sx:{p:3,mb:3},children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,fontWeight:"600",children:"Egresos: Estimado vs Real"}),(0,Q.jsx)(a.A,{sx:{mt:2},children:it.map((e,t)=>{const s=1.2*Math.max(e.estimado,e.real)||1,o=Ze[t];return(0,Q.jsxs)(a.A,{sx:{mb:3},children:[(0,Q.jsx)(l.A,{variant:"subtitle1",fontWeight:"600",gutterBottom:!0,children:e.mes}),(0,Q.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2,cursor:"pointer"},onClick:()=>o&&dt(o),children:[(0,Q.jsx)(l.A,{variant:"body2",sx:{minWidth:80},children:"Estimado:"}),(0,Q.jsx)(a.A,{sx:{flex:1,height:30},children:(0,Q.jsx)(B.u,{width:"100%",height:30,children:(0,Q.jsxs)(U.E,{data:[{name:e.mes,valor:e.estimado}],layout:"vertical",children:[(0,Q.jsx)(H.W,{type:"number",domain:[0,s],hide:!0}),(0,Q.jsx)(K.h,{type:"category",dataKey:"name",hide:!0}),(0,Q.jsx)(q.m,{formatter:e=>[(0,z.vv)(e),""]}),(0,Q.jsx)(L.y,{dataKey:"valor",fill:de,radius:[4,4,4,4],label:{position:"right",formatter:e=>(0,z.vv)(e)}})]})})})]}),!Be&&(0,Q.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2,cursor:"pointer"},onClick:()=>o&&dt(o),children:[(0,Q.jsx)(l.A,{variant:"body2",sx:{minWidth:80},children:"Real:"}),(0,Q.jsx)(a.A,{sx:{flex:1,height:30},children:(0,Q.jsx)(B.u,{width:"100%",height:30,children:(0,Q.jsxs)(U.E,{data:[{name:e.mes,valor:e.real}],layout:"vertical",children:[(0,Q.jsx)(H.W,{type:"number",domain:[0,s],hide:!0}),(0,Q.jsx)(K.h,{type:"category",dataKey:"name",hide:!0}),(0,Q.jsx)(q.m,{formatter:e=>[(0,z.vv)(e),""]}),(0,Q.jsx)(L.y,{dataKey:"valor",fill:he,radius:[4,4,4,4],label:{position:"right",formatter:e=>(0,z.vv)(e)}})]})})})]})]})]},"".concat(e.mes,"-").concat(t))})})]}),(0,Q.jsxs)(v.A,{sx:{p:3},children:[(0,Q.jsx)(l.A,{variant:"h6",gutterBottom:!0,fontWeight:"600",children:"Tendencia del Resultado Mensual"}),(0,Q.jsx)(B.u,{width:"100%",height:300,children:(0,Q.jsxs)(V.b,{data:ct,margin:{top:10,right:30,left:0,bottom:0},children:[(0,Q.jsx)("defs",{children:(0,Q.jsxs)("linearGradient",{id:"splitColor",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,Q.jsx)("stop",{offset:"50%",stopColor:"#4caf50",stopOpacity:.1}),(0,Q.jsx)("stop",{offset:"50%",stopColor:"#f44336",stopOpacity:.1})]})}),(0,Q.jsx)(G.Gk,{dataKey:"superavit",fill:"url(#splitColor)",stroke:"none",yAxisId:"left"}),(0,Q.jsx)(J.N,{type:"monotone",dataKey:"superavit",stroke:"#2196f3",strokeWidth:2,dot:{r:6,cursor:"pointer"},activeDot:{r:8},yAxisId:"left",onClick:(e,t)=>{const s=Ze[t];s&&dt(s)}}),(0,Q.jsx)($.e,{y:0,stroke:"#666",strokeDasharray:"3 3",label:{value:"Punto de equilibrio",position:"right",fill:"#666",fontSize:12}}),(0,Q.jsx)(H.W,{dataKey:"mes"}),(0,Q.jsx)(K.h,{yAxisId:"left",domain:[e=>Math.min(e,0),e=>Math.max(e,0)],tickFormatter:e=>(0,z.vv)(e),width:70}),(0,Q.jsx)(q.m,{formatter:e=>[Number(e)>=0?"Super\xe1vit: ".concat((0,z.vv)(e)):"D\xe9ficit: ".concat((0,z.vv)(e)),"Resultado"],contentStyle:{color:"black"}}),(0,Q.jsx)(X.s,{payload:[{value:"Resultado mensual",type:"line",color:"#2196f3"},{value:"Punto de equilibrio",type:"dashedLine",color:"#666"}]})]})})]})]}),1===Pe&&(0,Q.jsx)(v.A,{sx:{overflowX:"auto"},children:(0,Q.jsxs)(f.A,{sx:ge,children:[(0,Q.jsx)(y.A,{children:(0,Q.jsxs)(E.A,{children:[(0,Q.jsx)(w.A,{sx:ve,children:"Mes"}),(0,Q.jsx)(w.A,{sx:ve,children:"Ingreso Est."}),(0,Q.jsx)(w.A,{sx:ve,children:"Ingreso Real"}),(0,Q.jsx)(w.A,{sx:ve,children:"Egreso Est."}),(0,Q.jsx)(w.A,{sx:ve,children:"Egreso Real"}),(0,Q.jsx)(w.A,{sx:ve,children:"Resultado"}),(0,Q.jsx)(w.A,{sx:ve,children:"Acciones"})]})}),(0,Q.jsx)(R.A,{children:Ze.length>0?Ze.map((e,t)=>{var s,r;const a=ne(e.ingresoEst),l=ne(e.ingresoReal),n=ne(e.egresoEst),i=ne(e.egresoReal),d=ne(null!==(s=e.totalReal)&&void 0!==s?s:l-i),h=ne(null!==(r=e.totalEst)&&void 0!==r?r:a-n),u=d-h,m=Math.abs(h)>0?u/Math.abs(h)*100:0;return(0,Q.jsxs)(E.A,{children:[(0,Q.jsxs)(w.A,{sx:pe,children:[e.mes,d<0&&(0,Q.jsx)(j.A,{size:"small",icon:(0,Q.jsx)(re.A,{fontSize:"small"}),sx:(0,o.A)({ml:1},xe),label:"Mes con d\xe9ficit"})]}),(0,Q.jsx)(w.A,{sx:pe,children:(0,z.vv)(a)}),(0,Q.jsx)(w.A,{sx:pe,children:(0,z.vv)(l)}),(0,Q.jsx)(w.A,{sx:pe,children:(0,z.vv)(n)}),(0,Q.jsx)(w.A,{sx:pe,children:(0,z.vv)(i)}),(0,Q.jsxs)(w.A,{sx:e=>(0,o.A)((0,o.A)({},pe(e)),{},{fontWeight:700,color:m>=0?"#66bb6a":"#ef5350"}),children:[(0,z.vv)(d)," ",(0,Q.jsxs)("span",{style:{color:m>=0?"#66bb6a":"#ef5350"},children:["(",m.toFixed(0),"%)"]})]}),(0,Q.jsx)(w.A,{sx:pe,children:(0,Q.jsx)(c.A,{direction:"row",spacing:1,children:(0,Q.jsx)(C.A,{size:"small",variant:"contained",onClick:()=>dt(e),children:"Ver mes"})})})]},e.mes||t)}):(0,Q.jsx)(E.A,{children:(0,Q.jsx)(w.A,{colSpan:7,sx:e=>(0,o.A)((0,o.A)({},pe(e)),{},{textAlign:"center",padding:"20px",color:(e.vars||e).palette.text.secondary}),children:"No hay datos mensuales con los filtros actuales."})})})]})}),(0,Q.jsx)(a.A,{mt:4,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:(0,Q.jsx)(C.A,{variant:"outlined",onClick:()=>we(-1),children:"Volver"})}),(0,Q.jsx)(M.Ay,{anchor:"right",open:Ve,onClose:()=>Ge(!1),children:(0,Q.jsxs)(a.A,{sx:{width:360,p:2},children:[(0,Q.jsxs)(c.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[(0,Q.jsx)(l.A,{variant:"h6",children:"Meses con mayor desv\xedo"}),(0,Q.jsx)(h.A,{onClick:()=>Ge(!1),children:(0,Q.jsx)(oe.A,{})})]}),(0,Q.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Ingresos"===Je&&"Ordenado por diferencia Ingreso Real vs Estimado.","Egresos"===Je&&"Ordenado por diferencia Egreso Real vs Estimado.","resultado"===Je&&"Ordenado por diferencia de Resultado Real vs Estimado."]}),(0,Q.jsx)(S.A,{dense:!0,children:ht.map((e,t)=>{var s,o;const r=ne(e.ingresoReal)-ne(e.ingresoEst),a=ne(e.egresoReal)-ne(e.egresoEst),l=ne(null!==(s=e.totalEst)&&void 0!==s?s:ne(e.ingresoEst)-ne(e.egresoEst)),n=ne(null!==(o=e.totalReal)&&void 0!==o?o:ne(e.ingresoReal)-ne(e.egresoReal)),i="Ingresos"===Je?r:"egresos"===Je?a:n-l;return(0,Q.jsx)(k.Ay,{secondaryAction:(0,Q.jsx)(C.A,{size:"small",variant:"text",onClick:()=>{Ge(!1),dt(e)},children:"Ajustar mes"}),children:(0,Q.jsx)(I.A,{primary:e.mes,secondary:(0,Q.jsxs)("span",{style:{color:i>=0?"#66bb6a":"#ef5350"},children:[i>=0?"+":"-",(0,z.vv)(Math.abs(i))]})})},e.mes||t)})})]})})]})}},20475:(e,t,s)=>{s.d(t,{F5:()=>a,vu:()=>l,vv:()=>r});const o=new Intl.NumberFormat("es-AR",{minimumFractionDigits:0,maximumFractionDigits:2}),r=function(e){let{allowEmpty:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(""===e||null===e||"undefined"===typeof e)return t?"":"$ 0";const s=Number(e);if(Number.isNaN(s))return t?"":"$ 0";return"".concat(s<0?"-":"","$ ").concat(o.format(Math.abs(s)))},a=e=>r(e,{allowEmpty:!0}),l=function(e){let{returnEmpty:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e)return t?"":0;const s=e.toString().trim();if(!s)return t?"":0;const o=s.replace(/\s+/g,"").replace(/\$/g,""),r=o.startsWith("-"),a=o.replace(/[^0-9,.-]/g,"");if(!a||"-"===a)return t?"":0;const l=a.replace(/-/g,"").replace(/\./g,"").replace(",","."),n=Number(l);return Number.isNaN(n)?t?"":0:r?-n:n}},34955:(e,t,s)=>{s.d(t,{A:()=>x});var o=s(89379),r=(s(65043),s(53969)),a=s(26529),l=s(56647),n=s(74917),i=s(36252),c=s(70579);const d="#FDE4E3",h="#FACDCA",u="#E5F4E5",m="#CAE7CB";function x(e){let{onExportPdf:t,onExportExcel:s,sx:x={}}=e;return(0,c.jsxs)(r.A,{sx:(0,o.A)({display:"flex",gap:1},x),children:[(0,c.jsx)(a.A,{title:"Exportar PDF",children:(0,c.jsx)(l.A,{onClick:t,size:"small",color:"error",sx:e=>{const t={bgcolor:"".concat(h," !important"),backgroundColor:"".concat(h," !important"),borderColor:"#d32f2f","& .MuiSvgIcon-root":{color:"#000 !important"}};return(0,o.A)({border:"1px solid",borderColor:"#d32f2f",bgcolor:"".concat(d," !important"),backgroundColor:"".concat(d," !important"),"& .MuiSvgIcon-root":{color:"#000 !important"},"&:hover":t,width:36,height:36},e.applyStyles("dark",{borderColor:"#d32f2f","&:hover":t}))},"aria-label":"Exportar PDF",children:(0,c.jsx)(n.A,{fontSize:"small"})})}),(0,c.jsx)(a.A,{title:"Exportar Excel",children:(0,c.jsxs)(l.A,{onClick:s,size:"small",color:"success",sx:e=>{const t={bgcolor:"".concat(m," !important"),backgroundColor:"".concat(m," !important"),borderColor:"#2e7d32","& .MuiSvgIcon-root":{color:"#000 !important"}};return(0,o.A)({border:"1px solid",borderColor:"#2e7d32",bgcolor:"".concat(u," !important"),backgroundColor:"".concat(u," !important"),"& .MuiSvgIcon-root":{color:"#000 !important"},"&:hover":t,width:36,height:36},e.applyStyles("dark",{borderColor:"#2e7d32","&:hover":t}))},"aria-label":"Exportar Excel",children:[(0,c.jsx)(i.A,{fontSize:"small"})," "]})})]})}},38915:(e,t,s)=>{s.d(t,{A:()=>v});var o=s(79722),r=s(35644),a=s(29296),l=s(13658);const n=o.A.create(),i=l.A.PRONOSTICO,c={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let d=null,h=!1;const u=e=>Boolean(e&&i&&String(e).startsWith(String(i))),m=e=>{try{return sessionStorage.getItem(e)}catch(t){return console.warn("No se pudo leer sessionStorage:",t),null}},x=(e,t)=>{try{void 0!==t&&null!==t&&sessionStorage.setItem(e,t)}catch(s){console.warn("No se pudo escribir en sessionStorage:",s)}},g=()=>{if(!h){h=!0;try{sessionStorage.clear()}catch(e){}null!==a.m&&void 0!==a.m&&a.m.limpiarSesion&&a.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},p=()=>{const e=m("refreshToken"),t=(()=>{const e=m("email")||m("username");if(!e||!c.UserPoolId||!c.ClientId)return null;const t=new r.NE(c);return new r.TU({Username:e,Pool:t})})();if(!e||!t)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const s=new r.c9({RefreshToken:e});return new Promise((e,o)=>{t.refreshSession(s,(t,s)=>{if(t)return void o(t);const r=s.getAccessToken().getJwtToken(),a=s.getIdToken().getJwtToken(),l=s.getRefreshToken().getToken();x("accessToken",r),x("idToken",a),l&&x("refreshToken",l),e(r)})})};n.interceptors.request.use(e=>{const t=sessionStorage.getItem("accessToken");if(u(e.url)){var s;e.headers=null!==(s=e.headers)&&void 0!==s?s:{},t&&(e.headers.Authorization="Bearer ".concat(t));const o=sessionStorage.getItem("sub");o&&(e.headers["X-Usuario-Sub"]=o)}return e}),n.interceptors.response.use(e=>e,async e=>{const{config:t,response:s}=e;if(!t||!s||401!==s.status||!u(t.url))return Promise.reject(e);if(t.__isRetryRequest)return g(),Promise.reject(e);try{var o;const e=await(d||(d=p().then(e=>(d=null,e)).catch(e=>{throw d=null,e})),d);if(!e)throw new Error("No se obtuvo un token renovado.");return t.__isRetryRequest=!0,t.headers=null!==(o=t.headers)&&void 0!==o?o:{},t.headers.Authorization="Bearer ".concat(e),n(t)}catch(r){return g(),Promise.reject(r)}});const v=n},47436:(e,t,s)=>{s.d(t,{F:()=>l,c:()=>n});var o=s(79722);const r=s(13658).A.REGISTRO;function a(){const e={},t=sessionStorage.getItem("sub"),s=sessionStorage.getItem("accessToken");return t&&(e["X-Usuario-Sub"]=t),s&&(e.Authorization="Bearer ".concat(s)),e}async function l(e){let{fechaDesde:t,fechaHasta:s,tipos:l}=e;const n=new URLSearchParams;n.set("page",0),n.set("size",500),t&&n.set("fechaDesde",t),s&&n.set("fechaHasta",s),Array.isArray(l)&&l.length>0?n.set("tipos",l.join(",")):"string"===typeof l&&l&&n.set("tipos",l);const i="".concat(r,"/movimientos?").concat(n.toString()),{data:c}=await o.A.get(i,{headers:a()});return c}async function n(e){let{fechaDesde:t,fechaHasta:s}=e;const l=new URLSearchParams;t&&l.set("fechaDesde",t),s&&l.set("fechaHasta",s);const n="".concat(r,"/movimientos/presupuesto/datos-completos?").concat(l.toString()),{data:i}=await o.A.get(n,{headers:a()});return i}}}]);
//# sourceMappingURL=6562.fb2e7a0a.chunk.js.map