{"version":3,"file":"static/js/3185.d5111024.chunk.js","mappings":"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","sources":["../node_modules/@mui/icons-material/esm/Mic.js","registro/carga-general/components/CargaAudio.js"],"sourcesContent":["\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z\"\n}), 'Mic');","import React, { useState } from \"react\";\r\nimport { Box, Paper, IconButton, Alert, CircularProgress, Typography } from \"@mui/material\";\r\nimport { Mic, Close, Delete } from \"@mui/icons-material\";\r\nimport CustomButton from \"../../../shared-components/CustomButton\";\r\nimport axios from \"axios\";\r\nimport { styled, keyframes } from \"@mui/material/styles\";\r\n\r\nconst pulse = keyframes`\r\n  0% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0.6); }\r\n  50% { box-shadow: 0 0 0 20px rgba(76, 175, 239, 0); }\r\n  100% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0); }\r\n`;\r\n\r\nconst BigRecordButton = styled(IconButton)(({ theme, recording }) => ({\r\n  width: 100,\r\n  height: 100,\r\n  borderRadius: \"50%\",\r\n  color: \"#fff\",\r\n  backgroundColor: recording ? theme.palette.error.main : theme.palette.primary.main,\r\n  ...(recording && { animation: `${pulse} 1.5s infinite` }),\r\n}));\r\n\r\nconst tipoMovimientoMap = {\n  Movimiento: \"Movimiento\",\n  Ingreso: \"Ingreso\",\n  Egreso: \"Egreso\",\n  Deuda: \"Deuda\",\n  Acreencia: \"Acreencia\",\n  Factura: \"Factura\",\n};\n\nexport default function CargaAudio({ tipoDoc, endpoint, onResultado, onFallback }) {\n  const [grabando, setGrabando] = useState(false);\r\n  const [mediaRecorder, setMediaRecorder] = useState(null);\r\n  const [audioUrl, setAudioUrl] = useState(null);\r\n  const [audioFile, setAudioFile] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [cargando, setCargando] = useState(false);\r\n  const [parseWarning, setParseWarning] = useState(null);\r\n\r\n  const startRecording = async () => {\r\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n    const recorder = new MediaRecorder(stream);\r\n    let chunks = [];\r\n\r\n    recorder.ondataavailable = (e) => chunks.push(e.data);\r\n    recorder.onstop = () => {\r\n      const blob = new Blob(chunks, { type: \"audio/webm\" });\r\n      setAudioUrl(URL.createObjectURL(blob));\r\n      setAudioFile(new File([blob], \"grabacion.webm\", { type: \"audio/webm\" }));\r\n      stream.getTracks().forEach((t) => t.stop());\r\n    };\r\n\r\n    setParseWarning(null);\r\n    setError(null);\r\n    setMediaRecorder(recorder);\r\n    recorder.start();\r\n    setGrabando(true);\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorder) {\r\n      mediaRecorder.stop();\r\n    }\r\n    setGrabando(false);\r\n  };\r\n\r\n  const eliminarGrabacion = () => {\r\n    setAudioUrl(null);\r\n    setAudioFile(null);\r\n    setError(null);\r\n    setParseWarning(null);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!audioFile) return;\r\n    const usuarioSub = sessionStorage.getItem(\"sub\");\r\n    if (!usuarioSub) {\r\n      setError(\"No se encontró la sesión del usuario. Volvé a iniciar sesión.\");\r\n      return;\r\n    }\r\n\r\n    setCargando(true);\r\n    setError(null);\r\n    setParseWarning(null);\r\n    const archivo = audioFile;\r\n    const fd = new FormData();\r\n    fd.append(\"file\", archivo);\r\n    const tipoMovimiento = tipoMovimientoMap[tipoDoc];\r\n    if (tipoMovimiento && endpoint.includes(\"/movimientos/\")) {\r\n      fd.append(\"tipoMovimiento\", tipoMovimiento);\r\n    }\r\n    if (tipoDoc) {\r\n      fd.append(\"tipoDoc\", tipoDoc);\r\n    }\r\n    setAudioUrl(null);\r\n    setAudioFile(null);\r\n\r\n    try {\r\n      const response = await axios.post(endpoint, fd, {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n          \"X-Usuario-Sub\": usuarioSub,\r\n        },\r\n      });\r\n      console.log(\"Respuesta completa del audio:\", response.data);\r\n      const { campos, transcript, warnings } = response.data || {};\r\n      if (warnings?.length) {\r\n        console.warn(\"Advertencias al procesar audio:\", warnings);\r\n      }\r\n\r\n      const camposDetectados = campos && Object.entries(campos).some(([key, value]) => {\r\n        if (!key) return false;\r\n        if (key.toLowerCase() === \"moneda\") {\r\n          return false;\r\n        }\r\n        return !!value;\r\n      });\r\n\r\n      if (!camposDetectados) {\n        const warningPayload = {\n          message: \"No se pudo interpretar el audio. Por favor grabalo nuevamente procurando mayor claridad.\",\n          transcript: transcript || \"Sin transcripción disponible.\",\n        };\n        setParseWarning(warningPayload);\n        console.warn(\"Procesamiento de audio sin campos detectados.\", { transcript, warnings });\n        if (onFallback) {\n          onFallback({\n            origen: \"audio\",\n            mensaje: \"No pudimos interpretar el audio. Completa los datos manualmente.\",\n            detalle: warningPayload,\n          });\n        }\n        return;\n      }\n\r\n      if (onResultado) {\r\n        onResultado(response.data);\r\n      }\r\n    } catch (err) {\n      console.error(\"❌ Error en envío:\", err);\n      const mensaje = err.response?.data?.message || err.message || \"Error desconocido al procesar el audio.\";\n      setError(mensaje);\n      if (onFallback) {\n        onFallback({\n          origen: \"audio\",\n          mensaje,\n          detalle: err,\n        });\n      }\n    } finally {\n      setCargando(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ mt: 3, textAlign: \"center\" }}>\r\n      {!cargando && (\r\n        <BigRecordButton\r\n          sx={{ mt: 5 }}\r\n          recording={grabando ? 1 : 0}\r\n          onClick={grabando ? stopRecording : startRecording}\r\n        >\r\n          {grabando ? <Close /> : <Mic />}\r\n        </BigRecordButton>\r\n      )}\r\n\r\n      {!cargando && audioUrl && (\r\n        <>\r\n          <Paper\r\n            sx={{\r\n              mt: 1,\r\n              p: 1.5,\r\n              display: \"flex\",\r\n              justifyContent: \"space-between\",\r\n              alignItems: \"center\",\r\n              border: \"1px solid\",\r\n              borderColor: \"grey.400\",\r\n              borderRadius: 1,\r\n            }}\r\n          >\r\n            <audio controls src={audioUrl} />\r\n            <IconButton onClick={eliminarGrabacion} color=\"error\">\r\n              <Delete />\r\n            </IconButton>\r\n          </Paper>\r\n          <CustomButton\r\n            label=\"Enviar audio\"\r\n            width=\"100%\"\r\n            sx={{ mt: 2 }}\r\n            onClick={handleSubmit}\r\n          />\r\n        </>\r\n      )}\r\n\r\n      {cargando && (\r\n        <Box sx={{ mt: 4, display: \"flex\", justifyContent: \"center\" }}>\r\n          <CircularProgress size={40} />\r\n        </Box>\r\n      )}\r\n\r\n      <Box sx={{ mt: 3, textAlign: \"left\" }}>\r\n        {error && (\r\n          <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => setError(null)}>\r\n            {error}\r\n          </Alert>\r\n        )}\r\n\r\n        {parseWarning && (\r\n          <Alert severity=\"warning\" sx={{ mb: 2 }} onClose={() => setParseWarning(null)}>\r\n            <Typography sx={{ fontWeight: 600, mb: 1 }}>\r\n              {parseWarning.message}\r\n            </Typography>\r\n            <Typography variant=\"body2\">\r\n              Transcripción detectada: {parseWarning.transcript}\r\n            </Typography>\r\n          </Alert>\r\n        )}\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n"],"names":["createSvgIcon","_jsx","d","pulse","keyframes","_templateObject","_taggedTemplateLiteral","BigRecordButton","styled","IconButton","_ref","theme","recording","_objectSpread","width","height","borderRadius","color","backgroundColor","palette","error","main","primary","animation","concat","tipoMovimientoMap","Movimiento","Ingreso","Egreso","Deuda","Acreencia","Factura","CargaAudio","_ref2","tipoDoc","endpoint","onResultado","onFallback","grabando","setGrabando","useState","mediaRecorder","setMediaRecorder","audioUrl","setAudioUrl","audioFile","setAudioFile","setError","cargando","setCargando","parseWarning","setParseWarning","_jsxs","Box","sx","mt","textAlign","children","onClick","stopRecording","stop","async","stream","navigator","mediaDevices","getUserMedia","audio","recorder","MediaRecorder","chunks","ondataavailable","e","push","data","onstop","blob","Blob","type","URL","createObjectURL","File","getTracks","forEach","t","start","Close","Mic","_Fragment","Paper","p","display","justifyContent","alignItems","border","borderColor","controls","src","eliminarGrabacion","Delete","CustomButton","label","usuarioSub","sessionStorage","getItem","archivo","fd","FormData","append","tipoMovimiento","includes","response","axios","post","headers","console","log","campos","transcript","warnings","length","warn","Object","entries","some","_ref3","key","value","toLowerCase","warningPayload","message","origen","mensaje","detalle","err","_err$response","_err$response$data","CircularProgress","size","Alert","severity","mb","onClose","Typography","fontWeight","variant"],"sourceRoot":""}