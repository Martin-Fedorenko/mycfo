"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5473],{45473:(e,n,o)=>{o.r(n),o.d(n,{default:()=>K});var i=o(89379),t=o(65043),r=o(53969),s=o(55895),a=o(94799),c=o(70298),l=o(94527),d=o(26020),x=o(11840),m=o(82332),u=o(10256),h=o(3353),A=o(9446),f=o(88889),g=o(24343),j=o(3241),p=o(12097),v=o(91449),y=o(53089),b=o(80172),S=o(56465),C=o(63745),w=o(69302),z=o(93201),I=o(40042),E=o(91244),D=o(16128),k=o(76072),M=o(26529),T=o(56647),W=o(26392),R=o(91921),L=o(6013),N=o(92248),O=o(70579);function P(e){let{movimiento:n,selected:o=!1,onClick:i,onDesvincular:t}=e;const a=e=>"Ingreso"===e?"#2e7d32":"Egreso"===e?"#d32f2f":"#757575",l=e=>"MERCADOPAGO"===e?"#00b0ff":"EXCEL"===e?"#4caf50":"#9e9e9e";return(0,O.jsx)(E.A,{sx:{mb:2,cursor:"pointer",border:o?"2px solid #1976d2":"1px solid #e0e0e0",backgroundColor:o?"#e3f2fd":"#fff",transition:"all 0.2s ease","&:hover":{boxShadow:4,transform:"translateY(-2px)"}},onClick:i,children:(0,O.jsxs)(D.A,{children:[(0,O.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,O.jsxs)(r.A,{sx:{flex:1},children:[(0,O.jsxs)(c.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[(0,O.jsx)(k.A,{icon:(x=n.tipo,"Ingreso"===x?(0,O.jsx)(L.A,{fontSize:"small"}):"Egreso"===x?(0,O.jsx)(N.A,{fontSize:"small"}):(0,O.jsx)(R.A,{fontSize:"small"})),label:n.tipo||"Sin tipo",size:"small",sx:{backgroundColor:"".concat(a(n.tipo),"15"),color:a(n.tipo),fontWeight:"bold",border:"1px solid ".concat(a(n.tipo))}}),(0,O.jsx)(s.A,{variant:"h6",sx:{color:a(n.tipo),fontWeight:"bold"},children:(d=n.montoTotal,d?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(Math.abs(d)):"$0")})]}),(0,O.jsx)(s.A,{variant:"body2",color:"text.primary",sx:{mb:.5,fontWeight:500},children:n.descripcion||"Sin descripci\xf3n"}),(n.origen||n.destino)&&(0,O.jsxs)(s.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Egreso"===n.tipo&&n.destino&&"Para: ".concat(n.destino),"Ingreso"===n.tipo&&n.origen&&"De: ".concat(n.origen),"Egreso"!==n.tipo&&"Ingreso"!==n.tipo&&(n.origen||n.destino)]}),(0,O.jsxs)(c.A,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:.5},children:[(0,O.jsx)(k.A,{label:(e=>{if(!e)return"-";try{if(Array.isArray(e)&&e.length>=3){const[n,o,i]=e,t=String(i).padStart(2,"0"),r=String(o).padStart(2,"0");return"".concat(t,"/").concat(r,"/").concat(n)}if("string"===typeof e){const n=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n){const[,e,o,i]=n;return"".concat(i,"/").concat(o,"/").concat(e)}}const n=new Date(e);return Number.isNaN(n.getTime())?"-":n.toLocaleDateString("es-AR")}catch(n){return"-"}})(n.fechaEmision),size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}}),n.categoria&&(0,O.jsx)(k.A,{label:n.categoria,size:"small",variant:"outlined",color:"primary",sx:{fontSize:"0.75rem"}}),n.fuenteOrigen&&(0,O.jsx)(k.A,{label:n.fuenteOrigen,size:"small",sx:{fontSize:"0.75rem",backgroundColor:"".concat(l(n.fuenteOrigen),"15"),color:l(n.fuenteOrigen),fontWeight:500}})]})]}),(0,O.jsx)(r.A,{sx:{ml:2,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:n.conciliado?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(M.A,{title:"Conciliado con ".concat(n.tipoDocumentoConciliado," ").concat(n.numeroDocumentoConciliado),children:(0,O.jsx)(z.A,{sx:{color:"#4caf50",fontSize:32}})}),t&&(0,O.jsx)(M.A,{title:"Desvincular",children:(0,O.jsx)(T.A,{size:"small",onClick:e=>{e.stopPropagation(),t(n.id)},sx:{mt:.5},children:(0,O.jsx)(W.A,{fontSize:"small",color:"error"})})})]}):(0,O.jsx)(k.A,{label:"Sin conciliar",size:"small",color:"warning",variant:"outlined"})})]}),n.conciliado&&(0,O.jsx)(r.A,{sx:{mt:1,pt:1,borderTop:"1px solid #e0e0e0",backgroundColor:"#f5f5f5",p:1,borderRadius:1},children:(0,O.jsxs)(s.A,{variant:"caption",color:"text.secondary",children:["Conciliado con:"," ",(0,O.jsxs)("strong",{children:[n.tipoDocumentoConciliado," ",n.numeroDocumentoConciliado]})]})})]})});var d,x}var B=o(47951),F=o(39073),V=o(27601),$=o(96659);function q(e){let{documento:n,onVincular:o}=e;const i=e=>"FACTURA"===e?"#1976d2":"PAGARE"===e?"#f57c00":"RECIBO"===e?"#388e3c":"#757575",t=e=>"ALTA"===e?"#4caf50":"MEDIA"===e?"#ff9800":"#9e9e9e";return(0,O.jsx)(E.A,{sx:{mb:2,border:"ALTA"===n.nivelSugerencia?"2px solid #4caf50":"1px solid #e0e0e0",backgroundColor:"ALTA"===n.nivelSugerencia?"#f1f8e9":"#fff",transition:"all 0.2s ease","&:hover":{boxShadow:4,transform:"translateY(-2px)"}},children:(0,O.jsxs)(D.A,{children:[(0,O.jsx)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:(0,O.jsxs)(r.A,{sx:{flex:1},children:[(0,O.jsxs)(c.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[(0,O.jsx)(k.A,{icon:(0,O.jsx)(B.A,{fontSize:"small"}),label:n.tipoDocumento,size:"small",sx:{backgroundColor:"".concat(i(n.tipoDocumento),"15"),color:i(n.tipoDocumento),fontWeight:"bold",border:"1px solid ".concat(i(n.tipoDocumento))}}),"ALTA"===n.nivelSugerencia&&(0,O.jsx)(M.A,{title:"Alta coincidencia",children:(0,O.jsx)(V.A,{sx:{color:"#ffc107",fontSize:20}})})]}),(0,O.jsx)(s.A,{variant:"body1",sx:{fontWeight:600,mb:.5},children:n.numeroDocumento}),(0,O.jsxs)(c.A,{direction:"row",spacing:2,sx:{mb:1},children:[(0,O.jsx)(s.A,{variant:"body2",sx:{fontWeight:500,color:"#1976d2"},children:(a=n.montoTotal,a?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(Math.abs(a)):"$0")}),(0,O.jsx)(s.A,{variant:"body2",color:"text.secondary",children:(e=>{if(!e)return"-";try{if(Array.isArray(e)&&e.length>=3){const[n,o,i]=e,t=String(i).padStart(2,"0"),r=String(o).padStart(2,"0");return"".concat(t,"/").concat(r,"/").concat(n)}if("string"===typeof e){const n=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n){const[,e,o,i]=n;return"".concat(i,"/").concat(o,"/").concat(e)}}const n=new Date(e);return Number.isNaN(n.getTime())?"-":n.toLocaleDateString("es-AR")}catch(n){return"-"}})(n.fechaEmision)})]}),n.nombreRelacionado&&(0,O.jsx)(s.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:n.nombreRelacionado}),(0,O.jsxs)(c.A,{direction:"row",spacing:1,sx:{mb:1,flexWrap:"wrap",gap:.5},children:[n.categoria&&(0,O.jsx)(k.A,{label:n.categoria,size:"small",variant:"outlined",color:"primary",sx:{fontSize:"0.75rem"}}),n.cuit&&(0,O.jsx)(k.A,{label:"CUIT: ".concat(n.cuit),size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}})]}),(0,O.jsxs)(r.A,{sx:{mt:1,p:1,backgroundColor:"".concat(t(n.nivelSugerencia),"15"),borderRadius:1,border:"1px solid ".concat(t(n.nivelSugerencia))},children:[(0,O.jsxs)(c.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:.5},children:[(e=>{const n=Math.round(e/100*5),o=[];for(let i=0;i<5;i++)i<n?o.push((0,O.jsx)(V.A,{sx:{fontSize:16,color:"#ffc107"}},i)):o.push((0,O.jsx)($.A,{sx:{fontSize:16,color:"#e0e0e0"}},i));return(0,O.jsx)(r.A,{sx:{display:"flex"},children:o})})(n.scoreCoincidencia),(0,O.jsxs)(s.A,{variant:"caption",sx:{fontWeight:600,color:t(n.nivelSugerencia)},children:[n.scoreCoincidencia,"% coincidencia"]})]}),(0,O.jsx)(s.A,{variant:"caption",color:"text.secondary",children:n.razonSugerencia})]})]})}),(0,O.jsx)(p.A,{variant:"ALTA"===n.nivelSugerencia?"contained":"outlined",color:"primary",startIcon:(0,O.jsx)(F.A,{}),fullWidth:!0,onClick:()=>o(n.idDocumento),sx:{mt:1},children:"Vincular"})]})});var a}var G=o(79722),H=o(13658);const U="".concat(H.A.REGISTRO,"/api/conciliacion"),Y={obtenerMovimientosSinConciliar:async()=>(await G.A.get("".concat(U,"/movimientos/sin-conciliar"))).data,obtenerTodosLosMovimientos:async()=>(await G.A.get("".concat(U,"/movimientos"))).data,obtenerSugerencias:async e=>(await G.A.get("".concat(U,"/movimientos/").concat(e,"/sugerencias"))).data,vincularMovimiento:async(e,n)=>(await G.A.post("".concat(U,"/vincular"),{movimientoId:e,documentoId:n})).data,desvincularMovimiento:async e=>(await G.A.post("".concat(U,"/desvincular/").concat(e))).data,obtenerEstadisticas:async()=>(await G.A.get("".concat(U,"/estadisticas"))).data},X=5,J=5;function K(){const[e,n]=(0,t.useState)([]),[o,E]=(0,t.useState)(null),[D,k]=(0,t.useState)([]),[M,T]=(0,t.useState)(!1),[W,R]=(0,t.useState)(!1),[L,N]=(0,t.useState)(null),[B,F]=(0,t.useState)(null),[V,$]=(0,t.useState)("sin-conciliar"),[G,H]=(0,t.useState)("todos"),[U,K]=(0,t.useState)(""),[Q,Z]=(0,t.useState)(1),[_,ee]=(0,t.useState)(1);(0,t.useEffect)(()=>{Z(1)},[V,G,U]);const ne=(0,t.useCallback)(async()=>{T(!0),F(null);try{let e;e="sin-conciliar"===V?await Y.obtenerMovimientosSinConciliar():await Y.obtenerTodosLosMovimientos(),n(e)}catch(e){console.error("Error cargando movimientos:",e),F("Error al cargar los movimientos")}finally{T(!1)}},[V]),oe=(0,t.useCallback)(async()=>{try{const e=await Y.obtenerEstadisticas();N(e)}catch(e){console.error("Error cargando estad\xedsticas:",e)}},[]),ie=(0,t.useCallback)(async()=>{await Promise.all([ne(),oe()])},[ne,oe]);(0,t.useEffect)(()=>{ie()},[ie]),(0,t.useEffect)(()=>{ne()},[ne]);const te=e=>{E(e),ee(1),e.conciliado?(k([]),ee(1)):(async e=>{R(!0);try{const n=await Y.obtenerSugerencias(e);k(n.sugerencias||[]),ee(1)}catch(n){console.error("Error cargando sugerencias:",n),k([]),ee(1)}finally{R(!1)}})(e.id)},re=async n=>{if(o)try{await Y.vincularMovimiento(o.id,n),await ie();const t=e.find(e=>e.id===o.id);t&&E((0,i.A)((0,i.A)({},t),{},{conciliado:!0})),k([]),E(null)}catch(t){console.error("Error vinculando movimiento:",t),alert("Error al vincular el movimiento")}},se=async e=>{try{await Y.desvincularMovimiento(e),await ie(),(null===o||void 0===o?void 0:o.id)===e&&(E(null),k([]),ee(1))}catch(n){console.error("Error desvinculando movimiento:",n),alert("Error al desvincular el movimiento")}},ae=e.filter(e=>{if("sin-conciliar"===V&&e.conciliado)return!1;if("conciliados"===V&&!e.conciliado)return!1;if("todos"!==G&&e.tipo!==G)return!1;if(U){const n=U.toLowerCase(),o=(e.descripcion||"").toLowerCase(),i=(e.origen||"").toLowerCase(),t=(e.destino||"").toLowerCase(),r=(e.categoria||"").toLowerCase();if(!o.includes(n)&&!i.includes(n)&&!t.includes(n)&&!r.includes(n))return!1}return!0}),ce=Math.max(1,Math.ceil(ae.length/X)),le=Math.max(1,Math.ceil(D.length/J));(0,t.useEffect)(()=>{Q>ce&&Z(ce||1)},[Q,ce]),(0,t.useEffect)(()=>{_>le&&ee(le||1)},[_,le]);const de=Math.min(Q,ce),xe=Math.min(_,le),me=ae.slice((de-1)*X,de*X),ue=D.slice((xe-1)*J,xe*J);return(0,O.jsxs)(r.A,{sx:{p:3,minHeight:"100vh",display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsxs)(r.A,{sx:{mb:3},children:[(0,O.jsx)(s.A,{variant:"h4",gutterBottom:!0,sx:{fontWeight:600,color:"text.primary"},children:"Conciliaci\xf3n de Movimientos"}),(0,O.jsx)(s.A,{variant:"body2",sx:{color:"text.primary"},children:"Vincula tus movimientos bancarios con documentos comerciales"})]}),L&&(0,O.jsx)(a.A,{sx:{p:2,mb:3,backgroundColor:e=>{var n;return null!==(n=(e.vars||e).palette.background.level1)&&void 0!==n?n:(e.vars||e).palette.background.paper},border:e=>"1px solid ".concat((e.vars||e).palette.divider)},children:(0,O.jsxs)(c.A,{direction:"row",spacing:3,alignItems:"center",children:[(0,O.jsxs)(r.A,{sx:{flex:1},children:[(0,O.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"Total de movimientos"}),(0,O.jsx)(s.A,{variant:"h5",sx:{fontWeight:600},children:L.total})]}),(0,O.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,O.jsxs)(r.A,{sx:{flex:1},children:[(0,O.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"Sin conciliar"}),(0,O.jsx)(s.A,{variant:"h5",sx:{fontWeight:600,color:e=>(e.vars||e).palette.warning.main},children:L.sinConciliar})]}),(0,O.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,O.jsxs)(r.A,{sx:{flex:1},children:[(0,O.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"Conciliados"}),(0,O.jsx)(s.A,{variant:"h5",sx:{fontWeight:600,color:e=>(e.vars||e).palette.success.main},children:L.conciliados})]}),(0,O.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,O.jsxs)(r.A,{sx:{flex:1},children:[(0,O.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"Progreso"}),(0,O.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(d.A,{variant:"determinate",value:L.porcentajeConciliado,sx:{flex:1,height:8,borderRadius:4}}),(0,O.jsxs)(s.A,{variant:"body2",sx:{fontWeight:600},children:[Math.round(L.porcentajeConciliado),"%"]})]})]})]})}),(0,O.jsxs)(a.A,{sx:{p:2,mb:2},children:[(0,O.jsxs)(c.A,{direction:"row",spacing:2,alignItems:"center",sx:{flexWrap:"wrap",gap:2},children:[(0,O.jsxs)(x.A,{value:V,exclusive:!0,onChange:(e,n)=>n&&$(n),size:"small",children:[(0,O.jsxs)(m.A,{value:"sin-conciliar",children:[(0,O.jsx)(I.A,{sx:{mr:.5,fontSize:18}}),"Sin conciliar"]}),(0,O.jsxs)(m.A,{value:"conciliados",children:[(0,O.jsx)(z.A,{sx:{mr:.5,fontSize:18}}),"Conciliados"]}),(0,O.jsx)(m.A,{value:"todos",children:"Todos"})]}),(0,O.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,O.jsxs)(u.A,{size:"small",sx:{minWidth:120},children:[(0,O.jsx)(h.A,{children:"Tipo"}),(0,O.jsxs)(A.A,{value:G,onChange:e=>H(e.target.value),label:"Tipo",children:[(0,O.jsx)(f.A,{value:"todos",children:"Todos"}),(0,O.jsx)(f.A,{value:"Ingreso",children:"Ingreso"}),(0,O.jsx)(f.A,{value:"Egreso",children:"Egreso"})]})]}),(0,O.jsx)(g.A,{size:"small",placeholder:"Buscar...",value:U,onChange:e=>K(e.target.value),InputProps:{startAdornment:(0,O.jsx)(j.A,{position:"start",children:(0,O.jsx)(C.A,{})})},sx:{flex:1,minWidth:200}}),(0,O.jsx)(p.A,{variant:"outlined",startIcon:(0,O.jsx)(w.A,{}),onClick:ie,size:"small",children:"Recargar"})]}),(0,O.jsx)(r.A,{sx:{mt:1},children:(0,O.jsxs)(s.A,{variant:"caption",color:"text.secondary",children:["Mostrando ",me.length," de"," ",ae.length," movimientos filtrados (pagina"," ",de,"/",ce,")"]})})]}),B&&(0,O.jsx)(v.A,{severity:"error",sx:{mb:2},children:B}),(0,O.jsx)(r.A,{sx:{flex:1,overflow:"hidden"},children:(0,O.jsxs)(y.A,{container:!0,spacing:2,sx:{height:"100%"},children:[(0,O.jsx)(y.A,{item:!0,xs:12,md:6,sx:{height:"100%"},children:(0,O.jsxs)(a.A,{sx:{p:2,height:"100%",minHeight:{xs:160,sm:180,md:210},display:"flex",flexDirection:"column"},children:[(0,O.jsx)(s.A,{variant:"h6",gutterBottom:!0,children:"Movimientos"}),(0,O.jsx)(l.A,{sx:{mb:2}}),M?(0,O.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:(0,O.jsx)(b.A,{})}):0===ae.length?(0,O.jsx)(r.A,{sx:{textAlign:"center",py:4},children:(0,O.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"No hay movimientos que coincidan con los filtros"})}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(r.A,{sx:{flex:1,overflow:"auto",pr:1},children:me.map(e=>(0,O.jsx)(P,{movimiento:e,selected:(null===o||void 0===o?void 0:o.id)===e.id,onClick:()=>te(e),onDesvincular:se},e.id))}),ce>1&&(0,O.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,O.jsx)(S.A,{count:ce,page:de,onChange:(e,n)=>Z(n),color:"primary",size:"small"})})]})]})}),(0,O.jsx)(y.A,{item:!0,xs:12,md:6,sx:{height:"100%"},children:(0,O.jsxs)(a.A,{sx:{p:2,height:"100%",minHeight:{xs:160,sm:180,md:210},display:"flex",flexDirection:"column"},children:[(0,O.jsx)(s.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udca1 Documentos Sugeridos"}),(0,O.jsx)(l.A,{sx:{mb:2}}),o?o.conciliado?(0,O.jsxs)(r.A,{sx:{textAlign:"center",py:4},children:[(0,O.jsx)(z.A,{sx:{fontSize:64,color:"#4caf50",mb:2}}),(0,O.jsx)(s.A,{variant:"h6",gutterBottom:!0,children:"Movimiento ya conciliado"}),(0,O.jsxs)(s.A,{variant:"body2",color:"text.secondary",children:["Este movimiento ya est\xe1 vinculado con"," ",(0,O.jsxs)("strong",{children:[o.tipoDocumentoConciliado," ",o.numeroDocumentoConciliado]})]})]}):W?(0,O.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:(0,O.jsx)(b.A,{})}):0===D.length?(0,O.jsxs)(r.A,{sx:{textAlign:"center",py:4},children:[(0,O.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"No se encontraron documentos sugeridos para este movimiento"}),(0,O.jsx)(s.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Puedes buscar manualmente un documento o crear uno nuevo"})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(v.A,{severity:"info",sx:{mb:2},children:["Se encontraron ",(0,O.jsx)("strong",{children:D.length})," ","documento(s) que podr\xedan corresponder a este movimiento"]}),(0,O.jsx)(r.A,{sx:{flex:1,overflow:"auto",pr:1},children:ue.map(e=>(0,O.jsx)(q,{documento:e,onVincular:re},e.idDocumento))}),le>1&&(0,O.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,O.jsx)(S.A,{count:le,page:xe,onChange:(e,n)=>ee(n),color:"primary",size:"small"})})]}):(0,O.jsx)(r.A,{sx:{textAlign:"center",py:4},children:(0,O.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"Selecciona un movimiento de la izquierda para ver sugerencias de documentos"})})]})})]})})]})}}}]);
//# sourceMappingURL=5473.5a6f864f.chunk.js.map