"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[2588],{12807:(e,o,t)=>{t.d(o,{E:()=>a,c:()=>n});const r=new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:2}),n=function(e){let{fallback:o="$\xa00"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e||void 0===e)return o;const t=Number(e);return Number.isNaN(t)?o:r.format(t)},a=function(e){let{fractionDigits:o=0,fallback:t="0%"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e||void 0===e)return t;const r=Number(e);return Number.isNaN(r)?t:"".concat(r.toFixed(o),"%")}},32588:(e,o,t)=>{t.r(o),t.d(o,{default:()=>uo});var r=t(89379),n=t(65043),a=t(53969),i=t(70298),l=t(55895),s=t(53089),d=t(32911),c=t(91449),u=t(12097),m=t(29001),g=t(60267),v=t(86995),h=t(2321),p=t(66693),x=t(13568),A=t(47925),f=t(84138),y=t(74046),b=t(58198),j=t(91244),w=t(16128),S=t(73849),C=t(28572);function R(){var e,o,t,r,n,a,i,l,s,d,c,u,m;const v=(0,g.A)(),{mode:h,systemMode:p}=(0,C.Ut)(),x=("system"===h?p:h)||v.palette.mode||"light",A=null!==(e=null!==(o=null===(t=v.vars)||void 0===t?void 0:t.palette)&&void 0!==o?o:v.palette)&&void 0!==e?e:{};return{resolvedMode:x,paletteVars:A,primaryTextColor:"dark"===x?null!==(r=null!==(n=null===(a=A.common)||void 0===a?void 0:a.white)&&void 0!==n?n:null===(i=A.text)||void 0===i?void 0:i.primary)&&void 0!==r?r:"rgba(255, 255, 255, 0.9)":null!==(l=null!==(s=null===(d=A.common)||void 0===d?void 0:d.black)&&void 0!==s?s:null===(c=A.text)||void 0===c?void 0:c.primary)&&void 0!==l?l:"rgba(0, 0, 0, 0.88)",secondaryTextColor:null!==(u=null===(m=A.text)||void 0===m?void 0:m.secondary)&&void 0!==u?u:"dark"===x?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"}}var T=t(70579);const N=e=>{let{actions:o=[],loading:t=!1,onAction:n}=e;const{resolvedMode:i,primaryTextColor:l}=R(),s="dark"===i;return t?(0,T.jsx)(j.A,{variant:"outlined",sx:{width:"100%"},children:(0,T.jsxs)(w.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,T.jsx)(S.A,{variant:"text",width:160}),(0,T.jsx)(a.A,{sx:{display:"flex",gap:1},children:Array.from({length:4}).map((e,o)=>(0,T.jsx)(S.A,{variant:"rounded",width:120,height:40},o))})]})}):(0,T.jsx)(j.A,{variant:"outlined",sx:{width:"100%",backdropFilter:"blur(6px)",borderRadius:2,mx:"auto"},children:(0,T.jsx)(w.A,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"center"},children:(0,T.jsx)(a.A,{sx:{display:"flex",flexWrap:{xs:"nowrap",md:"wrap"},overflowX:{xs:"auto",md:"visible"},gap:1,pb:{xs:.5,md:0},justifyContent:{xs:"flex-start",md:"center"},alignItems:"center",width:"100%","&::-webkit-scrollbar":{display:"none"}},children:o.map(e=>(0,T.jsx)(u.A,{variant:"outlined",color:"primary",startIcon:e.icon,onClick:()=>null===n||void 0===n?void 0:n(e),sx:(0,r.A)({flexShrink:0,borderRadius:2,px:2,py:1,textTransform:"none",minWidth:{xs:140,md:150},fontWeight:600},s&&{color:"#42897f"}),children:e.label},e.id))})})})},E=e=>e,I=e=>{let{title:o,value:t,formatter:r=E,secondaryLabel:n,secondaryValue:i,secondaryFormatter:s=E,trend:d=[],trendColor:m="primary.main",loading:g=!1,error:v=null,onRetry:h}=e;const{primaryTextColor:p,secondaryTextColor:x}=R();return g?(0,T.jsx)(j.A,{variant:"outlined",sx:{height:"100%"},children:(0,T.jsxs)(w.A,{children:[(0,T.jsx)(S.A,{variant:"text",width:"60%",height:24}),(0,T.jsx)(S.A,{variant:"text",width:"70%",height:36}),(0,T.jsx)(S.A,{variant:"rectangular",width:"100%",height:40,sx:{mt:2}})]})}):v?(0,T.jsx)(j.A,{variant:"outlined",sx:{height:"100%"},children:(0,T.jsxs)(w.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,T.jsx)(c.A,{severity:"error",children:v}),h?(0,T.jsx)(u.A,{variant:"outlined",onClick:h,children:"Reintentar"}):null]})}):null===t||"undefined"===typeof t?(0,T.jsx)(j.A,{variant:"outlined",sx:{height:"100%"},children:(0,T.jsxs)(w.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,T.jsx)(l.A,{variant:"body2",sx:{color:x},children:"Sin datos disponibles para este indicador."}),h?(0,T.jsx)(u.A,{variant:"outlined",onClick:h,children:"Actualizar"}):null]})}):(0,T.jsx)(j.A,{variant:"outlined",sx:{height:"100%"},children:(0,T.jsxs)(w.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,px:2.5,py:2},children:[(0,T.jsx)(l.A,{variant:"subtitle2",sx:{flexShrink:0,whiteSpace:"nowrap",color:p},children:o}),(0,T.jsxs)(a.A,{sx:{textAlign:"right",flexGrow:1},children:[(0,T.jsx)(l.A,{variant:"h5",fontWeight:600,sx:{color:p},children:r(t)}),n?(0,T.jsxs)(l.A,{variant:"body2",sx:{color:x},children:[n,":"," ",(0,T.jsx)(a.A,{component:"span",fontWeight:500,children:s(i)})]}):null]})]})})};var k=t(7240),P=t(95563),D=t(26020),M=t(76072),_=t(94527),O=t(38915),F=t(12807),L=t(13658);const W=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],U=e=>{if(!e)return"";const o=String(e).split("-");if(o.length<2)return e;const t=Number(o[0]),r=Number(o[1])-1;return!Number.isFinite(t)||!Number.isFinite(r)||r<0||r>=W.length?e:"".concat(W[r]," ").concat(t)},B=(e,o)=>{const t=U(e),r=U(o);return t&&r?t===r?t:"".concat(t," - ").concat(r):t||r||""},z=e=>encodeURIComponent(String(null!==e&&void 0!==e?e:"").trim().toLowerCase().replace(/\s+/g,"-")),G=e=>{if(!e)return null;const o=String(e).split("-");if(o.length<2)return null;const t=Number(o[0]),r=Number(o[1])-1;return Number.isFinite(t)&&Number.isFinite(r)?new Date(t,r,1):null},H=(e,o)=>{if(!e)return!1;const t=G(e.desde),r=(e=>{const o=G(e);return o?new Date(o.getFullYear(),o.getMonth()+1,0,23,59,59,999):null})(e.hasta);return!(!t||!r)&&(t<=o&&o<=r)},V=e=>{if(null===e||void 0===e)return 0;if("number"===typeof e)return e;if("string"===typeof e){const o=Number(e);return Number.isNaN(o)?0:o}if("object"===typeof e&&null!==e&&"value"in e){const o=Number(e.value);return Number.isNaN(o)?0:o}return 0},K=e=>{if(!e)return[];const o=[{name:"Ingresos",planned:e.ingresoEstimado,actual:e.ingresoReal},{name:"Egresos",planned:e.egresoEstimado,actual:e.egresoReal}];return(Math.abs(e.saldoEstimado)>0||Math.abs(e.saldoReal)>0)&&o.push({name:"Resultado",planned:e.saldoEstimado,actual:e.saldoReal}),o},X=e=>{var o,t;return e?"string"===typeof e?e:null!==e&&void 0!==e&&null!==(o=e.response)&&void 0!==o&&null!==(t=o.data)&&void 0!==t&&t.error?String(e.response.data.error):null!==e&&void 0!==e&&e.message?e.message:"No pudimos cargar el presupuesto actual.":null},q=e=>{var o;let{companyId:t,period:r,data:s,loading:d=!1,error:g=null,onRetry:v}=e;const h=(0,m.Zp)(),{resolvedMode:p,primaryTextColor:x,secondaryTextColor:A}=R(),f="dark"===p,[y,b]=n.useState(!0),[C,N]=n.useState(null),[E,I]=n.useState(null),W="true"==={NODE_ENV:"production",PUBLIC_URL:"/mycfo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AWS_REGION:"sa-east-1",REACT_APP_BASE_URL:"https://managers-voip-made-imperial.trycloudflare.com",REACT_APP_COGNITO_CLIENT_ID:"3ksssqtg3r49rf6js1t1177hrd",REACT_APP_COGNITO_USER_POOL_ID:"sa-east-1_lTMNrWW7R",REACT_APP_URL_ADMINISTRACION:"https://managers-voip-made-imperial.trycloudflare.com/administracion",REACT_APP_URL_IA:"https://managers-voip-made-imperial.trycloudflare.com/ia",REACT_APP_URL_NOTIFICACION:"https://managers-voip-made-imperial.trycloudflare.com/notificacion",REACT_APP_URL_PRONOSTICO:"https://managers-voip-made-imperial.trycloudflare.com/pronostico",REACT_APP_URL_REGISTRO:"https://managers-voip-made-imperial.trycloudflare.com/registro",REACT_APP_URL_REPORTE:"https://managers-voip-made-imperial.trycloudflare.com/reporte",REACT_APP_WEBSOCKET_URL:"https://managers-voip-made-imperial.trycloudflare.com/notificacion/ws"}.REACT_APP_USE_MOCKS,U=L.A.PRONOSTICO,G=n.useMemo(()=>{var e;return null!==(e=(e=>{if(!e)return null;const o=String(e).split("-");if(o.length<2)return null;const t=Number(o[0]),r=Number(o[1])-1;return Number.isFinite(t)&&Number.isFinite(r)?new Date(t,r,15):null})(r))&&void 0!==e?e:new Date},[r]),q=n.useCallback(async()=>{if(W)return d&&!s?(b(!0),N(null),void I(null)):(I((e=>{var o,t,r,n,a,i;if(!e)return null;const l=e.slug?encodeURIComponent(String(e.slug)):z(e.name||e.nombre||"");return{id:null!==(o=e.id)&&void 0!==o?o:null,nombre:e.name||e.nombre||"Presupuesto",slug:l,desde:null!==(t=e.desde)&&void 0!==t?t:null,hasta:null!==(r=e.hasta)&&void 0!==r?r:null,rangeLabel:(null===(n=e.period)||void 0===n?void 0:n.label)||B(null!==(a=e.desde)&&void 0!==a?a:null,null!==(i=e.hasta)&&void 0!==i?i:null),categories:Array.isArray(e.categories)?e.categories:[],totals:null}})(s)),N(g?X(g):null),void b(!1));b(!0),N(null);try{const o=new URLSearchParams;o.set("status","active"),o.set("page","0"),o.set("size","100"),o.set("sort","createdAt,desc");const t=await O.A.get("".concat(U,"/api/presupuestos?").concat(o.toString())),r=(e=null===t||void 0===t?void 0:t.data,Array.isArray(e)?e:e&&Array.isArray(e.content)?e.content:[]).find(e=>H(e,G));if(!r)return void I(null);const n=await O.A.get("".concat(U,"/api/presupuestos/").concat(r.id,"/totales")),a=Array.isArray(null===n||void 0===n?void 0:n.data)?n.data:[],i=a.reduce((e,o)=>({ingresoEstimado:e.ingresoEstimado+V(o.ingresoEstimado),ingresoReal:e.ingresoReal+V(o.ingresoReal),egresoEstimado:e.egresoEstimado+V(o.egresoEstimado),egresoReal:e.egresoReal+V(o.egresoReal),saldoEstimado:e.saldoEstimado+V(o.saldoEstimado),saldoReal:e.saldoReal+V(o.saldoReal)}),{ingresoEstimado:0,ingresoReal:0,egresoEstimado:0,egresoReal:0,saldoEstimado:0,saldoReal:0});I({id:r.id,nombre:r.nombre,slug:z(r.nombre),desde:r.desde,hasta:r.hasta,rangeLabel:B(r.desde,r.hasta),categories:K(i),totals:i})}catch(o){N(X(o)),I(null)}finally{b(!1)}var e},[W,d,s,g,U,G]);n.useEffect(()=>{q()},[q]);const Y=n.useCallback(()=>{W&&"function"===typeof v?v():q()},[W,v,q]),J=n.useCallback(()=>{h("/presupuestos")},[h]),Z=n.useCallback(()=>{h("/presupuestos/nuevo")},[h]),$=n.useCallback(()=>{null!==E&&void 0!==E&&E.slug&&h("/presupuestos/".concat(E.slug))},[h,E]);if(y)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,{title:"Presupuesto actual",subheader:"Cargando datos...",titleTypographyProps:{variant:"h6",sx:{color:x}},subheaderTypographyProps:{variant:"body2",sx:{color:A}}}),(0,T.jsxs)(w.A,{children:[Array.from({length:4}).map((e,o)=>(0,T.jsxs)(i.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1.5},children:[(0,T.jsx)(S.A,{variant:"text",width:"40%"}),(0,T.jsx)(S.A,{variant:"text",width:"20%"})]},o)),(0,T.jsx)(S.A,{variant:"rectangular",height:8})]})]});if(C)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,{title:"Presupuesto actual",titleTypographyProps:{variant:"h6",sx:{color:x}}}),(0,T.jsxs)(w.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,T.jsx)(c.A,{severity:"error",children:C}),Y?(0,T.jsx)(u.A,{variant:"outlined",onClick:Y,children:"Reintentar"}):null]})]});const Q=null!==(o=null===E||void 0===E?void 0:E.categories)&&void 0!==o?o:[],ee=E?[E.nombre,E.rangeLabel].filter(Boolean).join(" - "):void 0;return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,{title:"Presupuesto actual",subheader:ee,titleTypographyProps:{variant:"h6",sx:{color:x}},subheaderTypographyProps:{variant:"body2",sx:{color:x}}}),(0,T.jsx)(w.A,{sx:{flexGrow:1},children:E?(0,T.jsxs)(i.A,{spacing:2,children:[E.totals?(0,T.jsxs)(i.A,{direction:"row",justifyContent:"space-between",children:[(0,T.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Saldo estimado:"," ",(0,F.c)(E.totals.saldoEstimado)]}),(0,T.jsxs)(l.A,{variant:"body2",color:"text.secondary",fontWeight:600,children:["Saldo real: ",(0,F.c)(E.totals.saldoReal)]})]}):null,Q.length>0?Q.map(e=>{const o=Number(e.planned)||0,t=Number(e.actual)||0,r=(e=>e<=.9?{color:"success",label:"En verde"}:e<=1.1?{color:"warning",label:"Cerca del objetivo"}:{color:"error",label:"Sobre el plan"})(0===o?0:t/o),n=0===o?0:t/o*100,s=Math.min(n,150),d=s>100?100:Math.max(0,s);return(0,T.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,T.jsxs)(i.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,T.jsx)(l.A,{variant:"subtitle2",children:e.name}),(0,T.jsx)(M.A,{color:r.color,label:"".concat((0,F.E)(n,{fractionDigits:0})," - ").concat(r.label),size:"small",variant:"outlined"})]}),(0,T.jsx)(D.A,{variant:"determinate",value:d,color:r.color,sx:{height:8,borderRadius:999,backgroundColor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:999}}}),(0,T.jsxs)(i.A,{direction:"row",justifyContent:"space-between",children:[(0,T.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Planificado: ",(0,F.c)(o)]}),(0,T.jsxs)(l.A,{variant:"body2",color:"text.secondary",fontWeight:600,children:["Ejecutado: ",(0,F.c)(t)]})]}),(0,T.jsx)(_.A,{sx:{my:.5}})]},e.name)}):(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No hay datos cargados para este presupuesto."})]}):(0,T.jsxs)(i.A,{spacing:2,children:[(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No hay presupuesto actual."}),(0,T.jsxs)(i.A,{direction:"row",spacing:1,children:[(0,T.jsx)(u.A,{variant:"contained",onClick:Z,sx:f?{color:"#42897f"}:void 0,children:"Nuevo presupuesto"}),(0,T.jsx)(u.A,{variant:"text",onClick:J,children:"Ver presupuestos"})]})]})}),E?(0,T.jsx)(P.A,{sx:{justifyContent:"flex-end",px:3,pb:2},children:(0,T.jsxs)(i.A,{direction:"row",spacing:1,children:[(0,T.jsx)(u.A,{variant:"contained",onClick:$,disabled:!(null!==E&&void 0!==E&&E.slug),children:"Ver m\xe1s"}),(0,T.jsx)(u.A,{variant:"outlined",onClick:Z,sx:f?{color:"#42897f"}:void 0,children:"Nuevo presupuesto"}),(0,T.jsx)(u.A,{variant:"text",onClick:J,children:"Ver presupuestos"})]})}):null]})};var Y=t(50108),J=t(82291),Z=t(87734),$=t(52185),Q=t(6026),ee=t(80379),oe=t(70095),te=t(66163);const re=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e||0);function ne(){const[e,o]=n.useState(!0),[t,r]=n.useState(null),[a,l]=n.useState(null),{primaryTextColor:s,secondaryTextColor:d}=R();return n.useEffect(()=>{const e=L.A.REPORTE;if(!e)return;const t=new Date,n=t.getFullYear(),a=t.getMonth()+1,i={},s=sessionStorage.getItem("sub"),d=sessionStorage.getItem("accessToken");s&&(i["X-Usuario-Sub"]=s),d&&(i.Authorization="Bearer ".concat(d)),o(!0),r(null);const c=fetch("".concat(e,"/cashflow?anio=").concat(n),{headers:i}).then(e=>e.ok?e.json():Promise.reject("HTTP ".concat(e.status))).then(e=>{const o=Array.isArray(e)?e:[];return{ingresos:o.filter(e=>"Ingreso"===e.tipo&&new Date(e.fechaEmision).getMonth()+1===a).reduce((e,o)=>e+(o.montoTotal||0),0),egresos:o.filter(e=>"Egreso"===e.tipo&&new Date(e.fechaEmision).getMonth()+1===a).reduce((e,o)=>e+(o.montoTotal||0),0)}}),u=new URLSearchParams;u.set("anio",n);const m=fetch("".concat(e,"/pyl?").concat(u.toString()),{headers:i}).then(e=>e.ok?e.json():Promise.reject("HTTP ".concat(e.status))).then(e=>{var o,t;const r=a-1;return{ingresos:(null!==(o=null===e||void 0===e?void 0:e.ingresosMensuales)&&void 0!==o?o:[])[r]||0,egresos:(null!==(t=null===e||void 0===e?void 0:e.egresosMensuales)&&void 0!==t?t:[])[r]||0}});Promise.all([c,m]).then(e=>{let[o,t]=e;const r=[{name:"Ingresos",Reales:o.ingresos,Devengado:t.ingresos},{name:"Egresos",Reales:o.egresos,Devengado:t.egresos}];l({dataset:r,cash:o,accrual:t})}).catch(e=>r(String(e))).finally(()=>o(!1))},[]),(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,{title:"Caja vs Devengado (\xfaltimo mes)",subheader:"Comparativo de ingresos y egresos para detectar gaps",titleTypographyProps:{variant:"h6",sx:{color:s}},subheaderTypographyProps:{variant:"body2",sx:{color:s}}}),(0,T.jsx)(w.A,{sx:{flexGrow:1},children:e?(0,T.jsx)(S.A,{variant:"rectangular",height:220}):t?(0,T.jsx)(c.A,{severity:"error",children:t}):a?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Y.u,{width:"100%",height:240,children:(0,T.jsxs)(J.E,{data:a.dataset,margin:{top:8,right:16,bottom:8,left:0},children:[(0,T.jsx)(Z.d,{strokeDasharray:"3 3",stroke:"#E0E0E0"}),(0,T.jsx)($.W,{dataKey:"name"}),(0,T.jsx)(Q.h,{}),(0,T.jsx)(ee.m,{formatter:e=>re(e)}),(0,T.jsx)(oe.s,{}),(0,T.jsx)(te.y,{dataKey:"Reales",fill:"#2e7d32"}),(0,T.jsx)(te.y,{dataKey:"Devengado",fill:"#0288d1"})]})}),(0,T.jsxs)(i.A,{direction:"row",spacing:2,sx:{mt:2},flexWrap:"wrap",children:[(0,T.jsx)(ae,{label:"Gap Ingresos",value:re((a.accrual.ingresos||0)-(a.cash.ingresos||0))}),(0,T.jsx)(ae,{label:"Gap Egresos",value:re((a.accrual.egresos||0)-(a.cash.egresos||0))})]})]}):null})]})}const ae=e=>{var o,t;let{label:r,value:n}=e;const{primaryTextColor:a,secondaryTextColor:i,paletteVars:s,resolvedMode:d}=R(),c=null!==(o=null===(t=s.action)||void 0===t?void 0:t.hover)&&void 0!==o?o:"dark"===d?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.05)";return(0,T.jsxs)("div",{style:{padding:"6px 12px",borderRadius:8,background:c},children:[(0,T.jsx)(l.A,{variant:"caption",sx:{color:a},children:r}),(0,T.jsx)(l.A,{variant:"body2",fontWeight:600,sx:{color:a},children:n})]})};var ie=t(87443),le=t(34375),se=t(81341),de=t(28259),ce=t(10756),ue=t(86172);const me={ingreso:{color:"#1b5e20",backgroundColor:"rgba(46, 125, 50, 0.12)"},egreso:{color:"#b71c1c",backgroundColor:"rgba(198, 40, 40, 0.12)"},deuda:{color:"#37474f",backgroundColor:"rgba(55, 71, 79, 0.12)"},acreencia:{color:"#01579b",backgroundColor:"rgba(1, 87, 155, 0.12)"},transferencia:{color:"#4a148c",backgroundColor:"rgba(74, 20, 140, 0.12)"}},ge=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ARS";const t=Number(e);if(!Number.isFinite(t))return"-";try{return new Intl.NumberFormat("es-AR",{style:"currency",currency:o||"ARS",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch(r){return"".concat(t.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2})," ").concat(o||"").trim()}},ve=e=>{if(!e)return"-";const o=new Date(e);return Number.isNaN(o.getTime())?"-":o.toLocaleDateString("es-AR",{day:"2-digit",month:"short"})},he=e=>{let{data:o,loading:t=!1,error:a=null,onRetry:s,onNavigate:d}=e;const{resolvedMode:m,primaryTextColor:g,secondaryTextColor:v}=R(),h="dark"===m,p=n.useMemo(()=>({titleTypographyProps:{variant:"h6",sx:{color:g}},subheaderTypographyProps:{variant:"body2",sx:{color:g}}}),[g]);if(t)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,(0,r.A)({title:"Movimientos",subheader:"Cargando..."},p)),(0,T.jsx)(w.A,{children:(0,T.jsx)(S.A,{variant:"rectangular",height:180})})]});if(a)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,(0,r.A)({title:"Movimientos"},p)),(0,T.jsxs)(w.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,T.jsx)(c.A,{severity:"error",children:a}),s?(0,T.jsx)(u.A,{variant:"outlined",onClick:s,children:"Reintentar"}):null]})]});const x=Array.isArray(o)?o:[];return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,(0,r.A)({title:"Movimientos",subheader:"\xdaltimos movimientos registrados"},p)),(0,T.jsx)(w.A,{sx:{flexGrow:1},children:0===x.length?(0,T.jsxs)(i.A,{spacing:2,alignItems:"flex-start",children:[(0,T.jsx)(l.A,{variant:"body2",sx:{color:v},children:"Todav\xeda no hay movimientos para mostrar. Registra un ingreso o egreso para verlos aqu\xed."}),s?(0,T.jsx)(u.A,{variant:"outlined",onClick:s,children:"Actualizar"}):null]}):(0,T.jsx)(de.A,{children:(0,T.jsxs)(ie.A,{size:"small",children:[(0,T.jsx)(ce.A,{children:(0,T.jsxs)(ue.A,{children:[(0,T.jsx)(se.A,{children:"Tipo"}),(0,T.jsx)(se.A,{align:"right",children:"Monto"}),(0,T.jsx)(se.A,{children:"Fecha"}),(0,T.jsx)(se.A,{children:"Categor\xeda"})]})}),(0,T.jsx)(le.A,{children:x.map((e,o)=>{var t,r,n;const a=null!==(t=e.id)&&void 0!==t?t:"movement-".concat(o),i=null!==(r=e.tipo)&&void 0!==r?r:"Movimiento",s=e.categoria||"Sin categor\xeda",d=(null!==(n=e.montoTotal)&&void 0!==n?n:0)<0?"error.main":"success.main",c=(e=>{var o;if(!e)return{color:"#424242",backgroundColor:"rgba(66, 66, 66, 0.1)"};const t=String(e).toLowerCase();return null!==(o=me[t])&&void 0!==o?o:{color:"#424242",backgroundColor:"rgba(66, 66, 66, 0.1)"}})(i);return(0,T.jsxs)(ue.A,{hover:!0,children:[(0,T.jsx)(se.A,{children:(0,T.jsx)(M.A,{label:i,size:"small",sx:{fontWeight:600,color:c.color,backgroundColor:c.backgroundColor,border:"1px solid ".concat(c.color)}})}),(0,T.jsx)(se.A,{align:"right",sx:{color:d,fontWeight:600},children:ge(e.montoTotal,e.moneda)}),(0,T.jsx)(se.A,{children:(0,T.jsx)(l.A,{variant:"body2",children:ve(e.fechaEmision)})}),(0,T.jsx)(se.A,{children:(0,T.jsx)(l.A,{variant:"body2",sx:{color:v},children:s})})]},a)})})]})})}),(0,T.jsx)(P.A,{sx:{px:3,pb:2,gap:1},children:(0,T.jsx)(u.A,{variant:"outlined",onClick:d,disabled:!d,sx:h?{color:"#42897f"}:void 0,children:"Ver m\xe1s"})})]})},pe=new Intl.NumberFormat("es-AR",{maximumFractionDigits:0}),xe=new Intl.NumberFormat("es-AR",{minimumFractionDigits:0,maximumFractionDigits:1}),Ae=e=>{const o=Number(e);return Number.isFinite(o)?Math.min(Math.max(o,0),100):0},fe=e=>"".concat(xe.format(Ae(e)),"%"),ye=e=>e?String(e):"--",be=e=>{var o,t,r;let{data:n,loading:s=!1,error:d=null,onRetry:m,onNavigate:g}=e;const{resolvedMode:v}=R(),h="dark"===v;if(s)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,{title:"Conciliaci\xf3n bancaria",subheader:"Sincronizando movimientos..."}),(0,T.jsx)(w.A,{children:Array.from({length:3}).map((e,o)=>(0,T.jsx)(S.A,{variant:"rectangular",height:48,sx:{mb:1.5}},o))})]});if(d)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,{title:"Conciliaci\xf3n bancaria"}),(0,T.jsxs)(w.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:2},children:[(0,T.jsx)(c.A,{severity:"error",children:d}),m?(0,T.jsx)(u.A,{variant:"outlined",onClick:m,children:"Reintentar"}):null]})]});const p=null!==n&&void 0!==n?n:null,x=Ae(null===p||void 0===p?void 0:p.porcentajeConciliados),A=Array.isArray(null===p||void 0===p?void 0:p.porTipo)?[...p.porTipo]:[];A.sort((e,o)=>{var t,r;return(Number(null!==(t=null===o||void 0===o?void 0:o.total)&&void 0!==t?t:0)||0)-(Number(null!==(r=null===e||void 0===e?void 0:e.total)&&void 0!==r?r:0)||0)});const f=p&&p.totalMovimientos?100*p.conciliados/(p.totalMovimientos||1):0,y=p&&p.totalMovimientos?100*p.pendientes/(p.totalMovimientos||1):0,b=(e,o,t)=>(0,T.jsxs)(i.A,{spacing:.5,sx:{p:1.25,borderRadius:1.5,border:"1px solid",borderColor:"divider",minWidth:0,flex:1},children:[(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e}),(0,T.jsx)(l.A,{variant:"subtitle1",fontWeight:600,children:o}),t?(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:t}):null]},e);return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,{title:"Conciliaci\xf3n bancaria",subheader:null!==p&&void 0!==p&&p.periodLabel?"Per\xedodo ".concat(p.periodLabel):"Resumen del \xfaltimo per\xedodo"}),(0,T.jsx)(w.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:2},children:p?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(i.A,{direction:{xs:"column",sm:"row"},spacing:1.5,sx:{alignItems:{xs:"stretch",sm:"flex-start"}},children:[b("Movimientos",pe.format(null!==(o=p.totalMovimientos)&&void 0!==o?o:0),"Total del per\xedodo"),b("Conciliados",pe.format(null!==(t=p.conciliados)&&void 0!==t?t:0),fe(f)),b("Pendientes",pe.format(null!==(r=p.pendientes)&&void 0!==r?r:0),fe(y))]}),(0,T.jsxs)(a.A,{children:[(0,T.jsxs)(i.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:.75},children:[(0,T.jsx)(l.A,{variant:"subtitle2",children:"Avance general"}),(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:fe(x)})]}),(0,T.jsx)(D.A,{variant:"determinate",value:x,sx:{height:10,borderRadius:999,backgroundColor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:999}}})]}),(0,T.jsxs)(i.A,{spacing:.5,children:[(0,T.jsx)(l.A,{variant:"subtitle2",children:"\xdaltimas referencias"}),(0,T.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["\xdaltima conciliaci\xf3n: ",ye(p.ultimaConciliacion)]}),(0,T.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["\xdaltimo movimiento pendiente: ",ye(p.ultimoPendiente)]})]}),(0,T.jsxs)(i.A,{spacing:1,children:[(0,T.jsx)(l.A,{variant:"subtitle2",children:"Detalle por tipo"}),A.length>0?A.map(e=>{var o,t,r,n,a;const s=Ae(null!==(o=null===e||void 0===e?void 0:e.porcentaje)&&void 0!==o?o:0);return(0,T.jsxs)(i.A,{spacing:.5,sx:{border:"1px solid",borderColor:"divider",borderRadius:1.5,p:1.25},children:[(0,T.jsxs)(i.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,T.jsx)(l.A,{variant:"body2",fontWeight:600,children:null!==(r=null===e||void 0===e?void 0:e.tipo)&&void 0!==r?r:"Sin tipo"}),(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:fe(s)})]}),(0,T.jsx)(D.A,{variant:"determinate",value:s,sx:{height:8,borderRadius:999,backgroundColor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:999}}}),(0,T.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[pe.format(null!==(n=null===e||void 0===e?void 0:e.conciliados)&&void 0!==n?n:0)," /"," ",pe.format(null!==(a=null===e||void 0===e?void 0:e.total)&&void 0!==a?a:0)," conciliados"]})]},null!==(t=null===e||void 0===e?void 0:e.tipo)&&void 0!==t?t:"tipo-desconocido")}):(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"No hay movimientos clasificados por tipo en este per\xedodo."})]})]}):(0,T.jsxs)(i.A,{spacing:2,alignItems:"flex-start",children:[(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Todav\xeda no hay movimientos que analizar en este per\xedodo. Carga o importa operaciones para comenzar a conciliarlas."}),m?(0,T.jsx)(u.A,{variant:"outlined",onClick:m,children:"Actualizar"}):null]})}),(0,T.jsx)(P.A,{sx:{px:3,pb:2},children:(0,T.jsx)(u.A,{variant:"outlined",onClick:()=>null===g||void 0===g?void 0:g(),disabled:!g,sx:h?{color:"#42897f"}:void 0,children:"Ir a conciliaci\xf3n"})})]})};var je=t(43791),we=t(89826);const Se=e=>{if(null===e||void 0===e)return"--";const o=Number(e);return Number.isFinite(o)?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}).format(o):"--"},Ce=new Intl.NumberFormat("es-AR",{maximumFractionDigits:0}),Re=e=>{var o,t,r,s,d,u,m,v,h,p;let{data:x,loading:A=!1,error:f=null,emptyMessage:y}=e;const b=(0,g.A)(),{primaryTextColor:C,secondaryTextColor:N}=R(),E=n.useRef(null),[I,P]=n.useState(0),D=n.useMemo(()=>{if(!I)return 820;return Math.max(I,540)},[I]);var M,O;if(n.useLayoutEffect(()=>{const e=E.current;if(!e)return;const o=()=>{const o=e.offsetWidth||e.getBoundingClientRect().width||0;P(o)};if(o(),"undefined"!==typeof ResizeObserver){const t=new ResizeObserver(o);return t.observe(e),()=>t.disconnect()}return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),A)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,{title:null!==(M=null===x||void 0===x?void 0:x.title)&&void 0!==M?M:"Ingresos durante el per\xedodo",subheader:"Generando serie..."}),(0,T.jsxs)(w.A,{children:[(0,T.jsx)(S.A,{variant:"text",width:"60%"}),(0,T.jsx)(S.A,{variant:"text",width:"40%"}),(0,T.jsx)(S.A,{variant:"rectangular",height:220,sx:{mt:2}})]})]});if(f)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,{title:null!==(O=null===x||void 0===x?void 0:x.title)&&void 0!==O?O:"Ingresos durante el per\xedodo"}),(0,T.jsx)(w.A,{children:(0,T.jsx)(c.A,{severity:"error",children:f})})]});const F=null!==(o=null===x||void 0===x?void 0:x.points)&&void 0!==o?o:[],L=F.map(e=>((e,o)=>{if(!e){const e=new Date(2e3,o%12,1);return new Intl.DateTimeFormat("es-AR",{month:"long"}).format(e)}const t=String(e).trim().toLowerCase(),r={ene:"enero",feb:"febrero",mar:"marzo",abr:"abril",may:"mayo",jun:"junio",jul:"julio",ago:"agosto",sep:"septiembre",oct:"octubre",nov:"noviembre",dic:"diciembre",january:"enero",february:"febrero",march:"marzo",april:"abril",june:"junio",july:"julio",august:"agosto",september:"septiembre",october:"octubre",november:"noviembre",december:"diciembre"};if(r[t])return r[t];const n=Date.parse("".concat(t," 1, 2020"));if(Number.isNaN(n)){const e=new Date(2e3,o%12,1);return new Intl.DateTimeFormat("es-AR",{month:"long"}).format(e)}return new Intl.DateTimeFormat("es-AR",{month:"long"}).format(n)})(e.month,e.monthIndex)),W=F.map(e=>e.value),U=null!==(t=null!==y&&void 0!==y?y:null===x||void 0===x?void 0:x.emptyMessage)&&void 0!==t?t:"No hay ingresos registrados en este per\xedodo.",B=W.length>0;return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",minHeight:520,display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,{title:null!==(r=null===x||void 0===x?void 0:x.title)&&void 0!==r?r:"Ingresos durante el per\xedodo",subheader:null!==(s=null===x||void 0===x?void 0:x.subheader)&&void 0!==s?s:"Serie mensual de ingresos registrados en los \xfaltimos 12 meses.",titleTypographyProps:{variant:"h6",fontWeight:600,sx:{color:C}},subheaderTypographyProps:{variant:"body2",sx:{color:C}},action:(0,T.jsxs)(i.A,{direction:"row",spacing:2,alignItems:"flex-start",sx:{pr:2.5,pt:.5,flexWrap:"wrap",rowGap:1,justifyContent:"flex-end","& .MuiTypography-overline":{letterSpacing:.6}},children:[(0,T.jsxs)(i.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,T.jsx)(l.A,{variant:"overline",sx:{color:C},children:"Maximo"}),(0,T.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:C},children:Se(null===x||void 0===x||null===(d=x.max)||void 0===d?void 0:d.value)}),(0,T.jsx)(l.A,{variant:"caption",sx:{color:C},children:null!==(u=null===x||void 0===x||null===(m=x.max)||void 0===m?void 0:m.label)&&void 0!==u?u:"--"})]}),(0,T.jsx)(_.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,T.jsxs)(i.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,T.jsx)(l.A,{variant:"overline",sx:{color:C},children:"Minimo"}),(0,T.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:C},children:Se(null===x||void 0===x||null===(v=x.min)||void 0===v?void 0:v.value)}),(0,T.jsx)(l.A,{variant:"caption",sx:{color:C},children:null!==(h=null===x||void 0===x||null===(p=x.min)||void 0===p?void 0:p.label)&&void 0!==h?h:"--"})]}),(0,T.jsx)(_.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,T.jsxs)(i.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,T.jsx)(l.A,{variant:"overline",sx:{color:C},children:"Promedio"}),(0,T.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:C},children:Se(null===x||void 0===x?void 0:x.average)}),(0,T.jsx)(l.A,{variant:"caption",sx:{color:C},children:"\xdaltimos 12 meses"})]})]}),sx:{py:2,"& .MuiCardHeader-content":{gap:.25,alignSelf:"flex-start"},"& .MuiCardHeader-action":{mt:0}}}),(0,T.jsx)(w.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",px:{xs:1,md:1.5},pt:{xs:.9,md:1.25},pb:{xs:2.1,md:2.35}},children:(0,T.jsx)(a.A,{ref:E,sx:{width:"100%",display:"block",mt:{xs:1,md:2},px:0},children:B?(0,T.jsx)(je.b,{width:D,height:360,series:[{data:W,type:"line",area:!0,curve:"natural",color:b.palette.primary.main,areaStyle:{fill:(0,we.X4)(b.palette.primary.main,.22)},showMark:!0,valueFormatter:e=>Ce.format(null!==e&&void 0!==e?e:0),lineStyle:{strokeWidth:3}}],yAxis:[{tickInterval:"auto",valueFormatter:()=>"",tickLabelStyle:{display:"none"}}],xAxis:[{id:"months",data:L,scaleType:"point",tickLabelStyle:{textTransform:"capitalize",fontSize:10.5,transform:"translateY(6px)",whiteSpace:"nowrap"},tickLabelSpacing:0}],margin:{left:50,right:90,top:8,bottom:40},grid:{vertical:!0,horizontal:!0},sx:{"& .MuiChartsAxis-bottom .MuiTypography-root":{fontSize:12,whiteSpace:"nowrap",overflow:"visible"},"& .MuiChartsAxis-left .MuiTypography-root":{fontSize:12,whiteSpace:"nowrap",overflow:"visible"},"& .MuiChartsAxis-label":{fontWeight:500},"& .MuiChartsGrid-line":{strokeDasharray:"4 4"},"& .MuiMarkElement-root":{strokeWidth:2,stroke:b.palette.background.paper,r:4},"& .MuiAreaElement-root":{opacity:.24}},slotProps:{legend:{hidden:!0},tooltip:{valueFormatter:e=>Se(e)}},showTooltip:!0}):(0,T.jsx)(a.A,{sx:{height:360,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:2,border:"1px dashed",borderColor:"divider",color:N,typography:"body2"},children:U})})})]})};var Te=t(18774);const Ne=e=>{if(null===e||void 0===e)return"--";const o=Number(e);return Number.isFinite(o)?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}).format(o):"--"},Ee=e=>{var o,t,r,s,d,u;let{data:m=[],loading:v=!1,error:h=null,emptyMessage:p="No hay datos para mostrar por categor\xeda en este per\xedodo.",title:x="Ingresos por categor\xedas",subtitle:A="Distribuci\xf3n anual por segmento"}=e;const f=(0,g.A)(),{primaryTextColor:y,secondaryTextColor:b}=R(),C=n.useRef(null),[N,E]=n.useState(0),I=n.useMemo(()=>{if(!N)return 820;return Math.max(N,540)},[N]);if(n.useLayoutEffect(()=>{const e=C.current;if(!e)return;const o=()=>{const o=e.offsetWidth||e.getBoundingClientRect().width||0;E(o)};if(o(),"undefined"!==typeof ResizeObserver){const t=new ResizeObserver(o);return t.observe(e),()=>t.disconnect()}return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),v)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,{title:x,subheader:"Armando ranking..."}),(0,T.jsx)(w.A,{children:(0,T.jsx)(i.A,{spacing:1,children:Array.from({length:6}).map((e,o)=>(0,T.jsx)(S.A,{variant:"rectangular",height:24},o))})})]});if(h)return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%"},children:[(0,T.jsx)(k.A,{title:x}),(0,T.jsx)(w.A,{children:(0,T.jsx)(c.A,{severity:"error",children:h})})]});const P=Array.isArray(m)&&m.length>0,D=P?m:[],M=D.map(e=>{var o;return null!==(o=e.category)&&void 0!==o?o:"Sin categor\xeda"}),O=D.map(e=>Number(e.value)||0);let F=null,L=null,W=null;if(P){var U,B;const e=O.reduce((e,o)=>e+o,0);W=O.length>0?e/O.length:null;const o=[...D].sort((e,o)=>(Number(o.value)||0)-(Number(e.value)||0));F=null!==(U=o[0])&&void 0!==U?U:null,L=null!==(B=o[o.length-1])&&void 0!==B?B:null}return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",minHeight:520,display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,{title:x,subheader:A,titleTypographyProps:{variant:"h6",fontWeight:600,sx:{color:y}},subheaderTypographyProps:{variant:"body2",sx:{color:y}},action:P?(0,T.jsxs)(i.A,{direction:"row",spacing:2,alignItems:"flex-start",sx:{pr:2.5,pt:.5,flexWrap:"wrap",rowGap:1,justifyContent:"flex-end","& .MuiTypography-overline":{letterSpacing:.6}},children:[(0,T.jsxs)(i.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,T.jsx)(l.A,{variant:"overline",sx:{color:y},children:"Categor\xeda superior"}),(0,T.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:y},children:Ne(null===(o=F)||void 0===o?void 0:o.value)}),(0,T.jsx)(l.A,{variant:"caption",sx:{color:y},children:null!==(t=null===(r=F)||void 0===r?void 0:r.category)&&void 0!==t?t:"--"})]}),(0,T.jsx)(_.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,T.jsxs)(i.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,T.jsx)(l.A,{variant:"overline",sx:{color:y},children:"Categor\xeda menor"}),(0,T.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:y},children:Ne(null===(s=L)||void 0===s?void 0:s.value)}),(0,T.jsx)(l.A,{variant:"caption",sx:{color:y},children:null!==(d=null===(u=L)||void 0===u?void 0:u.category)&&void 0!==d?d:"--"})]}),(0,T.jsx)(_.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,T.jsxs)(i.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,T.jsx)(l.A,{variant:"overline",sx:{color:y},children:"Promedio"}),(0,T.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:y},children:Ne(W)}),(0,T.jsxs)(l.A,{variant:"caption",sx:{color:y},children:[O.length," categor\xedas"]})]})]}):null,sx:{py:2,"& .MuiCardHeader-content":{gap:.25,alignSelf:"flex-start"},"& .MuiCardHeader-action":{mt:0}}}),(0,T.jsx)(w.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",px:{xs:1,md:1.5},pt:{xs:.9,md:1.25},pb:{xs:2.1,md:2.35}},children:P?(0,T.jsx)(a.A,{ref:C,sx:{width:"100%",display:"block",mt:{xs:1,md:2},px:0},children:(0,T.jsx)(Te.E,{width:I,height:360,xAxis:[{id:"categories",data:M,scaleType:"band",valueFormatter:e=>e,tickLabelStyle:{textTransform:"capitalize",fontSize:12,whiteSpace:"nowrap"}}],yAxis:[{tickInterval:"auto",min:0,valueFormatter:()=>"",tickLabelStyle:{display:"none"}}],series:[{data:O,color:f.palette.primary.main,valueFormatter:e=>Ne(e)}],margin:{left:60,right:100,top:12,bottom:56},grid:{vertical:!0,horizontal:!0},slotProps:{legend:{hidden:!0},tooltip:{valueFormatter:e=>Ne(e)}},sx:{"& .MuiChartsAxis-bottom .MuiTypography-root":{fontSize:12,whiteSpace:"nowrap",overflow:"visible"},"& .MuiChartsAxis-left .MuiTypography-root":{fontSize:12,whiteSpace:"nowrap",overflow:"visible"},"& .MuiBarElement-root":{fill:(0,we.X4)(f.palette.primary.main,.85)}}})}):(0,T.jsx)(a.A,{sx:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",px:{xs:2.5,md:3}},children:(0,T.jsx)(l.A,{variant:"body2",textAlign:"center",sx:{color:b},children:p})})})]})};var Ie=t(85030),ke=t(45847);const Pe=()=>{const[e,o]=n.useState(!1),[t,r]=n.useState(null),[a,s]=n.useState(null),[d,m]=n.useState(!1),g=a&&"string"===typeof a.diagnostico_corto?a.diagnostico_corto.split(/\n+/).map(e=>e.trim()).filter(Boolean):[],v=a&&a.senales?Object.entries(a.senales).filter(e=>{let[,o]=e;return Boolean(o)}):[],h=a&&a.detalles?Object.values(a.detalles).filter(e=>"string"===typeof e&&e.trim().length>0):[],p=Array.isArray(null===a||void 0===a?void 0:a.riesgos_clave)&&a.riesgos_clave.length>0?a.riesgos_clave.filter(Boolean):[],x=Array.isArray(null===a||void 0===a?void 0:a.tips)&&a.tips.length>0?a.tips.filter(Boolean):[];return(0,T.jsxs)(j.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsx)(k.A,{title:"An\xe1lisis IA",subheader:"Diagn\xf3stico autom\xe1tico de tu situaci\xf3n"}),(0,T.jsx)(w.A,{sx:{flexGrow:1},children:e?(0,T.jsx)(S.A,{variant:"rectangular",height:180}):t?(0,T.jsx)(c.A,{severity:"error",children:t}):a?(0,T.jsxs)(i.A,{spacing:1,children:[a.alerta?(0,T.jsx)(c.A,{severity:"warning",variant:"outlined",children:"Indicadores financieros en observacion."}):null,g.length>0?g.map((e,o)=>(0,T.jsx)(l.A,{variant:"body2",children:e},o)):(0,T.jsx)(l.A,{variant:"body2",children:"No hay resumen disponible."}),h.length>0?(0,T.jsxs)(i.A,{spacing:.25,children:[(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Detalle del mes"}),h.map((e,o)=>(0,T.jsxs)(l.A,{variant:"body2",children:["- ",e]},"det-".concat(o)))]}):null,v.length>0?(0,T.jsxs)(i.A,{spacing:.25,children:[(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Se\xf1ales"}),v.map(e=>{let[o,t]=e;return(0,T.jsxs)(l.A,{variant:"body2",children:[(0,T.jsxs)("b",{children:[o.charAt(0).toUpperCase()+o.slice(1),":"]})," ",t]},o)})]}):null,p.length>0?(0,T.jsxs)(i.A,{spacing:.25,children:[(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Riesgos clave"}),p.map((e,o)=>(0,T.jsxs)(l.A,{variant:"body2",children:["- ",e]},"risk-".concat(o)))]}):null,x.length>0?(0,T.jsxs)(i.A,{spacing:.25,children:[(0,T.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Recomendaciones"}),x.slice(0,4).map((e,o)=>(0,T.jsxs)(l.A,{variant:"body2",children:["- ",e]},"tip-".concat(o)))]}):null]}):(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:'Activa "Usar DeepSeek" para el an\xe1lisis del modelo o usa el resumen b\xe1sico.'})}),(0,T.jsxs)(P.A,{sx:{px:2,pb:2,justifyContent:"space-between",alignItems:"center"},children:[(0,T.jsx)(ke.A,{control:(0,T.jsx)(Ie.A,{checked:d,onChange:e=>m(e.target.checked),disabled:e}),label:"Usar DeepSeek"}),(0,T.jsx)(u.A,{variant:"contained",onClick:async()=>{o(!0),r(null),s(null);try{const e=L.A.IA,o=new Date,t=new URLSearchParams;t.set("anio",o.getFullYear()),t.set("mes",o.getMonth()+1);const r={"Content-Type":"application/json"},n=sessionStorage.getItem("sub"),a=sessionStorage.getItem("accessToken");n&&(r["X-Usuario-Sub"]=n),a&&(r.Authorization="Bearer ".concat(a)),t.set("modo",d?"llm":"basic");const i=await fetch("".concat(e,"/ia/insights?").concat(t.toString()),{method:"POST",headers:r});if(!i.ok)throw new Error("HTTP ".concat(i.status));const l=await i.json();s(l)}catch(e){r(String(e))}finally{o(!1)}},disabled:e,children:"Interpretar situaci\xf3n"})]})]})},De=6,Me=e=>{const o=Number(e);return Number.isFinite(o)?o:0},_e=(e,o)=>{var t,r,n,a,i,l,s,d,c,u,m,g,v,h,p,x,A;return{id:null!==(t=null!==(r=e.id)&&void 0!==r?r:e.uuid)&&void 0!==t?t:"movement-".concat(o),tipo:null!==(n=null!==(a=null!==(i=e.tipo)&&void 0!==i?i:e.tipoMovimiento)&&void 0!==a?a:e.tipoOperacion)&&void 0!==n?n:"Movimiento",montoTotal:Me(null!==(l=null!==(s=null!==(d=e.montoTotal)&&void 0!==d?d:e.monto)&&void 0!==s?s:e.importe)&&void 0!==l?l:0),moneda:null!==(c=null!==(u=e.moneda)&&void 0!==u?u:e.monedaCodigo)&&void 0!==c?c:"ARS",fechaEmision:null!==(m=null!==(g=null!==(v=e.fechaEmision)&&void 0!==v?v:e.fecha)&&void 0!==g?g:e.fechaRegistro)&&void 0!==m?m:null,categoria:null!==(h=null!==(p=null!==(x=null!==(A=e.categoria)&&void 0!==A?A:e.categoriaNombre)&&void 0!==x?x:e.categoriaDescripcion)&&void 0!==p?p:e.area)&&void 0!==h?h:null}},Oe=async function(){let{limit:e=De}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=(()=>{if("undefined"===typeof window)return null;try{return window.sessionStorage.getItem("sub")}catch(e){return console.error("No se pudo acceder a sessionStorage:",e),null}})();if(!o)throw new Error("No encontramos el usuario en la sesi\xf3n.");const t=Math.max(Number(e)||De,1),r=new URLSearchParams({page:"0",size:String(t),sortBy:"fechaEmision",sortDir:"desc"}),n=await fetch("".concat(L.A.REGISTRO,"/movimientos?").concat(r.toString()),{headers:{"X-Usuario-Sub":o},credentials:"include"});let a=null;try{a=await n.json()}catch(l){}if(!n.ok){const e=a&&(a.mensaje||a.error||a.message)||"No pudimos obtener los movimientos (c\xf3digo ".concat(n.status,")."),o=new Error(e);throw o.status=n.status,o}const i=(e=>e?Array.isArray(e)?e:Array.isArray(e.content)?e.content:Array.isArray(e.registros)?e.registros:[]:[])(a);return i.slice(0,t).map(_e)},Fe=e=>{const o=Number(e);return Number.isFinite(o)?o:0},Le=e=>{if(!e||"string"!==typeof e)return"";const[o,t]=e.split("-");if(!o||!t)return e;const r=new Date(Number(o),Number(t)-1,1);return new Intl.DateTimeFormat("es-AR",{month:"long",year:"numeric"}).format(r)},We=async function(){var e,o,t,r,n,a,i,l,s,d,c,u,m,g;let{period:v}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const h=(()=>{if("undefined"===typeof window)return null;try{return window.sessionStorage.getItem("sub")}catch(e){return console.error("No se pudo acceder a sessionStorage:",e),null}})();if(!h)throw new Error("No encontramos el usuario en la sesi\xf3n.");const p=new URLSearchParams;if(v){const[e,o]=v.split("-");e&&o&&p.set("fecha","".concat(e,"-").concat(o,"-01"))}const x="".concat(L.A.REGISTRO,"/movimientos/resumen/mensual").concat(p.toString()?"?".concat(p.toString()):""),A=await fetch(x,{headers:{"X-Usuario-Sub":h},credentials:"include"});let f=null;try{f=await A.json()}catch(y){}if(!A.ok){const e=f&&(f.mensaje||f.error||f.message)||"No pudimos obtener el resumen mensual (c\xf3digo ".concat(A.status,")."),o=new Error(e);throw o.status=A.status,o}return{organizationId:null!==(e=null===(o=f)||void 0===o?void 0:o.organizacionId)&&void 0!==e?e:null,period:null!==(t=null===(r=f)||void 0===r?void 0:r.periodo)&&void 0!==t?t:null,periodLabel:Le(null===(n=f)||void 0===n?void 0:n.periodo),periodStart:null!==(a=null===(i=f)||void 0===i?void 0:i.periodoInicio)&&void 0!==a?a:null,periodEnd:null!==(l=null===(s=f)||void 0===s?void 0:s.periodoFin)&&void 0!==l?l:null,totalIncomes:Fe(null===(d=f)||void 0===d?void 0:d.ingresosTotales),totalExpenses:Fe(null===(c=f)||void 0===c?void 0:c.egresosTotales),netResult:Fe(null===(u=f)||void 0===u?void 0:u.resultadoNeto),movementsCount:Number(null!==(m=null===(g=f)||void 0===g?void 0:g.totalMovimientos)&&void 0!==m?m:0)||0}},Ue=()=>{if("undefined"===typeof window)return null;try{return window.sessionStorage.getItem("sub")}catch(e){return console.error("No se pudo acceder a sessionStorage:",e),null}},Be=async e=>{try{return await e.json()}catch(o){return null}},ze=e=>{if(!e)return null;const[o,t]=e.split("-");return o&&t?"".concat(o,"-").concat(t,"-01"):null},Ge=async function(){let{period:e,months:o=12}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const r=Ue();if(!r)throw new Error("No encontramos el usuario en la sesion.");const n=new URLSearchParams,a=ze(e);a&&n.set("fecha",a),o&&n.set("meses",String(o));const i=await fetch("".concat(L.A.REGISTRO,"/movimientos/resumen/").concat(t).concat(n.toString()?"?".concat(n.toString()):""),{headers:{"X-Usuario-Sub":r},credentials:"include"}),l=await Be(i);if(!i.ok){const e=l&&(l.mensaje||l.error||l.message)||"No pudimos obtener los montos (".concat(t,") (codigo ").concat(i.status,")."),o=new Error(e);throw o.status=i.status,o}return null!==l&&void 0!==l?l:{}},He=async function(){let{period:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;const t=Ue();if(!t)throw new Error("No encontramos el usuario en la sesion.");const r=new URLSearchParams,n=ze(e);n&&r.set("fecha",n);const a=await fetch("".concat(L.A.REGISTRO,"/movimientos/resumen/").concat(o).concat(r.toString()?"?".concat(r.toString()):""),{headers:{"X-Usuario-Sub":t},credentials:"include"}),i=await Be(a);if(!a.ok){const e=i&&(i.mensaje||i.error||i.message)||"No pudimos obtener los montos por categoria (".concat(o,") (codigo ").concat(a.status,")."),t=new Error(e);throw t.status=a.status,t}return null!==i&&void 0!==i?i:{}},Ve=function(){return Ge(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"ingresos-mensuales")},Ke=function(){return Ge(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"egresos-mensuales")},Xe=function(){return He(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"ingresos-categorias")},qe=function(){return He(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"egresos-categorias")},Ye=function(){return async function(){let{period:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=Ue();if(!o)throw new Error("No encontramos el usuario en la sesion.");const t=new URLSearchParams,r=ze(e);r&&t.set("fecha",r);const n=await fetch("".concat(L.A.REGISTRO,"/movimientos/resumen/conciliacion").concat(t.toString()?"?".concat(t.toString()):""),{headers:{"X-Usuario-Sub":o},credentials:"include"}),a=await Be(n);if(!n.ok){const e=a&&(a.mensaje||a.error||a.message)||"No pudimos obtener el resumen de conciliacion (codigo ".concat(n.status,")."),o=new Error(e);throw o.status=n.status,o}return null!==a&&void 0!==a?a:{}}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},Je={totalIncomes:82e4,totalExpenses:54e4,netResult:28e4,cashBalance:125e4,cashRunwayDays:46,pendingReceivables:42e4,receivablesDueSoon:16e4,pendingPayables:21e4,payablesOverdue:65e3},Ze={title:"Ingresos durante el periodo",average:185e3,max:{value:215e3,label:"abr 2025"},min:{value:142e3,label:"ene 2025"},points:[{month:"ene",value:142e3},{month:"feb",value:168e3},{month:"mar",value:178500},{month:"abr",value:215e3},{month:"may",value:204e3},{month:"jun",value:198e3},{month:"jul",value:191e3},{month:"ago",value:199500},{month:"sep",value:188e3},{month:"oct",value:194500},{month:"nov",value:187e3},{month:"dic",value:181500}]},$e={title:"Egresos durante el periodo",average:142e3,max:{value:168e3,label:"mar 2025"},min:{value:118e3,label:"ene 2025"},points:[{month:"ene",value:125e3},{month:"feb",value:132e3},{month:"mar",value:168e3},{month:"abr",value:154e3},{month:"may",value:149e3},{month:"jun",value:138e3},{month:"jul",value:146e3},{month:"ago",value:152e3},{month:"sep",value:139e3},{month:"oct",value:145e3},{month:"nov",value:141e3},{month:"dic",value:134e3}]},Qe=[{category:"Servicios B\xe1sicos",value:54e3},{category:"Vivienda",value:76e3},{category:"Transporte",value:42e3},{category:"Servicios Financieros",value:35500},{category:"Impuestos y Tasas",value:68e3},{category:"Alimentos y Bebidas",value:38500},{category:"Educaci\xf3n",value:29500},{category:"Salud",value:31800}],eo=[{category:"Ventas",value:385188},{category:"Servicios",value:353625},{category:"Produccion",value:272799},{category:"Logistica",value:199511},{category:"Marketing",value:194480},{category:"Tecnologia",value:193511},{category:"RRHH",value:91909},{category:"Administracion",value:77346}],oo={name:"Presupuesto anual 2025",slug:"presupuesto-anual-2025",period:{label:"Octubre 2025",routeParam:"octubre-2025"},categories:[{name:"Ventas",planned:85e4,actual:64e4},{name:"Marketing",planned:25e4,actual:21e4},{name:"Operaciones",planned:3e5,actual:32e4},{name:"RRHH",planned:18e4,actual:15e4}]},to={labels:["Hoy","+5d","+10d","+15d","+20d","+25d","+30d"],incomes:[22e4,18e4,21e4,19e4,23e4,2e5,25e4],expenses:[15e4,16e4,17e4,165e3,175e3,16e4,185e3],net:[7e4,2e4,4e4,25e3,55e3,4e4,65e3]},ro=[{id:"afip-01",date:(new Date).toISOString(),type:"AFIP",name:"IVA mensual",amount:155e3},{id:"prov-02",date:new Date(Date.now()+2592e5).toISOString(),type:"Proveedor",name:"Servicios Cloud",amount:98e3},{id:"cli-03",date:new Date(Date.now()+6048e5).toISOString(),type:"Cliente",name:"Cobranza Grupo Litoral",amount:21e4}],no=[{id:"task-1",title:"Conciliar Banco Naci\xf3n",description:"Ten\xe9s 4 movimientos pendientes de revisar.",severity:"high"},{id:"task-2",title:"Subir comprobantes de AFIP",description:"Faltan adjuntar comprobantes del \xfaltimo pago.",severity:"medium"},{id:"task-3",title:"categoriar movimientos",description:"3 ingresos sin categoria asignada.",severity:"low"}],ao=[{id:"mov-1",tipo:"Egreso",montoTotal:-125e3,moneda:"ARS",fechaEmision:(new Date).toISOString(),categoria:"Logistica"},{id:"mov-2",tipo:"Ingreso",montoTotal:185e3,moneda:"ARS",fechaEmision:new Date(Date.now()-864e5).toISOString(),categoria:"Ventas"},{id:"mov-3",tipo:"Egreso",montoTotal:-78e3,moneda:"ARS",fechaEmision:new Date(Date.now()-1728e5).toISOString(),categoria:"Marketing"},{id:"mov-4",tipo:"Transferencia",montoTotal:-45e3,moneda:"ARS",fechaEmision:new Date(Date.now()-2592e5).toISOString(),categoria:null}],io={periodo:"2025-10",periodLabel:"octubre 2025",totalMovimientos:124,conciliados:96,pendientes:28,porcentajeConciliados:77.4,ultimaConciliacion:"2025-10-28",ultimoPendiente:"2025-10-30",porTipo:[{tipo:"Ingreso",total:68,conciliados:55,pendientes:13,porcentaje:80.9},{tipo:"Egreso",total:56,conciliados:41,pendientes:15,porcentaje:73.2}]},lo={invoices:[{id:"fac-01",number:"A-0003-000125",customer:"F\xe1brica El Sol",amount:145e3,date:(new Date).toISOString()},{id:"fac-02",number:"A-0003-000124",customer:"Cooperativa Delta",amount:98e3,date:new Date(Date.now()-864e5).toISOString()},{id:"fac-03",number:"B-0001-000543",customer:"Estudio Contable Sur",amount:54e3,date:new Date(Date.now()-1728e5).toISOString()}]},so={kpis:{loading:!0,error:null,data:null},budget:{loading:!0,error:null,data:null},cashflow:{loading:!0,error:null,data:null},dueDates:{loading:!0,error:null,data:null},tasks:{loading:!0,error:null,data:null},movements:{loading:!0,error:null,data:null},reconciliation:{loading:!0,error:null,data:null},billing:{loading:!0,error:null,data:null},salesTrend:{loading:!0,error:null,data:null},salesByCategory:{loading:!0,error:null,data:null},expensesTrend:{loading:!0,error:null,data:null},expensesByCategory:{loading:!0,error:null,data:null}},co=["MyCFO Demo","Acme Corp","Globex Latam"],uo=n.memo(()=>{var e,o,t,j,w,S,C;const E=(0,m.Zp)(),k=(0,g.A)(),{resolvedMode:P,paletteVars:D,primaryTextColor:M}=R(),_=(0,v.A)(k.breakpoints.down("sm")),[O,L]=n.useState(so),W=n.useRef(),U=n.useRef(0),B=n.useRef("true"==={NODE_ENV:"production",PUBLIC_URL:"/mycfo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AWS_REGION:"sa-east-1",REACT_APP_BASE_URL:"https://managers-voip-made-imperial.trycloudflare.com",REACT_APP_COGNITO_CLIENT_ID:"3ksssqtg3r49rf6js1t1177hrd",REACT_APP_COGNITO_USER_POOL_ID:"sa-east-1_lTMNrWW7R",REACT_APP_URL_ADMINISTRACION:"https://managers-voip-made-imperial.trycloudflare.com/administracion",REACT_APP_URL_IA:"https://managers-voip-made-imperial.trycloudflare.com/ia",REACT_APP_URL_NOTIFICACION:"https://managers-voip-made-imperial.trycloudflare.com/notificacion",REACT_APP_URL_PRONOSTICO:"https://managers-voip-made-imperial.trycloudflare.com/pronostico",REACT_APP_URL_REGISTRO:"https://managers-voip-made-imperial.trycloudflare.com/registro",REACT_APP_URL_REPORTE:"https://managers-voip-made-imperial.trycloudflare.com/reporte",REACT_APP_WEBSOCKET_URL:"https://managers-voip-made-imperial.trycloudflare.com/notificacion/ws"}.REACT_APP_USE_MOCKS).current,z=n.useCallback(()=>({kpis:{loading:!1,error:null,data:Je},budget:{loading:!1,error:null,data:oo},cashflow:{loading:!1,error:null,data:to},dueDates:{loading:!1,error:null,data:ro},tasks:{loading:!1,error:null,data:no},movements:{loading:!1,error:null,data:ao},reconciliation:{loading:!1,error:null,data:io},billing:{loading:!1,error:null,data:lo},salesTrend:{loading:!1,error:null,data:Ze},salesByCategory:{loading:!1,error:null,data:eo},expensesTrend:{loading:!1,error:null,data:$e},expensesByCategory:{loading:!1,error:null,data:Qe}}),[]),[G,H]=n.useState(null),[V,K]=n.useState(co[0]),X=n.useMemo(()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return Array.from({length:e}).map((e,o)=>{const t=new Date;return t.setMonth(t.getMonth()-o),{label:new Intl.DateTimeFormat("es-AR",{month:"long",year:"numeric"}).format(t),value:"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"))}})}(6),[]),[Y,J]=n.useState(null!==(e=null===(o=X[0])||void 0===o?void 0:o.value)&&void 0!==e?e:""),Z=n.useMemo(()=>{if("undefined"===typeof window)return"Usuario";try{const e=sessionStorage.getItem("nombre");if(e&&e.trim())return e.trim();const o=sessionStorage.getItem("name");if(o&&o.trim())return o.trim();const t=sessionStorage.getItem("email");if(t&&t.includes("@"))return t.split("@")[0]}catch(e){}return"Usuario"},[]),$=n.useCallback(()=>{if(L(e=>{const o={};return Object.entries(e).forEach(e=>{let[t,n]=e;o[t]=(0,r.A)((0,r.A)({},n),{},{loading:!0,error:null})}),o}),clearTimeout(W.current),L(e=>(0,r.A)((0,r.A)({},e),{},{kpis:{loading:!1,error:null,data:Je},budget:{loading:!1,error:null,data:oo},cashflow:{loading:!1,error:null,data:to},dueDates:{loading:!1,error:null,data:ro},tasks:{loading:!1,error:null,data:no},movements:{loading:!1,error:null,data:ao},reconciliation:{loading:!1,error:null,data:io},billing:{loading:!1,error:null,data:lo}})),B)return void(W.current=setTimeout(()=>{L(z())},700));W.current=void 0;const e=U.current+1;U.current=e;const o=(e,o)=>e?"string"===typeof e?e:e.message?e.message:e.mensaje?e.mensaje:o:o,t=(e,o)=>{var t,r;let{title:n,emptyMessage:a,subheader:i}=o;const l=Array.isArray(null===e||void 0===e?void 0:e.datos)?e.datos:[],s=new Intl.DateTimeFormat("es-AR",{month:"short"}),d=new Intl.DateTimeFormat("es-AR",{month:"long",year:"numeric"}),c=String(null!==(t=null!==(r=null===e||void 0===e?void 0:e.periodoBase)&&void 0!==r?r:null===e||void 0===e?void 0:e.periodo)&&void 0!==t?t:""),[u]=c.split("-"),m=Number(u)||(new Date).getFullYear(),g=new Map;l.forEach(e=>{var o;const t=String(null!==(o=null===e||void 0===e?void 0:e.periodo)&&void 0!==o?o:""),[r,n]=t.split("-"),a=Number(r),i=Number(n);if(Number.isFinite(a)&&Number.isFinite(i)){var l;const o="".concat(a,"-").concat(String(i).padStart(2,"0"));g.set(o,Number(null!==(l=null===e||void 0===e?void 0:e.total)&&void 0!==l?l:0))}});const v=l.reduce((e,o)=>{var t;const r=String(null!==(t=null===o||void 0===o?void 0:o.periodo)&&void 0!==t?t:""),[,n]=r.split("-"),a=Number(n);var i;Number.isFinite(a)&&!e.has(a)&&e.set(a,Number(null!==(i=null===o||void 0===o?void 0:o.total)&&void 0!==i?i:0));return e},new Map),h=Array.from({length:12},(e,o)=>{const t=new Date(m,o,1),r="".concat(t.getFullYear(),"-").concat(String(o+1).padStart(2,"0"));let n=g.get(r);var a;"undefined"===typeof n&&(n=null!==(a=v.get(o+1))&&void 0!==a?a:0);return{month:s.format(t),fullLabel:d.format(t),value:n}}),p=h.map(e=>e.value),x=p.length>0?p.reduce((e,o)=>e+o,0)/p.length:0,A=p.length>0?Math.max(...p):0,f=p.length>0?Math.min(...p):0,y=h.find(e=>e.value===A),b=h.find(e=>e.value===f);return{title:n,emptyMessage:a,subheader:i,points:h.map(e=>{let{month:o,value:t}=e;return{month:o,value:t}}),average:x,max:{value:A,label:y?y.fullLabel:"--"},min:{value:f,label:b?b.fullLabel:"--"}}},n=e=>(Array.isArray(null===e||void 0===e?void 0:e.categorias)?e.categorias:[]).map(e=>{var o,t;return{category:null!==(o=null===e||void 0===e?void 0:e.categoria)&&void 0!==o?o:"Sin categoria",value:Number(null!==(t=null===e||void 0===e?void 0:e.total)&&void 0!==t?t:0)}}),a=e=>{var o,t,r,n,a,i;if(!e)return null;const l=Number(null!==(o=e.totalMovimientos)&&void 0!==o?o:0),s=Number(null!==(t=e.conciliados)&&void 0!==t?t:0),d=void 0!==e.pendientes?Number(null!==(r=e.pendientes)&&void 0!==r?r:0):Math.max(l-s,0),c=void 0!==e.porcentajeConciliados&&null!==e.porcentajeConciliados?Number(e.porcentajeConciliados):l>0?100*s/l:0,u=String(null!==(n=e.periodo)&&void 0!==n?n:"");let m=u||"Periodo actual";const[g,v]=u.split("-"),h=Number(v)-1,p=Number(g),x=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];h>=0&&h<x.length&&Number.isFinite(p)&&(m="".concat(x[h]," ").concat(p));const A=(Array.isArray(e.porTipo)?e.porTipo:[]).map(e=>{var o,t,r,n;const a=Number(null!==(o=null===e||void 0===e?void 0:e.total)&&void 0!==o?o:0),i=Number(null!==(t=null===e||void 0===e?void 0:e.conciliados)&&void 0!==t?t:0),l=void 0!==(null===e||void 0===e?void 0:e.pendientes)?Number(null!==(r=e.pendientes)&&void 0!==r?r:0):Math.max(a-i,0),s=a>0?100*i/a:0;return{tipo:null!==(n=null===e||void 0===e?void 0:e.tipo)&&void 0!==n?n:"Sin tipo",total:a,conciliados:i,pendientes:l,porcentaje:s}});return{periodo:u,periodLabel:m,totalMovimientos:l,conciliados:s,pendientes:d,porcentajeConciliados:c,ultimaConciliacion:null!==(a=e.ultimaConciliacion)&&void 0!==a?a:null,ultimoPendiente:null!==(i=e.ultimoPendiente)&&void 0!==i?i:null,porTipo:A}};(async()=>{const[r,i,l,s,d,c,u]=await Promise.allSettled([Oe({limit:6}),We({period:Y}),Ve({period:Y,months:12}),Xe({period:Y}),Ke({period:Y,months:12}),qe({period:Y}),Ye({period:Y})]),m="fulfilled"===r.status?{loading:!1,error:null,data:r.value}:{loading:!1,error:(g=r.reason,g?"string"===typeof g?g:null!==g&&void 0!==g&&g.message?g.message:"No pudimos cargar los movimientos.":"No pudimos cargar los movimientos."),data:null};var g;let v=null;if("fulfilled"===i.status){const e=i.value;v={loading:!1,error:null,data:{totalIncomes:e.totalIncomes,totalExpenses:e.totalExpenses,netResult:e.netResult,period:e.period,periodLabel:e.periodLabel,movementsCount:e.movementsCount}}}else{const e=i.reason;v={loading:!1,error:e&&(e.message||e.mensaje)||"No pudimos obtener el resumen mensual.",data:null}}(o=>{let{movements:t,kpis:r,salesTrend:n,salesByCategory:a,expensesTrend:i,expensesByCategory:l,reconciliation:s}=o;if(U.current!==e)return;const d=z();d.movements=null!==t&&void 0!==t?t:d.movements,r&&(d.kpis=r),n&&(d.salesTrend=n),a&&(d.salesByCategory=a),i&&(d.expensesTrend=i),l&&(d.expensesByCategory=l),s&&(d.reconciliation=s),L(d)})({movements:m,kpis:v,salesTrend:"fulfilled"===l.status?{loading:!1,error:null,data:t(l.value,{title:"Ingresos durante el periodo",emptyMessage:"No hay ingresos registrados en este periodo.",subheader:"Serie mensual de ingresos registrados en los ultimos 12 meses."})}:{loading:!1,error:o(l.reason,"No pudimos obtener la serie de ingresos."),data:null},salesByCategory:"fulfilled"===s.status?{loading:!1,error:null,data:n(s.value)}:{loading:!1,error:o(s.reason,"No pudimos obtener las ventas por categoria."),data:null},expensesTrend:"fulfilled"===d.status?{loading:!1,error:null,data:t(d.value,{title:"Egresos durante el periodo",emptyMessage:"No hay egresos registrados en este periodo.",subheader:"Serie mensual de egresos registrados en los ultimos 12 meses."})}:{loading:!1,error:o(d.reason,"No pudimos obtener la serie de egresos."),data:null},expensesByCategory:"fulfilled"===c.status?{loading:!1,error:null,data:n(c.value)}:{loading:!1,error:o(c.reason,"No pudimos obtener los egresos por categoria."),data:null},reconciliation:"fulfilled"===u.status?{loading:!1,error:null,data:a(u.value)}:{loading:!1,error:o(u.reason,"No pudimos obtener el resumen de conciliacion."),data:null}})})()},[z,B,Y]);n.useEffect(()=>($(),()=>{clearTimeout(W.current),U.current+=1}),[$]);const Q=n.useCallback((e,o)=>{if(e){if(o){const t=new URLSearchParams(o);E({pathname:e,search:"?".concat(t.toString())})}else E(e);"undefined"!==typeof window&&window.scrollTo({top:0,behavior:"smooth"})}},[E]),ee=n.useMemo(()=>[{id:"movement",label:"Cargar movimiento",icon:(0,T.jsx)(h.A,{}),action:()=>Q("/carga")},{id:"excel",label:"Importar Excel",icon:(0,T.jsx)(p.A,{}),action:()=>Q("/carga-movimientos")},{id:"mp",label:"Mercado Pago",icon:(0,T.jsx)(x.A,{}),action:()=>Q("/mercado-pago")},{id:"reconcile",label:"Conciliar",icon:(0,T.jsx)(A.A,{}),action:()=>Q("/conciliacion")},{id:"invoice",label:"Cargar factura",icon:(0,T.jsx)(f.A,{}),action:()=>Q("/carga/factura")},{id:"budget",label:"Nuevo presupuesto",icon:(0,T.jsx)(y.A,{}),action:()=>Q("/presupuestos/nuevo")},{id:"reminder",label:"Recordatorio",icon:(0,T.jsx)(b.A,{}),action:()=>Q("/recordatorios")}],[Q]),oe=(e,o)=>{"clickaway"!==o&&H(null)},te=n.useMemo(()=>{var e,o,t;const r=O.kpis.data;return[{id:"totalIncomes",title:"Ingresos Totales Mensuales",value:null!==(e=null===r||void 0===r?void 0:r.totalIncomes)&&void 0!==e?e:null,formatter:F.c,trend:[]},{id:"totalExpenses",title:"Egresos Totales Mensuales",value:null!==(o=null===r||void 0===r?void 0:r.totalExpenses)&&void 0!==o?o:null,formatter:F.c,trend:[]},{id:"netResult",title:"Resultado Neto Mensuales",value:null!==(t=null===r||void 0===r?void 0:r.netResult)&&void 0!==t?t:null,formatter:F.c,trend:[]}]},[O.kpis.data]),re=O.kpis.loading&&!O.kpis.data,ae=n.useMemo(()=>({position:{xs:"relative",md:"sticky"},top:{md:k.spacing(1)},zIndex:k.zIndex.appBar-1,display:"flex",justifyContent:"center"}),[k]);return(0,T.jsxs)(a.A,{sx:{width:"100%",maxWidth:1650,mx:"auto",px:{xs:2,sm:3,md:4,lg:6},pb:6},children:[(0,T.jsxs)(i.A,{spacing:3,sx:{width:"100%"},children:[(0,T.jsx)(i.A,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},sx:{width:"100%"},children:(0,T.jsxs)(a.A,{children:[(0,T.jsxs)(l.A,{variant:"h4",fontWeight:600,children:["Hola, ",Z]}),(0,T.jsx)(l.A,{variant:"body2",sx:{color:M},children:"Todo lo importante de tu cuenta, en un solo lugar."})]})}),(0,T.jsx)(a.A,{sx:ae,children:(0,T.jsx)(N,{actions:ee,loading:re,onAction:e=>{var o;null!==e&&void 0!==e&&e.action?e.action():H({severity:"info",message:"".concat(null!==(o=null===e||void 0===e?void 0:e.label)&&void 0!==o?o:"Acci\xf3n"," en desarrollo.")})}})}),(0,T.jsx)(s.A,{container:!0,spacing:2,justifyContent:"center",sx:{maxWidth:{xs:"100%",md:1600},mx:"auto"},children:te.map(e=>(0,T.jsx)(s.A,{item:!0,xs:12,sm:4,children:(0,T.jsx)(I,{title:e.title,value:e.value,formatter:e.formatter,secondaryLabel:e.secondaryLabel,secondaryValue:e.secondaryValue,secondaryFormatter:e.secondaryFormatter,trend:e.trend,trendColor:e.trendColor,loading:O.kpis.loading&&!O.kpis.data,error:O.kpis.error,onRetry:$})},e.id))}),(0,T.jsxs)(s.A,{container:!0,spacing:3,justifyContent:"center",sx:{width:"100%",maxWidth:1600,mx:"auto"},children:[(0,T.jsx)(s.A,{item:!0,children:(0,T.jsx)(a.A,{sx:{width:{xs:"100%",md:720}},children:(0,T.jsx)(Re,{data:null!==(t=O.salesTrend.data)&&void 0!==t?t:{title:"Ingresos durante el periodo",points:[],average:0,max:{value:0,label:"--"},min:{value:0,label:"--"}},loading:O.salesTrend.loading&&!O.salesTrend.data,error:O.salesTrend.error,onNavigate:()=>Q("/reportes/ventas")})})}),(0,T.jsx)(s.A,{item:!0,children:(0,T.jsx)(a.A,{sx:{width:{xs:"100%",md:720}},children:(0,T.jsx)(Ee,{data:null!==(j=O.salesByCategory.data)&&void 0!==j?j:[],loading:O.salesByCategory.loading&&!O.salesByCategory.data,error:O.salesByCategory.error})})})]}),(0,T.jsxs)(s.A,{container:!0,spacing:3,justifyContent:"center",sx:{width:"100%",maxWidth:1600,mx:"auto"},children:[(0,T.jsx)(s.A,{item:!0,children:(0,T.jsx)(a.A,{sx:{width:{xs:"100%",md:720}},children:(0,T.jsx)(Re,{data:null!==(w=O.expensesTrend.data)&&void 0!==w?w:{title:"Egresos durante el periodo",points:[],average:0,max:{value:0,label:"--"},min:{value:0,label:"--"}},loading:O.expensesTrend.loading&&!O.expensesTrend.data,error:O.expensesTrend.error,emptyMessage:"No hay egresos registrados en este periodo."})})}),(0,T.jsx)(s.A,{item:!0,children:(0,T.jsx)(a.A,{sx:{width:{xs:"100%",md:720}},children:(0,T.jsx)(Ee,{data:null!==(S=O.expensesByCategory.data)&&void 0!==S?S:[],loading:O.expensesByCategory.loading&&!O.expensesByCategory.data,error:O.expensesByCategory.error,emptyMessage:"No hay egresos por categoria en este periodo.",title:"Egresos por categorias",subtitle:"Distribucion anual por segmento"})})})]}),(0,T.jsxs)(s.A,{container:!0,spacing:2,children:[(0,T.jsx)(s.A,{item:!0,xs:12,lg:4,children:(0,T.jsx)(q,{companyId:V,period:Y,data:O.budget.data,loading:O.budget.loading&&!O.budget.data,error:O.budget.error,onRetry:$})}),(0,T.jsx)(s.A,{item:!0,xs:12,lg:4,children:(0,T.jsx)(ne,{})}),(0,T.jsx)(s.A,{item:!0,xs:12,lg:4,children:(0,T.jsx)(he,{data:O.movements.data,loading:O.movements.loading&&!O.movements.data,error:O.movements.error,onRetry:$,onNavigate:()=>Q("/ver-movimientos")})})]}),(0,T.jsxs)(s.A,{container:!0,spacing:2,children:[(0,T.jsx)(s.A,{item:!0,xs:12,md:6,xl:4,children:(0,T.jsx)(be,{data:O.reconciliation.data,loading:O.reconciliation.loading&&!O.reconciliation.data,error:O.reconciliation.error,onRetry:$,onNavigate:e=>Q("/conciliacion",e?{cuenta:e}:void 0)})}),(0,T.jsx)(s.A,{item:!0,xs:12,md:6,xl:4,children:(0,T.jsx)(Pe,{})})]}),(0,T.jsx)(a.A,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,T.jsx)(u.A,{variant:"text",size:"small",onClick:$,children:"Recargar datos de Dashboard"})})]}),(0,T.jsx)(d.A,{open:Boolean(G),autoHideDuration:4e3,onClose:oe,anchorOrigin:{vertical:_?"top":"bottom",horizontal:"center"},children:G?(0,T.jsx)(c.A,{onClose:oe,severity:null!==(C=G.severity)&&void 0!==C?C:"info",variant:"filled",sx:{width:"100%"},children:G.message}):null})]})})},38915:(e,o,t)=>{t.d(o,{A:()=>x});var r=t(79722),n=t(35644),a=t(29296),i=t(13658);const l=r.A.create(),s=i.A.PRONOSTICO,d={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let c=null,u=!1;const m=e=>Boolean(e&&s&&String(e).startsWith(String(s))),g=e=>{try{return sessionStorage.getItem(e)}catch(o){return console.warn("No se pudo leer sessionStorage:",o),null}},v=(e,o)=>{try{void 0!==o&&null!==o&&sessionStorage.setItem(e,o)}catch(t){console.warn("No se pudo escribir en sessionStorage:",t)}},h=()=>{if(!u){u=!0;try{sessionStorage.clear()}catch(e){}null!==a.m&&void 0!==a.m&&a.m.limpiarSesion&&a.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},p=()=>{const e=g("refreshToken"),o=(()=>{const e=g("email")||g("username");if(!e||!d.UserPoolId||!d.ClientId)return null;const o=new n.NE(d);return new n.TU({Username:e,Pool:o})})();if(!e||!o)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const t=new n.c9({RefreshToken:e});return new Promise((e,r)=>{o.refreshSession(t,(o,t)=>{if(o)return void r(o);const n=t.getAccessToken().getJwtToken(),a=t.getIdToken().getJwtToken(),i=t.getRefreshToken().getToken();v("accessToken",n),v("idToken",a),i&&v("refreshToken",i),e(n)})})};l.interceptors.request.use(e=>{const o=sessionStorage.getItem("accessToken");if(m(e.url)){var t;e.headers=null!==(t=e.headers)&&void 0!==t?t:{},o&&(e.headers.Authorization="Bearer ".concat(o));const r=sessionStorage.getItem("sub");r&&(e.headers["X-Usuario-Sub"]=r)}return e}),l.interceptors.response.use(e=>e,async e=>{const{config:o,response:t}=e;if(!o||!t||401!==t.status||!m(o.url))return Promise.reject(e);if(o.__isRetryRequest)return h(),Promise.reject(e);try{var r;const e=await(c||(c=p().then(e=>(c=null,e)).catch(e=>{throw c=null,e})),c);if(!e)throw new Error("No se obtuvo un token renovado.");return o.__isRetryRequest=!0,o.headers=null!==(r=o.headers)&&void 0!==r?r:{},o.headers.Authorization="Bearer ".concat(e),l(o)}catch(n){return h(),Promise.reject(n)}});const x=l}}]);
//# sourceMappingURL=2588.df3bef87.chunk.js.map