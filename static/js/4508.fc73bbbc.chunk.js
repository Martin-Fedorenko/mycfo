"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4508],{3665:(e,r,n)=>{n.d(r,{A:()=>a});var s=n(14057),o=n(70579);const a=(0,s.A)((0,o.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},22950:(e,r,n)=>{n.d(r,{A:()=>a});var s=n(14057),o=n(70579);const a=(0,s.A)((0,o.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},28259:(e,r,n)=>{n.d(r,{A:()=>j});var s=n(89379),o=n(80045),a=n(65043),i=n(58387),l=n(31807),c=n(58128),t=n(28301),d=n(79857),u=n(86061);function h(e){return(0,u.Ay)("MuiTableContainer",e)}(0,d.A)("MuiTableContainer",["root"]);var A=n(70579);const x=["className","component"],m=(0,c.Ay)("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),j=a.forwardRef(function(e,r){const n=(0,t.b)({props:e,name:"MuiTableContainer"}),{className:a,component:c="div"}=n,d=(0,o.A)(n,x),u=(0,s.A)((0,s.A)({},n),{},{component:c}),j=(e=>{const{classes:r}=e;return(0,l.A)({root:["root"]},h,r)})(u);return(0,A.jsx)(m,(0,s.A)({ref:r,as:c,className:(0,i.A)(j.root,a),ownerState:u},d))})},38915:(e,r,n)=>{n.d(r,{A:()=>v});var s=n(79722),o=n(35644),a=n(29296),i=n(13658);const l=s.A.create(),c=i.A.PRONOSTICO,t={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let d=null,u=!1;const h=e=>Boolean(e&&c&&String(e).startsWith(String(c))),A=e=>{try{return sessionStorage.getItem(e)}catch(r){return console.warn("No se pudo leer sessionStorage:",r),null}},x=(e,r)=>{try{void 0!==r&&null!==r&&sessionStorage.setItem(e,r)}catch(n){console.warn("No se pudo escribir en sessionStorage:",n)}},m=()=>{if(!u){u=!0;try{sessionStorage.clear()}catch(e){}null!==a.m&&void 0!==a.m&&a.m.limpiarSesion&&a.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},j=()=>{const e=A("refreshToken"),r=(()=>{const e=A("email")||A("username");if(!e||!t.UserPoolId||!t.ClientId)return null;const r=new o.NE(t);return new o.TU({Username:e,Pool:r})})();if(!e||!r)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const n=new o.c9({RefreshToken:e});return new Promise((e,s)=>{r.refreshSession(n,(r,n)=>{if(r)return void s(r);const o=n.getAccessToken().getJwtToken(),a=n.getIdToken().getJwtToken(),i=n.getRefreshToken().getToken();x("accessToken",o),x("idToken",a),i&&x("refreshToken",i),e(o)})})};l.interceptors.request.use(e=>{const r=sessionStorage.getItem("accessToken");if(h(e.url)){var n;e.headers=null!==(n=e.headers)&&void 0!==n?n:{},r&&(e.headers.Authorization="Bearer ".concat(r));const s=sessionStorage.getItem("sub");s&&(e.headers["X-Usuario-Sub"]=s)}return e}),l.interceptors.response.use(e=>e,async e=>{const{config:r,response:n}=e;if(!r||!n||401!==n.status||!h(r.url))return Promise.reject(e);if(r.__isRetryRequest)return m(),Promise.reject(e);try{var s;const e=await(d||(d=j().then(e=>(d=null,e)).catch(e=>{throw d=null,e})),d);if(!e)throw new Error("No se obtuvo un token renovado.");return r.__isRetryRequest=!0,r.headers=null!==(s=r.headers)&&void 0!==s?s:{},r.headers.Authorization="Bearer ".concat(e),l(r)}catch(o){return m(),Promise.reject(o)}});const v=l},44508:(e,r,n)=>{n.r(r),n.d(r,{default:()=>_});var s=n(89379),o=n(65043),a=n(53969),i=n(55895),l=n(91449),c=n(94799),t=n(26529),d=n(56647),u=n(28259),h=n(87443),A=n(10756),x=n(86172),m=n(81341),j=n(34375),v=n(24343),g=n(10256),f=n(9446),p=n(88889),b=n(80172),C=n(38517),y=n(81911),S=n(78776),z=n(85877),w=n(12097),k=n(3665),E=n(5362),T=n(22950),P=n(61773),N=n(85465),O=n(27421),M=n(14057),I=n(70579);const R=(0,M.A)((0,I.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow");var F=n(29001),W=n(96470),q=n(13658),U=n(38915);const B=[{label:"Mensual",value:1},{label:"Bimestral",value:2},{label:"Semestral",value:6},{label:"Anual",value:12}],D=[{label:"1 a\xf1o",value:12},{label:"2 a\xf1os",value:24},{label:"3 a\xf1os",value:36},{label:"4 a\xf1os",value:48},{label:"5 a\xf1os",value:60}];function _(){const[e,r]=o.useState([]),[n,M]=o.useState([]),[_,H]=o.useState(!0),[V,X]=o.useState(null),[G,J]=o.useState(null),[L,Z]=o.useState(!1),[K,Q]=o.useState(!1),[Y,$]=o.useState(null),[ee,re]=o.useState(null),[ne,se]=o.useState(null),[oe,ae]=o.useState(!1),[ie,le]=o.useState(null),[ce,te]=o.useState({nombre:"",mesesFrecuencia:1,horizonteMeses:12}),[de,ue]=o.useState(!1),[he,Ae]=o.useState(null),[xe,me]=o.useState(null),je=(0,F.Zp)();o.useEffect(()=>{ve(),ge()},[]);const ve=async()=>{H(!0),X(null);try{const[e,n]=await Promise.all([U.A.get("".concat(q.A.PRONOSTICO,"/api/forecasts")),U.A.get("".concat(q.A.PRONOSTICO,"/api/forecast-config"))]);r(e.data),M(n.data)}catch(s){var e,n;console.error("Error cargando datos:",s),X((null===(e=s.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Error al cargar los datos. Por favor intenta nuevamente.")}finally{H(!1)}},ge=async()=>{try{const e=sessionStorage.getItem("sub");if(!e)return;const r=await fetch("".concat(q.A.ADMINISTRACION,"/api/usuarios/perfil"),{headers:{"X-Usuario-Sub":e}});if(!r.ok)return;const n=await r.json();me(n.rol||null)}catch(e){console.error("Error cargando rol de usuario:",e)}},fe=()=>{se(null),le(null)},pe=async()=>{if(ne&&ie)if(ie.nombre&&""!==ie.nombre.trim()){ue(!0);try{await U.A.put("".concat(q.A.PRONOSTICO,"/api/forecast-config/").concat(ne),ie),se(null),le(null),ve(),J("Configuraci\xf3n actualizada exitosamente")}catch(n){var e,r;console.error("Error guardando configuraci\xf3n:",n),X((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al guardar la configuraci\xf3n.")}finally{ue(!1)}}else X("El nombre es requerido")},be=e=>{const r=B.find(r=>r.value===e);return r?r.label:"Cada ".concat(e," meses")},Ce=e=>{const r=D.find(r=>r.value===e);return r?r.label:"".concat(e," meses")},ye=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("es-AR",{year:"numeric",month:"long",day:"numeric"})}catch(r){return e}},Se=(e,r)=>{if(e&&""!==e.trim())return e;if(r)try{const e=new Date(r).toLocaleDateString("es-AR",{year:"numeric",month:"long"});return"Pron\xf3stico de ".concat(e)}catch(n){}return"Pron\xf3stico sin nombre"},ze=(xe||"").toUpperCase().includes("ADMIN");return _?(0,I.jsx)(W.A,{}):(0,I.jsxs)(a.A,{sx:{width:"100%",maxWidth:{sm:"100%",md:"1700px"},mx:"auto",p:3},children:[(0,I.jsx)(i.A,{variant:"h4",component:"h1",sx:{mb:3},children:"Pron\xf3sticos Fijos"}),V&&(0,I.jsx)(l.A,{severity:"error",sx:{mb:2},onClose:()=>X(null),children:V}),G&&(0,I.jsx)(l.A,{severity:"success",sx:{mb:2},onClose:()=>J(null),children:G}),(0,I.jsxs)(c.A,{sx:{mb:4},children:[(0,I.jsxs)(a.A,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderColor:"divider"},children:[(0,I.jsx)(i.A,{variant:"h6",children:"Configuraciones"}),(0,I.jsx)(t.A,{title:"Agregar nueva configuraci\xf3n",children:(0,I.jsx)(d.A,{color:"primary",onClick:()=>{ae(!0),te({nombre:"",mesesFrecuencia:1,horizonteMeses:12})},disabled:oe,children:(0,I.jsx)(T.A,{})})})]}),(0,I.jsx)(u.A,{children:(0,I.jsxs)(h.A,{children:[(0,I.jsx)(A.A,{children:(0,I.jsxs)(x.A,{children:[(0,I.jsx)(m.A,{children:(0,I.jsx)("strong",{children:"Nombre"})}),(0,I.jsx)(m.A,{children:(0,I.jsx)("strong",{children:"Frecuencia"})}),(0,I.jsx)(m.A,{children:(0,I.jsx)("strong",{children:"Horizonte"})}),(0,I.jsx)(m.A,{align:"center",children:(0,I.jsx)("strong",{children:"Acciones"})})]})}),(0,I.jsxs)(j.A,{children:[oe&&(0,I.jsxs)(x.A,{children:[(0,I.jsx)(m.A,{children:(0,I.jsx)(v.A,{size:"small",value:ce.nombre,onChange:e=>te((0,s.A)((0,s.A)({},ce),{},{nombre:e.target.value})),placeholder:"Nombre de la configuraci\xf3n",fullWidth:!0})}),(0,I.jsx)(m.A,{children:(0,I.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,I.jsx)(f.A,{value:ce.mesesFrecuencia,onChange:e=>te((0,s.A)((0,s.A)({},ce),{},{mesesFrecuencia:e.target.value})),children:B.map(e=>(0,I.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,I.jsx)(m.A,{children:(0,I.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,I.jsx)(f.A,{value:ce.horizonteMeses,onChange:e=>te((0,s.A)((0,s.A)({},ce),{},{horizonteMeses:e.target.value})),children:D.map(e=>(0,I.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,I.jsxs)(m.A,{align:"center",children:[(0,I.jsx)(d.A,{color:"success",onClick:async()=>{if(ce.nombre&&""!==ce.nombre.trim()){ue(!0);try{await U.A.post("".concat(q.A.PRONOSTICO,"/api/forecast-config"),ce),ae(!1),te({nombre:"",mesesFrecuencia:1,horizonteMeses:12}),ve(),J("Configuraci\xf3n creada exitosamente")}catch(n){var e,r;console.error("Error creando configuraci\xf3n:",n),X((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al crear la configuraci\xf3n.")}finally{ue(!1)}}else X("El nombre es requerido")},disabled:de,size:"small",children:de?(0,I.jsx)(b.A,{size:20}):(0,I.jsx)(N.A,{})}),(0,I.jsx)(d.A,{color:"error",onClick:()=>{ae(!1),te({nombre:"",mesesFrecuencia:1,horizonteMeses:12})},disabled:de,size:"small",children:(0,I.jsx)(O.A,{})})]})]}),0!==n.length||oe?n.map(e=>(0,I.jsx)(x.A,{hover:!0,children:ne===e.id?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(m.A,{children:(0,I.jsx)(v.A,{size:"small",value:ie.nombre,onChange:e=>le((0,s.A)((0,s.A)({},ie),{},{nombre:e.target.value})),fullWidth:!0})}),(0,I.jsx)(m.A,{children:(0,I.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,I.jsx)(f.A,{value:ie.mesesFrecuencia,onChange:e=>le((0,s.A)((0,s.A)({},ie),{},{mesesFrecuencia:e.target.value})),children:B.map(e=>(0,I.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,I.jsx)(m.A,{children:(0,I.jsx)(g.A,{size:"small",fullWidth:!0,children:(0,I.jsx)(f.A,{value:ie.horizonteMeses,onChange:e=>le((0,s.A)((0,s.A)({},ie),{},{horizonteMeses:e.target.value})),children:D.map(e=>(0,I.jsx)(p.A,{value:e.value,children:e.label},e.value))})})}),(0,I.jsxs)(m.A,{align:"center",children:[(0,I.jsx)(d.A,{color:"success",onClick:pe,disabled:de,size:"small",children:de?(0,I.jsx)(b.A,{size:20}):(0,I.jsx)(N.A,{})}),(0,I.jsx)(d.A,{color:"error",onClick:fe,disabled:de,size:"small",children:(0,I.jsx)(O.A,{})})]})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(m.A,{children:e.nombre}),(0,I.jsx)(m.A,{children:be(e.mesesFrecuencia)}),(0,I.jsx)(m.A,{children:Ce(e.horizonteMeses)}),(0,I.jsxs)(m.A,{align:"center",children:[(0,I.jsx)(t.A,{title:"Calcular ahora",children:(0,I.jsx)(d.A,{color:"success",onClick:()=>(async e=>{Ae(e),X(null);try{await U.A.post("".concat(q.A.PRONOSTICO,"/api/forecasts/generar/").concat(e)),J("Pron\xf3stico generado exitosamente"),ve()}catch(s){var r,n;console.error("Error generando forecast:",s),X((null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Error al generar el pron\xf3stico. Por favor intenta nuevamente.")}finally{Ae(null)}})(e.id),disabled:he===e.id,size:"small",children:he===e.id?(0,I.jsx)(b.A,{size:20}):(0,I.jsx)(R,{})})}),(0,I.jsx)(t.A,{title:"Editar",children:(0,I.jsx)(d.A,{color:"primary",onClick:()=>(e=>{se(e.id),le({nombre:e.nombre||"",mesesFrecuencia:e.mesesFrecuencia||1,horizonteMeses:e.horizonteMeses||12})})(e),size:"small",children:(0,I.jsx)(P.A,{})})}),(0,I.jsx)(t.A,{title:"Eliminar",children:(0,I.jsx)(d.A,{color:"error",onClick:()=>(e=>{re(e),Q(!0)})(e),size:"small",children:(0,I.jsx)(E.A,{})})})]})]})},e.id)):(0,I.jsx)(x.A,{children:(0,I.jsx)(m.A,{colSpan:4,align:"center",children:(0,I.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{py:3},children:"No hay configuraciones. Haz clic en + para agregar una."})})})]})]})})]}),(0,I.jsxs)(c.A,{children:[(0,I.jsx)(a.A,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:(0,I.jsx)(i.A,{variant:"h6",children:"Pron\xf3sticos Generados"})}),(0,I.jsx)(u.A,{children:(0,I.jsxs)(h.A,{children:[(0,I.jsx)(A.A,{children:(0,I.jsxs)(x.A,{children:[(0,I.jsx)(m.A,{children:(0,I.jsx)("strong",{children:"Nombre"})}),(0,I.jsx)(m.A,{children:(0,I.jsx)("strong",{children:"Horizonte"})}),(0,I.jsx)(m.A,{children:(0,I.jsx)("strong",{children:"Frecuencia"})}),(0,I.jsx)(m.A,{children:(0,I.jsx)("strong",{children:"Fecha Generaci\xf3n"})}),(0,I.jsx)(m.A,{align:"center",children:(0,I.jsx)("strong",{children:"Acciones"})})]})}),(0,I.jsx)(j.A,{children:0===e.length?(0,I.jsx)(x.A,{children:(0,I.jsx)(m.A,{colSpan:5,align:"center",children:(0,I.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{py:3},children:"No hay pron\xf3sticos generados a\xfan."})})}):e.map(e=>(0,I.jsxs)(x.A,{hover:!0,children:[(0,I.jsx)(m.A,{children:Se(e.nombre,e.createdAt)}),(0,I.jsx)(m.A,{children:Ce(e.horizonteMeses)}),(0,I.jsx)(m.A,{children:be(e.mesesFrecuencia)}),(0,I.jsx)(m.A,{children:ye(e.createdAt)}),(0,I.jsxs)(m.A,{align:"center",children:[(0,I.jsx)(t.A,{title:"Ver pron\xf3stico",children:(0,I.jsx)(d.A,{color:"primary",onClick:()=>{return r=e.id,void je("/pronostico-fijo/".concat(r));var r},size:"small",children:(0,I.jsx)(k.A,{})})}),ze&&(0,I.jsx)(t.A,{title:"Eliminar",children:(0,I.jsx)(d.A,{color:"error",onClick:()=>(e=>{$(e),Z(!0)})(e),size:"small",children:(0,I.jsx)(E.A,{})})})]})]},e.id))})]})})]}),(0,I.jsxs)(C.A,{open:L,onClose:()=>Z(!1),children:[(0,I.jsx)(y.A,{children:"Confirmar Eliminaci\xf3n"}),(0,I.jsx)(S.A,{children:(0,I.jsxs)(i.A,{children:['\xbfEst\xe1s seguro de que deseas eliminar el pron\xf3stico "',Se(null===Y||void 0===Y?void 0:Y.nombre,null===Y||void 0===Y?void 0:Y.createdAt),'"? Esta acci\xf3n no se puede deshacer.']})}),(0,I.jsxs)(z.A,{children:[(0,I.jsx)(w.A,{onClick:()=>Z(!1),children:"Cancelar"}),(0,I.jsx)(w.A,{onClick:async()=>{if(Y)try{await U.A.delete("".concat(q.A.PRONOSTICO,"/api/forecasts/").concat(Y.id)),Z(!1),$(null),ve(),J("Pron\xf3stico eliminado exitosamente")}catch(n){var e,r;console.error("Error eliminando forecast:",n),X((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al eliminar el pron\xf3stico.")}},color:"error",variant:"contained",children:"Eliminar"})]})]}),(0,I.jsxs)(C.A,{open:K,onClose:()=>Q(!1),children:[(0,I.jsx)(y.A,{children:"Confirmar Eliminaci\xf3n"}),(0,I.jsx)(S.A,{children:(0,I.jsxs)(i.A,{children:['\xbfEst\xe1s seguro de que deseas eliminar la configuraci\xf3n "',null===ee||void 0===ee?void 0:ee.nombre,'"? Esta acci\xf3n no se puede deshacer.']})}),(0,I.jsxs)(z.A,{children:[(0,I.jsx)(w.A,{onClick:()=>Q(!1),children:"Cancelar"}),(0,I.jsx)(w.A,{onClick:async()=>{if(ee)try{await U.A.delete("".concat(q.A.PRONOSTICO,"/api/forecast-config/").concat(ee.id)),Q(!1),re(null),ve(),J("Configuraci\xf3n eliminada exitosamente")}catch(n){var e,r;console.error("Error eliminando configuraci\xf3n:",n),X((null===(e=n.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||"Error al eliminar la configuraci\xf3n.")}},color:"error",variant:"contained",children:"Eliminar"})]})]})]})}}}]);
//# sourceMappingURL=4508.fc73bbbc.chunk.js.map