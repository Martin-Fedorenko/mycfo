"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3185],{60450:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(14057),a=t(70579);const r=(0,o.A)((0,a.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic")},93185:(e,n,t)=>{t.r(n),t.d(n,{default:()=>C});var o,a=t(89379),r=t(57528),s=t(65043),i=t(56647),l=t(53969),c=t(94799),d=t(80172),u=t(91449),p=t(55895),m=t(27421),x=t(5362),g=t(60450),b=t(23892),h=t(79722),v=t(83290),A=t(58128),f=t(70579);const w=(0,v.i7)(o||(o=(0,r.A)(["\n  0% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0.6); }\n  50% { box-shadow: 0 0 0 20px rgba(76, 175, 239, 0); }\n  100% { box-shadow: 0 0 0 0 rgba(76, 175, 239, 0); }\n"]))),j=(0,A.Ay)(i.A)(e=>{let{theme:n,recording:t}=e;return(0,a.A)({width:100,height:100,borderRadius:"50%",color:"#fff",backgroundColor:t?n.palette.error.main:n.palette.primary.main},t&&{animation:"".concat(w," 1.5s infinite")})}),y={Movimiento:"Movimiento",Ingreso:"Ingreso",Egreso:"Egreso",Deuda:"Deuda",Acreencia:"Acreencia",Factura:"Factura"};function C(e){let{tipoDoc:n,endpoint:t,onResultado:o}=e;const[a,r]=(0,s.useState)(!1),[v,A]=(0,s.useState)(null),[w,C]=(0,s.useState)(null),[S,k]=(0,s.useState)(null),[M,R]=(0,s.useState)(null),[D,E]=(0,s.useState)(!1),[F,I]=(0,s.useState)(null);return(0,f.jsxs)(l.A,{sx:{mt:3,textAlign:"center"},children:[!D&&(0,f.jsx)(j,{sx:{mt:5},recording:a?1:0,onClick:a?()=>{v&&v.stop(),r(!1)}:async()=>{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new MediaRecorder(e);let t=[];n.ondataavailable=e=>t.push(e.data),n.onstop=()=>{const n=new Blob(t,{type:"audio/webm"});C(URL.createObjectURL(n)),k(new File([n],"grabacion.webm",{type:"audio/webm"})),e.getTracks().forEach(e=>e.stop())},I(null),R(null),A(n),n.start(),r(!0)},children:a?(0,f.jsx)(m.A,{}):(0,f.jsx)(g.A,{})}),!D&&w&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(c.A,{sx:{mt:1,p:1.5,display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid",borderColor:"grey.400",borderRadius:1},children:[(0,f.jsx)("audio",{controls:!0,src:w}),(0,f.jsx)(i.A,{onClick:()=>{C(null),k(null),R(null),I(null)},color:"error",children:(0,f.jsx)(x.A,{})})]}),(0,f.jsx)(b.A,{label:"Enviar audio",width:"100%",sx:{mt:2},onClick:async()=>{if(!S)return;const e=sessionStorage.getItem("sub");if(!e)return void R("No se encontr\xf3 la sesi\xf3n del usuario. Volv\xe9 a iniciar sesi\xf3n.");E(!0),R(null),I(null);const a=S,r=new FormData;r.append("file",a);const s=y[n];s&&t.includes("/movimientos/")&&r.append("tipoMovimiento",s),n&&r.append("tipoDoc",n),C(null),k(null);try{const n=await h.A.post(t,r,{headers:{"Content-Type":"multipart/form-data","X-Usuario-Sub":e}});console.log("Respuesta completa del audio:",n.data);const{campos:a,transcript:s,warnings:i}=n.data||{};null!==i&&void 0!==i&&i.length&&console.warn("Advertencias al procesar audio:",i);if(!(a&&Object.entries(a).some(e=>{let[n,t]=e;return!!n&&("moneda"!==n.toLowerCase()&&!!t)})))return I({message:"No se pudo interpretar el audio. Por favor grabalo nuevamente procurando mayor claridad.",transcript:s||"Sin transcripci\xf3n disponible."}),void console.warn("Procesamiento de audio sin campos detectados.",{transcript:s,warnings:i});o&&o(n.data)}catch(c){var i,l;console.error("\u274c Error en env\xedo:",c);const e=(null===(i=c.response)||void 0===i||null===(l=i.data)||void 0===l?void 0:l.message)||c.message||"Error desconocido al procesar el audio.";R(e)}finally{E(!1)}}})]}),D&&(0,f.jsx)(l.A,{sx:{mt:4,display:"flex",justifyContent:"center"},children:(0,f.jsx)(d.A,{size:40})}),(0,f.jsxs)(l.A,{sx:{mt:3,textAlign:"left"},children:[M&&(0,f.jsx)(u.A,{severity:"error",sx:{mb:2},onClose:()=>R(null),children:M}),F&&(0,f.jsxs)(u.A,{severity:"warning",sx:{mb:2},onClose:()=>I(null),children:[(0,f.jsx)(p.A,{sx:{fontWeight:600,mb:1},children:F.message}),(0,f.jsxs)(p.A,{variant:"body2",children:["Transcripci\xf3n detectada: ",F.transcript]})]})]})]})}}}]);
//# sourceMappingURL=3185.09615d2e.chunk.js.map