"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5851],{20475:(e,t,o)=>{o.d(t,{F5:()=>i,vu:()=>a,vv:()=>n});const r=new Intl.NumberFormat("es-AR",{minimumFractionDigits:0,maximumFractionDigits:2}),n=function(e){let{allowEmpty:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(""===e||null===e||"undefined"===typeof e)return t?"":"$ 0";const o=Number(e);if(Number.isNaN(o))return t?"":"$ 0";return"".concat(o<0?"-":"","$ ").concat(r.format(Math.abs(o)))},i=e=>n(e,{allowEmpty:!0}),a=function(e){let{returnEmpty:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e)return t?"":0;const o=e.toString().trim();if(!o)return t?"":0;const r=o.replace(/\s+/g,"").replace(/\$/g,""),n=r.startsWith("-"),i=r.replace(/[^0-9,.-]/g,"");if(!i||"-"===i)return t?"":0;const a=i.replace(/-/g,"").replace(/\./g,"").replace(",","."),s=Number(a);return Number.isNaN(s)?t?"":0:n?-s:s}},35851:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ie});var r=o(89379),n=o(65043),i=o(53969),a=o(55895),s=o(53407),l=o(79693),c=o(99147),d=o(91449),u=o(24343),m=o(94527),p=o(12097),g=o(26529),h=o(45847),x=o(85030),v=o(94799),f=o(87443),A=o(10756),j=o(86172),b=o(81341),C=o(34375),y=o(17060),I=o(88889),S=o(70298),E=o(56647),N=o(76072),w=o(41968),M=o(80172),k=o(92659),T=o(67819),O=o(58128),W=o(52956),F=o(80349),R=o(70579);const z=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],U=(0,O.Ay)(p.A)(e=>{let{theme:t}=e;return{width:"100%",justifyContent:"flex-start",textTransform:"none",color:(t.vars||t).palette.text.primary,backgroundColor:(t.vars||t).palette.background.default,border:"1px solid ".concat((t.vars||t).palette.divider),"&:hover":{backgroundColor:(t.vars||t).palette.action.hover},padding:t.spacing(1)}});function P(e){if(!e)return"";const[t,o]=e.split("-"),r=Number(o)-1;return"".concat(z[r]," ").concat(t)}function J(e){let{value:t={},onChange:o}=e;const[r,s]=n.useState(null),[l,c]=n.useState({from:t.from,to:t.to}),[d,u]=n.useState(0);n.useEffect(()=>{c({from:t.from,to:t.to})},[t.from,t.to]);const m=()=>{s(null),c({from:t.from,to:t.to})},g=n.useMemo(()=>{const e=(new Date).getFullYear();return Array.from({length:2},(t,o)=>e+d+o)},[d]),h=e=>{u(t=>t+("up"===e?-2:2))},x=(e,t,o)=>!(!t||!o)&&(e>t&&e<o);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(U,{onClick:e=>{s(e.currentTarget)},endIcon:(0,R.jsx)(F.A,{}),sx:{display:"flex",justifyContent:"space-between","& .MuiButton-endIcon":{marginLeft:"auto",marginRight:0}},children:(0,R.jsx)(a.A,{sx:{color:t.from||t.to?"text.primary":"text.secondary",flex:1,textAlign:"left"},children:(v=t.from,f=t.to,v||f?f?"".concat(P(v)," - ").concat(P(f)):"".concat(P(v)," - ..."):"Mes inicial - Mes final")})}),(0,R.jsx)(W.Ay,{open:Boolean(r),anchorEl:r,onClose:m,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{width:"fit-content",minWidth:"unset",maxWidth:"none",p:1.5}}},children:(0,R.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,R.jsx)(p.A,{fullWidth:!0,size:"small",onClick:()=>h("up"),sx:{borderRadius:1,minHeight:"20px",height:"20px",py:0,color:"text.secondary"},children:"\u2b9d"}),g.map(e=>(0,R.jsxs)(i.A,{sx:{mb:.5,animation:"fadeIn 0.3s ease-in-out","@keyframes fadeIn":{"0%":{opacity:0,transform:"translateY(10px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[(0,R.jsx)(a.A,{variant:"subtitle2",sx:{mb:.5,fontWeight:"bold"},children:e}),(0,R.jsx)(i.A,{sx:{display:"grid",gridTemplateColumns:"repeat(3, auto)",gap:1},children:Array.from({length:12},(t,o)=>{const r=String(o+1).padStart(2,"0"),n="".concat(e,"-").concat(r);return(0,R.jsx)(p.A,{size:"small",onClick:()=>(e=>{if(!l.from||l.to)c({from:e,to:null});else{const t=new Date(l.from+"-01"),o=new Date(e+"-01");c(o<t?{from:e,to:null}:{from:l.from,to:e})}})(n),variant:n===l.from||n===l.to?"contained":"outlined",color:n===l.from||n===l.to?"primary":"inherit",sx:[{minWidth:72},x(n,l.from,l.to)?e=>{var t,o;const r=(e.vars||e).palette,n="dark"===e.palette.mode;return{bgcolor:r.primary&&r.primary.mainChannel?"rgba(".concat(r.primary.mainChannel," / ").concat(n?.22:.15,")"):null!==(t=null===(o=r.action)||void 0===o?void 0:o.selected)&&void 0!==t?t:n?"rgba(255,255,255,0.12)":"rgba(0,0,0,0.06)",color:r.primary.main,borderColor:r.primary.main,boxShadow:"inset 0 0 0 1.5px ".concat(r.primary.main)}}:{}],children:z[o]},o)})})]},e)),(0,R.jsx)(p.A,{fullWidth:!0,size:"small",onClick:()=>h("down"),sx:{borderRadius:1,minHeight:"20px",height:"20px",py:0,color:"text.secondary"},children:"\u2b9f"}),(0,R.jsxs)(i.A,{sx:{display:"flex",gap:1,mt:1,justifyContent:"flex-end",borderTop:1,borderColor:"divider",pt:1},children:[(0,R.jsx)(p.A,{size:"small",onClick:()=>{const e={from:null,to:null};c(e),o(e)},color:"inherit",children:"Limpiar"}),(0,R.jsx)(p.A,{size:"small",variant:"contained",onClick:()=>{l.from&&l.to&&(o(l),m())},disabled:!l.from||!l.to,sx:{minWidth:"100px","&.Mui-disabled":{backgroundColor:"grey.200",color:"grey.600",boxShadow:"none","&:hover":{backgroundColor:"grey.200"}}},children:"Confirmar"})]})]})})]});var v,f}var L=o(29001),D=o(5362),B=o(19817),G=o(22950),$=o(73457),Y=o(3555),q=o(38915),X=o(20475),H=o(13658);const V={backgroundColor:"rgba(255, 255, 255, 0.02)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},_=e=>({border:"1px solid ".concat((e.vars||e).palette.divider),maxWidth:110,minWidth:90,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",padding:"4px 6px",textAlign:"center"}),Z=e=>(0,r.A)((0,r.A)({},_(e)),{},{fontWeight:600});function K(e,t){return new Date(Date.UTC(e,t,1))}function Q(e,t){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+t,1))}function ee(e){const t=e.getUTCFullYear(),o=String(e.getUTCMonth()+1).padStart(2,"0");return"".concat(t,"-").concat(o)}const te=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];const oe=e=>{const t=Number(e);return Number.isFinite(t)?Math.round(100*(t+Number.EPSILON))/100:0},re=e=>(0,X.vv)(e),ne=[{value:"FIJO",label:"Fijo mensual"},{value:"AJUSTE",label:"Ajuste % mensual"},{value:"UNICO",label:"\xdanico (1 mes)"},{value:"CUOTAS",label:"En cuotas"}];function ie(){const e=(0,L.Zp)(),[t,o]=n.useState(0),[O,W]=n.useState(!1),[F,z]=n.useState(""),[U,P]=n.useState(""),[ie,ae]=n.useState(""),[se,le]=n.useState([{categoria:"",tipo:"",regla:{modo:"FIJO",importe:0}},{categoria:"",tipo:"",regla:{modo:"AJUSTE",importe:0,porcentaje:0}},{categoria:"",tipo:"",regla:{modo:"FIJO",importe:0}}]),[ce,de]=n.useState(k.gd);n.useEffect(()=>{(async()=>{try{const e=await q.A.get("".concat(H.A.REGISTRO,"/api/categorias"));e.data&&e.data.length>0&&de(e.data)}catch(e){console.error("Error fetching categories, using fallback",e)}})()},[]);const[ue,me]=n.useState({}),[pe,ge]=n.useState(null),[he,xe]=n.useState(!0),ve=n.useMemo(()=>U&&ie?function(e,t){const o=[];if(!e||!t)return o;const[r,n]=e.split("-").map(Number),[i,a]=t.split("-").map(Number);if(!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(i)||!Number.isFinite(a))return o;let s=K(r,n-1);const l=K(i,a-1);for(;s.getTime()<=l.getTime();)o.push(ee(s)),s=Q(s,1);return o}(U,ie):[],[U,ie]);n.useEffect(()=>{0!==ve.length?me(e=>{const t=(0,r.A)({},e);return ve.forEach(e=>{t[e]||(t[e]={}),se.forEach(o=>{var r;null!==(r=o.categoria)&&void 0!==r&&r.trim()&&(t[e][o.categoria]?t[e][o.categoria].tipo=o.tipo:t[e][o.categoria]={sugerido:0,tipo:o.tipo})}),Object.keys(t[e]).forEach(o=>{se.find(e=>e.categoria===o)||delete t[e][o]})}),Object.keys(t).forEach(e=>{ve.includes(e)||delete t[e]}),t}):me({})},[ve,se]);const fe=()=>F?U&&ie?U>ie?'El mes "Desde" no puede ser posterior a "Hasta".':null:"Complet\xe1 los meses.":"Ingres\xe1 un nombre para el presupuesto.",Ae=()=>{if(0===se.length)return"Agreg\xe1 al menos una categor\xeda.";if(se.some(e=>{var t;return!(null!==(t=e.categoria)&&void 0!==t&&t.trim())}))return"Todas las categor\xedas deben tener nombre.";if(se.some(e=>{var t;return!(null!==(t=e.tipo)&&void 0!==t&&t.trim())}))return"Todas las categor\xedas deben tener tipo.";const e=e=>""===e||null==e||Number.isNaN(Number(e)),t=e=>Number.isInteger(Number(e))&&Number(e)>=1;for(let r=0;r<se.length;r++){var o;const n=se[r];if(null===(o=n.categoria)||void 0===o||!o.trim())continue;const i=n.categoria.trim()||"Categor\xeda #".concat(r+1),a=n.regla||{},s=(a.modo||"FIJO").toUpperCase();if("FIJO"===s&&e(a.importe))return'Complet\xe1 el importe en "'.concat(i,'" (Regla: Fijo mensual).');if("AJUSTE"===s){if(e(a.importe))return'Complet\xe1 el importe inicial en "'.concat(i,'" (Regla: Ajuste % mensual).');if(e(a.porcentaje))return'Complet\xe1 el porcentaje mensual en "'.concat(i,'" (Regla: Ajuste % mensual).')}if("UNICO"===s){if(!a.mesUnico)return'Eleg\xed el mes en "'.concat(i,'" (Regla: \xdanico).');if(e(a.importe))return'Complet\xe1 el importe en "'.concat(i,'" (Regla: \xdanico).')}if("CUOTAS"===s){if(e(a.montoTotal))return'Complet\xe1 el monto total en "'.concat(i,'" (Regla: En cuotas).');if(!t(a.cuotas))return'Indic\xe1 la cantidad de cuotas (>= 1) en "'.concat(i,'" (Regla: En cuotas).');if(""!==a.interesMensual&&null!=a.interesMensual&&Number.isNaN(Number(a.interesMensual)))return'El inter\xe9s mensual debe ser num\xe9rico en "'.concat(i,'" (Regla: En cuotas).');if(!a.comienza)return'Eleg\xed el mes de inicio en "'.concat(i,'" (Regla: En cuotas).')}}return null},je=()=>{const e=0===t?fe():1===t?Ae():null;e?ge(e):(ge(null),o(e=>Math.min(2,e+1)))},be=()=>{ge(null),o(e=>Math.max(0,e-1))},Ce=(e,t,o)=>{const n=[...se],i=n[e].categoria;n[e][t]=o,"categoria"===t?me(t=>{const a={};return Object.entries(t).forEach(t=>{let[s,l]=t;a[s]={},Object.entries(l).forEach(t=>{let[l,c]=t;l===i?a[s][o]=(0,r.A)((0,r.A)({},c),{},{tipo:n[e].tipo}):a[s][l]=c})}),a}):"tipo"===t&&me(t=>{const i=(0,r.A)({},t);return Object.keys(i).forEach(t=>{i[t][n[e].categoria]&&(i[t][n[e].categoria].tipo=o)}),i}),le(n)},ye=(e,t,o)=>{const n=[...se];n[e].regla=(0,r.A)((0,r.A)({},n[e].regla||{modo:"FIJO"}),{},{[t]:o}),"modo"===t&&("FIJO"===o&&(n[e].regla={modo:"FIJO",importe:0}),"AJUSTE"===o&&(n[e].regla={modo:"AJUSTE",importe:0,porcentaje:0}),"UNICO"===o&&(n[e].regla={modo:"UNICO",importe:0,mesUnico:""}),"CUOTAS"===o&&(n[e].regla={modo:"CUOTAS",montoTotal:0,cuotas:2,interesMensual:0,comienza:ve[0]||""})),le(n)},{monthTotals:Ie,negativeMonths:Se,totalIngresos:Ee,totalEgresos:Ne}=n.useMemo(()=>{const e={},t=[];let o=0,r=0;return ve.forEach(n=>{const i=ue[n]||{};let a=0,s=0;Object.values(i).forEach(e=>{var t;const o=Number(null!==(t=null===e||void 0===e?void 0:e.sugerido)&&void 0!==t?t:0);if(!Number.isFinite(o))return;const r=((null===e||void 0===e?void 0:e.tipo)||"").toString().toUpperCase();"INGRESO"===r?a+=o:"EGRESO"===r&&(s+=o)});const l=a-s;e[n]={ingresos:a,egresos:s,resultado:l},o+=a,r+=s,l<0&&t.push({mes:n,resultado:l})}),{monthTotals:e,negativeMonths:t,totalIngresos:o,totalEgresos:r}},[ve,ue]),we=n.useMemo(()=>Ee-Ne,[Ee,Ne]),Me=Se.length>0,ke=n.useMemo(()=>{if(!Se.length)return"";let e=Se.slice(0,6).map(e=>function(e){var t;if(!e)return"";const[o,r]=e.split("-"),n=null!==o&&void 0!==o?o:"",i=Number(r)-1;if(!Number.isFinite(i)||i<0||i>11)return e;const a=null!==(t=te[i])&&void 0!==t?t:r;return"".concat(a," ").concat(n).trim()}(e.mes)).join(", ");return Se.length>6&&(e+=" y ".concat(Se.length-6," m\xe1s")),e},[Se]);return(0,R.jsxs)(i.A,{sx:{width:"100%",minHeight:"100vh",p:3},children:[(0,R.jsx)(a.A,{variant:"h4",gutterBottom:!0,children:"Nuevo Presupuesto"}),(0,R.jsx)(a.A,{variant:"subtitle1",gutterBottom:!0,children:"Planific\xe1 tus ingresos y egresos esperados"}),(0,R.jsxs)(s.A,{activeStep:t,alternativeLabel:!0,sx:{mb:3},children:[(0,R.jsx)(l.A,{children:(0,R.jsx)(c.A,{children:"Datos b\xe1sicos"})}),(0,R.jsx)(l.A,{children:(0,R.jsx)(c.A,{children:"Categor\xedas & Reglas"})}),(0,R.jsx)(l.A,{children:(0,R.jsx)(c.A,{children:"Vista previa & Guardar"})})]}),pe&&(0,R.jsx)(d.A,{severity:"warning",sx:{mb:2},children:pe}),0===t&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(i.A,{sx:{display:"flex",gap:2,mb:3,flexDirection:"column"},children:[(0,R.jsx)(u.A,{label:"Nombre del presupuesto",value:F,onChange:e=>z(e.target.value),fullWidth:!0,variant:"outlined"}),(0,R.jsx)(i.A,{sx:{maxWidth:300},children:(0,R.jsx)(J,{value:{from:U,to:ie},onChange:e=>{P(e.from),ae(e.to)}})})]}),(0,R.jsx)(m.A,{sx:{my:2}}),(0,R.jsxs)(i.A,{display:"flex",gap:2,children:[(0,R.jsx)(p.A,{variant:"contained",onClick:je,children:"Continuar"}),(0,R.jsx)(p.A,{variant:"outlined",onClick:()=>e(-1),children:"Cancelar"})]})]}),1===t&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(i.A,{mt:1,mb:2,display:"flex",gap:1,alignItems:"center",children:[(0,R.jsx)(p.A,{startIcon:(0,R.jsx)(G.A,{}),variant:"outlined",onClick:()=>{le([...se,{categoria:"",tipo:"Egreso",regla:{modo:"FIJO",importe:0}}])},children:"Nueva categor\xeda"}),(0,R.jsx)(g.A,{title:"Bloquear montos negativos",children:(0,R.jsx)(h.A,{control:(0,R.jsx)(x.A,{size:"small",checked:he,onChange:(e,t)=>xe(t)}),label:"Bloquear negativos"})})]}),(0,R.jsx)(v.A,{variant:"outlined",sx:{p:0,mb:2,overflowX:"auto",borderColor:e=>(e.vars||e).palette.divider},children:(0,R.jsxs)(f.A,{size:"small",sx:{tableLayout:"auto",width:"100%",minWidth:720},children:[(0,R.jsx)(A.A,{children:(0,R.jsxs)(j.A,{sx:V,children:[(0,R.jsx)(b.A,{sx:Z,children:"Categor\xeda"}),(0,R.jsx)(b.A,{sx:Z,children:"Tipo"}),(0,R.jsx)(b.A,{sx:Z,children:"Regla"}),(0,R.jsx)(b.A,{sx:Z,children:"Par\xe1metros"}),(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},Z(e)),{},{width:96,minWidth:96,maxWidth:96}),children:"Acciones"})]})}),(0,R.jsx)(C.A,{children:se.map((e,t)=>{var o;const n=e.regla||{modo:"FIJO"};return(0,R.jsxs)(j.A,{sx:V,children:[(0,R.jsx)(b.A,{sx:_,children:(0,R.jsx)(y.A,{value:e.categoria||null,onChange:(e,o)=>Ce(t,"categoria",o||""),options:ce,freeSolo:!1,disableClearable:!0,forcePopupIcon:!0,popupIcon:(0,R.jsx)(Y.A,{}),componentsProps:{popupIndicator:{disableRipple:!0,disableFocusRipple:!0,sx:{p:0,m:0,bgcolor:"transparent",border:"none",boxShadow:"none","&:hover":{bgcolor:"transparent"},"& .MuiTouchRipple-root":{display:"none"},"& .MuiSvgIcon-root":{fontSize:24}}},clearIndicator:{sx:{display:"none"}}},sx:{"& .MuiAutocomplete-endAdornment":{right:0,top:"50%",transform:"translateY(-50%)"},"& .MuiAutocomplete-popupIndicator":{p:0},"& .MuiAutocomplete-popupIndicatorOpen .MuiSvgIcon-root":{transform:"none"}},renderInput:e=>(0,R.jsx)(u.A,(0,r.A)((0,r.A)({},e),{},{variant:"standard",size:"small",placeholder:"Categor\xeda",sx:{minWidth:140,maxWidth:220}}))})}),(0,R.jsx)(b.A,{sx:_,children:(0,R.jsxs)(u.A,{select:!0,value:e.tipo,onChange:e=>Ce(t,"tipo",e.target.value),variant:"outlined",size:"small",sx:[{minWidth:100},(0,T.i)(e.tipo)],children:[(0,R.jsx)(I.A,{value:"Ingreso",children:"INGRESO"}),(0,R.jsx)(I.A,{value:"Egreso",children:"EGRESO"})]})}),(0,R.jsx)(b.A,{sx:_,children:(0,R.jsx)(u.A,{select:!0,value:n.modo,onChange:e=>ye(t,"modo",e.target.value),variant:"standard",size:"small",sx:{minWidth:160},children:ne.map(e=>(0,R.jsx)(I.A,{value:e.value,children:e.label},e.value))})}),(0,R.jsxs)(b.A,{sx:e=>(0,r.A)((0,r.A)({},_(e)),{},{textAlign:"left",whiteSpace:"normal",overflow:"visible",textOverflow:"unset",minWidth:220,maxWidth:420}),children:["FIJO"===n.modo&&(0,R.jsxs)(S.A,{spacing:.75,alignItems:"flex-start",children:[(0,R.jsx)(u.A,{type:"text",label:"Importe",placeholder:"$ 0",value:0===n.importe||"0"===n.importe||""===n.importe?"":(0,X.F5)(n.importe),onChange:e=>{const o=(0,X.vu)(e.target.value,{returnEmpty:!0});ye(t,"importe",""===o?"":o)},size:"small",variant:"standard",InputLabelProps:{shrink:!0},sx:{maxWidth:180},inputProps:{inputMode:"numeric"}}),(0,R.jsx)(a.A,{variant:"caption",color:"text.secondary",children:"Mismo importe para cada mes del rango"})]}),"AJUSTE"===n.modo&&(0,R.jsxs)(S.A,{spacing:.75,alignItems:"flex-start",children:[(0,R.jsxs)(S.A,{direction:"row",spacing:1,flexWrap:"wrap",sx:{width:"100%"},children:[(0,R.jsx)(u.A,{type:"text",label:"Importe inicial",placeholder:"$ 0",value:0===n.importe||"0"===n.importe||""===n.importe?"":(0,X.F5)(n.importe),onChange:e=>{const o=(0,X.vu)(e.target.value,{returnEmpty:!0});ye(t,"importe",""===o?"":o)},size:"small",variant:"standard",InputLabelProps:{shrink:!0},sx:{flex:"1 1 140px",minWidth:140},inputProps:{inputMode:"numeric"}}),(0,R.jsx)(u.A,{type:"number",label:"% mensual",placeholder:"% 0",value:0===n.porcentaje||"0"===n.porcentaje||""===n.porcentaje?"":n.porcentaje,onChange:e=>ye(t,"porcentaje",e.target.value),size:"small",variant:"standard",InputLabelProps:{shrink:!0},sx:{flex:"1 1 120px",minWidth:120},inputProps:{step:.1,inputMode:"decimal"}})]}),(0,R.jsx)(a.A,{variant:"caption",color:"info.main",children:"Crecimiento compuesto mes a mes"})]}),"UNICO"===n.modo&&(0,R.jsxs)(S.A,{spacing:.75,alignItems:"flex-start",children:[(0,R.jsxs)(S.A,{direction:"row",spacing:1,flexWrap:"wrap",sx:{width:"100%"},children:[(0,R.jsx)(u.A,{select:!0,label:"Mes",value:n.mesUnico||"",onChange:e=>ye(t,"mesUnico",e.target.value),size:"small",variant:"standard",sx:{flex:"1 1 140px",minWidth:140},children:ve.map(e=>(0,R.jsx)(I.A,{value:e,children:e},e))}),(0,R.jsx)(u.A,{type:"text",label:"Importe",placeholder:"$ 0",value:0===n.importe||"0"===n.importe||""===n.importe?"":(0,X.F5)(n.importe),onChange:e=>{const o=(0,X.vu)(e.target.value,{returnEmpty:!0});ye(t,"importe",""===o?"":o)},size:"small",variant:"standard",InputLabelProps:{shrink:!0},sx:{flex:"1 1 140px",minWidth:140},inputProps:{inputMode:"numeric"}})]}),(0,R.jsx)(a.A,{variant:"caption",color:"text.secondary",children:"Se aplica solo al mes seleccionado"})]}),"CUOTAS"===n.modo&&(0,R.jsxs)(S.A,{spacing:.75,alignItems:"flex-start",children:[(0,R.jsxs)(S.A,{direction:"row",spacing:1,flexWrap:"wrap",sx:{width:"100%"},children:[(0,R.jsx)(u.A,{type:"text",label:"Monto total",placeholder:"$ 0",value:0===n.montoTotal||"0"===n.montoTotal||""===n.montoTotal?"":(0,X.F5)(n.montoTotal),onChange:e=>{const o=(0,X.vu)(e.target.value,{returnEmpty:!0});ye(t,"montoTotal",""===o?"":o)},size:"small",variant:"standard",InputLabelProps:{shrink:!0},sx:{flex:"1 1 150px",minWidth:150},inputProps:{inputMode:"numeric"}}),(0,R.jsx)(u.A,{type:"number",label:"Cuotas",value:null!==(o=n.cuotas)&&void 0!==o?o:"",onChange:e=>ye(t,"cuotas",e.target.value),size:"small",variant:"standard",sx:{flex:"1 1 110px",minWidth:110},inputProps:{min:1,step:1,inputMode:"numeric"}}),(0,R.jsx)(u.A,{type:"number",label:"% inter\xe9s",placeholder:"% 0",value:0===n.interesMensual||"0"===n.interesMensual||""===n.interesMensual?"":n.interesMensual,onChange:e=>ye(t,"interesMensual",e.target.value),size:"small",variant:"standard",InputLabelProps:{shrink:!0},sx:{flex:"1 1 120px",minWidth:120},inputProps:{step:.1,inputMode:"decimal"}}),(0,R.jsx)(u.A,{select:!0,label:"Comienza",value:n.comienza||ve[0]||"",onChange:e=>ye(t,"comienza",e.target.value),size:"small",variant:"standard",sx:{flex:"1 1 140px",minWidth:140},children:ve.map(e=>(0,R.jsx)(I.A,{value:e,children:e},e))})]}),(0,R.jsx)(a.A,{variant:"caption",color:"warning.main",children:"Calcula cuotas estilo franc\xe9s cuando hay inter\xe9s"})]})]}),(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},_(e)),{},{width:96,minWidth:96,maxWidth:96,px:.5}),children:(0,R.jsxs)(S.A,{direction:"row",spacing:.5,justifyContent:"center",children:[(0,R.jsx)(g.A,{title:"Duplicar categor\xeda",children:(0,R.jsx)(E.A,{onClick:()=>(e=>{const t=se[e],o={categoria:"".concat(t.categoria," copia"),tipo:t.tipo,regla:JSON.parse(JSON.stringify(t.regla))};le([...se,o])})(t),size:"small",children:(0,R.jsx)(B.A,{fontSize:"small"})})}),(0,R.jsx)(g.A,{title:"Eliminar",children:(0,R.jsx)(E.A,{onClick:()=>(e=>{const t=se[e];le(se.filter((t,o)=>o!==e)),me(e=>{const o=(0,r.A)({},e);return Object.keys(o).forEach(e=>{delete o[e][t.categoria]}),o})})(t),size:"small",children:(0,R.jsx)(D.A,{color:"error",fontSize:"small"})})})]})})]},t)})})]})}),(0,R.jsxs)(i.A,{display:"flex",gap:1,mb:2,children:[(0,R.jsx)(p.A,{startIcon:(0,R.jsx)($.A,{}),variant:"contained",color:"primary",onClick:()=>{0!==ve.length?(ge(null),me(e=>{const t=(0,r.A)({},e);return se.forEach(e=>{var o;if(null===(o=e.categoria)||void 0===o||!o.trim())return;const{tipo:r,categoria:n,regla:i}=e,a=((null===i||void 0===i?void 0:i.modo)||"FIJO").toUpperCase();if("FIJO"===a){const e=Number((null===i||void 0===i?void 0:i.importe)||0);ve.forEach(o=>{t[o]||(t[o]={}),t[o][n]||(t[o][n]={sugerido:0,tipo:r}),t[o][n].sugerido=e,t[o][n].tipo=r})}if("AJUSTE"===a){const e=Number((null===i||void 0===i?void 0:i.importe)||0),o=Number((null===i||void 0===i?void 0:i.porcentaje)||0)/100;ve.forEach((i,a)=>{const s=oe(e*Math.pow(1+o,a));t[i]||(t[i]={}),t[i][n]||(t[i][n]={sugerido:0,tipo:r}),t[i][n].sugerido=s,t[i][n].tipo=r})}if("UNICO"===a){const e=null===i||void 0===i?void 0:i.mesUnico,o=Number((null===i||void 0===i?void 0:i.importe)||0);ve.forEach(i=>{t[i]||(t[i]={}),t[i][n]||(t[i][n]={sugerido:0,tipo:r}),t[i][n].sugerido=i===e?o:0,t[i][n].tipo=r})}if("CUOTAS"===a){const e=Number((null===i||void 0===i?void 0:i.montoTotal)||0),o=Math.max(1,Number((null===i||void 0===i?void 0:i.cuotas)||1)),a=Number((null===i||void 0===i?void 0:i.interesMensual)||0)/100,s=(null===i||void 0===i?void 0:i.comienza)||ve[0];let l=0;const c=e=>Math.round(100*(e+Number.EPSILON))/100;if(a>0){const t=Math.pow(1+a,o);l=c(e*(a*t/(t-1)))}else l=c(e/o);const d=ve.findIndex(e=>e===s);ve.forEach((e,i)=>{t[e]||(t[e]={}),t[e][n]||(t[e][n]={sugerido:0,tipo:r});const a=i-d;t[e][n].sugerido=a>=0&&a<o?l:0,t[e][n].tipo=r})}}),t})):ge("Defin\xed el rango de meses primero.")},children:"Aplicar reglas a los meses"}),(0,R.jsx)(p.A,{variant:"outlined",onClick:je,children:"Continuar"}),(0,R.jsx)(p.A,{variant:"text",onClick:be,children:"Volver"})]})]}),2===t&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(i.A,{mb:1,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[(0,R.jsx)(a.A,{variant:"subtitle1",children:"Revis\xe1 y ajust\xe1 los montos estimados por mes y categor\xeda"}),(0,R.jsxs)(S.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,R.jsx)(N.A,{label:"Ingresos: ".concat(re(Ee)),color:"success"}),(0,R.jsx)(N.A,{label:"Egresos: ".concat(re(Ne)),color:"error"}),(0,R.jsx)(N.A,{label:"Resultado: ".concat(re(we)),color:we>=0?"info":"error"})]})]}),Me&&(0,R.jsxs)(d.A,{severity:"error",variant:"filled",role:"alert","aria-live":"polite",sx:{mb:2},children:[(0,R.jsx)(w.A,{children:"Atenci\xf3n: hay meses en p\xe9rdida (resultado negativo)."}),"Revis\xe1 los montos. Meses afectados: ",ke||"ver detalle en la grilla."]}),(0,R.jsx)(v.A,{variant:"outlined",sx:{mt:1,width:"100%",overflowX:"auto",p:0,borderColor:e=>(e.vars||e).palette.divider},children:(0,R.jsxs)(f.A,{size:"small",sx:{tableLayout:"fixed",width:"100%"},children:[(0,R.jsx)(A.A,{children:(0,R.jsxs)(j.A,{sx:V,children:[(0,R.jsx)(b.A,{sx:Z,children:"Mes"}),se.map((e,t)=>(0,R.jsx)(b.A,{sx:Z,children:(0,R.jsxs)(S.A,{alignItems:"center",spacing:.5,children:[(0,R.jsx)(a.A,{variant:"body2",noWrap:!0,title:e.categoria,sx:{fontWeight:600},children:e.categoria}),(0,R.jsx)(N.A,{size:"small",label:e.tipo,color:"Ingreso"===e.tipo?"success":"default"})]})},t)),(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},Z(e)),{},{minWidth:120}),children:"Ingresos (mes)"}),(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},Z(e)),{},{minWidth:120}),children:"Egresos (mes)"}),(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},Z(e)),{},{minWidth:130}),children:"Resultado (mes)"})]})}),(0,R.jsxs)(C.A,{children:[ve.map(e=>{const t=Ie[e]||{ingresos:0,egresos:0,resultado:0},o=t.resultado<0;return(0,R.jsxs)(j.A,{sx:V,children:[(0,R.jsx)(b.A,{sx:_,children:e}),se.map((t,o)=>{var n;const i=(null===(n=ue[e])||void 0===n?void 0:n[t.categoria])||{sugerido:0};return(0,R.jsx)(b.A,{sx:_,children:(0,R.jsx)(u.A,{type:"text",variant:"standard",size:"small",value:(0,X.F5)(i.sugerido),onChange:o=>((e,t,o,n)=>{const i=""===n?0:Number(n);Number.isNaN(i)||he&&i<0||me(n=>{const a=(0,r.A)({},n);return a[e]||(a[e]={}),a[e][t]||(a[e][t]={sugerido:0,tipo:"Egreso"}),a[e][t][o]=i,a})})(e,t.categoria,"sugerido",(0,X.vu)(o.target.value,{returnEmpty:!0})),inputProps:{inputMode:"numeric",style:{padding:"4px 6px",textAlign:"right"}},sx:{maxWidth:90}})},o)}),(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},_(e)),{},{fontWeight:700,color:"#66bb6a"}),children:re(t.ingresos)}),(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},_(e)),{},{fontWeight:700,color:"#ef5350"}),children:re(t.egresos)}),(0,R.jsx)(b.A,{sx:_,children:(0,R.jsx)(g.A,{title:o?"Este mes los egresos superan a los ingresos.":"",disableHoverListener:!o,children:(0,R.jsxs)(S.A,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",children:[(0,R.jsx)(a.A,{component:"span",sx:{fontWeight:700,color:o?"error.main":"info.main"},children:re(t.resultado)}),o&&(0,R.jsx)(N.A,{size:"small",color:"error",label:"En p\xe9rdida"})]})})})]},e)}),(0,R.jsxs)(j.A,{children:[(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},_(e)),{},{fontWeight:700}),children:"Totales mes"}),se.map((e,t)=>{const o=ve.reduce((t,o)=>{var r,n;const i=(null===(r=ue[o])||void 0===r||null===(n=r[e.categoria])||void 0===n?void 0:n.sugerido)||0;return t+Number(i||0)},0);return(0,R.jsx)(b.A,{sx:e=>(0,r.A)((0,r.A)({},_(e)),{},{fontWeight:700}),children:re(o)},t)}),(0,R.jsx)(b.A,{sx:_}),(0,R.jsx)(b.A,{sx:_}),(0,R.jsx)(b.A,{sx:_})]})]})]})}),(0,R.jsxs)(i.A,{mt:3,display:"flex",gap:2,flexWrap:"wrap",children:[(0,R.jsx)(p.A,{variant:"contained",onClick:async()=>{if(O)return;const t=fe();if(t)return ge(t);const o=Ae();if(o)return ge(o);W(!0);try{var r;const t=U,o=ie,n=ve[0],i=se.map(e=>{var t,o,r,i,a,s;const l=(e.categoria||"").trim(),c=(e.tipo||"").toString().toUpperCase(),d=null!==(t=null!==(o=null===e||void 0===e||null===(r=e.regla)||void 0===r?void 0:r.importe)&&void 0!==o?o:null===e||void 0===e||null===(i=e.regla)||void 0===i?void 0:i.montoTotal)&&void 0!==t?t:0,u=ve.map(e=>{var t,o,r,n;const i=null===ue||void 0===ue||null===(t=ue[e])||void 0===t?void 0:t[l],a=null!==(o=null===i||void 0===i?void 0:i.sugerido)&&void 0!==o?o:0,s=null!==(r=null!==(n=null===i||void 0===i?void 0:i.montoReal)&&void 0!==n?n:null===i||void 0===i?void 0:i.real)&&void 0!==r?r:null;return{mes:e,montoEstimado:oe(a),montoReal:null==s?null:oe(s)}}),m=n?null===ue||void 0===ue||null===(a=ue[n])||void 0===a||null===(s=a[l])||void 0===s?void 0:s.sugerido:void 0,p=oe(null!=m?m:d||0);return{categoria:l,tipo:c,montoEstimado:p,montoReal:null,meses:u}}),a={nombre:F,desde:t,hasta:o,autogenerarCeros:!1,plantilla:i},s=await q.A.post("".concat(H.A.PRONOSTICO,"/api/presupuestos"),a),l=(null===s||void 0===s||null===(r=s.data)||void 0===r?void 0:r.nombre)||F,c=encodeURIComponent(l.trim().toLowerCase().replace(/\s+/g,"-"));e("/presupuestos/".concat(c))}catch(i){var n;console.error("Error guardando presupuesto",i),409===(null===i||void 0===i||null===(n=i.response)||void 0===n?void 0:n.status)?ge("Ya existe un presupuesto con el mismo nombre y per\xedodo."):ge("No se pudo guardar el presupuesto. Prob\xe1 de nuevo.")}finally{W(!1)}},disabled:O,startIcon:O?(0,R.jsx)(M.A,{size:16,color:"inherit"}):null,disableElevation:!0,sx:{"&.Mui-disabled":{backgroundColor:e=>"".concat(e.palette.action.disabledBackground," !important"),color:e=>"".concat(e.palette.text.disabled," !important"),backgroundImage:"none !important",boxShadow:"none",borderColor:"transparent"}},children:O?"Guardando\u2026":"Guardar presupuesto"}),(0,R.jsx)(p.A,{variant:"outlined",onClick:be,children:"Volver"}),(0,R.jsx)(p.A,{variant:"text",onClick:()=>e(-1),children:"Cancelar"})]})]})]})}},38915:(e,t,o)=>{o.d(t,{A:()=>v});var r=o(79722),n=o(35644),i=o(29296),a=o(13658);const s=r.A.create(),l=a.A.PRONOSTICO,c={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let d=null,u=!1;const m=e=>Boolean(e&&l&&String(e).startsWith(String(l))),p=e=>{try{return sessionStorage.getItem(e)}catch(t){return console.warn("No se pudo leer sessionStorage:",t),null}},g=(e,t)=>{try{void 0!==t&&null!==t&&sessionStorage.setItem(e,t)}catch(o){console.warn("No se pudo escribir en sessionStorage:",o)}},h=()=>{if(!u){u=!0;try{sessionStorage.clear()}catch(e){}null!==i.m&&void 0!==i.m&&i.m.limpiarSesion&&i.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},x=()=>{const e=p("refreshToken"),t=(()=>{const e=p("email")||p("username");if(!e||!c.UserPoolId||!c.ClientId)return null;const t=new n.NE(c);return new n.TU({Username:e,Pool:t})})();if(!e||!t)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const o=new n.c9({RefreshToken:e});return new Promise((e,r)=>{t.refreshSession(o,(t,o)=>{if(t)return void r(t);const n=o.getAccessToken().getJwtToken(),i=o.getIdToken().getJwtToken(),a=o.getRefreshToken().getToken();g("accessToken",n),g("idToken",i),a&&g("refreshToken",a),e(n)})})};s.interceptors.request.use(e=>{const t=sessionStorage.getItem("accessToken");if(m(e.url)){var o;e.headers=null!==(o=e.headers)&&void 0!==o?o:{},t&&(e.headers.Authorization="Bearer ".concat(t));const r=sessionStorage.getItem("sub");r&&(e.headers["X-Usuario-Sub"]=r)}return e}),s.interceptors.response.use(e=>e,async e=>{const{config:t,response:o}=e;if(!t||!o||401!==o.status||!m(t.url))return Promise.reject(e);if(t.__isRetryRequest)return h(),Promise.reject(e);try{var r;const e=await(d||(d=x().then(e=>(d=null,e)).catch(e=>{throw d=null,e})),d);if(!e)throw new Error("No se obtuvo un token renovado.");return t.__isRetryRequest=!0,t.headers=null!==(r=t.headers)&&void 0!==r?r:{},t.headers.Authorization="Bearer ".concat(e),s(t)}catch(n){return h(),Promise.reject(n)}});const v=s},67819:(e,t,o)=>{o.d(t,{i:()=>n});var r=o(89826);const n=e=>t=>{var o,n;const i="ingreso"===String(e).toLowerCase()?"#2e7d32":"#d32f2f",a=(0,r.X4)(i,.12),s=(0,r.X4)(i,.16),l=(0,r.X4)(i,.2),c=(t.vars||t).palette,d=c.text.primary,u=null!==(o=null===(n=c.text)||void 0===n?void 0:n.primaryChannel)&&void 0!==o?o:"dark"===t.palette.mode?"255 255 255":"0 0 0",m="&& .MuiOutlinedInput-root",p=["".concat(m," .MuiSelect-select"),"".concat(m," .MuiSelect-select.MuiSelect-outlined"),"".concat(m," .MuiSelect-select.MuiSelect-outlined.MuiInputBase-input"),"".concat(m," .MuiInputBase-input"),"".concat(m," .MuiOutlinedInput-input")].join(", "),g=["".concat(m," .MuiSelect-icon"),"".concat(m," .MuiSelect-iconOutlined"),"".concat(m," .MuiSvgIcon-root")].join(", ");return{[m]:{borderRadius:1,color:d,backgroundColor:a,"--mui-palette-text-primary":d,"--mui-palette-text-secondary":d,"--mui-palette-action-active":d,"--mui-palette-text-primaryChannel":u,"--mui-palette-text-secondaryChannel":u,"--mui-palette-action-activeChannel":u,"&:hover":{backgroundColor:s},"&.Mui-focused":{backgroundColor:l},"& fieldset":{borderColor:c.divider},"&:hover fieldset":{borderColor:c.divider},"&.Mui-focused fieldset":{borderColor:c.divider}},[p]:{color:d,WebkitTextFillColor:d,fontWeight:200},[g]:{color:d},"&& .MuiInputLabel-root, && .MuiInputLabel-root.Mui-focused":{color:d,WebkitTextFillColor:d}}}},92659:(e,t,o)=>{o.d(t,{gd:()=>i});const r=["Alimentos y Bebidas","Transporte","Vivienda","Servicios B\xe1sicos","Ocio y Entretenimiento","Compras Personales","Salud","Educaci\xf3n","Impuestos y Tasas","Servicios Financieros","Compras de Negocio","Otros Egresos"],n=["Ventas de Productos","Prestaci\xf3n de Servicios","Cobranzas","Transferencias Recibidas","Inversiones y Rendimientos","Otros Ingresos"],i=[...r,...n]}}]);
//# sourceMappingURL=5851.7b05ec06.chunk.js.map