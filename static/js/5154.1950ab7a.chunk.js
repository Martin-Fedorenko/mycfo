"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5154],{12807:(e,o,r)=>{r.d(o,{E:()=>i,c:()=>t});const n=new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:2}),t=function(e){let{fallback:o="$\xa00"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e||void 0===e)return o;const r=Number(e);return Number.isNaN(r)?o:n.format(r)},i=function(e){let{fractionDigits:o=0,fallback:r="0%"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e||void 0===e)return r;const n=Number(e);return Number.isNaN(n)?r:"".concat(n.toFixed(o),"%")}},35154:(e,o,r)=>{r.r(o),r.d(o,{default:()=>oo});var n=r(89379),t=r(65043),i=r(53969),a=r(70298),l=r(55895),s=r(53089),d=r(32911),c=r(91449),u=r(12097),m=r(29001),x=r(60267),v=r(86995),g=r(2321),h=r(66693),p=r(13568),A=r(47925),y=r(84138),j=r(74046),b=r(58198),f=r(91244),C=r(16128),S=r(73849),R=r(28572);function T(){var e,o,r,n,t,i,a,l,s,d,c,u,m;const v=(0,x.A)(),{mode:g,systemMode:h}=(0,R.Ut)(),p=("system"===g?h:g)||v.palette.mode||"light",A=null!==(e=null!==(o=null===(r=v.vars)||void 0===r?void 0:r.palette)&&void 0!==o?o:v.palette)&&void 0!==e?e:{};return{resolvedMode:p,paletteVars:A,primaryTextColor:"dark"===p?null!==(n=null!==(t=null===(i=A.common)||void 0===i?void 0:i.white)&&void 0!==t?t:null===(a=A.text)||void 0===a?void 0:a.primary)&&void 0!==n?n:"rgba(255, 255, 255, 0.9)":null!==(l=null!==(s=null===(d=A.common)||void 0===d?void 0:d.black)&&void 0!==s?s:null===(c=A.text)||void 0===c?void 0:c.primary)&&void 0!==l?l:"rgba(0, 0, 0, 0.88)",secondaryTextColor:null!==(u=null===(m=A.text)||void 0===m?void 0:m.secondary)&&void 0!==u?u:"dark"===p?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"}}var w=r(70579);const N=e=>{let{actions:o=[],loading:r=!1,onAction:t}=e;const{resolvedMode:a,primaryTextColor:l}=T(),s="dark"===a;return r?(0,w.jsx)(f.A,{variant:"outlined",sx:{width:"100%"},children:(0,w.jsxs)(C.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,w.jsx)(S.A,{variant:"text",width:160}),(0,w.jsx)(i.A,{sx:{display:"flex",gap:1},children:Array.from({length:4}).map((e,o)=>(0,w.jsx)(S.A,{variant:"rounded",width:120,height:40},o))})]})}):(0,w.jsx)(f.A,{variant:"outlined",sx:{width:"100%",backdropFilter:"blur(6px)",borderRadius:2,mx:"auto"},children:(0,w.jsx)(C.A,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"center"},children:(0,w.jsx)(i.A,{sx:{display:"flex",flexWrap:{xs:"nowrap",md:"wrap"},overflowX:{xs:"auto",md:"visible"},gap:1,pb:{xs:.5,md:0},justifyContent:{xs:"flex-start",md:"center"},alignItems:"center",width:"100%","&::-webkit-scrollbar":{display:"none"}},children:o.map(e=>(0,w.jsx)(u.A,{variant:"outlined",color:"primary",startIcon:e.icon,onClick:()=>null===t||void 0===t?void 0:t(e),sx:(0,n.A)({flexShrink:0,borderRadius:2,px:2,py:1,textTransform:"none",minWidth:{xs:140,md:150},fontWeight:600},s&&{color:"#42897f"}),children:e.label},e.id))})})})},I=e=>e,k=e=>{let{title:o,value:r,formatter:n=I,secondaryLabel:t,secondaryValue:a,secondaryFormatter:s=I,trend:d=[],trendColor:m="primary.main",loading:x=!1,error:v=null,onRetry:g}=e;const{primaryTextColor:h,secondaryTextColor:p}=T();return x?(0,w.jsx)(f.A,{variant:"outlined",sx:{height:"100%"},children:(0,w.jsxs)(C.A,{children:[(0,w.jsx)(S.A,{variant:"text",width:"60%",height:24}),(0,w.jsx)(S.A,{variant:"text",width:"70%",height:36}),(0,w.jsx)(S.A,{variant:"rectangular",width:"100%",height:40,sx:{mt:2}})]})}):v?(0,w.jsx)(f.A,{variant:"outlined",sx:{height:"100%"},children:(0,w.jsxs)(C.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,w.jsx)(c.A,{severity:"error",children:v}),g?(0,w.jsx)(u.A,{variant:"outlined",onClick:g,children:"Reintentar"}):null]})}):null===r||"undefined"===typeof r?(0,w.jsx)(f.A,{variant:"outlined",sx:{height:"100%"},children:(0,w.jsxs)(C.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,w.jsx)(l.A,{variant:"body2",sx:{color:p},children:"Sin datos disponibles para este indicador."}),g?(0,w.jsx)(u.A,{variant:"outlined",onClick:g,children:"Actualizar"}):null]})}):(0,w.jsx)(f.A,{variant:"outlined",sx:{height:"100%"},children:(0,w.jsxs)(C.A,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"space-between",gap:1,px:2,py:1.5},children:[(0,w.jsx)(l.A,{variant:"subtitle2",sx:{color:h,fontSize:{xs:"0.8rem",sm:"0.85rem",md:"0.9rem"}},children:o}),(0,w.jsxs)(i.A,{sx:{textAlign:"right",flexGrow:1,minWidth:0},children:[(0,w.jsx)(l.A,{variant:"h5",fontWeight:600,sx:{color:h,fontSize:{xs:"1.3rem",sm:"1.6rem",md:"1.9rem"},lineHeight:1.1,wordBreak:"break-word"},children:n(r)}),t?(0,w.jsxs)(l.A,{variant:"body2",sx:{color:p},children:[t,":"," ",(0,w.jsx)(i.A,{component:"span",fontWeight:500,children:s(a)})]}):null]})]})})};var E=r(7240),P=r(95563),D=r(26020),_=r(76072),M=r(94527),F=r(38915),O=r(12807),W=r(13658);const L=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],B=e=>{if(!e)return"";const o=String(e).split("-");if(o.length<2)return e;const r=Number(o[0]),n=Number(o[1])-1;return!Number.isFinite(r)||!Number.isFinite(n)||n<0||n>=L.length?e:"".concat(L[n]," ").concat(r)},U=(e,o)=>{const r=B(e),n=B(o);return r&&n?r===n?r:"".concat(r," - ").concat(n):r||n||""},z=e=>encodeURIComponent(String(null!==e&&void 0!==e?e:"").trim().toLowerCase().replace(/\s+/g,"-")),G=e=>{if(!e)return null;const o=String(e).split("-");if(o.length<2)return null;const r=Number(o[0]),n=Number(o[1])-1;return Number.isFinite(r)&&Number.isFinite(n)?new Date(r,n,1):null},H=(e,o)=>{if(!e)return!1;const r=G(e.desde),n=(e=>{const o=G(e);return o?new Date(o.getFullYear(),o.getMonth()+1,0,23,59,59,999):null})(e.hasta);return!(!r||!n)&&(r<=o&&o<=n)},V=e=>{if(null===e||void 0===e)return 0;if("number"===typeof e)return e;if("string"===typeof e){const o=Number(e);return Number.isNaN(o)?0:o}if("object"===typeof e&&null!==e&&"value"in e){const o=Number(e.value);return Number.isNaN(o)?0:o}return 0},K=e=>{if(!e)return[];const o=[{name:"Ingresos",planned:e.ingresoEstimado,actual:e.ingresoReal},{name:"Egresos",planned:e.egresoEstimado,actual:e.egresoReal}];return(Math.abs(e.saldoEstimado)>0||Math.abs(e.saldoReal)>0)&&o.push({name:"Resultado",planned:e.saldoEstimado,actual:e.saldoReal}),o},q=e=>{var o,r;return e?"string"===typeof e?e:null!==e&&void 0!==e&&null!==(o=e.response)&&void 0!==o&&null!==(r=o.data)&&void 0!==r&&r.error?String(e.response.data.error):null!==e&&void 0!==e&&e.message?e.message:"No pudimos cargar el presupuesto actual.":null},X=e=>{var o;let{companyId:r,period:n,data:s,loading:d=!1,error:x=null,onRetry:v}=e;const g=(0,m.Zp)(),{resolvedMode:h,primaryTextColor:p,secondaryTextColor:A}=T(),y="dark"===h,[j,b]=t.useState(!0),[R,N]=t.useState(null),[I,k]=t.useState(null),L="true"==={NODE_ENV:"production",PUBLIC_URL:"/mycfo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AWS_REGION:"sa-east-1",REACT_APP_BASE_URL:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net",REACT_APP_COGNITO_CLIENT_ID:"3ksssqtg3r49rf6js1t1177hrd",REACT_APP_COGNITO_USER_POOL_ID:"sa-east-1_lTMNrWW7R",REACT_APP_URL_ADMINISTRACION:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/administracion",REACT_APP_URL_IA:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/ia",REACT_APP_URL_NOTIFICACION:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/notificacion",REACT_APP_URL_PRONOSTICO:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/pronostico",REACT_APP_URL_REGISTRO:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/registro",REACT_APP_URL_REPORTE:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/reporte",REACT_APP_WEBSOCKET_URL:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/notificacion/ws"}.REACT_APP_USE_MOCKS,B=W.A.PRONOSTICO,G=t.useMemo(()=>{var e;return null!==(e=(e=>{if(!e)return null;const o=String(e).split("-");if(o.length<2)return null;const r=Number(o[0]),n=Number(o[1])-1;return Number.isFinite(r)&&Number.isFinite(n)?new Date(r,n,15):null})(n))&&void 0!==e?e:new Date},[n]),X=t.useCallback(async()=>{if(L)return d&&!s?(b(!0),N(null),void k(null)):(k((e=>{var o,r,n,t,i,a;if(!e)return null;const l=e.slug?encodeURIComponent(String(e.slug)):z(e.name||e.nombre||"");return{id:null!==(o=e.id)&&void 0!==o?o:null,nombre:e.name||e.nombre||"Presupuesto",slug:l,desde:null!==(r=e.desde)&&void 0!==r?r:null,hasta:null!==(n=e.hasta)&&void 0!==n?n:null,rangeLabel:(null===(t=e.period)||void 0===t?void 0:t.label)||U(null!==(i=e.desde)&&void 0!==i?i:null,null!==(a=e.hasta)&&void 0!==a?a:null),categories:Array.isArray(e.categories)?e.categories:[],totals:null}})(s)),N(x?q(x):null),void b(!1));b(!0),N(null);try{const o=new URLSearchParams;o.set("status","active"),o.set("page","0"),o.set("size","100"),o.set("sort","createdAt,desc");const r=await F.A.get("".concat(B,"/api/presupuestos?").concat(o.toString())),n=(e=null===r||void 0===r?void 0:r.data,Array.isArray(e)?e:e&&Array.isArray(e.content)?e.content:[]).find(e=>H(e,G));if(!n)return void k(null);const t=await F.A.get("".concat(B,"/api/presupuestos/").concat(n.id,"/totales")),i=Array.isArray(null===t||void 0===t?void 0:t.data)?t.data:[],a=i.reduce((e,o)=>({ingresoEstimado:e.ingresoEstimado+V(o.ingresoEstimado),ingresoReal:e.ingresoReal+V(o.ingresoReal),egresoEstimado:e.egresoEstimado+V(o.egresoEstimado),egresoReal:e.egresoReal+V(o.egresoReal),saldoEstimado:e.saldoEstimado+V(o.saldoEstimado),saldoReal:e.saldoReal+V(o.saldoReal)}),{ingresoEstimado:0,ingresoReal:0,egresoEstimado:0,egresoReal:0,saldoEstimado:0,saldoReal:0});k({id:n.id,nombre:n.nombre,slug:z(n.nombre),desde:n.desde,hasta:n.hasta,rangeLabel:U(n.desde,n.hasta),categories:K(a),totals:a})}catch(o){N(q(o)),k(null)}finally{b(!1)}var e},[L,d,s,x,B,G]);t.useEffect(()=>{X()},[X]);const Y=t.useCallback(()=>{L&&"function"===typeof v?v():X()},[L,v,X]),J=t.useCallback(()=>{g("/presupuestos")},[g]),Z=t.useCallback(()=>{g("/presupuestos/nuevo")},[g]),Q=t.useCallback(()=>{null!==I&&void 0!==I&&I.slug&&g("/presupuestos/".concat(I.slug))},[g,I]);if(j)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,{title:"Presupuesto actual",subheader:"Cargando datos...",titleTypographyProps:{variant:"h6",sx:{color:p}},subheaderTypographyProps:{variant:"body2",sx:{color:A}}}),(0,w.jsxs)(C.A,{children:[Array.from({length:4}).map((e,o)=>(0,w.jsxs)(a.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1.5},children:[(0,w.jsx)(S.A,{variant:"text",width:"40%"}),(0,w.jsx)(S.A,{variant:"text",width:"20%"})]},o)),(0,w.jsx)(S.A,{variant:"rectangular",height:8})]})]});if(R)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,{title:"Presupuesto actual",titleTypographyProps:{variant:"h6",sx:{color:p}}}),(0,w.jsxs)(C.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,w.jsx)(c.A,{severity:"error",children:R}),Y?(0,w.jsx)(u.A,{variant:"outlined",onClick:Y,children:"Reintentar"}):null]})]});const $=null!==(o=null===I||void 0===I?void 0:I.categories)&&void 0!==o?o:[],ee=I?[I.nombre,I.rangeLabel].filter(Boolean).join(" - "):void 0;return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,{title:"Presupuesto actual",subheader:ee,titleTypographyProps:{variant:"h6",sx:{color:p}},subheaderTypographyProps:{variant:"body2",sx:{color:p}}}),(0,w.jsx)(C.A,{sx:{flexGrow:1},children:I?(0,w.jsxs)(a.A,{spacing:2,children:[I.totals?(0,w.jsxs)(a.A,{direction:"row",justifyContent:"space-between",children:[(0,w.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Saldo estimado:"," ",(0,O.c)(I.totals.saldoEstimado)]}),(0,w.jsxs)(l.A,{variant:"body2",color:"text.secondary",fontWeight:600,children:["Saldo real: ",(0,O.c)(I.totals.saldoReal)]})]}):null,$.length>0?$.map(e=>{const o=Number(e.planned)||0,r=Number(e.actual)||0,n=(e=>e<=.9?{color:"primary",label:"En verde"}:e<=1.1?{color:"primary",label:"Cerca del objetivo"}:{color:"primary",label:"Sobre el plan"})(0===o?0:r/o),t=0===o?0:r/o*100,s=Math.min(t,150),d=s>100?100:Math.max(0,s);return(0,w.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,w.jsxs)(a.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,w.jsx)(l.A,{variant:"subtitle2",children:e.name}),(0,w.jsx)(_.A,{color:n.color,label:"".concat((0,O.E)(t,{fractionDigits:0})," - ").concat(n.label),size:"small",variant:"outlined"})]}),(0,w.jsx)(D.A,{variant:"determinate",value:d,color:n.color,sx:{height:8,borderRadius:999,backgroundColor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:999}}}),(0,w.jsxs)(a.A,{direction:"row",justifyContent:"space-between",children:[(0,w.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Planificado: ",(0,O.c)(o)]}),(0,w.jsxs)(l.A,{variant:"body2",color:"text.secondary",fontWeight:600,children:["Ejecutado: ",(0,O.c)(r)]})]}),(0,w.jsx)(M.A,{sx:{my:.5}})]},e.name)}):(0,w.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No hay datos cargados para este presupuesto."})]}):(0,w.jsxs)(a.A,{spacing:2,children:[(0,w.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"No hay presupuesto actual."}),(0,w.jsxs)(a.A,{direction:"row",spacing:1,children:[(0,w.jsx)(u.A,{variant:"contained",onClick:Z,sx:y?{color:"#42897f"}:void 0,children:"Nuevo presupuesto"}),(0,w.jsx)(u.A,{variant:"text",onClick:J,children:"Ver presupuestos"})]})]})}),I?(0,w.jsx)(P.A,{sx:{justifyContent:"flex-end",px:3,pb:2},children:(0,w.jsxs)(a.A,{direction:"row",spacing:1,children:[(0,w.jsx)(u.A,{variant:"contained",onClick:Q,disabled:!(null!==I&&void 0!==I&&I.slug),children:"Ver m\xe1s"}),(0,w.jsx)(u.A,{variant:"outlined",onClick:Z,sx:y?{color:"#42897f"}:void 0,children:"Nuevo presupuesto"}),(0,w.jsx)(u.A,{variant:"text",onClick:J,children:"Ver presupuestos"})]})}):null]})};var Y=r(50108),J=r(82291),Z=r(87734),Q=r(52185),$=r(6026),ee=r(80379),oe=r(70095),re=r(66163);const ne=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e||0);function te(){const[e,o]=t.useState(!0),[r,n]=t.useState(null),[i,l]=t.useState(null),{primaryTextColor:s,secondaryTextColor:d}=T();return t.useEffect(()=>{const e=W.A.REPORTE;if(!e)return;const r=new Date,t=r.getFullYear(),i=r.getMonth()+1,a={},s=sessionStorage.getItem("sub"),d=sessionStorage.getItem("accessToken");s&&(a["X-Usuario-Sub"]=s),d&&(a.Authorization="Bearer ".concat(d)),o(!0),n(null);const c=fetch("".concat(e,"/cashflow?anio=").concat(t),{headers:a}).then(e=>e.ok?e.json():Promise.reject("HTTP ".concat(e.status))).then(e=>{const o=Array.isArray(e)?e:[];return{ingresos:o.filter(e=>"Ingreso"===e.tipo&&new Date(e.fechaEmision).getMonth()+1===i).reduce((e,o)=>e+(o.montoTotal||0),0),egresos:o.filter(e=>"Egreso"===e.tipo&&new Date(e.fechaEmision).getMonth()+1===i).reduce((e,o)=>e+(o.montoTotal||0),0)}}),u=new URLSearchParams;u.set("anio",t);const m=fetch("".concat(e,"/pyl?").concat(u.toString()),{headers:a}).then(e=>e.ok?e.json():Promise.reject("HTTP ".concat(e.status))).then(e=>{var o,r;const n=i-1;return{ingresos:(null!==(o=null===e||void 0===e?void 0:e.ingresosMensuales)&&void 0!==o?o:[])[n]||0,egresos:(null!==(r=null===e||void 0===e?void 0:e.egresosMensuales)&&void 0!==r?r:[])[n]||0}});Promise.all([c,m]).then(e=>{let[o,r]=e;const n=[{name:"Ingresos",Reales:o.ingresos,Devengado:r.ingresos},{name:"Egresos",Reales:o.egresos,Devengado:r.egresos}];l({dataset:n,cash:o,accrual:r})}).catch(e=>n(String(e))).finally(()=>o(!1))},[]),(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,{title:"Caja vs Devengado (\xfaltimo mes)",subheader:"Comparativo de ingresos y egresos para detectar gaps",titleTypographyProps:{variant:"h6",sx:{color:s}},subheaderTypographyProps:{variant:"body2",sx:{color:s}}}),(0,w.jsx)(C.A,{sx:{flexGrow:1},children:e?(0,w.jsx)(S.A,{variant:"rectangular",height:220}):r?(0,w.jsx)(c.A,{severity:"error",children:r}):i?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Y.u,{width:"100%",height:240,children:(0,w.jsxs)(J.E,{data:i.dataset,margin:{top:8,right:16,bottom:8,left:0},children:[(0,w.jsx)(Z.d,{strokeDasharray:"3 3",stroke:"#E0E0E0"}),(0,w.jsx)(Q.W,{dataKey:"name"}),(0,w.jsx)($.h,{}),(0,w.jsx)(ee.m,{formatter:e=>ne(e)}),(0,w.jsx)(oe.s,{}),(0,w.jsx)(re.y,{dataKey:"Reales",fill:"#2e7d32"}),(0,w.jsx)(re.y,{dataKey:"Devengado",fill:"#0288d1"})]})}),(0,w.jsxs)(a.A,{direction:"row",spacing:2,sx:{mt:2},flexWrap:"wrap",children:[(0,w.jsx)(ie,{label:"Gap Ingresos",value:ne((i.accrual.ingresos||0)-(i.cash.ingresos||0))}),(0,w.jsx)(ie,{label:"Gap Egresos",value:ne((i.accrual.egresos||0)-(i.cash.egresos||0))})]})]}):null})]})}const ie=e=>{var o,r;let{label:n,value:t}=e;const{primaryTextColor:i,secondaryTextColor:a,paletteVars:s,resolvedMode:d}=T(),c=null!==(o=null===(r=s.action)||void 0===r?void 0:r.hover)&&void 0!==o?o:"dark"===d?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.05)";return(0,w.jsxs)("div",{style:{padding:"6px 12px",borderRadius:8,background:c},children:[(0,w.jsx)(l.A,{variant:"caption",sx:{color:i},children:n}),(0,w.jsx)(l.A,{variant:"body2",fontWeight:600,sx:{color:i},children:t})]})};var ae=r(87443),le=r(34375),se=r(81341),de=r(28259),ce=r(10756),ue=r(86172);const me={ingreso:{color:"#1b5e20",backgroundColor:"rgba(46, 125, 50, 0.12)"},egreso:{color:"#b71c1c",backgroundColor:"rgba(198, 40, 40, 0.12)"},deuda:{color:"#37474f",backgroundColor:"rgba(55, 71, 79, 0.12)"},acreencia:{color:"#01579b",backgroundColor:"rgba(1, 87, 155, 0.12)"},transferencia:{color:"#4a148c",backgroundColor:"rgba(74, 20, 140, 0.12)"}},xe=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ARS";const r=Number(e);if(!Number.isFinite(r))return"-";try{return new Intl.NumberFormat("es-AR",{style:"currency",currency:o||"ARS",minimumFractionDigits:2,maximumFractionDigits:2}).format(r)}catch(n){return"".concat(r.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2})," ").concat(o||"").trim()}},ve=e=>{if(!e)return"-";const o=new Date(e);return Number.isNaN(o.getTime())?"-":o.toLocaleDateString("es-AR",{day:"2-digit",month:"short"})},ge=e=>{let{data:o,loading:r=!1,error:i=null,onRetry:s,onNavigate:d}=e;const{resolvedMode:m,primaryTextColor:x,secondaryTextColor:v}=T(),g="dark"===m,h=t.useMemo(()=>({titleTypographyProps:{variant:"h6",sx:{color:x}},subheaderTypographyProps:{variant:"body2",sx:{color:x}}}),[x]);if(r)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,(0,n.A)({title:"Movimientos",subheader:"Cargando..."},h)),(0,w.jsx)(C.A,{children:(0,w.jsx)(S.A,{variant:"rectangular",height:180})})]});if(i)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,(0,n.A)({title:"Movimientos"},h)),(0,w.jsxs)(C.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,w.jsx)(c.A,{severity:"error",children:i}),s?(0,w.jsx)(u.A,{variant:"outlined",onClick:s,children:"Reintentar"}):null]})]});const p=Array.isArray(o)?o:[];return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,(0,n.A)({title:"Movimientos",subheader:"\xdaltimos movimientos registrados"},h)),(0,w.jsx)(C.A,{sx:{flexGrow:1},children:0===p.length?(0,w.jsxs)(a.A,{spacing:2,alignItems:"flex-start",children:[(0,w.jsx)(l.A,{variant:"body2",sx:{color:v},children:"Todav\xeda no hay movimientos para mostrar. Registra un ingreso o egreso para verlos aqu\xed."}),s?(0,w.jsx)(u.A,{variant:"outlined",onClick:s,children:"Actualizar"}):null]}):(0,w.jsx)(de.A,{children:(0,w.jsxs)(ae.A,{size:"small",children:[(0,w.jsx)(ce.A,{children:(0,w.jsxs)(ue.A,{children:[(0,w.jsx)(se.A,{children:"Tipo"}),(0,w.jsx)(se.A,{align:"right",children:"Monto"}),(0,w.jsx)(se.A,{children:"Fecha"}),(0,w.jsx)(se.A,{children:"Categor\xeda"})]})}),(0,w.jsx)(le.A,{children:p.map((e,o)=>{var r,n,t;const i=null!==(r=e.id)&&void 0!==r?r:"movement-".concat(o),a=null!==(n=e.tipo)&&void 0!==n?n:"Movimiento",s=e.categoria||"Sin categor\xeda",d=(null!==(t=e.montoTotal)&&void 0!==t?t:0)<0?"error.main":"success.main",c=(e=>{var o;if(!e)return{color:"#424242",backgroundColor:"rgba(66, 66, 66, 0.1)"};const r=String(e).toLowerCase();return null!==(o=me[r])&&void 0!==o?o:{color:"#424242",backgroundColor:"rgba(66, 66, 66, 0.1)"}})(a);return(0,w.jsxs)(ue.A,{hover:!0,children:[(0,w.jsx)(se.A,{children:(0,w.jsx)(_.A,{label:a,size:"small",sx:{fontWeight:600,color:c.color,backgroundColor:c.backgroundColor,border:"1px solid ".concat(c.color)}})}),(0,w.jsx)(se.A,{align:"right",sx:{color:d,fontWeight:600},children:xe(e.montoTotal,e.moneda)}),(0,w.jsx)(se.A,{children:(0,w.jsx)(l.A,{variant:"body2",children:ve(e.fechaEmision)})}),(0,w.jsx)(se.A,{children:(0,w.jsx)(l.A,{variant:"body2",sx:{color:v},children:s})})]},i)})})]})})}),(0,w.jsx)(P.A,{sx:{px:3,pb:2,gap:1},children:(0,w.jsx)(u.A,{variant:"outlined",onClick:d,disabled:!d,sx:g?{color:"#42897f"}:void 0,children:"Ver m\xe1s"})})]})},he={venta:{color:"#1b5e20",backgroundColor:"rgba(46, 125, 50, 0.12)"},compra:{color:"#b71c1c",backgroundColor:"rgba(198, 40, 40, 0.12)"}},pe=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ARS";const r=Number(e);if(!Number.isFinite(r))return"-";try{return new Intl.NumberFormat("es-AR",{style:"currency",currency:o||"ARS",minimumFractionDigits:2,maximumFractionDigits:2}).format(r)}catch(n){return"".concat(r.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2})," ").concat(o||"").trim()}},Ae=e=>{if(!e)return"-";const o=new Date(e);return Number.isNaN(o.getTime())?"-":o.toLocaleDateString("es-AR",{day:"2-digit",month:"short"})},ye=e=>{let{data:o,loading:r=!1,error:i=null,onRetry:s,onNavigate:d}=e;const{resolvedMode:m,primaryTextColor:x,secondaryTextColor:v}=T(),g="dark"===m,h=t.useMemo(()=>({titleTypographyProps:{variant:"h6",sx:{color:x}},subheaderTypographyProps:{variant:"body2",sx:{color:x}}}),[x]);if(r)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,(0,n.A)({title:"Facturas",subheader:"Cargando..."},h)),(0,w.jsx)(C.A,{children:(0,w.jsx)(S.A,{variant:"rectangular",height:180})})]});if(i)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,(0,n.A)({title:"Facturas"},h)),(0,w.jsxs)(C.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,w.jsx)(c.A,{severity:"error",children:i}),s?(0,w.jsx)(u.A,{variant:"outlined",onClick:s,children:"Reintentar"}):null]})]});const p=Array.isArray(o)?o:[];return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,(0,n.A)({title:"Facturas",subheader:"\xdaltimas facturas registradas"},h)),(0,w.jsx)(C.A,{sx:{flexGrow:1},children:0===p.length?(0,w.jsxs)(a.A,{spacing:2,alignItems:"flex-start",children:[(0,w.jsx)(l.A,{variant:"body2",sx:{color:v},children:"Todav\xeda no hay facturas para mostrar. Carga una factura para verla ac\xe1."}),s?(0,w.jsx)(u.A,{variant:"outlined",onClick:s,children:"Actualizar"}):null]}):(0,w.jsx)(de.A,{children:(0,w.jsxs)(ae.A,{size:"small",children:[(0,w.jsx)(ce.A,{children:(0,w.jsxs)(ue.A,{children:[(0,w.jsx)(se.A,{children:"Tipo"}),(0,w.jsx)(se.A,{children:"N\xfamero"}),(0,w.jsx)(se.A,{align:"right",children:"Monto"}),(0,w.jsx)(se.A,{children:"Fecha"}),(0,w.jsx)(se.A,{children:"Cliente"})]})}),(0,w.jsx)(le.A,{children:p.map((e,o)=>{var r,n,t,i;const a=null!==(r=e.id)&&void 0!==r?r:"invoice-".concat(o),s=null!==(n=e.tipoFactura)&&void 0!==n?n:"Factura",d=null!==(t=e.numeroDocumento)&&void 0!==t?t:"-",c=e.compradorNombre||e.vendedorNombre||"Sin dato",u=(null!==(i=e.montoTotal)&&void 0!==i?i:0)<0?"error.main":"success.main",m=(e=>{var o;if(!e)return{color:"#424242",backgroundColor:"rgba(66, 66, 66, 0.1)"};const r=String(e).toLowerCase();return null!==(o=he[r])&&void 0!==o?o:{color:"#424242",backgroundColor:"rgba(66, 66, 66, 0.1)"}})(s);return(0,w.jsxs)(ue.A,{hover:!0,children:[(0,w.jsx)(se.A,{children:(0,w.jsx)(_.A,{label:s,size:"small",sx:{fontWeight:600,color:m.color,backgroundColor:m.backgroundColor,border:"1px solid ".concat(m.color)}})}),(0,w.jsx)(se.A,{children:(0,w.jsx)(l.A,{variant:"body2",children:d})}),(0,w.jsx)(se.A,{align:"right",sx:{color:u,fontWeight:600},children:pe(e.montoTotal,e.moneda)}),(0,w.jsx)(se.A,{children:(0,w.jsx)(l.A,{variant:"body2",children:Ae(e.fechaEmision)})}),(0,w.jsx)(se.A,{children:(0,w.jsx)(l.A,{variant:"body2",sx:{color:v},children:c})})]},a)})})]})})}),(0,w.jsx)(P.A,{sx:{px:3,pb:2,gap:1},children:(0,w.jsx)(u.A,{variant:"outlined",onClick:d,disabled:!d,sx:g?{color:"#42897f"}:void 0,children:"Ver m\xe1s"})})]})},je=new Intl.NumberFormat("es-AR",{maximumFractionDigits:0}),be=e=>{if(null===e||void 0===e)return"--";const o=Number(e);return Number.isFinite(o)?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}).format(o):"--"},fe=new Intl.NumberFormat("es-AR",{minimumFractionDigits:0,maximumFractionDigits:1}),Ce=e=>{const o=Number(e);return Number.isFinite(o)?Math.min(Math.max(o,0),100):0},Se=e=>"".concat(fe.format(Ce(e)),"%"),Re=e=>e?String(e):"--",Te=e=>{var o,r,n;let{data:t,loading:s=!1,error:d=null,onRetry:m,onNavigate:x}=e;const{resolvedMode:v}=T(),g="dark"===v;if(s)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,{title:"Conciliaci\xf3n bancaria",subheader:"Sincronizando movimientos..."}),(0,w.jsx)(C.A,{children:Array.from({length:3}).map((e,o)=>(0,w.jsx)(S.A,{variant:"rectangular",height:48,sx:{mb:1.5}},o))})]});if(d)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,{title:"Conciliaci\xf3n bancaria"}),(0,w.jsxs)(C.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:2},children:[(0,w.jsx)(c.A,{severity:"error",children:d}),m?(0,w.jsx)(u.A,{variant:"outlined",onClick:m,children:"Reintentar"}):null]})]});const h=null!==t&&void 0!==t?t:null,p=Ce(null===h||void 0===h?void 0:h.porcentajeConciliados),A=Array.isArray(null===h||void 0===h?void 0:h.porTipo)?[...h.porTipo]:[];A.sort((e,o)=>{var r,n;return(Number(null!==(r=null===o||void 0===o?void 0:o.total)&&void 0!==r?r:0)||0)-(Number(null!==(n=null===e||void 0===e?void 0:e.total)&&void 0!==n?n:0)||0)});const y=h&&h.totalMovimientos?100*h.conciliados/(h.totalMovimientos||1):0,j=h&&h.totalMovimientos?100*h.pendientes/(h.totalMovimientos||1):0,b=(e,o,r)=>(0,w.jsxs)(a.A,{spacing:.5,sx:{p:1.25,borderRadius:1.5,border:"1px solid",borderColor:"divider",minWidth:0,flex:1},children:[(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e}),(0,w.jsx)(l.A,{variant:"subtitle1",fontWeight:600,children:o}),r?(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:r}):null]},e);return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,{title:"Conciliaci\xf3n bancaria",subheader:null!==h&&void 0!==h&&h.periodLabel?"Per\xedodo ".concat(h.periodLabel):"Resumen del \xfaltimo per\xedodo"}),(0,w.jsx)(C.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:2},children:h?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(a.A,{direction:{xs:"column",sm:"row"},spacing:1.5,sx:{alignItems:{xs:"stretch",sm:"flex-start"}},children:[b("Movimientos",je.format(null!==(o=h.totalMovimientos)&&void 0!==o?o:0),"Total del per\xedodo"),b("Conciliados",je.format(null!==(r=h.conciliados)&&void 0!==r?r:0),Se(y)),b("Pendientes",je.format(null!==(n=h.pendientes)&&void 0!==n?n:0),Se(j))]}),(0,w.jsxs)(i.A,{children:[(0,w.jsxs)(a.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:.75},children:[(0,w.jsx)(l.A,{variant:"subtitle2",children:"Avance general"}),(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:Se(p)})]}),(0,w.jsx)(D.A,{variant:"determinate",value:p,sx:{height:10,borderRadius:999,backgroundColor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:999}}})]}),(0,w.jsxs)(a.A,{spacing:.5,children:[(0,w.jsx)(l.A,{variant:"subtitle2",children:"\xdaltimas referencias"}),(0,w.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["\xdaltima conciliaci\xf3n: ",Re(h.ultimaConciliacion)]}),(0,w.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["\xdaltimo movimiento pendiente: ",Re(h.ultimoPendiente)]})]}),(0,w.jsxs)(a.A,{spacing:1,children:[(0,w.jsx)(l.A,{variant:"subtitle2",children:"Detalle por tipo"}),A.length>0?A.map(e=>{var o,r,n,t,i;const s=Ce(null!==(o=null===e||void 0===e?void 0:e.porcentaje)&&void 0!==o?o:0);return(0,w.jsxs)(a.A,{spacing:.5,sx:{border:"1px solid",borderColor:"divider",borderRadius:1.5,p:1.25},children:[(0,w.jsxs)(a.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,w.jsx)(l.A,{variant:"body2",fontWeight:600,children:null!==(n=null===e||void 0===e?void 0:e.tipo)&&void 0!==n?n:"Sin tipo"}),(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:Se(s)})]}),(0,w.jsx)(D.A,{variant:"determinate",value:s,sx:{height:8,borderRadius:999,backgroundColor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:999}}}),(0,w.jsxs)(a.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,w.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[je.format(null!==(t=null===e||void 0===e?void 0:e.conciliados)&&void 0!==t?t:0)," /"," ",je.format(null!==(i=null===e||void 0===e?void 0:e.total)&&void 0!==i?i:0)," conciliados"]}),void 0!==(null===e||void 0===e?void 0:e.montoTotal)&&null!==(null===e||void 0===e?void 0:e.montoTotal)&&(0,w.jsx)(l.A,{variant:"body2",fontWeight:700,sx:{color:"Egreso"===e.tipo||e.montoTotal<0?"error.main":"success.main"},children:be(e.montoTotal)})]})]},null!==(r=null===e||void 0===e?void 0:e.tipo)&&void 0!==r?r:"tipo-desconocido")}):(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"No hay movimientos clasificados por tipo en este per\xedodo."})]})]}):(0,w.jsxs)(a.A,{spacing:2,alignItems:"flex-start",children:[(0,w.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Todav\xeda no hay movimientos que analizar en este per\xedodo. Carga o importa operaciones para comenzar a conciliarlas."}),m?(0,w.jsx)(u.A,{variant:"outlined",onClick:m,children:"Actualizar"}):null]})}),(0,w.jsx)(P.A,{sx:{px:3,pb:2},children:(0,w.jsx)(u.A,{variant:"outlined",onClick:()=>null===x||void 0===x?void 0:x(),disabled:!x,sx:g?{color:"#42897f"}:void 0,children:"Ir a conciliaci\xf3n"})})]})};var we=r(877),Ne=r(35963),Ie=r(89826);const ke=e=>{if(null===e||void 0===e)return"--";const o=Number(e);return Number.isFinite(o)?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}).format(o):"--"},Ee=(new Intl.NumberFormat("es-AR",{maximumFractionDigits:0}),(e,o)=>{if(!e){const e=new Date(2e3,o%12,1);return new Intl.DateTimeFormat("es-AR",{month:"long"}).format(e)}const r=String(e).trim().toLowerCase(),n={ene:"enero",feb:"febrero",mar:"marzo",abr:"abril",may:"mayo",jun:"junio",jul:"julio",ago:"agosto",sep:"septiembre",oct:"octubre",nov:"noviembre",dic:"diciembre",january:"enero",february:"febrero",march:"marzo",april:"abril",june:"junio",july:"julio",august:"agosto",september:"septiembre",october:"octubre",november:"noviembre",december:"diciembre"};if(n[r])return n[r];const t=Date.parse("".concat(r," 1, 2020"));if(Number.isNaN(t)){const e=new Date(2e3,o%12,1);return new Intl.DateTimeFormat("es-AR",{month:"long"}).format(e)}return new Intl.DateTimeFormat("es-AR",{month:"long"}).format(t)}),Pe=e=>{var o,r,n,t,s,d,u,m,v,g;let{data:h,loading:p=!1,error:A=null,emptyMessage:y}=e;const j=(0,x.A)(),{primaryTextColor:b,secondaryTextColor:R}=T();var N,I;if(p)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,{title:null!==(N=null===h||void 0===h?void 0:h.title)&&void 0!==N?N:"Ingresos durante el per\xedodo",subheader:"Generando serie..."}),(0,w.jsxs)(C.A,{children:[(0,w.jsx)(S.A,{variant:"text",width:"60%"}),(0,w.jsx)(S.A,{variant:"text",width:"40%"}),(0,w.jsx)(S.A,{variant:"rectangular",height:220,sx:{mt:2}})]})]});if(A)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,{title:null!==(I=null===h||void 0===h?void 0:h.title)&&void 0!==I?I:"Ingresos durante el per\xedodo"}),(0,w.jsx)(C.A,{children:(0,w.jsx)(c.A,{severity:"error",children:A})})]});const k=(null!==(o=null===h||void 0===h?void 0:h.points)&&void 0!==o?o:[]).map((e,o)=>{var r;return{name:Ee(e.month,e.monthIndex),value:null!==(r=e.value)&&void 0!==r?r:0}}),P=null!==(r=null!==y&&void 0!==y?y:null===h||void 0===h?void 0:h.emptyMessage)&&void 0!==r?r:"No hay ingresos registrados en este per\xedodo.",D=k.length>0&&k.some(e=>0!==e.value);return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",minHeight:520,display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,{title:null!==(n=null===h||void 0===h?void 0:h.title)&&void 0!==n?n:"Ingresos durante el per\xedodo",subheader:null!==(t=null===h||void 0===h?void 0:h.subheader)&&void 0!==t?t:"Serie mensual de ingresos registrados en los \xfaltimos 12 meses.",titleTypographyProps:{variant:"h6",fontWeight:600,sx:{color:b}},subheaderTypographyProps:{variant:"body2",sx:{color:b}},action:(0,w.jsxs)(a.A,{direction:"row",spacing:2,alignItems:"flex-start",sx:{pr:2.5,pt:.5,flexWrap:"wrap",rowGap:1,justifyContent:"flex-end","& .MuiTypography-overline":{letterSpacing:.6}},children:[(0,w.jsxs)(a.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,w.jsx)(l.A,{variant:"overline",sx:{color:b},children:"Maximo"}),(0,w.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:b},children:ke(null===h||void 0===h||null===(s=h.max)||void 0===s?void 0:s.value)}),(0,w.jsx)(l.A,{variant:"caption",sx:{color:b},children:null!==(d=null===h||void 0===h||null===(u=h.max)||void 0===u?void 0:u.label)&&void 0!==d?d:"--"})]}),(0,w.jsx)(M.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,w.jsxs)(a.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,w.jsx)(l.A,{variant:"overline",sx:{color:b},children:"Minimo"}),(0,w.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:b},children:ke(null===h||void 0===h||null===(m=h.min)||void 0===m?void 0:m.value)}),(0,w.jsx)(l.A,{variant:"caption",sx:{color:b},children:null!==(v=null===h||void 0===h||null===(g=h.min)||void 0===g?void 0:g.label)&&void 0!==v?v:"--"})]}),(0,w.jsx)(M.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,w.jsxs)(a.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,w.jsx)(l.A,{variant:"overline",sx:{color:b},children:"Promedio"}),(0,w.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:b},children:ke(null===h||void 0===h?void 0:h.average)}),(0,w.jsx)(l.A,{variant:"caption",sx:{color:b},children:"\xdaltimos 12 meses"})]})]}),sx:{py:2,"& .MuiCardHeader-content":{gap:.25,alignSelf:"flex-start"},"& .MuiCardHeader-action":{mt:0}}}),(0,w.jsx)(C.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",px:{xs:1,md:1.5},pt:{xs:.9,md:1.25},pb:{xs:2.1,md:2.35}},children:(0,w.jsx)(i.A,{sx:{width:"100%",height:350,mt:{xs:1,md:2}},children:D?(0,w.jsx)(Y.u,{width:"100%",height:"100%",children:(0,w.jsxs)(we.Q,{data:k,margin:{top:10,right:10,left:0,bottom:10},children:[(0,w.jsx)("defs",{children:(0,w.jsxs)("linearGradient",{id:"colorValue",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:j.palette.primary.main,stopOpacity:.3}),(0,w.jsx)("stop",{offset:"95%",stopColor:j.palette.primary.main,stopOpacity:0})]})}),(0,w.jsx)(Z.d,{strokeDasharray:"3 3",stroke:(0,Ie.X4)(j.palette.divider,.3)}),(0,w.jsx)(Q.W,{dataKey:"name",tick:{fill:b,fontSize:9},angle:-40,textAnchor:"end",height:45,interval:0}),(0,w.jsx)($.h,{tick:{fill:b,fontSize:9},tickFormatter:e=>ke(e),width:80}),(0,w.jsx)(ee.m,{contentStyle:{backgroundColor:j.palette.background.paper,border:"1px solid ".concat(j.palette.divider),borderRadius:8},labelStyle:{color:b},formatter:e=>[ke(e),"Valor"]}),(0,w.jsx)(Ne.Gk,{type:"monotone",dataKey:"value",stroke:j.palette.primary.main,strokeWidth:3,fill:"url(#colorValue)",dot:{fill:j.palette.primary.main,r:4},activeDot:{r:6}})]})}):(0,w.jsx)(i.A,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:2,border:"1px dashed",borderColor:"divider",color:R,typography:"body2"},children:P})})})]})};var De=r(17869);const _e=e=>{if(null===e||void 0===e)return"--";const o=Number(e);return Number.isFinite(o)?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}).format(o):"--"},Me=e=>{var o,r,n,t,s,d;let{data:u=[],loading:m=!1,error:v=null,emptyMessage:g="No hay datos para mostrar por categor\xeda en este per\xedodo.",title:h="Ingresos por categor\xedas",subtitle:p="Distribuci\xf3n anual por segmento"}=e;const A=(0,x.A)(),{primaryTextColor:y,secondaryTextColor:j}=T();if(m)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,{title:h,subheader:"Armando ranking..."}),(0,w.jsx)(C.A,{children:(0,w.jsx)(a.A,{spacing:1,children:Array.from({length:6}).map((e,o)=>(0,w.jsx)(S.A,{variant:"rectangular",height:24},o))})})]});if(v)return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%"},children:[(0,w.jsx)(E.A,{title:h}),(0,w.jsx)(C.A,{children:(0,w.jsx)(c.A,{severity:"error",children:v})})]});const b=Array.isArray(u)&&u.length>0,R=(b?u:[]).map(e=>{var o;return{name:null!==(o=e.category)&&void 0!==o?o:"Sin categor\xeda",value:Number(e.value)||0}});let N=null,I=null,k=null;if(b){const e=R.map(e=>e.value),o=e.reduce((e,o)=>e+o,0);k=e.length>0?o/e.length:null;const r=[...R].sort((e,o)=>o.value-e.value);N=r[0]?{category:r[0].name,value:r[0].value}:null,I=r[r.length-1]?{category:r[r.length-1].name,value:r[r.length-1].value}:null}return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",minHeight:520,display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,{title:h,subheader:p,titleTypographyProps:{variant:"h6",fontWeight:600,sx:{color:y}},subheaderTypographyProps:{variant:"body2",sx:{color:y}},action:b?(0,w.jsxs)(a.A,{direction:"row",spacing:2,alignItems:"flex-start",sx:{pr:2.5,pt:.5,flexWrap:"wrap",rowGap:1,justifyContent:"flex-end","& .MuiTypography-overline":{letterSpacing:.6}},children:[(0,w.jsxs)(a.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,w.jsx)(l.A,{variant:"overline",sx:{color:y},children:"Categor\xeda superior"}),(0,w.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:y},children:_e(null===(o=N)||void 0===o?void 0:o.value)}),(0,w.jsx)(l.A,{variant:"caption",sx:{color:y},children:null!==(r=null===(n=N)||void 0===n?void 0:n.category)&&void 0!==r?r:"--"})]}),(0,w.jsx)(M.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,w.jsxs)(a.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,w.jsx)(l.A,{variant:"overline",sx:{color:y},children:"Categor\xeda menor"}),(0,w.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:y},children:_e(null===(t=I)||void 0===t?void 0:t.value)}),(0,w.jsx)(l.A,{variant:"caption",sx:{color:y},children:null!==(s=null===(d=I)||void 0===d?void 0:d.category)&&void 0!==s?s:"--"})]}),(0,w.jsx)(M.A,{flexItem:!0,orientation:"vertical",sx:{alignSelf:"stretch",borderColor:"divider",mx:.5}}),(0,w.jsxs)(a.A,{spacing:.5,alignItems:"flex-end",sx:{minWidth:120},children:[(0,w.jsx)(l.A,{variant:"overline",sx:{color:y},children:"Promedio"}),(0,w.jsx)(l.A,{variant:"subtitle2",fontWeight:600,sx:{color:y},children:_e(k)}),(0,w.jsxs)(l.A,{variant:"caption",sx:{color:y},children:[R.length," categor\xedas"]})]})]}):null,sx:{py:2,"& .MuiCardHeader-content":{gap:.25,alignSelf:"flex-start"},"& .MuiCardHeader-action":{mt:0}}}),(0,w.jsx)(C.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",px:{xs:1,md:1.5},pt:{xs:.9,md:1.25},pb:{xs:2.1,md:2.35}},children:b?(0,w.jsx)(i.A,{sx:{width:"100%",height:350,mt:{xs:1,md:2}},children:(0,w.jsx)(Y.u,{width:"100%",height:"100%",children:(0,w.jsxs)(J.E,{data:R,margin:{top:10,right:10,left:0,bottom:10},children:[(0,w.jsx)(Z.d,{strokeDasharray:"3 3",stroke:(0,Ie.X4)(A.palette.divider,.3)}),(0,w.jsx)(Q.W,{dataKey:"name",tick:{fill:y,fontSize:9},angle:-40,textAnchor:"end",height:60,interval:0}),(0,w.jsx)($.h,{tick:{fill:y,fontSize:9},tickFormatter:e=>_e(e),width:80}),(0,w.jsx)(ee.m,{contentStyle:{backgroundColor:A.palette.background.paper,border:"1px solid ".concat(A.palette.divider),borderRadius:8},labelStyle:{color:y},formatter:e=>[_e(e),"Valor"]}),(0,w.jsx)(re.y,{dataKey:"value",fill:A.palette.primary.main,radius:[8,8,0,0],children:R.map((e,o)=>(0,w.jsx)(De.f,{fill:(0,Ie.X4)(A.palette.primary.main,.85)},"cell-".concat(o)))})]})})}):(0,w.jsx)(i.A,{sx:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",px:{xs:2.5,md:3}},children:(0,w.jsx)(l.A,{variant:"body2",textAlign:"center",sx:{color:j},children:g})})})]})},Fe=()=>{const[e,o]=t.useState(!1),[r,n]=t.useState(null),[i,s]=t.useState(null),d=i&&"string"===typeof i.diagnostico_corto?i.diagnostico_corto.split(/\n+/).map(e=>e.trim()).filter(Boolean):[],m=i&&i.senales?Object.entries(i.senales).filter(e=>{let[,o]=e;return Boolean(o)}):[],x=i&&i.detalles?Object.values(i.detalles).filter(e=>"string"===typeof e&&e.trim().length>0):[],v=Array.isArray(null===i||void 0===i?void 0:i.riesgos_clave)&&i.riesgos_clave.length>0?i.riesgos_clave.filter(Boolean):[],g=Array.isArray(null===i||void 0===i?void 0:i.tips)&&i.tips.length>0?i.tips.filter(Boolean):[];return(0,w.jsxs)(f.A,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,w.jsx)(E.A,{title:"An\xe1lisis IA",subheader:"Diagn\xf3stico autom\xe1tico de tu situaci\xf3n"}),(0,w.jsx)(C.A,{sx:{flexGrow:1},children:e?(0,w.jsx)(S.A,{variant:"rectangular",height:180}):r?(0,w.jsx)(c.A,{severity:"error",children:r}):i?(0,w.jsxs)(a.A,{spacing:1,children:[i.alerta?(0,w.jsx)(c.A,{severity:"warning",variant:"outlined",children:"Indicadores financieros en observacion."}):null,d.length>0?d.map((e,o)=>(0,w.jsx)(l.A,{variant:"body2",children:e},o)):(0,w.jsx)(l.A,{variant:"body2",children:"No hay resumen disponible."}),x.length>0?(0,w.jsxs)(a.A,{spacing:.25,children:[(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Detalle del mes"}),x.map((e,o)=>(0,w.jsxs)(l.A,{variant:"body2",children:["- ",e]},"det-".concat(o)))]}):null,m.length>0?(0,w.jsxs)(a.A,{spacing:.25,children:[(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Se\xf1ales"}),m.map(e=>{let[o,r]=e;return(0,w.jsxs)(l.A,{variant:"body2",children:[(0,w.jsxs)("b",{children:[o.charAt(0).toUpperCase()+o.slice(1),":"]})," ",r]},o)})]}):null,v.length>0?(0,w.jsxs)(a.A,{spacing:.25,children:[(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Riesgos clave"}),v.map((e,o)=>(0,w.jsxs)(l.A,{variant:"body2",children:["- ",e]},"risk-".concat(o)))]}):null,g.length>0?(0,w.jsxs)(a.A,{spacing:.25,children:[(0,w.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Recomendaciones"}),g.slice(0,4).map((e,o)=>(0,w.jsxs)(l.A,{variant:"body2",children:["- ",e]},"tip-".concat(o)))]}):null]}):(0,w.jsx)(l.A,{variant:"body2",color:"text.secondary",children:'Presiona "Interpretar situaci\xf3n" para obtener el an\xe1lisis con IA.'})}),(0,w.jsx)(P.A,{sx:{px:2,pb:2,justifyContent:"flex-end",alignItems:"center"},children:(0,w.jsx)(u.A,{variant:"contained",onClick:async()=>{o(!0),n(null),s(null);try{const e=W.A.IA,o=new Date,r=new URLSearchParams;r.set("anio",o.getFullYear()),r.set("mes",o.getMonth()+1);const n={"Content-Type":"application/json"},t=sessionStorage.getItem("sub"),i=sessionStorage.getItem("accessToken");t&&(n["X-Usuario-Sub"]=t),i&&(n.Authorization="Bearer ".concat(i));const a=await fetch("".concat(e,"/ia/insights?").concat(r.toString()),{method:"POST",headers:n});if(!a.ok)throw new Error("HTTP ".concat(a.status));const l=await a.json();s(l)}catch(e){n(String(e))}finally{o(!1)}},disabled:e,children:"Interpretar situaci\xf3n"})})]})},Oe=async function(){let{period:e,months:o=12,limitMovements:r=6,limitInvoices:n=6}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(()=>{if("undefined"===typeof window)return null;try{return window.sessionStorage.getItem("sub")}catch(e){return console.error("No se pudo acceder a sessionStorage:",e),null}})();if(!t)throw new Error("No encontramos el usuario en la sesi\xf3n.");const i=new URLSearchParams;if(e){const[o,r]=e.split("-");o&&r&&i.set("fecha","".concat(o,"-").concat(r,"-01"))}o&&i.set("meses",String(o)),r&&i.set("limiteMovimientos",String(r)),n&&i.set("limiteFacturas",String(n));const a="".concat(W.A.REGISTRO,"/movimientos/resumen/dashboard").concat(i.toString()?"?".concat(i.toString()):""),l=await fetch(a,{headers:{"X-Usuario-Sub":t},credentials:"include"});let s=null;try{s=await l.json()}catch(d){}if(!l.ok){const e=s&&(s.mensaje||s.error||s.message)||"No pudimos obtener el resumen de dashboard (c\xf3digo ".concat(l.status,")."),o=new Error(e);throw o.status=l.status,o}return s},We={totalIncomes:82e4,totalExpenses:54e4,netResult:28e4,cashBalance:125e4,cashRunwayDays:46,pendingReceivables:42e4,receivablesDueSoon:16e4,pendingPayables:21e4,payablesOverdue:65e3},Le={title:"Ingresos durante el periodo",average:185e3,max:{value:215e3,label:"abr 2025"},min:{value:142e3,label:"ene 2025"},points:[{month:"ene",value:142e3},{month:"feb",value:168e3},{month:"mar",value:178500},{month:"abr",value:215e3},{month:"may",value:204e3},{month:"jun",value:198e3},{month:"jul",value:191e3},{month:"ago",value:199500},{month:"sep",value:188e3},{month:"oct",value:194500},{month:"nov",value:187e3},{month:"dic",value:181500}]},Be={title:"Egresos durante el periodo",average:142e3,max:{value:168e3,label:"mar 2025"},min:{value:118e3,label:"ene 2025"},points:[{month:"ene",value:125e3},{month:"feb",value:132e3},{month:"mar",value:168e3},{month:"abr",value:154e3},{month:"may",value:149e3},{month:"jun",value:138e3},{month:"jul",value:146e3},{month:"ago",value:152e3},{month:"sep",value:139e3},{month:"oct",value:145e3},{month:"nov",value:141e3},{month:"dic",value:134e3}]},Ue=[{category:"Servicios B\xe1sicos",value:54e3},{category:"Vivienda",value:76e3},{category:"Transporte",value:42e3},{category:"Servicios Financieros",value:35500},{category:"Impuestos y Tasas",value:68e3},{category:"Alimentos y Bebidas",value:38500},{category:"Educaci\xf3n",value:29500},{category:"Salud",value:31800}],ze=[{category:"Ventas",value:385188},{category:"Servicios",value:353625},{category:"Produccion",value:272799},{category:"Logistica",value:199511},{category:"Marketing",value:194480},{category:"Tecnologia",value:193511},{category:"RRHH",value:91909},{category:"Administracion",value:77346}],Ge={name:"Presupuesto anual 2025",slug:"presupuesto-anual-2025",period:{label:"Octubre 2025",routeParam:"octubre-2025"},categories:[{name:"Ventas",planned:85e4,actual:64e4},{name:"Marketing",planned:25e4,actual:21e4},{name:"Operaciones",planned:3e5,actual:32e4},{name:"RRHH",planned:18e4,actual:15e4}]},He={labels:["Hoy","+5d","+10d","+15d","+20d","+25d","+30d"],incomes:[22e4,18e4,21e4,19e4,23e4,2e5,25e4],expenses:[15e4,16e4,17e4,165e3,175e3,16e4,185e3],net:[7e4,2e4,4e4,25e3,55e3,4e4,65e3]},Ve=[{id:"afip-01",date:(new Date).toISOString(),type:"AFIP",name:"IVA mensual",amount:155e3},{id:"prov-02",date:new Date(Date.now()+2592e5).toISOString(),type:"Proveedor",name:"Servicios Cloud",amount:98e3},{id:"cli-03",date:new Date(Date.now()+6048e5).toISOString(),type:"Cliente",name:"Cobranza Grupo Litoral",amount:21e4}],Ke=[{id:"task-1",title:"Conciliar Banco Naci\xf3n",description:"Ten\xe9s 4 movimientos pendientes de revisar.",severity:"high"},{id:"task-2",title:"Subir comprobantes de AFIP",description:"Faltan adjuntar comprobantes del \xfaltimo pago.",severity:"medium"},{id:"task-3",title:"categoriar movimientos",description:"3 ingresos sin categoria asignada.",severity:"low"}],qe=[{id:"mov-1",tipo:"Egreso",montoTotal:-125e3,moneda:"ARS",fechaEmision:(new Date).toISOString(),categoria:"Logistica"},{id:"mov-2",tipo:"Ingreso",montoTotal:185e3,moneda:"ARS",fechaEmision:new Date(Date.now()-864e5).toISOString(),categoria:"Ventas"},{id:"mov-3",tipo:"Egreso",montoTotal:-78e3,moneda:"ARS",fechaEmision:new Date(Date.now()-1728e5).toISOString(),categoria:"Marketing"},{id:"mov-4",tipo:"Transferencia",montoTotal:-45e3,moneda:"ARS",fechaEmision:new Date(Date.now()-2592e5).toISOString(),categoria:null}],Xe={periodo:"2025-10",periodLabel:"octubre 2025",totalMovimientos:124,conciliados:96,pendientes:28,porcentajeConciliados:77.4,ultimaConciliacion:"2025-10-28",ultimoPendiente:"2025-10-30",porTipo:[{tipo:"Ingreso",total:68,conciliados:55,pendientes:13,porcentaje:80.9},{tipo:"Egreso",total:56,conciliados:41,pendientes:15,porcentaje:73.2}]},Ye={invoices:[{id:"fac-01",number:"A-0003-000125",customer:"F\xe1brica El Sol",amount:145e3,date:(new Date).toISOString()},{id:"fac-02",number:"A-0003-000124",customer:"Cooperativa Delta",amount:98e3,date:new Date(Date.now()-864e5).toISOString()},{id:"fac-03",number:"B-0001-000543",customer:"Estudio Contable Sur",amount:54e3,date:new Date(Date.now()-1728e5).toISOString()}]},Je="dashboard_summary_v1",Ze=(e,o)=>{var r,n,t,i,a,l,s,d,c,u,m,x,v,g,h,p,A;if(!e)return{id:"movement-".concat(o),tipo:"Movimiento",montoTotal:0,moneda:"ARS",fechaEmision:null,categoria:null};return{id:null!==(r=null!==(n=e.id)&&void 0!==n?n:e.uuid)&&void 0!==r?r:"movement-".concat(o),tipo:null!==(t=null!==(i=null!==(a=e.tipo)&&void 0!==a?a:e.tipoMovimiento)&&void 0!==i?i:e.tipoOperacion)&&void 0!==t?t:"Movimiento",montoTotal:(e=>{const o=Number(e);return Number.isFinite(o)?o:0})(null!==(l=null!==(s=null!==(d=e.montoTotal)&&void 0!==d?d:e.monto)&&void 0!==s?s:e.importe)&&void 0!==l?l:0),moneda:null!==(c=null!==(u=e.moneda)&&void 0!==u?u:e.monedaCodigo)&&void 0!==c?c:"ARS",fechaEmision:null!==(m=null!==(x=null!==(v=e.fechaEmision)&&void 0!==v?v:e.fecha)&&void 0!==x?x:e.fechaRegistro)&&void 0!==m?m:null,categoria:null!==(g=null!==(h=null!==(p=null!==(A=e.categoria)&&void 0!==A?A:e.categoriaNombre)&&void 0!==p?p:e.categoriaDescripcion)&&void 0!==h?h:e.area)&&void 0!==g?g:null}},Qe=(e,o)=>{var r,n,t,i,a,l,s,d,c;if(!e)return{id:"invoice-".concat(o),tipoFactura:"Factura",numeroDocumento:null,montoTotal:0,moneda:"ARS",fechaEmision:null,compradorNombre:null,vendedorNombre:null};return{id:null!==(r=null!==(n=e.id)&&void 0!==n?n:e.idDocumento)&&void 0!==r?r:"invoice-".concat(o),tipoFactura:null!==(t=e.tipoFactura)&&void 0!==t?t:"Factura",numeroDocumento:null!==(i=e.numeroDocumento)&&void 0!==i?i:null,montoTotal:(e=>{const o=Number(e);return Number.isFinite(o)?o:0})(null!==(a=e.montoTotal)&&void 0!==a?a:0),moneda:null!==(l=e.moneda)&&void 0!==l?l:"ARS",fechaEmision:null!==(s=e.fechaEmision)&&void 0!==s?s:null,compradorNombre:null!==(d=e.compradorNombre)&&void 0!==d?d:null,vendedorNombre:null!==(c=e.vendedorNombre)&&void 0!==c?c:null}},$e={kpis:{loading:!0,error:null,data:null},budget:{loading:!0,error:null,data:null},cashflow:{loading:!0,error:null,data:null},dueDates:{loading:!0,error:null,data:null},tasks:{loading:!0,error:null,data:null},movements:{loading:!0,error:null,data:null},invoices:{loading:!0,error:null,data:null},reconciliation:{loading:!0,error:null,data:null},billing:{loading:!0,error:null,data:null},salesTrend:{loading:!0,error:null,data:null},salesByCategory:{loading:!0,error:null,data:null},expensesTrend:{loading:!0,error:null,data:null},expensesByCategory:{loading:!0,error:null,data:null}},eo=["MyCFO Demo","Acme Corp","Globex Latam"],oo=t.memo(()=>{var e,o,r,f,C,S,R,I,E,P,D,_,M;const F=(0,m.Zp)(),W=(0,x.A)(),{resolvedMode:L,paletteVars:B,primaryTextColor:U}=T(),z=(0,v.A)(W.breakpoints.down("sm")),[G,H]=t.useState($e),[V,K]=t.useState(!1),q=t.useRef(),Y=t.useRef(0),J=t.useRef("true"==={NODE_ENV:"production",PUBLIC_URL:"/mycfo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AWS_REGION:"sa-east-1",REACT_APP_BASE_URL:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net",REACT_APP_COGNITO_CLIENT_ID:"3ksssqtg3r49rf6js1t1177hrd",REACT_APP_COGNITO_USER_POOL_ID:"sa-east-1_lTMNrWW7R",REACT_APP_URL_ADMINISTRACION:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/administracion",REACT_APP_URL_IA:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/ia",REACT_APP_URL_NOTIFICACION:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/notificacion",REACT_APP_URL_PRONOSTICO:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/pronostico",REACT_APP_URL_REGISTRO:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/registro",REACT_APP_URL_REPORTE:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/reporte",REACT_APP_WEBSOCKET_URL:"https://sjxxmr-ip-191-102-24-197.tunnelmole.net/notificacion/ws"}.REACT_APP_USE_MOCKS).current,Z=t.useCallback(()=>({kpis:{loading:!1,error:null,data:We},budget:{loading:!1,error:null,data:Ge},cashflow:{loading:!1,error:null,data:He},dueDates:{loading:!1,error:null,data:Ve},tasks:{loading:!1,error:null,data:Ke},movements:{loading:!1,error:null,data:qe},invoices:{loading:!1,error:null,data:[]},reconciliation:{loading:!1,error:null,data:Xe},billing:{loading:!1,error:null,data:Ye},salesTrend:{loading:!1,error:null,data:Le},salesByCategory:{loading:!1,error:null,data:ze},expensesTrend:{loading:!1,error:null,data:Be},expensesByCategory:{loading:!1,error:null,data:Ue}}),[]),[Q,$]=t.useState(null),[ee,oe]=t.useState(eo[0]),re=t.useMemo(()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return Array.from({length:e}).map((e,o)=>{const r=new Date;return r.setMonth(r.getMonth()-o),{label:new Intl.DateTimeFormat("es-AR",{month:"long",year:"numeric"}).format(r),value:"".concat(r.getFullYear(),"-").concat(String(r.getMonth()+1).padStart(2,"0"))}})}(6),[]),[ne,ie]=t.useState(null!==(e=null===(o=re[0])||void 0===o?void 0:o.value)&&void 0!==e?e:""),ae=t.useMemo(()=>{if("undefined"===typeof window)return"Usuario";try{const e=sessionStorage.getItem("nombre");if(e&&e.trim())return e.trim();const o=sessionStorage.getItem("name");if(o&&o.trim())return o.trim();const r=sessionStorage.getItem("email");if(r&&r.includes("@"))return r.split("@")[0]}catch(e){}return"Usuario"},[]),le=t.useCallback(()=>{if(console.log("\ud83d\udd04 Recargando datos del dashboard..."),K(!0),H(e=>{const o={};return Object.entries(e).forEach(e=>{let[r,t]=e;o[r]=(0,n.A)((0,n.A)({},t),{},{loading:!0,error:null})}),o}),clearTimeout(q.current),J)return void(q.current=setTimeout(()=>{H(Z()),K(!1),console.log("\u2705 Datos del dashboard recargados (modo mock)")},700));q.current=void 0;const e=Y.current+1;Y.current=e;const o=(e,o)=>{var r,n;let{title:t,emptyMessage:i,subheader:a}=o;const l=Array.isArray(null===e||void 0===e?void 0:e.datos)?e.datos:[],s=new Intl.DateTimeFormat("es-AR",{month:"short"}),d=new Intl.DateTimeFormat("es-AR",{month:"long",year:"numeric"}),c=String(null!==(r=null!==(n=null===e||void 0===e?void 0:e.periodoBase)&&void 0!==n?n:null===e||void 0===e?void 0:e.periodo)&&void 0!==r?r:""),[u]=c.split("-"),m=Number(u)||(new Date).getFullYear(),x=new Map;l.forEach(e=>{var o;const r=String(null!==(o=null===e||void 0===e?void 0:e.periodo)&&void 0!==o?o:""),[n,t]=r.split("-"),i=Number(n),a=Number(t);if(Number.isFinite(i)&&Number.isFinite(a)){var l;const o="".concat(i,"-").concat(String(a).padStart(2,"0"));x.set(o,Number(null!==(l=null===e||void 0===e?void 0:e.total)&&void 0!==l?l:0))}});const v=l.reduce((e,o)=>{var r;const n=String(null!==(r=null===o||void 0===o?void 0:o.periodo)&&void 0!==r?r:""),[,t]=n.split("-"),i=Number(t);var a;Number.isFinite(i)&&!e.has(i)&&e.set(i,Number(null!==(a=null===o||void 0===o?void 0:o.total)&&void 0!==a?a:0));return e},new Map),g=Array.from({length:12},(e,o)=>{const r=new Date(m,o,1),n="".concat(r.getFullYear(),"-").concat(String(o+1).padStart(2,"0"));let t=x.get(n);var i;"undefined"===typeof t&&(t=null!==(i=v.get(o+1))&&void 0!==i?i:0);return{month:s.format(r),fullLabel:d.format(r),value:t}}),h=g.map(e=>e.value),p=h.filter(e=>0!==e),A=p.length>0?p.reduce((e,o)=>e+o,0)/p.length:0,y=h.length>0?Math.max(...h):0,j=h.length>0?Math.min(...h):0,b=g.find(e=>e.value===y),f=g.find(e=>e.value===j);return{title:t,emptyMessage:i,subheader:a,points:g.map(e=>{let{month:o,value:r}=e;return{month:o,value:r}}),average:A,max:{value:y,label:b?b.fullLabel:"--"},min:{value:j,label:f?f.fullLabel:"--"}}},r=e=>(Array.isArray(null===e||void 0===e?void 0:e.categorias)?e.categorias:[]).map(e=>{var o,r;return{category:null!==(o=null===e||void 0===e?void 0:e.categoria)&&void 0!==o?o:"Sin categoria",value:Number(null!==(r=null===e||void 0===e?void 0:e.total)&&void 0!==r?r:0)}}),t=e=>{var o,r,n,t,i,a;if(!e)return null;const l=Number(null!==(o=e.totalMovimientos)&&void 0!==o?o:0),s=Number(null!==(r=e.conciliados)&&void 0!==r?r:0),d=void 0!==e.pendientes?Number(null!==(n=e.pendientes)&&void 0!==n?n:0):Math.max(l-s,0),c=void 0!==e.porcentajeConciliados&&null!==e.porcentajeConciliados?Number(e.porcentajeConciliados):l>0?100*s/l:0,u=String(null!==(t=e.periodo)&&void 0!==t?t:"");let m=u||"Periodo actual";const[x,v]=u.split("-"),g=Number(v)-1,h=Number(x),p=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];g>=0&&g<p.length&&Number.isFinite(h)&&(m="".concat(p[g]," ").concat(h));const A=(Array.isArray(e.porTipo)?e.porTipo:[]).map(e=>{var o,r,n,t;const i=Number(null!==(o=null===e||void 0===e?void 0:e.total)&&void 0!==o?o:0),a=Number(null!==(r=null===e||void 0===e?void 0:e.conciliados)&&void 0!==r?r:0),l=void 0!==(null===e||void 0===e?void 0:e.pendientes)?Number(null!==(n=e.pendientes)&&void 0!==n?n:0):Math.max(i-a,0),s=i>0?100*a/i:0;return{tipo:null!==(t=null===e||void 0===e?void 0:e.tipo)&&void 0!==t?t:"Sin tipo",total:i,conciliados:a,pendientes:l,porcentaje:s}});return{periodo:u,periodLabel:m,totalMovimientos:l,conciliados:s,pendientes:d,porcentajeConciliados:c,ultimaConciliacion:null!==(i=e.ultimaConciliacion)&&void 0!==i?i:null,ultimoPendiente:null!==(a=e.ultimoPendiente)&&void 0!==a?a:null,porTipo:A}};(async()=>{const i=n=>{if(!n)return;const i=Array.isArray(n.movimientosRecientes)?n.movimientosRecientes:[],a=Array.isArray(n.facturasRecientes)?n.facturasRecientes:[],l={loading:!1,error:null,data:i.map(Ze)},s={loading:!1,error:null,data:a.map(Qe)};let d=null;const c=n.resumenMensual,u=n.saldoTotal;var m;c&&(d={loading:!1,error:null,data:{totalIncomes:c.ingresosTotales,totalExpenses:c.egresosTotales,netResult:c.resultadoNeto,period:c.periodo,periodLabel:c.periodo,movementsCount:c.totalMovimientos,totalBalance:null!==(m=null===u||void 0===u?void 0:u.saldoTotal)&&void 0!==m?m:null}});const x=n.ingresosMensuales?{loading:!1,error:null,data:o(n.ingresosMensuales,{title:"Ingresos durante el periodo",emptyMessage:"No hay ingresos registrados en este periodo.",subheader:"Serie mensual de ingresos registrados en los ultimos 12 meses."})}:{loading:!1,error:null,data:null},v=n.egresosMensuales?{loading:!1,error:null,data:o(n.egresosMensuales,{title:"Egresos durante el periodo",emptyMessage:"No hay egresos registrados en este periodo.",subheader:"Serie mensual de egresos registrados en los ultimos 12 meses."})}:{loading:!1,error:null,data:null};(o=>{let{movements:r,invoices:n,kpis:t,salesTrend:i,salesByCategory:a,expensesTrend:l,expensesByCategory:s,reconciliation:d}=o;if(Y.current!==e)return;const c=Z();c.movements=null!==r&&void 0!==r?r:c.movements,n&&(c.invoices=n),t&&(c.kpis=t),i&&(c.salesTrend=i),a&&(c.salesByCategory=a),l&&(c.expensesTrend=l),s&&(c.expensesByCategory=s),d&&(c.reconciliation=d),H(c),K(!1),console.log("\u2705 Datos del dashboard recargados")})({movements:l,invoices:s,kpis:d,salesTrend:x,salesByCategory:n.ingresosPorCategoria?{loading:!1,error:null,data:r(n.ingresosPorCategoria)}:{loading:!1,error:null,data:null},expensesTrend:v,expensesByCategory:n.egresosPorCategoria?{loading:!1,error:null,data:r(n.egresosPorCategoria)}:{loading:!1,error:null,data:null},reconciliation:n.conciliacion?{loading:!1,error:null,data:t(n.conciliacion)}:{loading:!1,error:null,data:null}})};if("undefined"!==typeof window)try{const e=window.sessionStorage.getItem(Je);if(e){i(JSON.parse(e))}}catch(a){}try{const e=await Oe({period:ne,months:12,limitMovements:6,limitInvoices:6});if("undefined"!==typeof window)try{window.sessionStorage.setItem(Je,JSON.stringify(e))}catch(a){}i(e)}catch(l){console.error("\u274c Error recargando dashboard:",l),K(!1),H(e=>(0,n.A)((0,n.A)({},e),{},{kpis:(0,n.A)((0,n.A)({},e.kpis),{},{loading:!1,error:(null===l||void 0===l?void 0:l.message)||"No pudimos actualizar el resumen de dashboard."})}))}})()},[Z,J,ne]);t.useEffect(()=>(le(),()=>{clearTimeout(q.current),Y.current+=1}),[le]);const se=t.useCallback((e,o)=>{if(e){if(o){const r=new URLSearchParams(o);F({pathname:e,search:"?".concat(r.toString())})}else F(e);"undefined"!==typeof window&&window.scrollTo({top:0,behavior:"smooth"})}},[F]),de=t.useMemo(()=>[{id:"movement",label:"Cargar movimiento",icon:(0,w.jsx)(g.A,{}),action:()=>se("/carga")},{id:"excel",label:"Importar Excel",icon:(0,w.jsx)(h.A,{}),action:()=>se("/carga-movimientos")},{id:"mp",label:"Mercado Pago",icon:(0,w.jsx)(p.A,{}),action:()=>se("/mercado-pago")},{id:"reconcile",label:"Conciliar",icon:(0,w.jsx)(A.A,{}),action:()=>se("/conciliacion")},{id:"invoice",label:"Cargar factura",icon:(0,w.jsx)(y.A,{}),action:()=>se("/carga/factura")},{id:"budget",label:"Nuevo presupuesto",icon:(0,w.jsx)(j.A,{}),action:()=>se("/presupuestos/nuevo")},{id:"reminder",label:"Recordatorio",icon:(0,w.jsx)(b.A,{}),action:()=>se("/recordatorios")}],[se]),ce=(e,o)=>{"clickaway"!==o&&$(null)},ue=t.useMemo(()=>{var e,o,r,n;const t=G.kpis.data;return[{id:"totalIncomes",title:"Ingresos Totales Mensuales",value:null!==(e=null===t||void 0===t?void 0:t.totalIncomes)&&void 0!==e?e:null,formatter:O.c,trend:[]},{id:"totalExpenses",title:"Egresos Totales Mensuales",value:null!==(o=null===t||void 0===t?void 0:t.totalExpenses)&&void 0!==o?o:null,formatter:O.c,trend:[]},{id:"netResult",title:"Resultado Neto Mensuales",value:null!==(r=null===t||void 0===t?void 0:t.netResult)&&void 0!==r?r:null,formatter:O.c,trend:[]},{id:"totalBalance",title:"Dinero Total",value:null!==(n=null===t||void 0===t?void 0:t.totalBalance)&&void 0!==n?n:null,formatter:O.c,trend:[]}]},[G.kpis.data]),me=G.kpis.loading&&!G.kpis.data,xe=t.useMemo(()=>({position:{xs:"relative",md:"sticky"},top:{md:W.spacing(1)},zIndex:W.zIndex.appBar-1,display:"flex",justifyContent:"center"}),[W]);return(0,w.jsxs)(i.A,{sx:{width:"100%",maxWidth:1650,mx:"auto",px:{xs:2,sm:3,md:4,lg:6},pb:6},children:[(0,w.jsxs)(a.A,{spacing:3,sx:{width:"100%"},children:[(0,w.jsx)(a.A,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},sx:{width:"100%"},children:(0,w.jsxs)(i.A,{children:[(0,w.jsxs)(l.A,{variant:"h4",fontWeight:600,children:["Hola, ",ae]}),(0,w.jsx)(l.A,{variant:"body2",sx:{color:U},children:"Todo lo importante de tu cuenta, en un solo lugar."})]})}),(0,w.jsx)(i.A,{sx:xe,children:(0,w.jsx)(N,{actions:de,loading:me,onAction:e=>{var o;null!==e&&void 0!==e&&e.action?e.action():$({severity:"info",message:"".concat(null!==(o=null===e||void 0===e?void 0:e.label)&&void 0!==o?o:"Acci\xf3n"," en desarrollo.")})}})}),(0,w.jsx)(s.A,{container:!0,spacing:2,justifyContent:"center",sx:{maxWidth:{xs:"100%",md:1600},mx:"auto"},children:ue.map(e=>(0,w.jsx)(s.A,{item:!0,xs:12,sm:12,md:3,children:(0,w.jsx)(k,{title:e.title,value:e.value,formatter:e.formatter,secondaryLabel:e.secondaryLabel,secondaryValue:e.secondaryValue,secondaryFormatter:e.secondaryFormatter,trend:e.trend,trendColor:e.trendColor,loading:G.kpis.loading&&!G.kpis.data,error:G.kpis.error,onRetry:le})},e.id))}),(0,w.jsxs)(s.A,{container:!0,spacing:3,justifyContent:"center",sx:{width:"100%",maxWidth:1600,mx:"auto"},children:[(0,w.jsx)(s.A,{item:!0,children:(0,w.jsx)(i.A,{sx:{width:{xs:"100%",md:720}},children:(0,w.jsx)(Pe,{data:null!==(r=G.salesTrend.data)&&void 0!==r?r:{title:"Ingresos durante el periodo",points:[],average:0,max:{value:0,label:"--"},min:{value:0,label:"--"}},loading:G.salesTrend.loading&&!G.salesTrend.data,error:G.salesTrend.error,onNavigate:()=>se("/reportes/ventas")})})}),(0,w.jsx)(s.A,{item:!0,children:(0,w.jsx)(i.A,{sx:{width:{xs:"100%",md:720}},children:(0,w.jsx)(Me,{data:null!==(f=G.salesByCategory.data)&&void 0!==f?f:[],loading:G.salesByCategory.loading&&!G.salesByCategory.data,error:G.salesByCategory.error})})})]}),(0,w.jsxs)(s.A,{container:!0,spacing:3,justifyContent:"center",sx:{width:"100%",maxWidth:1600,mx:"auto"},children:[(0,w.jsx)(s.A,{item:!0,children:(0,w.jsx)(i.A,{sx:{width:{xs:"100%",md:720}},children:(0,w.jsx)(Pe,{data:null!==(C=G.expensesTrend.data)&&void 0!==C?C:{title:"Egresos durante el periodo",points:[],average:0,max:{value:0,label:"--"},min:{value:0,label:"--"}},loading:G.expensesTrend.loading&&!G.expensesTrend.data,error:G.expensesTrend.error,emptyMessage:"No hay egresos registrados en este periodo."})})}),(0,w.jsx)(s.A,{item:!0,children:(0,w.jsx)(i.A,{sx:{width:{xs:"100%",md:720}},children:(0,w.jsx)(Me,{data:null!==(S=G.expensesByCategory.data)&&void 0!==S?S:[],loading:G.expensesByCategory.loading&&!G.expensesByCategory.data,error:G.expensesByCategory.error,emptyMessage:"No hay egresos por categoria en este periodo.",title:"Egresos por categorias",subtitle:"Distribucion anual por segmento"})})})]}),(0,w.jsxs)(s.A,{container:!0,spacing:2,justifyContent:"center",sx:{mt:1,width:"100%",maxWidth:1600,mx:"auto"},children:[(0,w.jsx)(s.A,{item:!0,xs:12,md:4,children:(0,w.jsx)(X,{companyId:ee,period:ne,data:G.budget.data,loading:G.budget.loading&&!G.budget.data,error:G.budget.error,onRetry:le})}),(0,w.jsx)(s.A,{item:!0,xs:12,md:4,children:(0,w.jsx)(te,{})}),(0,w.jsx)(s.A,{item:!0,xs:12,md:4,children:(0,w.jsx)(Te,{data:G.reconciliation.data,loading:G.reconciliation.loading&&!G.reconciliation.data,error:G.reconciliation.error,onRetry:le,onNavigate:e=>se("/conciliacion",e?{cuenta:e}:void 0)})})]}),(0,w.jsxs)(s.A,{container:!0,spacing:2,justifyContent:"center",sx:{mt:1,width:"100%",maxWidth:1600,mx:"auto"},children:[(0,w.jsx)(s.A,{item:!0,xs:12,md:6,children:(0,w.jsx)(ge,{data:G.movements.data,loading:G.movements.loading&&!G.movements.data,error:G.movements.error,onRetry:le,onNavigate:()=>se("/ver-movimientos")})}),(0,w.jsx)(s.A,{item:!0,xs:12,md:6,children:(0,w.jsx)(ye,{data:null!==(R=null===(I=G.invoices)||void 0===I?void 0:I.data)&&void 0!==R?R:null,loading:(null===(E=G.invoices)||void 0===E?void 0:E.loading)&&!(null!==(P=G.invoices)&&void 0!==P&&P.data),error:null!==(D=null===(_=G.invoices)||void 0===_?void 0:_.error)&&void 0!==D?D:null,onRetry:le,onNavigate:()=>se("/ver-facturas")})})]}),(0,w.jsx)(s.A,{container:!0,spacing:2,justifyContent:"center",sx:{mt:1,width:"100%",maxWidth:1600,mx:"auto"},children:(0,w.jsx)(s.A,{item:!0,xs:12,md:10,children:(0,w.jsx)(i.A,{sx:{width:"100%",mx:"auto"},children:(0,w.jsx)(Fe,{})})})}),(0,w.jsx)(i.A,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,w.jsx)(u.A,{variant:"text",size:"small",onClick:le,disabled:V,children:V?"Recargando...":"Recargar datos de Dashboard"})})]}),(0,w.jsx)(d.A,{open:Boolean(Q),autoHideDuration:4e3,onClose:ce,anchorOrigin:{vertical:z?"top":"bottom",horizontal:"center"},children:Q?(0,w.jsx)(c.A,{onClose:ce,severity:null!==(M=Q.severity)&&void 0!==M?M:"info",variant:"filled",sx:{width:"100%"},children:Q.message}):null})]})})},38915:(e,o,r)=>{r.d(o,{A:()=>p});var n=r(79722),t=r(35644),i=r(29296),a=r(13658);const l=n.A.create(),s=a.A.PRONOSTICO,d={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let c=null,u=!1;const m=e=>Boolean(e&&s&&String(e).startsWith(String(s))),x=e=>{try{return sessionStorage.getItem(e)}catch(o){return console.warn("No se pudo leer sessionStorage:",o),null}},v=(e,o)=>{try{void 0!==o&&null!==o&&sessionStorage.setItem(e,o)}catch(r){console.warn("No se pudo escribir en sessionStorage:",r)}},g=()=>{if(!u){u=!0;try{sessionStorage.clear()}catch(e){}null!==i.m&&void 0!==i.m&&i.m.limpiarSesion&&i.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},h=()=>{const e=x("refreshToken"),o=(()=>{const e=x("email")||x("username");if(!e||!d.UserPoolId||!d.ClientId)return null;const o=new t.NE(d);return new t.TU({Username:e,Pool:o})})();if(!e||!o)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const r=new t.c9({RefreshToken:e});return new Promise((e,n)=>{o.refreshSession(r,(o,r)=>{if(o)return void n(o);const t=r.getAccessToken().getJwtToken(),i=r.getIdToken().getJwtToken(),a=r.getRefreshToken().getToken();v("accessToken",t),v("idToken",i),a&&v("refreshToken",a),e(t)})})};l.interceptors.request.use(e=>{const o=sessionStorage.getItem("accessToken");if(m(e.url)){var r;e.headers=null!==(r=e.headers)&&void 0!==r?r:{},o&&(e.headers.Authorization="Bearer ".concat(o));const n=sessionStorage.getItem("sub");n&&(e.headers["X-Usuario-Sub"]=n)}return e}),l.interceptors.response.use(e=>e,async e=>{const{config:o,response:r}=e;if(!o||!r||401!==r.status||!m(o.url))return Promise.reject(e);if(o.__isRetryRequest)return g(),Promise.reject(e);try{var n;const e=await(c||(c=h().then(e=>(c=null,e)).catch(e=>{throw c=null,e})),c);if(!e)throw new Error("No se obtuvo un token renovado.");return o.__isRetryRequest=!0,o.headers=null!==(n=o.headers)&&void 0!==n?n:{},o.headers.Authorization="Bearer ".concat(e),l(o)}catch(t){return g(),Promise.reject(t)}});const p=l}}]);
//# sourceMappingURL=5154.1950ab7a.chunk.js.map