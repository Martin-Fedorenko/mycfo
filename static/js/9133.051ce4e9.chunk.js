"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9133],{38915:(e,s,r)=>{r.d(s,{A:()=>y});var o=r(79722),t=r(35644),n=r(29296),a=r(13658);const i=o.A.create(),c=a.A.PRONOSTICO,l={UserPoolId:"sa-east-1_lTMNrWW7R",ClientId:"3ksssqtg3r49rf6js1t1177hrd"};let d=null,h=!1;const x=e=>Boolean(e&&c&&String(e).startsWith(String(c))),m=e=>{try{return sessionStorage.getItem(e)}catch(s){return console.warn("No se pudo leer sessionStorage:",s),null}},u=(e,s)=>{try{void 0!==s&&null!==s&&sessionStorage.setItem(e,s)}catch(r){console.warn("No se pudo escribir en sessionStorage:",r)}},g=()=>{if(!h){h=!0;try{sessionStorage.clear()}catch(e){}null!==n.m&&void 0!==n.m&&n.m.limpiarSesion&&n.m.limpiarSesion(),"undefined"!==typeof window&&(window.location.href="/#/signin")}},j=()=>{const e=m("refreshToken"),s=(()=>{const e=m("email")||m("username");if(!e||!l.UserPoolId||!l.ClientId)return null;const s=new t.NE(l);return new t.TU({Username:e,Pool:s})})();if(!e||!s)return Promise.reject(new Error("No hay datos para renovar la sesi\xf3n."));const r=new t.c9({RefreshToken:e});return new Promise((e,o)=>{s.refreshSession(r,(s,r)=>{if(s)return void o(s);const t=r.getAccessToken().getJwtToken(),n=r.getIdToken().getJwtToken(),a=r.getRefreshToken().getToken();u("accessToken",t),u("idToken",n),a&&u("refreshToken",a),e(t)})})};i.interceptors.request.use(e=>{const s=sessionStorage.getItem("accessToken");if(x(e.url)){var r;e.headers=null!==(r=e.headers)&&void 0!==r?r:{},s&&(e.headers.Authorization="Bearer ".concat(s));const o=sessionStorage.getItem("sub");o&&(e.headers["X-Usuario-Sub"]=o)}return e}),i.interceptors.response.use(e=>e,async e=>{const{config:s,response:r}=e;if(!s||!r||401!==r.status||!x(s.url))return Promise.reject(e);if(s.__isRetryRequest)return g(),Promise.reject(e);try{var o;const e=await(d||(d=j().then(e=>(d=null,e)).catch(e=>{throw d=null,e})),d);if(!e)throw new Error("No se obtuvo un token renovado.");return s.__isRetryRequest=!0,s.headers=null!==(o=s.headers)&&void 0!==o?o:{},s.headers.Authorization="Bearer ".concat(e),i(s)}catch(t){return g(),Promise.reject(t)}});const y=i},49133:(e,s,r)=>{r.r(s),r.d(s,{default:()=>T});var o=r(65043),t=r(53969),n=r(91449),a=r(12097),i=r(55895),c=r(94799),l=r(11840),d=r(82332),h=r(14057),x=r(70579);const m=(0,h.A)((0,x.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var u=r(29001),g=r(28791),j=r(50108),y=r(75748),p=r(87734),f=r(52185),A=r(6026),k=r(80379),v=r(70095),b=r(73243),w=r(80768),S=r(96470),I=r(13658),N=r(38915);function T(){const{id:e}=(0,u.g)(),s=(0,u.Zp)(),[r,h]=o.useState(!0),[T,P]=o.useState(null),[W,E]=o.useState(null),[F,K]=o.useState("todos");o.useEffect(()=>{C()},[e]);const C=async()=>{h(!0),E(null);try{const s=await N.A.get("".concat(I.A.PRONOSTICO,"/api/forecasts/").concat(e));P(s.data)}catch(o){var s,r;console.error("Error cargando forecast:",o),E((null===(s=o.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Error al cargar el pron\xf3stico. Por favor intenta nuevamente.")}finally{h(!1)}},R=T&&T.lineas?T.lineas.sort((e,s)=>e.a\u00f1o!==s.a\u00f1o?e.a\u00f1o-s.a\u00f1o:e.mes-s.mes).map(e=>({mes:"".concat(e.mes,"/").concat(e.a\u00f1o),"a\xf1o":e.a\u00f1o,mesNum:e.mes,tipo:e.tipo||"estimado",ingresos:parseFloat(e.ingresosEsperados||0),egresos:parseFloat(e.egresosEsperados||0),balance:parseFloat(e.balanceNetoEsperado||0)})):[],B=()=>{if(!R||0===R.length)return-1;for(let e=0;e<R.length;e++)if("estimado"===R[e].tipo)return e;return-1},z=()=>{var e;const s=B();return s<=0?null:null===(e=R[s])||void 0===e?void 0:e.mes};return r?(0,x.jsx)(S.A,{}):W?(0,x.jsxs)(t.A,{sx:{p:3},children:[(0,x.jsx)(n.A,{severity:"error",sx:{mb:2},children:W}),(0,x.jsx)(a.A,{startIcon:(0,x.jsx)(m,{}),onClick:()=>s("/pronostico-fijo"),children:"Volver"})]}):T?(0,x.jsxs)(t.A,{sx:{width:"100%",minHeight:"100vh",p:3},children:[(0,x.jsxs)(t.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,x.jsx)(a.A,{startIcon:(0,x.jsx)(m,{}),onClick:()=>s("/pronostico-fijo"),sx:{mr:2},children:"Volver"}),(0,x.jsx)(i.A,{variant:"h4",children:T.nombre||"Pron\xf3stico"})]}),(0,x.jsxs)(c.A,{sx:{p:3,mb:3},children:[(0,x.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"Informaci\xf3n del Pron\xf3stico"}),(0,x.jsxs)(t.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:2,mt:2},children:[(0,x.jsxs)(t.A,{children:[(0,x.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Horizonte"}),(0,x.jsxs)(i.A,{variant:"body1",children:[T.horizonteMeses," meses"]})]}),(0,x.jsxs)(t.A,{children:[(0,x.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Frecuencia"}),(0,x.jsxs)(i.A,{variant:"body1",children:["Cada ",T.mesesFrecuencia," meses"]})]}),(0,x.jsxs)(t.A,{children:[(0,x.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Per\xedodos Analizados"}),(0,x.jsxs)(i.A,{variant:"body1",children:[T.periodosAnalizados," per\xedodos"]})]}),(0,x.jsxs)(t.A,{children:[(0,x.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Fecha de Generaci\xf3n"}),(0,x.jsx)(i.A,{variant:"body1",children:(e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("es-AR",{year:"numeric",month:"long",day:"numeric"})}catch(s){return e}})(T.createdAt)})]}),(0,x.jsxs)(t.A,{children:[(0,x.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Per\xedodo del Pron\xf3stico"}),(0,x.jsxs)(i.A,{variant:"body1",children:[T.mesInicioPronostico," - ",T.mesFinPronostico]})]})]})]}),R.length>0&&(0,x.jsxs)(c.A,{sx:{p:3,mb:3},children:[(0,x.jsxs)(t.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,x.jsx)(i.A,{variant:"h6",sx:{mr:3},children:"Visualizaci\xf3n"}),(0,x.jsxs)(l.A,{value:F,exclusive:!0,onChange:(e,s)=>s&&K(s),size:"small",children:[(0,x.jsx)(d.A,{value:"todos",children:"Todos"}),(0,x.jsx)(d.A,{value:"ingresos",children:"Solo Ingresos"}),(0,x.jsx)(d.A,{value:"egresos",children:"Solo Egresos"}),(0,x.jsx)(d.A,{value:"balance",children:"Solo Balance"})]})]}),(0,x.jsx)(j.u,{width:"100%",height:400,children:(0,x.jsxs)(y.b,{data:R,children:[(0,x.jsx)(p.d,{strokeDasharray:"3 3"}),(0,x.jsx)(f.W,{dataKey:"mes"}),(0,x.jsx)(A.h,{}),(0,x.jsx)(k.m,{formatter:e=>"$".concat(e.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}))}),(0,x.jsx)(v.s,{}),z()&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(b.e,{x:z(),stroke:"#9e9e9e",strokeWidth:2,strokeDasharray:"3 3",label:{value:"Estimado",position:"top",fill:"#9e9e9e"}}),(0,x.jsx)(w.T,{x1:z(),fill:"#e3f2fd",fillOpacity:.3})]}),(()=>{const e=B()>0;switch(F){case"ingresos":return e?(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(g.N,{dataKey:"ingresos",stroke:"#2e7d32",strokeWidth:2,name:"Ingresos",dot:!1})}):(0,x.jsx)(g.N,{type:"monotone",dataKey:"ingresos",stroke:"#4caf50",strokeWidth:2,name:"Ingresos"});case"egresos":return e?(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(g.N,{dataKey:"egresos",stroke:"#c62828",strokeWidth:2,name:"Egresos",dot:!1})}):(0,x.jsx)(g.N,{type:"monotone",dataKey:"egresos",stroke:"#f44336",strokeWidth:2,name:"Egresos"});case"balance":return e?(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(g.N,{dataKey:"balance",stroke:"#1565c0",strokeWidth:2,name:"Balance",dot:!1})}):(0,x.jsx)(g.N,{type:"monotone",dataKey:"balance",stroke:"#2196f3",strokeWidth:2,name:"Balance"});default:return e?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(g.N,{dataKey:"ingresos",stroke:"#2e7d32",strokeWidth:2,name:"Ingresos",dot:!1}),(0,x.jsx)(g.N,{dataKey:"egresos",stroke:"#c62828",strokeWidth:2,name:"Egresos",dot:!1}),(0,x.jsx)(g.N,{dataKey:"balance",stroke:"#1565c0",strokeWidth:2,name:"Balance",dot:!1})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(g.N,{type:"monotone",dataKey:"ingresos",stroke:"#4caf50",strokeWidth:2,name:"Ingresos"}),(0,x.jsx)(g.N,{type:"monotone",dataKey:"egresos",stroke:"#f44336",strokeWidth:2,name:"Egresos"}),(0,x.jsx)(g.N,{type:"monotone",dataKey:"balance",stroke:"#2196f3",strokeWidth:2,name:"Balance"})]})}})()]})})]}),0===R.length&&(0,x.jsx)(n.A,{severity:"warning",children:"Este pron\xf3stico no tiene datos disponibles."})]}):(0,x.jsxs)(t.A,{sx:{p:3},children:[(0,x.jsx)(n.A,{severity:"warning",children:"No se encontr\xf3 el pron\xf3stico solicitado."}),(0,x.jsx)(a.A,{startIcon:(0,x.jsx)(m,{}),onClick:()=>s("/pronostico-fijo"),sx:{mt:2},children:"Volver"})]})}}}]);
//# sourceMappingURL=9133.051ce4e9.chunk.js.map