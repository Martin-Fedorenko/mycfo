"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5473],{45473:(e,o,n)=>{n.r(o),n.d(o,{default:()=>K});var i=n(89379),t=n(65043),s=n(53969),r=n(55895),a=n(94799),c=n(70298),l=n(94527),d=n(26020),x=n(11840),m=n(82332),u=n(10256),h=n(3353),A=n(9446),f=n(88889),g=n(24343),j=n(3241),p=n(12097),v=n(91449),b=n(53089),y=n(80172),C=n(56465),S=n(63745),w=n(69302),z=n(93201),I=n(40042),E=n(91244),D=n(16128),k=n(76072),M=n(26529),W=n(56647),R=n(26392),T=n(91921),L=n(6013),O=n(92248),P=n(70579);function B(e){let{movimiento:o,selected:n=!1,onClick:i,onDesvincular:t}=e;const a=e=>"Ingreso"===e?"#2e7d32":"Egreso"===e?"#d32f2f":"#757575",l=e=>"MERCADOPAGO"===e?"#00b0ff":"EXCEL"===e?"#4caf50":"#9e9e9e";return(0,P.jsx)(E.A,{sx:{mb:2,cursor:"pointer",border:n?"2px solid #1976d2":"1px solid #e0e0e0",backgroundColor:n?"#e3f2fd":"#fff",transition:"all 0.2s ease","&:hover":{boxShadow:4,transform:"translateY(-2px)"}},onClick:i,children:(0,P.jsxs)(D.A,{children:[(0,P.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,P.jsxs)(s.A,{sx:{flex:1},children:[(0,P.jsxs)(c.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[(0,P.jsx)(k.A,{icon:(m=o.tipo,"Ingreso"===m?(0,P.jsx)(L.A,{fontSize:"small"}):"Egreso"===m?(0,P.jsx)(O.A,{fontSize:"small"}):(0,P.jsx)(T.A,{fontSize:"small"})),label:o.tipo||"Sin tipo",size:"small",sx:{backgroundColor:"".concat(a(o.tipo),"15"),color:a(o.tipo),fontWeight:"bold",border:"1px solid ".concat(a(o.tipo))}}),(0,P.jsx)(r.A,{variant:"h6",sx:{color:a(o.tipo),fontWeight:"bold"},children:(x=o.montoTotal,x?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(Math.abs(x)):"$0")})]}),(0,P.jsx)(r.A,{variant:"body2",color:"text.primary",sx:{mb:.5,fontWeight:500},children:o.descripcion||"Sin descripci\xf3n"}),(o.origen||o.destino)&&(0,P.jsxs)(r.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Egreso"===o.tipo&&o.destino&&"Para: ".concat(o.destino),"Ingreso"===o.tipo&&o.origen&&"De: ".concat(o.origen),"Egreso"!==o.tipo&&"Ingreso"!==o.tipo&&(o.origen||o.destino)]}),(0,P.jsxs)(c.A,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:.5},children:[(0,P.jsx)(k.A,{label:(d=o.fechaEmision,d?new Date(d).toLocaleDateString("es-AR"):"-"),size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}}),o.categoria&&(0,P.jsx)(k.A,{label:o.categoria,size:"small",variant:"outlined",color:"primary",sx:{fontSize:"0.75rem"}}),o.fuenteOrigen&&(0,P.jsx)(k.A,{label:o.fuenteOrigen,size:"small",sx:{fontSize:"0.75rem",backgroundColor:"".concat(l(o.fuenteOrigen),"15"),color:l(o.fuenteOrigen),fontWeight:500}})]})]}),(0,P.jsx)(s.A,{sx:{ml:2,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:o.conciliado?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(M.A,{title:"Conciliado con ".concat(o.tipoDocumentoConciliado," ").concat(o.numeroDocumentoConciliado),children:(0,P.jsx)(z.A,{sx:{color:"#4caf50",fontSize:32}})}),t&&(0,P.jsx)(M.A,{title:"Desvincular",children:(0,P.jsx)(W.A,{size:"small",onClick:e=>{e.stopPropagation(),t(o.id)},sx:{mt:.5},children:(0,P.jsx)(R.A,{fontSize:"small",color:"error"})})})]}):(0,P.jsx)(k.A,{label:"Sin conciliar",size:"small",color:"warning",variant:"outlined"})})]}),o.conciliado&&(0,P.jsx)(s.A,{sx:{mt:1,pt:1,borderTop:"1px solid #e0e0e0",backgroundColor:"#f5f5f5",p:1,borderRadius:1},children:(0,P.jsxs)(r.A,{variant:"caption",color:"text.secondary",children:["Conciliado con:"," ",(0,P.jsxs)("strong",{children:[o.tipoDocumentoConciliado," ",o.numeroDocumentoConciliado]})]})})]})});var d,x,m}var F=n(47951),N=n(39073),V=n(27601),q=n(96659);function G(e){let{documento:o,onVincular:n}=e;const i=e=>"FACTURA"===e?"#1976d2":"PAGARE"===e?"#f57c00":"RECIBO"===e?"#388e3c":"#757575",t=e=>"ALTA"===e?"#4caf50":"MEDIA"===e?"#ff9800":"#9e9e9e";return(0,P.jsx)(E.A,{sx:{mb:2,border:"ALTA"===o.nivelSugerencia?"2px solid #4caf50":"1px solid #e0e0e0",backgroundColor:"ALTA"===o.nivelSugerencia?"#f1f8e9":"#fff",transition:"all 0.2s ease","&:hover":{boxShadow:4,transform:"translateY(-2px)"}},children:(0,P.jsxs)(D.A,{children:[(0,P.jsx)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:(0,P.jsxs)(s.A,{sx:{flex:1},children:[(0,P.jsxs)(c.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[(0,P.jsx)(k.A,{icon:(0,P.jsx)(F.A,{fontSize:"small"}),label:o.tipoDocumento,size:"small",sx:{backgroundColor:"".concat(i(o.tipoDocumento),"15"),color:i(o.tipoDocumento),fontWeight:"bold",border:"1px solid ".concat(i(o.tipoDocumento))}}),"ALTA"===o.nivelSugerencia&&(0,P.jsx)(M.A,{title:"Alta coincidencia",children:(0,P.jsx)(V.A,{sx:{color:"#ffc107",fontSize:20}})})]}),(0,P.jsx)(r.A,{variant:"body1",sx:{fontWeight:600,mb:.5},children:o.numeroDocumento}),(0,P.jsxs)(c.A,{direction:"row",spacing:2,sx:{mb:1},children:[(0,P.jsx)(r.A,{variant:"body2",sx:{fontWeight:500,color:"#1976d2"},children:(l=o.montoTotal,l?new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(Math.abs(l)):"$0")}),(0,P.jsx)(r.A,{variant:"body2",color:"text.secondary",children:(a=o.fechaEmision,a?new Date(a).toLocaleDateString("es-AR"):"-")})]}),o.nombreRelacionado&&(0,P.jsx)(r.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:o.nombreRelacionado}),(0,P.jsxs)(c.A,{direction:"row",spacing:1,sx:{mb:1,flexWrap:"wrap",gap:.5},children:[o.categoria&&(0,P.jsx)(k.A,{label:o.categoria,size:"small",variant:"outlined",color:"primary",sx:{fontSize:"0.75rem"}}),o.cuit&&(0,P.jsx)(k.A,{label:"CUIT: ".concat(o.cuit),size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}})]}),(0,P.jsxs)(s.A,{sx:{mt:1,p:1,backgroundColor:"".concat(t(o.nivelSugerencia),"15"),borderRadius:1,border:"1px solid ".concat(t(o.nivelSugerencia))},children:[(0,P.jsxs)(c.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:.5},children:[(e=>{const o=Math.round(e/100*5),n=[];for(let i=0;i<5;i++)i<o?n.push((0,P.jsx)(V.A,{sx:{fontSize:16,color:"#ffc107"}},i)):n.push((0,P.jsx)(q.A,{sx:{fontSize:16,color:"#e0e0e0"}},i));return(0,P.jsx)(s.A,{sx:{display:"flex"},children:n})})(o.scoreCoincidencia),(0,P.jsxs)(r.A,{variant:"caption",sx:{fontWeight:600,color:t(o.nivelSugerencia)},children:[o.scoreCoincidencia,"% coincidencia"]})]}),(0,P.jsx)(r.A,{variant:"caption",color:"text.secondary",children:o.razonSugerencia})]})]})}),(0,P.jsx)(p.A,{variant:"ALTA"===o.nivelSugerencia?"contained":"outlined",color:"primary",startIcon:(0,P.jsx)(N.A,{}),fullWidth:!0,onClick:()=>n(o.idDocumento),sx:{mt:1},children:"Vincular"})]})});var a,l}var H=n(79722),U=n(13658);const Y="".concat(U.A.REGISTRO,"/api/conciliacion"),$={obtenerMovimientosSinConciliar:async()=>(await H.A.get("".concat(Y,"/movimientos/sin-conciliar"))).data,obtenerTodosLosMovimientos:async()=>(await H.A.get("".concat(Y,"/movimientos"))).data,obtenerSugerencias:async e=>(await H.A.get("".concat(Y,"/movimientos/").concat(e,"/sugerencias"))).data,vincularMovimiento:async(e,o)=>(await H.A.post("".concat(Y,"/vincular"),{movimientoId:e,documentoId:o})).data,desvincularMovimiento:async e=>(await H.A.post("".concat(Y,"/desvincular/").concat(e))).data,obtenerEstadisticas:async()=>(await H.A.get("".concat(Y,"/estadisticas"))).data},X=5,J=5;function K(){const[e,o]=(0,t.useState)([]),[n,E]=(0,t.useState)(null),[D,k]=(0,t.useState)([]),[M,W]=(0,t.useState)(!1),[R,T]=(0,t.useState)(!1),[L,O]=(0,t.useState)(null),[F,N]=(0,t.useState)(null),[V,q]=(0,t.useState)("sin-conciliar"),[H,U]=(0,t.useState)("todos"),[Y,K]=(0,t.useState)(""),[Q,Z]=(0,t.useState)(1),[_,ee]=(0,t.useState)(1);(0,t.useEffect)(()=>{Z(1)},[V,H,Y]);const oe=(0,t.useCallback)(async()=>{W(!0),N(null);try{let e;e="sin-conciliar"===V?await $.obtenerMovimientosSinConciliar():await $.obtenerTodosLosMovimientos(),o(e)}catch(e){console.error("Error cargando movimientos:",e),N("Error al cargar los movimientos")}finally{W(!1)}},[V]),ne=(0,t.useCallback)(async()=>{try{const e=await $.obtenerEstadisticas();O(e)}catch(e){console.error("Error cargando estad\xedsticas:",e)}},[]),ie=(0,t.useCallback)(async()=>{await Promise.all([oe(),ne()])},[oe,ne]);(0,t.useEffect)(()=>{ie()},[ie]),(0,t.useEffect)(()=>{oe()},[oe]);const te=e=>{E(e),ee(1),e.conciliado?(k([]),ee(1)):(async e=>{T(!0);try{const o=await $.obtenerSugerencias(e);k(o.sugerencias||[]),ee(1)}catch(o){console.error("Error cargando sugerencias:",o),k([]),ee(1)}finally{T(!1)}})(e.id)},se=async o=>{if(n)try{await $.vincularMovimiento(n.id,o),await ie();const t=e.find(e=>e.id===n.id);t&&E((0,i.A)((0,i.A)({},t),{},{conciliado:!0})),k([]),E(null)}catch(t){console.error("Error vinculando movimiento:",t),alert("Error al vincular el movimiento")}},re=async e=>{try{await $.desvincularMovimiento(e),await ie(),(null===n||void 0===n?void 0:n.id)===e&&(E(null),k([]),ee(1))}catch(o){console.error("Error desvinculando movimiento:",o),alert("Error al desvincular el movimiento")}},ae=e.filter(e=>{if("sin-conciliar"===V&&e.conciliado)return!1;if("conciliados"===V&&!e.conciliado)return!1;if("todos"!==H&&e.tipo!==H)return!1;if(Y){const o=Y.toLowerCase(),n=(e.descripcion||"").toLowerCase(),i=(e.origen||"").toLowerCase(),t=(e.destino||"").toLowerCase(),s=(e.categoria||"").toLowerCase();if(!n.includes(o)&&!i.includes(o)&&!t.includes(o)&&!s.includes(o))return!1}return!0}),ce=Math.max(1,Math.ceil(ae.length/X)),le=Math.max(1,Math.ceil(D.length/J));(0,t.useEffect)(()=>{Q>ce&&Z(ce||1)},[Q,ce]),(0,t.useEffect)(()=>{_>le&&ee(le||1)},[_,le]);const de=Math.min(Q,ce),xe=Math.min(_,le),me=ae.slice((de-1)*X,de*X),ue=D.slice((xe-1)*J,xe*J);return(0,P.jsxs)(s.A,{sx:{p:3,minHeight:"100vh",display:"flex",flexDirection:"column",gap:2},children:[(0,P.jsxs)(s.A,{sx:{mb:3},children:[(0,P.jsx)(r.A,{variant:"h4",gutterBottom:!0,sx:{fontWeight:600,color:"text.primary"},children:"Conciliaci\xf3n de Movimientos"}),(0,P.jsx)(r.A,{variant:"body2",sx:{color:"text.primary"},children:"Vincula tus movimientos bancarios con documentos comerciales"})]}),L&&(0,P.jsx)(a.A,{sx:{p:2,mb:3,backgroundColor:e=>{var o;return null!==(o=(e.vars||e).palette.background.level1)&&void 0!==o?o:(e.vars||e).palette.background.paper},border:e=>"1px solid ".concat((e.vars||e).palette.divider)},children:(0,P.jsxs)(c.A,{direction:"row",spacing:3,alignItems:"center",children:[(0,P.jsxs)(s.A,{sx:{flex:1},children:[(0,P.jsx)(r.A,{variant:"caption",color:"text.secondary",children:"Total de movimientos"}),(0,P.jsx)(r.A,{variant:"h5",sx:{fontWeight:600},children:L.total})]}),(0,P.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,P.jsxs)(s.A,{sx:{flex:1},children:[(0,P.jsx)(r.A,{variant:"caption",color:"text.secondary",children:"Sin conciliar"}),(0,P.jsx)(r.A,{variant:"h5",sx:{fontWeight:600,color:e=>(e.vars||e).palette.warning.main},children:L.sinConciliar})]}),(0,P.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,P.jsxs)(s.A,{sx:{flex:1},children:[(0,P.jsx)(r.A,{variant:"caption",color:"text.secondary",children:"Conciliados"}),(0,P.jsx)(r.A,{variant:"h5",sx:{fontWeight:600,color:e=>(e.vars||e).palette.success.main},children:L.conciliados})]}),(0,P.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,P.jsxs)(s.A,{sx:{flex:1},children:[(0,P.jsx)(r.A,{variant:"caption",color:"text.secondary",children:"Progreso"}),(0,P.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,P.jsx)(d.A,{variant:"determinate",value:L.porcentajeConciliado,sx:{flex:1,height:8,borderRadius:4}}),(0,P.jsxs)(r.A,{variant:"body2",sx:{fontWeight:600},children:[Math.round(L.porcentajeConciliado),"%"]})]})]})]})}),(0,P.jsxs)(a.A,{sx:{p:2,mb:2},children:[(0,P.jsxs)(c.A,{direction:"row",spacing:2,alignItems:"center",sx:{flexWrap:"wrap",gap:2},children:[(0,P.jsxs)(x.A,{value:V,exclusive:!0,onChange:(e,o)=>o&&q(o),size:"small",children:[(0,P.jsxs)(m.A,{value:"sin-conciliar",children:[(0,P.jsx)(I.A,{sx:{mr:.5,fontSize:18}}),"Sin conciliar"]}),(0,P.jsxs)(m.A,{value:"conciliados",children:[(0,P.jsx)(z.A,{sx:{mr:.5,fontSize:18}}),"Conciliados"]}),(0,P.jsx)(m.A,{value:"todos",children:"Todos"})]}),(0,P.jsx)(l.A,{orientation:"vertical",flexItem:!0}),(0,P.jsxs)(u.A,{size:"small",sx:{minWidth:120},children:[(0,P.jsx)(h.A,{children:"Tipo"}),(0,P.jsxs)(A.A,{value:H,onChange:e=>U(e.target.value),label:"Tipo",children:[(0,P.jsx)(f.A,{value:"todos",children:"Todos"}),(0,P.jsx)(f.A,{value:"Ingreso",children:"Ingreso"}),(0,P.jsx)(f.A,{value:"Egreso",children:"Egreso"})]})]}),(0,P.jsx)(g.A,{size:"small",placeholder:"Buscar...",value:Y,onChange:e=>K(e.target.value),InputProps:{startAdornment:(0,P.jsx)(j.A,{position:"start",children:(0,P.jsx)(S.A,{})})},sx:{flex:1,minWidth:200}}),(0,P.jsx)(p.A,{variant:"outlined",startIcon:(0,P.jsx)(w.A,{}),onClick:ie,size:"small",children:"Recargar"})]}),(0,P.jsx)(s.A,{sx:{mt:1},children:(0,P.jsxs)(r.A,{variant:"caption",color:"text.secondary",children:["Mostrando ",me.length," de"," ",ae.length," movimientos filtrados (pagina"," ",de,"/",ce,")"]})})]}),F&&(0,P.jsx)(v.A,{severity:"error",sx:{mb:2},children:F}),(0,P.jsx)(s.A,{sx:{flex:1,overflow:"hidden"},children:(0,P.jsxs)(b.A,{container:!0,spacing:2,sx:{height:"100%"},children:[(0,P.jsx)(b.A,{item:!0,xs:12,md:6,sx:{height:"100%"},children:(0,P.jsxs)(a.A,{sx:{p:2,height:"100%",minHeight:{xs:160,sm:180,md:210},display:"flex",flexDirection:"column"},children:[(0,P.jsx)(r.A,{variant:"h6",gutterBottom:!0,children:"Movimientos"}),(0,P.jsx)(l.A,{sx:{mb:2}}),M?(0,P.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:(0,P.jsx)(y.A,{})}):0===ae.length?(0,P.jsx)(s.A,{sx:{textAlign:"center",py:4},children:(0,P.jsx)(r.A,{variant:"body2",color:"text.secondary",children:"No hay movimientos que coincidan con los filtros"})}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(s.A,{sx:{flex:1,overflow:"auto",pr:1},children:me.map(e=>(0,P.jsx)(B,{movimiento:e,selected:(null===n||void 0===n?void 0:n.id)===e.id,onClick:()=>te(e),onDesvincular:re},e.id))}),ce>1&&(0,P.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,P.jsx)(C.A,{count:ce,page:de,onChange:(e,o)=>Z(o),color:"primary",size:"small"})})]})]})}),(0,P.jsx)(b.A,{item:!0,xs:12,md:6,sx:{height:"100%"},children:(0,P.jsxs)(a.A,{sx:{p:2,height:"100%",minHeight:{xs:160,sm:180,md:210},display:"flex",flexDirection:"column"},children:[(0,P.jsx)(r.A,{variant:"h6",gutterBottom:!0,children:"\ud83d\udca1 Documentos Sugeridos"}),(0,P.jsx)(l.A,{sx:{mb:2}}),n?n.conciliado?(0,P.jsxs)(s.A,{sx:{textAlign:"center",py:4},children:[(0,P.jsx)(z.A,{sx:{fontSize:64,color:"#4caf50",mb:2}}),(0,P.jsx)(r.A,{variant:"h6",gutterBottom:!0,children:"Movimiento ya conciliado"}),(0,P.jsxs)(r.A,{variant:"body2",color:"text.secondary",children:["Este movimiento ya est\xe1 vinculado con"," ",(0,P.jsxs)("strong",{children:[n.tipoDocumentoConciliado," ",n.numeroDocumentoConciliado]})]})]}):R?(0,P.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:(0,P.jsx)(y.A,{})}):0===D.length?(0,P.jsxs)(s.A,{sx:{textAlign:"center",py:4},children:[(0,P.jsx)(r.A,{variant:"body2",color:"text.secondary",children:"No se encontraron documentos sugeridos para este movimiento"}),(0,P.jsx)(r.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Puedes buscar manualmente un documento o crear uno nuevo"})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(v.A,{severity:"info",sx:{mb:2},children:["Se encontraron ",(0,P.jsx)("strong",{children:D.length})," ","documento(s) que podr\xedan corresponder a este movimiento"]}),(0,P.jsx)(s.A,{sx:{flex:1,overflow:"auto",pr:1},children:ue.map(e=>(0,P.jsx)(G,{documento:e,onVincular:se},e.idDocumento))}),le>1&&(0,P.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,P.jsx)(C.A,{count:le,page:xe,onChange:(e,o)=>ee(o),color:"primary",size:"small"})})]}):(0,P.jsx)(s.A,{sx:{textAlign:"center",py:4},children:(0,P.jsx)(r.A,{variant:"body2",color:"text.secondary",children:"Selecciona un movimiento de la izquierda para ver sugerencias de documentos"})})]})})]})})]})}}}]);
//# sourceMappingURL=5473.291f6c86.chunk.js.map